!function(e,a){for(var i in a)e[i]=a[i]}(window,function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="lib/assets/build/",__webpack_require__(__webpack_require__.s=19)}([function(module,exports,__webpack_require__){var lodash;try{lodash=__webpack_require__(5)}catch(e){}lodash=lodash||window._,module.exports=lodash},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),Graph=__webpack_require__(3).Graph;function addDummyNode(g,type,attrs,name){for(var v;v=_.uniqueId(name),g.hasNode(v););return attrs.dummy=type,g.setNode(v,attrs),v}function maxRank(g){return _.max(_.map(g.nodes(),function(v){var rank=g.node(v).rank;if(!_.isUndefined(rank))return rank}))}module.exports={addDummyNode:addDummyNode,simplify:function(g){var simplified=(new Graph).setGraph(g.graph());return _.each(g.nodes(),function(v){simplified.setNode(v,g.node(v))}),_.each(g.edges(),function(e){var simpleLabel=simplified.edge(e.v,e.w)||{weight:0,minlen:1},label=g.edge(e);simplified.setEdge(e.v,e.w,{weight:simpleLabel.weight+label.weight,minlen:Math.max(simpleLabel.minlen,label.minlen)})}),simplified},asNonCompoundGraph:function(g){var simplified=new Graph({multigraph:g.isMultigraph()}).setGraph(g.graph());return _.each(g.nodes(),function(v){g.children(v).length||simplified.setNode(v,g.node(v))}),_.each(g.edges(),function(e){simplified.setEdge(e,g.edge(e))}),simplified},successorWeights:function(g){var weightMap=_.map(g.nodes(),function(v){var sucs={};return _.each(g.outEdges(v),function(e){sucs[e.w]=(sucs[e.w]||0)+g.edge(e).weight}),sucs});return _.zipObject(g.nodes(),weightMap)},predecessorWeights:function(g){var weightMap=_.map(g.nodes(),function(v){var preds={};return _.each(g.inEdges(v),function(e){preds[e.v]=(preds[e.v]||0)+g.edge(e).weight}),preds});return _.zipObject(g.nodes(),weightMap)},intersectRect:function(rect,point){var sx,sy,x=rect.x,y=rect.y,dx=point.x-x,dy=point.y-y,w=rect.width/2,h=rect.height/2;if(!dx&&!dy)throw new Error("Not possible to find intersection inside of the rectangle");sy=Math.abs(dy)*w>Math.abs(dx)*h?(dy<0&&(h=-h),sx=h*dx/dy,h):(dx<0&&(w=-w),(sx=w)*dy/dx);return{x:x+sx,y:y+sy}},buildLayerMatrix:function(g){var layering=_.map(_.range(maxRank(g)+1),function(){return[]});return _.each(g.nodes(),function(v){var node=g.node(v),rank=node.rank;_.isUndefined(rank)||(layering[rank][node.order]=v)}),layering},normalizeRanks:function(g){var min=_.min(_.map(g.nodes(),function(v){return g.node(v).rank}));_.each(g.nodes(),function(v){var node=g.node(v);_.has(node,"rank")&&(node.rank-=min)})},removeEmptyRanks:function(g){var offset=_.min(_.map(g.nodes(),function(v){return g.node(v).rank})),layers=[];_.each(g.nodes(),function(v){var rank=g.node(v).rank-offset;layers[rank]||(layers[rank]=[]),layers[rank].push(v)});var delta=0,nodeRankFactor=g.graph().nodeRankFactor;_.each(layers,function(vs,i){_.isUndefined(vs)&&i%nodeRankFactor!=0?--delta:delta&&_.each(vs,function(v){g.node(v).rank+=delta})})},addBorderNode:function(g,prefix,rank,order){var node={width:0,height:0};4<=arguments.length&&(node.rank=rank,node.order=order);return addDummyNode(g,"border",node,prefix)},maxRank:maxRank,partition:function(collection,fn){var result={lhs:[],rhs:[]};return _.each(collection,function(value){fn(value)?result.lhs.push(value):result.rhs.push(value)}),result},time:function(name,fn){var start=_.now();try{return fn()}finally{console.log(name+" time: "+(_.now()-start)+"ms")}},notime:function(name,fn){return fn()}}},function(module,exports,__webpack_require__){var lodash;try{lodash=__webpack_require__(5)}catch(e){}lodash=lodash||window._,module.exports=lodash},function(module,exports,__webpack_require__){var graphlib;try{graphlib=__webpack_require__(11)}catch(e){}graphlib=graphlib||window.graphlib,module.exports=graphlib},function(module,exports){module.exports=function(module){return module.webpackPolyfill||(module.deprecate=function(){},module.paths=[],module.children||(module.children=[]),Object.defineProperty(module,"loaded",{enumerable:!0,get:function(){return module.l}}),Object.defineProperty(module,"id",{enumerable:!0,get:function(){return module.i}}),module.webpackPolyfill=1),module}},function(module,exports,__webpack_require__){(function(module,global){var __WEBPACK_AMD_DEFINE_RESULT__;
/**
 * @license
 * lodash 3.10.1 (Custom Build) <https://lodash.com/>
 * Build: `lodash modern -d -o ./index.js`
 * Copyright 2012-2015 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */(function(){var undefined,upper,lower,VERSION="3.10.1",BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=150,HOT_SPAN=16,LARGE_ARRAY_SIZE=200,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,FUNC_ERROR_TEXT="Expected a function",PLACEHOLDER="__lodash_placeholder__",argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,reRegExpChars=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,reHasRegExpChars=RegExp(reRegExpChars.source),reComboMark=/[\u0300-\u036f\ufe20-\ufe23]/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reHasHexPrefix=/^0[xX]/,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^\d+$/,reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,reWords=(upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+",RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")),contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags["[object Map]"]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags["[object Set]"]=typedArrayTags[stringTag]=typedArrayTags["[object WeakMap]"]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags["[object Map]"]=cloneableTags["[object Set]"]=cloneableTags["[object WeakMap]"]=!1;var deburredLetters={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},objectTypes={function:!0,object:!0},regexpEscapes={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global&&global.Object&&global,freeSelf=objectTypes[typeof self]&&self&&self.Object&&self,freeWindow=objectTypes[typeof window]&&window&&window.Object&&window,root=(freeModule&&freeModule.exports,freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||freeSelf||this);function baseCompareAscending(value,other){if(value!==other){var valIsNull=null===value,valIsUndef=value===undefined,valIsReflexive=value==value,othIsNull=null===other,othIsUndef=other===undefined,othIsReflexive=other==other;if(other<value&&!othIsNull||!valIsReflexive||valIsNull&&!othIsUndef&&othIsReflexive||valIsUndef&&othIsReflexive)return 1;if(value<other&&!valIsNull||!othIsReflexive||othIsNull&&!valIsUndef&&valIsReflexive||othIsUndef&&valIsReflexive)return-1}return 0}function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){if(value!=value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function baseIsFunction(value){return"function"==typeof value||!1}function baseToString(value){return null==value?"":value+""}function charsLeftIndex(string,chars){for(var index=-1,length=string.length;++index<length&&-1<chars.indexOf(string.charAt(index)););return index}function charsRightIndex(string,chars){for(var index=string.length;index--&&-1<chars.indexOf(string.charAt(index)););return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeRegExpChar(chr,leadingChar,whitespaceChar){return leadingChar?chr=regexpEscapes[chr]:whitespaceChar&&(chr=stringEscapes[chr]),"\\"+chr}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!=other)return index}return-1}function isObjectLike(value){return!!value&&"object"==typeof value}function isSpace(charCode){return charCode<=160&&9<=charCode&&charCode<=13||32==charCode||160==charCode||5760==charCode||6158==charCode||8192<=charCode&&(charCode<=8202||8232==charCode||8233==charCode||8239==charCode||8287==charCode||12288==charCode||65279==charCode)}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}function trimmedLeftIndex(string){for(var index=-1,length=string.length;++index<length&&isSpace(string.charCodeAt(index)););return index}function trimmedRightIndex(string){for(var index=string.length;index--&&isSpace(string.charCodeAt(index)););return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}var _=function runInContext(context){var Array=(context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root).Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,objToString=objectProto.toString,oldDash=root._,reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ArrayBuffer=context.ArrayBuffer,clearTimeout=context.clearTimeout,parseFloat=context.parseFloat,pow=Math.pow,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=getNative(context,"Set"),setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=context.Uint8Array,WeakMap=getNative(context,"WeakMap"),nativeCeil=Math.ceil,nativeCreate=getNative(Object,"create"),nativeFloor=Math.floor,nativeIsArray=getNative(Array,"isArray"),nativeIsFinite=context.isFinite,nativeKeys=getNative(Object,"keys"),nativeMax=Math.max,nativeMin=Math.min,nativeNow=getNative(Date,"now"),nativeParseInt=context.parseInt,nativeRandom=Math.random,NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY,MAX_ARRAY_INDEX=4294967294,HALF_MAX_ARRAY_LENGTH=2147483647,MAX_SAFE_INTEGER=9007199254740991,metaMap=WeakMap&&new WeakMap,realNames={};function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value,this.__actions__=actions||[],this.__chain__=!!chainAll}lodash.support={};function LazyWrapper(value){this.__wrapped__=value,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=POSITIVE_INFINITY,this.__views__=[]}function MapCache(){this.__data__={}}function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set};length--;)this.push(values[length])}function cacheIndexOf(cache,value){var data=cache.data;return("string"==typeof value||isObject(value)?data.set.has(value):data.hash[value])?0:-1}function arrayCopy(source,array){var index=-1,length=source.length;for(array=array||Array(length);++index<length;)array[index]=source[index];return array}function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;for(initFromArray&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function assignOwnDefaults(objectValue,sourceValue,key,object){return objectValue!==undefined&&hasOwnProperty.call(object,key)?objectValue:sourceValue}function assignWith(object,source,customizer){for(var index=-1,props=keys(source),length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result==result?result===value:value!=value)&&(value!==undefined||key in object)||(object[key]=result)}return object}function baseAssign(object,source){return null==source?object:baseCopy(source,keys(source),object)}function baseAt(collection,props){for(var index=-1,isNil=null==collection,isArr=!isNil&&isArrayLike(collection),length=isArr?collection.length:0,propsLength=props.length,result=Array(propsLength);++index<propsLength;){var key=props[index];result[index]=isArr?isIndex(key,length)?collection[key]:undefined:isNil?undefined:collection[key]}return result}function baseCopy(source,props,object){object=object||{};for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;return"function"==type?thisArg===undefined?func:bindCallback(func,thisArg,argCount):null==func?identity:"object"==type?baseMatches(func):thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer&&(result=object?customizer(value,key,object):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=function(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}(value),!isDeep)return arrayCopy(value,result)}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?function(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}(value,tag,isDeep):object?value:{};if(result=function(object){var Ctor=object.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor||(Ctor=Object),new Ctor}(isFunc?{}:value),!isDeep)return baseAssign(result,value)}stackB=stackB||[];for(var length=(stackA=stackA||[]).length;length--;)if(stackA[length]==value)return stackB[length];return stackA.push(value),stackB.push(result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)}),result}lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};var baseCreate=function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}};function object(){}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length)return result;var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=LARGE_ARRAY_SIZE?createCache(values):null,valuesLength=values.length;cache&&(indexOf=cacheIndexOf,isCommon=!1,values=cache);outer:for(;++index<length;){var value=array[index];if(isCommon&&value==value){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===value)continue outer;result.push(value)}else indexOf(values,value,0)<0&&result.push(value)}return result}var baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0);function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){if(predicate(value,key,collection))return result=retKey?key:value,!1}),result}function baseFlatten(array,isDeep,isStrict,result){result=result||[];for(var index=-1,length=array.length;++index<length;){var value=array[index];isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))?isDeep?baseFlatten(value,isDeep,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var baseFor=createBaseFor(),baseForRight=createBaseFor(!0);function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){for(var index=-1,length=props.length,resIndex=-1,result=[];++index<length;){var key=props[index];isFunction(object[key])&&(result[++resIndex]=key)}return result}function baseGet(object,path,pathKey){if(null!=object){pathKey!==undefined&&pathKey in toObject(object)&&(path=[pathKey]);for(var index=0,length=path.length;null!=object&&index<length;)object=object[path[index++]];return index&&index==length?object:undefined}}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){return value===other||(null==value||null==other||!isObject(value)&&!isObjectLike(other)?value!=value&&other!=other:function(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||((objTag=objToString.call(object))==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||((othTag=objToString.call(other))==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return function(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return!1}(object,other,objTag);if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped)return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackB=stackB||[];for(var length=(stackA=stackA||[]).length;length--;)if(stackA[length]==object)return stackB[length]==other;stackA.push(object),stackB.push(other);var result=(objIsArr?function(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&arrLength<othLength))return!1;for(;++index<arrLength;){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result)continue;return!1}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)}))return!1}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))return!1}return!0}:function(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othLength=keys(other).length;if(objLength!=othLength&&!isLoose)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key)))return!1}for(var skipCtor=isLoose;++index<objLength;){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result))return!1;skipCtor=skipCtor||"constructor"==key}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0})(object,other,equalFunc,customizer,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}(value,other,baseIsEqual,customizer,isLoose,stackA,stackB))}function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=toObject(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object))return!1}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,!0):result))return!1}}return!0}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var matchData=getMatchData(source);if(1==matchData.length&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){return null!=object&&object[key]===value&&(value!==undefined||key in toObject(object))}}return function(object){return baseIsMatch(object,matchData)}}function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";return path=toPath(path),function(object){if(null==object)return!1;var key=pathKey;if(object=toObject(object),(isArr||!isCommon)&&!(key in object)){if(null==(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1))))return!1;key=last(path),object=toObject(object)}return object[key]===srcValue?srcValue!==undefined||key in object:baseIsEqual(srcValue,object[key],undefined,!0)}}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePullAt(array,indexes){for(var length=array?indexes.length:0;length--;){var index=indexes[length];if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return array}function baseRandom(min,max){return min+nativeFloor(nativeRandom()*(max-min+1))}var baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity;function baseSlice(array,start,end){var index=-1,length=array.length;(start=null==start?0:+start||0)<0&&(start=length<-start?0:length+start),(end=end===undefined||length<end?length:+end||0)<0&&(end+=length),length=end<start?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return!(result=predicate(value,index,collection))}),!!result}function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}function baseSortByOrder(collection,iteratees,orders){var callback=getCallback(),index=-1;return iteratees=arrayMap(iteratees,function(iteratee){return callback(iteratee)}),baseSortBy(baseMap(collection,function(value){return{criteria:arrayMap(iteratees,function(iteratee){return iteratee(value)}),index:++index,value:value}}),function(object,other){return function(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result){if(ordersLength<=index)return result;var order=orders[index];return result*("asc"===order||!0===order?1:-1)}}return object.index-other.index}(object,other,orders)})}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&LARGE_ARRAY_SIZE<=length,seen=isLarge?createCache():null,result=[];seen?(indexOf=cacheIndexOf,isCommon=!1):(isLarge=!1,seen=iteratee?[]:result);outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value==value){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else indexOf(seen,computed,0)<0&&((iteratee||isLarge)&&seen.push(computed),result.push(value))}return result}function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;result instanceof LazyWrapper&&(result=result.value());for(var index=-1,length=actions.length;++index<length;){var action=actions[index];result=action.func.apply(action.thisArg,arrayPush([result],action.args))}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if("number"==typeof value&&value==value&&high<=HALF_MAX_ARRAY_LENGTH){for(;low<high;){var mid=low+high>>>1,computed=array[mid];(retHighest?computed<=value:computed<value)&&null!==computed?low=1+mid:high=mid}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=array?array.length:0,valIsNaN=value!=value,valIsNull=null===value,valIsUndef=value===undefined;low<high;){var mid=nativeFloor((low+high)/2),computed=iteratee(array[mid]),isDef=computed!==undefined,isReflexive=computed==computed;if(valIsNaN)var setLow=isReflexive||retHighest;else setLow=valIsNull?isReflexive&&isDef&&(retHighest||null!=computed):valIsUndef?isReflexive&&(retHighest||isDef):null!=computed&&(retHighest?computed<=value:computed<value);setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if(thisArg===undefined)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){var result=new ArrayBuffer(buffer.byteLength);return new Uint8Array(result).set(new Uint8Array(buffer)),result}function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};if(iteratee=getCallback(iteratee,thisArg,3),isArray(collection))for(var index=-1,length=collection.length;++index<length;){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}else baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)});return result}}function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=null==object?0:sources.length,customizer=2<length?sources[length-2]:undefined,guard=2<length?sources[2]:undefined,thisArg=1<length?sources[length-1]:undefined;for("function"==typeof customizer?(customizer=bindCallback(customizer,thisArg,5),length-=2):length-=(customizer="function"==typeof thisArg?thisArg:undefined)?1:0,guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?undefined:customizer,length=1);++index<length;){var source=sources[index];source&&assigner(object,source,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length))return eachFunc(collection,iteratee);for(var index=fromRight?length:-1,iterable=toObject(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;fromRight?index--:++index<length;){var key=props[index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}function createCache(values){return nativeCreate&&Set?new SetCache(values):null}function createCompounder(callback){return function(string){for(var index=-1,array=words(deburr(string)),length=array.length,result="";++index<length;)result=callback(result,array[index],index);return result}}function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurry(flag){return function curryFunc(func,arity,guard){guard&&isIterateeCall(func,arity,guard)&&(arity=undefined);var result=createWrapper(func,flag,undefined,undefined,undefined,undefined,undefined,arity);return result.placeholder=curryFunc.placeholder,result}}function createDefaults(assigner,customizer){return restParam(function(args){var object=args[0];return null==object?object:(args.push(customizer),assigner.apply(undefined,args))})}function createExtremum(comparator,exValue){return function(collection,iteratee,thisArg){if(thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined),1==(iteratee=getCallback(iteratee,thisArg,3)).length){var result=function(array,iteratee,comparator,exValue){for(var index=-1,length=array.length,computed=exValue,result=computed;++index<length;){var value=array[index],current=+iteratee(value);comparator(current,computed)&&(computed=current,result=value)}return result}(collection=isArray(collection)?collection:toIterable(collection),iteratee,comparator,exValue);if(!collection.length||result!==exValue)return result}return function(collection,iteratee,comparator,exValue){var computed=exValue,result=computed;return baseEach(collection,function(value,index,collection){var current=+iteratee(value,index,collection);(comparator(current,computed)||current===exValue&&current===result)&&(computed=current,result=value)}),result}(collection,iteratee,comparator,exValue)}}function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){if(predicate=getCallback(predicate,thisArg,3),isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return-1<index?collection[index]:undefined}return baseFind(collection,predicate,eachFunc)}}function createFindIndex(fromRight){return function(array,predicate,thisArg){return array&&array.length?baseFindIndex(array,predicate=getCallback(predicate,thisArg,3),fromRight):-1}}function createFindKey(objectFunc){return function(object,predicate,thisArg){return baseFind(object,predicate=getCallback(predicate,thisArg,3),objectFunc,!0)}}function createFlow(fromRight){return function(){for(var wrapper,length=arguments.length,index=fromRight?length:-1,leftIndex=0,funcs=Array(length);fromRight?index--:++index<length;){var func=funcs[leftIndex++]=arguments[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);!wrapper&&LodashWrapper.prototype.thru&&"wrapper"==getFuncName(func)&&(wrapper=new LodashWrapper([],!0))}for(index=wrapper?-1:length;++index<length;){var funcName=getFuncName(func=funcs[index]),data="wrapper"==funcName?getData(func):undefined;wrapper=data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments,value=args[0];if(wrapper&&1==args.length&&isArray(value)&&value.length>=LARGE_ARRAY_SIZE)return wrapper.plant(value).value();for(var index=0,result=length?funcs[index].apply(this,args):value;++index<length;)result=funcs[index].call(this,result);return result}}}function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}function createForIn(objectFunc){return function(object,iteratee,thisArg){return"function"==typeof iteratee&&thisArg===undefined||(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee,keysIn)}}function createForOwn(objectFunc){return function(object,iteratee,thisArg){return"function"==typeof iteratee&&thisArg===undefined||(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee)}}function createObjectMapper(isMapKeys){return function(object,iteratee,thisArg){var result={};return iteratee=getCallback(iteratee,thisArg,3),baseForOwn(object,function(value,key,object){var mapped=iteratee(value,key,object);value=isMapKeys?value:mapped,result[key=isMapKeys?mapped:key]=value}),result}}function createPadDir(fromRight){return function(string,length,chars){return string=baseToString(string),(fromRight?string:"")+createPadding(string,length,chars)+(fromRight?"":string)}}function createPartial(flag){var partialFunc=restParam(function(func,partials){var holders=replaceHolders(partials,partialFunc.placeholder);return createWrapper(func,flag,undefined,partials,holders)});return partialFunc}function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):function(collection,iteratee,accumulator,initFromCollection,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}(collection,getCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);return function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if((length-=argsHolders.length)<arity){var newArgPos=argPos?arrayCopy(argPos):undefined,newArity=nativeMax(arity-length,0);bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG),isCurryBound||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,isCurry?args:undefined,isCurry?argsHolders:undefined,isCurry?undefined:args,isCurry?undefined:argsHolders,newArgPos,ary,newArity],result=createHybridWrapper.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;return argPos&&(args=function(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}(args,argPos)),isAry&&ary<args.length&&(args.length=ary),this&&this!==root&&this instanceof wrapper&&(fn=Ctor||createCtorWrapper(func)),fn.apply(thisBinding,args)}}function createPadding(string,length,chars){var strLength=string.length;if((length=+length)<=strLength||!nativeIsFinite(length))return"";var padLength=length-strLength;return repeat(chars=null==chars?" ":chars+"",nativeCeil(padLength/chars.length)).slice(0,padLength)}function createRound(methodName){var func=Math[methodName];return function(number,precision){return(precision=precision===undefined?0:+precision||0)?(precision=pow(10,precision),func(number*precision)/precision):func(number)}}function createSortedIndex(retHighest){return function(array,value,iteratee,thisArg){var callback=getCallback(iteratee);return null==iteratee&&callback===baseCallback?binaryIndex(array,value,retHighest):binaryIndexBy(array,value,callback(iteratee,thisArg,1),retHighest)}}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=undefined),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var data=isBindKey?undefined:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&(function(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=newBitmask<ARY_FLAG,isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(isCommon||isCombo){srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}(value=source[5])&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])),(value=source[7])&&(data[7]=arrayCopy(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask}}(newData,data),bitmask=newData[1],arity=newData[9]),newData[9]=null==arity?isBindKey?0:func.length:nativeMax(arity-length,0)||0,bitmask==BIND_FLAG)var result=function(func,thisArg){var Ctor=createCtorWrapper(func);return function wrapper(){return(this&&this!==root&&this instanceof wrapper?Ctor:func).apply(thisArg,arguments)}}(newData[0],newData[2]);else result=bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||newData[4].length?createHybridWrapper.apply(undefined,newData):function(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength);++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];return(this&&this!==root&&this instanceof wrapper?Ctor:func).apply(isBind?thisArg:this,args)}}.apply(undefined,newData);return(data?baseSetData:setData)(result,newData)}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;return result=result===callback?baseCallback:result,argCount?result(func,thisArg,argCount):result}var getData=metaMap?function(func){return metaMap.get(func)}:noop;function getFuncName(func){for(var result=func.name,array=realNames[result],length=array?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;return result=result===indexOf?baseIndexOf:result,collection?result(collection,target,fromIndex):result}var getLength=baseProperty("length");function getMatchData(object){for(var result=pairs(object),length=result.length;length--;)result[length][2]=isStrictComparable(result[length][1]);return result}function getNative(object,key){var value=null==object?undefined:object[key];return isNative(value)?value:undefined}function invokePath(object,path,args){null==object||isKey(path,object)||(object=1==(path=toPath(path)).length?object:baseGet(object,baseSlice(path,0,-1)),path=last(path));var func=null==object?object:object[path];return null==func?undefined:func.apply(object,args)}function isArrayLike(value){return null!=value&&isLength(getLength(value))}function isIndex(value,length){return value="number"==typeof value||reIsUint.test(value)?+value:-1,length=null==length?MAX_SAFE_INTEGER:length,-1<value&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object){var other=object[index];return value==value?value===other:other!=other}return!1}function isKey(value,object){var type=typeof value;return!!("string"==type&&reIsPlainProp.test(value)||"number"==type)||!isArray(value)&&(!reIsDeepProp.test(value)||null!=object&&value in toObject(object))}function isLaziable(func){var funcName=getFuncName(func);if(!(funcName in LazyWrapper.prototype))return!1;var other=lodash[funcName];if(func===other)return!0;var data=getData(other);return!!data&&func===data[0]}function isLength(value){return"number"==typeof value&&-1<value&&value%1==0&&value<=MAX_SAFE_INTEGER}function isStrictComparable(value){return value==value&&!isObject(value)}function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}var count,lastCalled,setData=(lastCalled=count=0,function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,0<remaining){if(++count>=HOT_COUNT)return key}else count=0;return baseSetData(key,value)});function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}function toIterable(value){return null==value?[]:isArrayLike(value)?isObject(value)?value:Object(value):values(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value))return value;var result=[];return baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}var difference=restParam(function(array,values){return isObjectLike(array)&&isArrayLike(array)?baseDifference(array,baseFlatten(values,!1,!0)):[]});function drop(array,n,guard){return array&&array.length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,n<0?0:n)):[]}function dropRight(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0,(n=length-(+n||0))<0?0:n)):[]}var findIndex=createFindIndex(),findLastIndex=createFindIndex(!0);function first(array){return array?array[0]:undefined}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;if("number"==typeof fromIndex)fromIndex=fromIndex<0?nativeMax(length+fromIndex,0):fromIndex;else if(fromIndex){var index=binaryIndex(array,value);return index<length&&(value==value?value===array[index]:array[index]!=array[index])?index:-1}return baseIndexOf(array,value,fromIndex||0)}var intersection=restParam(function(arrays){for(var othLength=arrays.length,othIndex=othLength,caches=Array(length),indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,result=[];othIndex--;){var value=arrays[othIndex]=isArrayLike(value=arrays[othIndex])?value:[];caches[othIndex]=isCommon&&120<=value.length?createCache(othIndex&&value):null}var array=arrays[0],index=-1,length=array?array.length:0,seen=caches[0];outer:for(;++index<length;)if(value=array[index],(seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){for(othIndex=othLength;--othIndex;){var cache=caches[othIndex];if((cache?cacheIndexOf(cache,value):indexOf(arrays[othIndex],value,0))<0)continue outer}seen&&seen.push(value),result.push(value)}return result});function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}var pullAt=restParam(function(array,indexes){var result=baseAt(array,indexes=baseFlatten(indexes));return basePullAt(array,indexes.sort(baseCompareAscending)),result});function rest(array){return drop(array,1)}var sortedIndex=createSortedIndex(),sortedLastIndex=createSortedIndex(!0);var union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))});function uniq(array,isSorted,iteratee,thisArg){if(!array||!array.length)return[];null!=isSorted&&"boolean"!=typeof isSorted&&(iteratee=isIterateeCall(array,isSorted,thisArg=iteratee)?undefined:isSorted,isSorted=!1);var callback=getCallback();return null==iteratee&&callback===baseCallback||(iteratee=callback(iteratee,thisArg,3)),isSorted&&getIndexOf()==baseIndexOf?function(array,iteratee){for(var seen,index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;index&&seen===computed||(seen=computed,result[++resIndex]=value)}return result}(array,iteratee):baseUniq(array,iteratee)}function unzip(array){if(!array||!array.length)return[];var index=-1,length=0;array=arrayFilter(array,function(group){if(isArrayLike(group))return length=nativeMax(group.length,length),!0});for(var result=Array(length);++index<length;)result[index]=arrayMap(array,baseProperty(index));return result}function unzipWith(array,iteratee,thisArg){if(!array||!array.length)return[];var result=unzip(array);return null==iteratee?result:(iteratee=bindCallback(iteratee,thisArg,4),arrayMap(result,function(group){return arrayReduce(group,iteratee,undefined,!0)}))}var without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]});var zip=restParam(unzip);function zipObject(props,values){var index=-1,length=props?props.length:0,result={};for(!length||values||isArray(props[0])||(values=[]);++index<length;){var key=props[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}var zipWith=restParam(function(arrays){var length=arrays.length,iteratee=2<length?arrays[length-2]:undefined,thisArg=1<length?arrays[length-1]:undefined;return 2<length&&"function"==typeof iteratee?length-=2:(iteratee=1<length&&"function"==typeof thisArg?(--length,thisArg):undefined,thisArg=undefined),arrays.length=length,unzipWith(arrays,iteratee,thisArg)});function chain(value){var result=lodash(value);return result.__chain__=!0,result}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}var wrapperConcat=restParam(function(values){return values=baseFlatten(values),this.thru(function(array){return function(array,other){for(var index=-1,length=array.length,othIndex=-1,othLength=other.length,result=Array(length+othLength);++index<length;)result[index]=array[index];for(;++othIndex<othLength;)result[index++]=other[othIndex];return result}(isArray(array)?array:[toObject(array)],values)})});var at=restParam(function(collection,props){return baseAt(collection,baseFlatten(props))}),countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1});function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=undefined),"function"==typeof predicate&&thisArg===undefined||(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}function filter(collection,predicate,thisArg){return(isArray(collection)?arrayFilter:baseFilter)(collection,predicate=getCallback(predicate,thisArg,3))}var find=createFind(baseEach),findLast=createFind(baseEachRight,!0);var forEach=createForEach(arrayEach,baseEach),forEachRight=createForEach(function(array,iteratee){for(var length=array.length;length--&&!1!==iteratee(array[length],length,array););return array},baseEachRight),groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]});function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;return isLength(length)||(length=(collection=values(collection)).length),fromIndex="number"!=typeof fromIndex||guard&&isIterateeCall(target,fromIndex,guard)?0:fromIndex<0?nativeMax(length+fromIndex,0):fromIndex||0,"string"==typeof collection||!isArray(collection)&&isString(collection)?fromIndex<=length&&-1<collection.indexOf(target,fromIndex):!!length&&-1<getIndexOf(collection,target,fromIndex)}var indexBy=createAggregator(function(result,value,key){result[key]=value}),invoke=restParam(function(collection,path,args){var index=-1,isFunc="function"==typeof path,isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){var func=isFunc?path:isProp&&null!=value?value[path]:undefined;result[++index]=func?func.apply(value,args):invokePath(value,path,args)}),result});function map(collection,iteratee,thisArg){return(isArray(collection)?arrayMap:baseMap)(collection,iteratee=getCallback(iteratee,thisArg,3))}var partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]});var reduce=createReduce(arrayReduce,baseEach),reduceRight=createReduce(function(array,iteratee,accumulator,initFromArray){var length=array.length;for(initFromArray&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator},baseEachRight);function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):null==n)return 0<(length=(collection=toIterable(collection)).length)?collection[baseRandom(0,length-1)]:undefined;var length,index=-1,result=toArray(collection),lastIndex=(length=result.length)-1;for(n=nativeMin(n<0?0:+n||0,length);++index<n;){var rand=baseRandom(index,lastIndex),value=result[rand];result[rand]=result[index],result[index]=value}return result.length=n,result}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=undefined),"function"==typeof predicate&&thisArg===undefined||(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}var sortByAll=restParam(function(collection,iteratees){if(null==collection)return[];var guard=iteratees[2];return guard&&isIterateeCall(iteratees[0],iteratees[1],guard)&&(iteratees.length=1),baseSortByOrder(collection,baseFlatten(iteratees),[])});var now=nativeNow||function(){return(new Date).getTime()};function before(n,func){var result;if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return function(){return 0<--n&&(result=func.apply(this,arguments)),n<=1&&(func=undefined),result}}var bind=restParam(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}),bindAll=restParam(function(object,methodNames){for(var index=-1,length=(methodNames=methodNames.length?baseFlatten(methodNames):functions(object)).length;++index<length;){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}),bindKey=restParam(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}),curry=createCurry(CURRY_FLAG),curryRight=createCurry(CURRY_RIGHT_FLAG);function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(wait=wait<0?0:+wait||0,!0===options){var leading=!0;trailing=!1}else isObject(options)&&(leading=!!options.leading,maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait),trailing="trailing"in options?!!options.trailing:trailing);function complete(isCalled,id){id&&clearTimeout(id),maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=undefined))}function delayed(){var remaining=wait-(now()-stamp);remaining<=0||wait<remaining?complete(trailingCall,maxTimeoutId):timeoutId=setTimeout(delayed,remaining)}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),!1===maxWait)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||maxWait<remaining;isCalled?(maxTimeoutId=maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId=maxTimeoutId||setTimeout(maxDelayed,remaining)}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=undefined),result}return debounced.cancel=function(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),lastCalled=0,maxTimeoutId=timeoutId=trailingCall=undefined},debounced}var defer=restParam(function(func,args){return baseDelay(func,1,args)}),delay=restParam(function(func,wait,args){return baseDelay(func,wait,args)}),flow=createFlow(),flowRight=createFlow(!0);function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return memoized.cache=cache.set(key,result),result};return memoized.cache=new memoize.Cache,memoized}var modArgs=restParam(function(func,transforms){if(transforms=baseFlatten(transforms),"function"!=typeof func||!arrayEvery(transforms,baseIsFunction))throw new TypeError(FUNC_ERROR_TEXT);var length=transforms.length;return restParam(function(args){for(var index=nativeMin(args.length,length);index--;)args[index]=transforms[index](args[index]);return func.apply(this,args)})});var partial=createPartial(PARTIAL_FLAG),partialRight=createPartial(PARTIAL_RIGHT_FLAG),rearg=restParam(function(func,indexes){return createWrapper(func,REARG_FLAG,undefined,undefined,undefined,baseFlatten(indexes))});function restParam(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(start===undefined?func.length-1:+start||0,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);++index<length;)rest[index]=args[start+index];switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=rest,func.apply(this,otherArgs)}}function gt(value,other){return other<value}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isEqual(value,other,customizer,thisArg){var result=(customizer="function"==typeof customizer?bindCallback(customizer,thisArg,3):undefined)?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&"string"==typeof value.message&&objToString.call(value)==errorTag}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function isNative(value){return null!=value&&(isFunction(value)?reIsNative.test(fnToString.call(value)):isObjectLike(value)&&reIsHostCtor.test(value))}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag}function isPlainObject(value){var Ctor,result;return!(!isObjectLike(value)||objToString.call(value)!=objectTag||isArguments(value)||!(hasOwnProperty.call(value,"constructor")||"function"!=typeof(Ctor=value.constructor)||Ctor instanceof Ctor))&&(baseForIn(value,function(subValue,key){result=key}),result===undefined||hasOwnProperty.call(value,result))}function isRegExp(value){return isObject(value)&&objToString.call(value)==regexpTag}function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}function lt(value,other){return value<other}function toArray(value){var length=value?getLength(value):0;return isLength(length)?length?arrayCopy(value):[]:values(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}var merge=createAssigner(function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source)),props=isSrcArr?undefined:keys(source);return arrayEach(props||source,function(srcValue,key){if(props&&(srcValue=source[key=srcValue]),isObjectLike(srcValue))!function(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return object[key]=stackB[length];var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(isArrayLike(result=srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result==result?result!==value:value==value)&&(object[key]=result)}(object,source,key,baseMerge,customizer,stackA=stackA||[],stackB=stackB||[]);else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(result=srcValue),result===undefined&&(!isSrcArr||key in object)||!isCommon&&(result==result?result===value:value!=value)||(object[key]=result)}}),object}),assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)});var defaults=createDefaults(assign,function(objectValue,sourceValue){return objectValue===undefined?sourceValue:objectValue}),defaultsDeep=createDefaults(merge,function mergeDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:merge(objectValue,sourceValue,mergeDefaults)}),findKey=createFindKey(baseForOwn),findLastKey=createFindKey(baseForOwnRight),forIn=createForIn(baseFor),forInRight=createForIn(baseForRight),forOwn=createForOwn(baseForOwn),forOwnRight=createForOwn(baseForOwnRight);function functions(object){return baseFunctions(object,keysIn(object))}var keys=nativeKeys?function(object){var Ctor=null==object?undefined:object.constructor;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&isArrayLike(object)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys;function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=0<length;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}var mapKeys=createObjectMapper(!0),mapValues=createObjectMapper(),omit=restParam(function(object,props){if(null==object)return{};if("function"!=typeof props[0])return props=arrayMap(baseFlatten(props),String),pickByArray(object,baseDifference(keysIn(object),props));var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})});function pairs(object){object=toObject(object);for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}var pick=restParam(function(object,props){return null==object?{}:"function"==typeof props[0]?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))});function values(object){return baseValues(object,keys(object))}var camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)});function deburr(string){return(string=baseToString(string))&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}var kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()});var padLeft=createPadDir(),padRight=createPadDir(!0);function repeat(string,n){var result="";if(string=baseToString(string),(n=+n)<1||!string||!nativeIsFinite(n))return result;for(;n%2&&(result+=string),string+=string,n=nativeFloor(n/2););return result}var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}),startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))});function trim(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1):(chars+="",string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)):string}function words(string,pattern,guard){return guard&&isIterateeCall(string,pattern,guard)&&(pattern=undefined),(string=baseToString(string)).match(pattern||reWords)||[]}var attempt=restParam(function(func,args){try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}});function callback(func,thisArg,guard){return guard&&isIterateeCall(func,thisArg,guard)&&(thisArg=undefined),isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,!0))}var method=restParam(function(path,args){return function(object){return invokePath(object,path,args)}}),methodOf=restParam(function(object,args){return function(path){return invokePath(object,path,args)}});function mixin(object,source,options){if(null==options){var isObj=isObject(source),props=isObj?keys(source):undefined,methodNames=props&&props.length?baseFunctions(source,props):undefined;(methodNames?methodNames.length:isObj)||(methodNames=!1,options=source,source=object,object=this)}methodNames=methodNames||baseFunctions(source,keys(source));var chain=!0,index=-1,isFunc=isFunction(object),length=methodNames.length;!1===options?chain=!1:isObject(options)&&"chain"in options&&(chain=options.chain);for(;++index<length;){var methodName=methodNames[index],func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__);return(result.__actions__=arrayCopy(this.__actions__)).push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}return func.apply(object,arrayPush([this.value()],arguments))}}(func))}return object}function noop(){}function property(path){return isKey(path)?baseProperty(path):function(path){var pathKey=path+"";return path=toPath(path),function(object){return baseGet(object,path,pathKey)}}(path)}var source,ceil=createRound("ceil"),floor=createRound("floor"),max=createExtremum(gt,NEGATIVE_INFINITY),min=createExtremum(lt,POSITIVE_INFINITY),round=createRound("round");return lodash.prototype=baseLodash.prototype,(LodashWrapper.prototype=baseCreate(baseLodash.prototype)).constructor=LodashWrapper,(LazyWrapper.prototype=baseCreate(baseLodash.prototype)).constructor=LazyWrapper,MapCache.prototype.delete=function(key){return this.has(key)&&delete this.__data__[key]},MapCache.prototype.get=function(key){return"__proto__"==key?undefined:this.__data__[key]},MapCache.prototype.has=function(key){return"__proto__"!=key&&hasOwnProperty.call(this.__data__,key)},MapCache.prototype.set=function(key,value){return"__proto__"!=key&&(this.__data__[key]=value),this},SetCache.prototype.push=function(value){var data=this.data;"string"==typeof value||isObject(value)?data.set.add(value):data.hash[value]=!0},memoize.Cache=MapCache,lodash.after=function(n,func){if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return n=nativeIsFinite(n=+n)?n:0,function(){if(--n<1)return func.apply(this,arguments)}},lodash.ary=function(func,n,guard){return guard&&isIterateeCall(func,n,guard)&&(n=undefined),n=func&&null==n?func.length:nativeMax(+n||0,0),createWrapper(func,ARY_FLAG,undefined,undefined,undefined,undefined,n)},lodash.assign=assign,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.callback=callback,lodash.chain=chain,lodash.chunk=function(array,size,guard){size=(guard?isIterateeCall(array,size,guard):null==size)?1:nativeMax(nativeFloor(size)||1,1);for(var index=0,length=array?array.length:0,resIndex=-1,result=Array(nativeCeil(length/size));index<length;)result[++resIndex]=baseSlice(array,index,index+=size);return result},lodash.compact=function(array){for(var index=-1,length=array?array.length:0,resIndex=-1,result=[];++index<length;){var value=array[index];value&&(result[++resIndex]=value)}return result},lodash.constant=function(value){return function(){return value}},lodash.countBy=countBy,lodash.create=function(prototype,properties,guard){var result=baseCreate(prototype);return guard&&isIterateeCall(prototype,properties,guard)&&(properties=undefined),properties?baseAssign(result,properties):result},lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defaultsDeep=defaultsDeep,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=function(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0,!0):[]},lodash.dropWhile=function(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0):[]},lodash.fill=function(array,value,start,end){var length=array?array.length:0;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),function(array,value,start,end){var length=array.length;for((start=null==start?0:+start||0)<0&&(start=length<-start?0:length+start),(end=end===undefined||length<end?length:+end||0)<0&&(end+=length),length=end<start?0:end>>>0,start>>>=0;start<length;)array[start++]=value;return array}(array,value,start,end)):[]},lodash.filter=filter,lodash.flatten=function(array,isDeep,guard){var length=array?array.length:0;return guard&&isIterateeCall(array,isDeep,guard)&&(isDeep=!1),length?baseFlatten(array,isDeep):[]},lodash.flattenDeep=function(array){return array&&array.length?baseFlatten(array,!0):[]},lodash.flow=flow,lodash.flowRight=flowRight,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=function(array){return dropRight(array,1)},lodash.intersection=intersection,lodash.invert=function(object,multiValue,guard){guard&&isIterateeCall(object,multiValue,guard)&&(multiValue=undefined);for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index],value=object[key];multiValue?hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]:result[value]=key}return result},lodash.invoke=invoke,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=function(path,srcValue){return baseMatchesProperty(path,baseClone(srcValue,!0))},lodash.memoize=memoize,lodash.merge=merge,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.modArgs=modArgs,lodash.negate=function(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){return!predicate.apply(this,arguments)}},lodash.omit=omit,lodash.once=function(func){return before(2,func)},lodash.pairs=pairs,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pluck=function(collection,path){return map(collection,property(path))},lodash.property=property,lodash.propertyOf=function(object){return function(path){return baseGet(object,toPath(path),path+"")}},lodash.pull=function(){var args=arguments,array=args[0];if(!array||!array.length)return array;for(var index=0,indexOf=getIndexOf(),length=args.length;++index<length;)for(var fromIndex=0,value=args[index];-1<(fromIndex=indexOf(array,value,fromIndex));)splice.call(array,fromIndex,1);return array},lodash.pullAt=pullAt,lodash.range=function(start,end,step){step&&isIterateeCall(start,end,step)&&(end=step=undefined),start=+start||0,null==end?(end=start,start=0):end=+end||0;for(var index=-1,length=nativeMax(nativeCeil((end-start)/((step=null==step?1:+step||0)||1)),0),result=Array(length);++index<length;)result[index]=start,start+=step;return result},lodash.rearg=rearg,lodash.reject=function(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getCallback(predicate,thisArg,3),func(collection,function(value,index,collection){return!predicate(value,index,collection)})},lodash.remove=function(array,predicate,thisArg){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getCallback(predicate,thisArg,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result},lodash.rest=rest,lodash.restParam=restParam,lodash.set=function(object,path,value){if(null==object)return object;for(var pathKey=path+"",index=-1,length=(path=null!=object[pathKey]||isKey(path,object)?[pathKey]:toPath(path)).length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=path[index];isObject(nested)&&(index==lastIndex?nested[key]=value:null==nested[key]&&(nested[key]=isIndex(path[index+1])?[]:{})),nested=nested[key]}return object},lodash.shuffle=function(collection){return sample(collection,POSITIVE_INFINITY)},lodash.slice=function(array,start,end){var length=array?array.length:0;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)&&(start=0,end=length),baseSlice(array,start,end)):[]},lodash.sortBy=function(collection,iteratee,thisArg){if(null==collection)return[];thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined);var index=-1;return iteratee=getCallback(iteratee,thisArg,3),baseSortBy(baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}}),compareAscending)},lodash.sortByAll=sortByAll,lodash.sortByOrder=function(collection,iteratees,orders,guard){return null==collection?[]:(guard&&isIterateeCall(iteratees,orders,guard)&&(orders=undefined),isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),isArray(orders)||(orders=null==orders?[]:[orders]),baseSortByOrder(collection,iteratees,orders))},lodash.spread=function(func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return function(array){return func.apply(this,array)}},lodash.take=function(array,n,guard){return array&&array.length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0,n<0?0:n)):[]},lodash.takeRight=function(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,(n=length-(+n||0))<0?0:n)):[]},lodash.takeRightWhile=function(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!1,!0):[]},lodash.takeWhile=function(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3)):[]},lodash.tap=function(value,interceptor,thisArg){return interceptor.call(thisArg,value),value},lodash.throttle=function(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return!1===options?leading=!1:isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:+wait,trailing:trailing})},lodash.thru=thru,lodash.times=function(n,iteratee,thisArg){if((n=nativeFloor(n))<1||!nativeIsFinite(n))return[];var index=-1,result=Array(nativeMin(n,4294967295));for(iteratee=bindCallback(iteratee,thisArg,1);++index<n;)index<4294967295?result[index]=iteratee(index):iteratee(index);return result},lodash.toArray=toArray,lodash.toPlainObject=toPlainObject,lodash.transform=function(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);if(iteratee=getCallback(iteratee,thisArg,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)?Ctor.prototype:undefined)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator},lodash.union=union,lodash.uniq=uniq,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.values=values,lodash.valuesIn=function(object){return baseValues(object,keysIn(object))},lodash.where=function(collection,source){return filter(collection,baseMatches(source))},lodash.without=without,lodash.wrap=function(value,wrapper){return createWrapper(wrapper=null==wrapper?identity:wrapper,PARTIAL_FLAG,undefined,[value],[])},lodash.xor=function(){for(var index=-1,length=arguments.length;++index<length;){var array=arguments[index];if(isArrayLike(array))var result=result?arrayPush(baseDifference(result,array),baseDifference(array,result)):array}return result?baseUniq(result):[]},lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipWith=zipWith,lodash.backflow=flowRight,lodash.collect=map,lodash.compose=flowRight,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.extend=assign,lodash.iteratee=callback,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,mixin(lodash,lodash),lodash.add=function(augend,addend){return(+augend||0)+(+addend||0)},lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=function(string){return(string=baseToString(string))&&string.charAt(0).toUpperCase()+string.slice(1)},lodash.ceil=ceil,lodash.clone=function(value,isDeep,customizer,thisArg){return isDeep&&"boolean"!=typeof isDeep&&isIterateeCall(value,isDeep,customizer)?isDeep=!1:"function"==typeof isDeep&&(thisArg=customizer,customizer=isDeep,isDeep=!1),"function"==typeof customizer?baseClone(value,isDeep,bindCallback(customizer,thisArg,1)):baseClone(value,isDeep)},lodash.cloneDeep=function(value,customizer,thisArg){return"function"==typeof customizer?baseClone(value,!0,bindCallback(customizer,thisArg,1)):baseClone(value,!0)},lodash.deburr=deburr,lodash.endsWith=function(string,target,position){target+="";var length=(string=baseToString(string)).length;return position=position===undefined?length:nativeMin(position<0?0:+position||0,length),0<=(position-=target.length)&&string.indexOf(target,position)==position},lodash.escape=function(string){return(string=baseToString(string))&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string},lodash.escapeRegExp=function(string){return(string=baseToString(string))&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,escapeRegExpChar):string||"(?:)"},lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.findWhere=function(collection,source){return find(collection,baseMatches(source))},lodash.first=first,lodash.floor=floor,lodash.get=function(object,path,defaultValue){var result=null==object?undefined:baseGet(object,toPath(path),path+"");return result===undefined?defaultValue:result},lodash.gt=gt,lodash.gte=function(value,other){return other<=value},lodash.has=function(object,path){if(null==object)return!1;var result=hasOwnProperty.call(object,path);if(!result&&!isKey(path)){if(null==(object=1==(path=toPath(path)).length?object:baseGet(object,baseSlice(path,0,-1))))return!1;path=last(path),result=hasOwnProperty.call(object,path)}return result||isLength(object.length)&&isIndex(path,object.length)&&(isArray(object)||isArguments(object))},lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=function(value,start,end){return start=+start||0,end===undefined?(end=start,start=0):end=+end||0,value>=nativeMin(start,end)&&value<nativeMax(start,end)},lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=function(value){return!0===value||!1===value||isObjectLike(value)&&objToString.call(value)==boolTag},lodash.isDate=function(value){return isObjectLike(value)&&objToString.call(value)==dateTag},lodash.isElement=function(value){return!!value&&1===value.nodeType&&isObjectLike(value)&&!isPlainObject(value)},lodash.isEmpty=function(value){return null==value||(isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))?!value.length:!keys(value).length)},lodash.isEqual=isEqual,lodash.isError=isError,lodash.isFinite=function(value){return"number"==typeof value&&nativeIsFinite(value)},lodash.isFunction=isFunction,lodash.isMatch=function(object,source,customizer,thisArg){return customizer="function"==typeof customizer?bindCallback(customizer,thisArg,3):undefined,baseIsMatch(object,getMatchData(source),customizer)},lodash.isNaN=function(value){return isNumber(value)&&value!=+value},lodash.isNative=isNative,lodash.isNull=function(value){return null===value},lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isTypedArray=isTypedArray,lodash.isUndefined=function(value){return value===undefined},lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=function(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;var index=length;if("number"==typeof fromIndex)index=(fromIndex<0?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1;else if(fromIndex){var other=array[index=binaryIndex(array,value,!0)-1];return(value==value?value===other:other!=other)?index:-1}if(value!=value)return indexOfNaN(array,index,!0);for(;index--;)if(array[index]===value)return index;return-1},lodash.lt=lt,lodash.lte=function(value,other){return value<=other},lodash.max=max,lodash.min=min,lodash.noConflict=function(){return root._=oldDash,this},lodash.noop=noop,lodash.now=now,lodash.pad=function(string,length,chars){length=+length;var strLength=(string=baseToString(string)).length;if(length<=strLength||!nativeIsFinite(length))return string;var mid=(length-strLength)/2,leftLength=nativeFloor(mid);return(chars=createPadding("",nativeCeil(mid),chars)).slice(0,leftLength)+string+chars},lodash.padLeft=padLeft,lodash.padRight=padRight,lodash.parseInt=function(string,radix,guard){return radix=(guard?isIterateeCall(string,radix,guard):null==radix)?0:radix&&+radix,string=trim(string),nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))},lodash.random=function(min,max,floating){floating&&isIterateeCall(min,max,floating)&&(max=floating=undefined);var noMin=null==min,noMax=null==max;if(null==floating&&(noMax&&"boolean"==typeof min?(floating=min,min=1):"boolean"==typeof max&&(floating=max,noMax=!0)),noMin&&noMax&&(noMax=!(max=1)),min=+min||0,noMax?(max=min,min=0):max=+max||0,floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)},lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.result=function(object,path,defaultValue){var result=null==object?undefined:object[path];return result===undefined&&(null==object||isKey(path,object)||(result=null==(object=1==(path=toPath(path)).length?object:baseGet(object,baseSlice(path,0,-1)))?undefined:object[last(path)]),result=result===undefined?defaultValue:result),isFunction(result)?result.call(object):result},lodash.round=round,lodash.runInContext=runInContext,lodash.size=function(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length},lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedLastIndex=sortedLastIndex,lodash.startCase=startCase,lodash.startsWith=function(string,target,position){return string=baseToString(string),position=null==position?0:nativeMin(position<0?0:+position||0,string.length),string.lastIndexOf(target,position)==position},lodash.sum=function(collection,iteratee,thisArg){return thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=undefined),1==(iteratee=getCallback(iteratee,thisArg,3)).length?function(array,iteratee){for(var length=array.length,result=0;length--;)result+=+iteratee(array[length])||0;return result}(isArray(collection)?collection:toIterable(collection),iteratee):function(collection,iteratee){var result=0;return baseEach(collection,function(value,index,collection){result+=+iteratee(value,index,collection)||0}),result}(collection,iteratee)},lodash.template=function(string,options,otherOptions){var settings=lodash.templateSettings;otherOptions&&isIterateeCall(string,options,otherOptions)&&(options=otherOptions=undefined),string=baseToString(string);var isEscaping,isEvaluating,imports=assignWith(baseAssign({},(options=assignWith(baseAssign({},otherOptions||options),settings,assignOwnDefaults)).imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue=interpolateValue||esTemplateValue,source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result},lodash.trim=trim,lodash.trimLeft=function(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string)):string.slice(charsLeftIndex(string,chars+"")):string},lodash.trimRight=function(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(0,trimmedRightIndex(string)+1):string.slice(0,charsRightIndex(string,chars+"")+1):string},lodash.trunc=function(string,options,guard){guard&&isIterateeCall(string,options,guard)&&(options=undefined);var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(null!=options)if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length,omission="omission"in options?baseToString(options.omission):omission}else length=+options||0;if(length>=(string=baseToString(string)).length)return string;var end=length-omission.length;if(end<1)return omission;var result=string.slice(0,end);if(null==separator)return result+omission;if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);for(separator.global||(separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")),separator.lastIndex=0;match=separator.exec(substring);)newEnd=match.index;result=result.slice(0,null==newEnd?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);-1<index&&(result=result.slice(0,index))}return result+omission},lodash.unescape=function(string){return(string=baseToString(string))&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string},lodash.uniqueId=function(prefix){var id=++idCounter;return baseToString(prefix)+id},lodash.words=words,lodash.all=every,lodash.any=some,lodash.contains=includes,lodash.eq=isEqual,lodash.detect=find,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.head=first,lodash.include=includes,lodash.inject=reduce,mixin(lodash,(source={},baseForOwn(lodash,function(func,methodName){lodash.prototype[methodName]||(source[methodName]=func)}),source),!1),lodash.sample=sample,lodash.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(value){return sample(value,n)}):sample(this.value())},lodash.VERSION=VERSION,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["drop","take"],function(methodName,index){LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__;if(filtered&&!index)return new LazyWrapper(this);n=null==n?1:nativeMax(nativeFloor(n)||0,0);var result=this.clone();return filtered?result.__takeCount__=nativeMin(result.__takeCount__,n):result.__views__.push({size:n,type:methodName+(result.__dir__<0?"Right":"")}),result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()}}),arrayEach(["filter","map","takeWhile"],function(methodName,index){var type=index+1,isFilter=type!=LAZY_MAP_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var result=this.clone();return result.__iteratees__.push({iteratee:getCallback(iteratee,thisArg,1),type:type}),result.__filtered__=result.__filtered__||isFilter,result}}),arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this.__filtered__?new LazyWrapper(this):this[dropName](1)}}),arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:property;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.reject=function(predicate,thisArg){return predicate=getCallback(predicate,thisArg,1),this.filter(function(value){return!predicate(value)})},LazyWrapper.prototype.slice=function(start,end){start=null==start?0:+start||0;var result=this;return result.__filtered__&&(0<start||end<0)?new LazyWrapper(result):(start<0?result=result.takeRight(-start):start&&(result=result.drop(start)),end!==undefined&&(result=(end=+end||0)<0?result.dropRight(-end):result.take(end-start)),result)},LazyWrapper.prototype.takeRightWhile=function(predicate,thisArg){return this.reverse().takeWhile(predicate,thisArg).reverse()},LazyWrapper.prototype.toArray=function(){return this.take(POSITIVE_INFINITY)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName),lodashFunc=lodash[retUnwrapped?"take"+("last"==methodName?"Right":""):methodName];lodashFunc&&(lodash.prototype[methodName]=function(){var args=retUnwrapped?[1]:arguments,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);function interceptor(value){return retUnwrapped&&chainAll?lodashFunc(value,1)[0]:lodashFunc.apply(undefined,arrayPush([value],args))}useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var action={func:thru,args:[interceptor],thisArg:undefined},onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll)return onlyLazy?((value=value.clone()).__actions__.push(action),func.call(value)):lodashFunc.call(undefined,this.value())[0];if(retUnwrapped||!useLazy)return this.thru(interceptor);value=onlyLazy?value:new LazyWrapper(this);var result=func.apply(value,args);return result.__actions__.push(action),new LodashWrapper(result,chainAll)})}),arrayEach(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;return retUnwrapped&&!this.__chain__?func.apply(this.value(),args):this[chainName](function(value){return func.apply(value,args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name;(realNames[key]||(realNames[key]=[])).push({name:methodName,func:lodashFunc})}}),realNames[createHybridWrapper(undefined,BIND_KEY_FLAG).name]=[{name:"wrapper",func:undefined}],LazyWrapper.prototype.clone=function(){var result=new LazyWrapper(this.__wrapped__);return result.__actions__=arrayCopy(this.__actions__),result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=arrayCopy(this.__iteratees__),result.__takeCount__=this.__takeCount__,result.__views__=arrayCopy(this.__views__),result},LazyWrapper.prototype.reverse=function(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else(result=this.clone()).__dir__*=-1;return result},LazyWrapper.prototype.value=function(){var array=this.__wrapped__.value(),dir=this.__dir__,isArr=isArray(array),isRight=dir<0,arrLength=isArr?array.length:0,view=function(start,end,transforms){for(var index=-1,length=transforms.length;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}(0,arrLength,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,iteratees=this.__iteratees__,iterLength=iteratees.length,resIndex=0,takeCount=nativeMin(length,this.__takeCount__);if(!isArr||arrLength<LARGE_ARRAY_SIZE||arrLength==length&&takeCount==length)return baseWrapperValue(isRight&&isArr?array.reverse():array,this.__actions__);var result=[];outer:for(;length--&&resIndex<takeCount;){for(var iterIndex=-1,value=array[index+=dir];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type,computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}result[resIndex++]=value}return result},lodash.prototype.chain=function(){return chain(this)},lodash.prototype.commit=function(){return new LodashWrapper(this.value(),this.__chain__)},lodash.prototype.concat=wrapperConcat,lodash.prototype.plant=function(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result},lodash.prototype.reverse=function(){function interceptor(value){return wrapped&&wrapped.__dir__<0?value:value.reverse()}var value=this.__wrapped__;if(value instanceof LazyWrapper){var wrapped=value;return this.__actions__.length&&(wrapped=new LazyWrapper(this)),(wrapped=wrapped.reverse()).__actions__.push({func:thru,args:[interceptor],thisArg:undefined}),new LodashWrapper(wrapped,this.__chain__)}return this.thru(interceptor)},lodash.prototype.toString=function(){return this.value()+""},lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=function(){return baseWrapperValue(this.__wrapped__,this.__actions__)},lodash.prototype.collect=lodash.prototype.map,lodash.prototype.head=lodash.prototype.first,lodash.prototype.select=lodash.prototype.filter,lodash.prototype.tail=lodash.prototype.rest,lodash}();root._=_,(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.call(exports,__webpack_require__,exports,module))===undefined||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this)}).call(this,__webpack_require__(4)(module),__webpack_require__(6))},function(module,exports){var g;g=function(){return this}();try{g=g||new Function("return this")()}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0);module.exports={longestPath:function(g){var visited={};_.each(g.sources(),function dfs(v){var label=g.node(v);if(_.has(visited,v))return label.rank;visited[v]=!0;var rank=_.min(_.map(g.outEdges(v),function(e){return dfs(e.w)-g.edge(e).minlen}));return rank===Number.POSITIVE_INFINITY&&(rank=0),label.rank=rank})},slack:function(g,e){return g.node(e.w).rank-g.node(e.v).rank-g.edge(e).minlen}}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(2);module.exports=Graph;var DEFAULT_EDGE_NAME="\0",GRAPH_NODE="\0",EDGE_KEY_DELIM="";function Graph(opts){this._isDirected=!_.has(opts,"directed")||opts.directed,this._isMultigraph=!!_.has(opts,"multigraph")&&opts.multigraph,this._isCompound=!!_.has(opts,"compound")&&opts.compound,this._label=void 0,this._defaultNodeLabelFn=_.constant(void 0),this._defaultEdgeLabelFn=_.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[GRAPH_NODE]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function incrementOrInitEntry(map,k){map[k]?map[k]++:map[k]=1}function decrementOrRemoveEntry(map,k){--map[k]||delete map[k]}function edgeArgsToId(isDirected,v_,w_,name){var v=""+v_,w=""+w_;if(!isDirected&&w<v){var tmp=v;v=w,w=tmp}return v+EDGE_KEY_DELIM+w+EDGE_KEY_DELIM+(_.isUndefined(name)?DEFAULT_EDGE_NAME:name)}function edgeObjToId(isDirected,edgeObj){return edgeArgsToId(isDirected,edgeObj.v,edgeObj.w,edgeObj.name)}Graph.prototype._nodeCount=0,Graph.prototype._edgeCount=0,Graph.prototype.isDirected=function(){return this._isDirected},Graph.prototype.isMultigraph=function(){return this._isMultigraph},Graph.prototype.isCompound=function(){return this._isCompound},Graph.prototype.setGraph=function(label){return this._label=label,this},Graph.prototype.graph=function(){return this._label},Graph.prototype.setDefaultNodeLabel=function(newDefault){return _.isFunction(newDefault)||(newDefault=_.constant(newDefault)),this._defaultNodeLabelFn=newDefault,this},Graph.prototype.nodeCount=function(){return this._nodeCount},Graph.prototype.nodes=function(){return _.keys(this._nodes)},Graph.prototype.sources=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._in[v])},this)},Graph.prototype.sinks=function(){return _.filter(this.nodes(),function(v){return _.isEmpty(this._out[v])},this)},Graph.prototype.setNodes=function(vs,value){var args=arguments;return _.each(vs,function(v){1<args.length?this.setNode(v,value):this.setNode(v)},this),this},Graph.prototype.setNode=function(v,value){return _.has(this._nodes,v)?1<arguments.length&&(this._nodes[v]=value):(this._nodes[v]=1<arguments.length?value:this._defaultNodeLabelFn(v),this._isCompound&&(this._parent[v]=GRAPH_NODE,this._children[v]={},this._children[GRAPH_NODE][v]=!0),this._in[v]={},this._preds[v]={},this._out[v]={},this._sucs[v]={},++this._nodeCount),this},Graph.prototype.node=function(v){return this._nodes[v]},Graph.prototype.hasNode=function(v){return _.has(this._nodes,v)},Graph.prototype.removeNode=function(v){var self=this;if(_.has(this._nodes,v)){var removeEdge=function(e){self.removeEdge(self._edgeObjs[e])};delete this._nodes[v],this._isCompound&&(this._removeFromParentsChildList(v),delete this._parent[v],_.each(this.children(v),function(child){this.setParent(child)},this),delete this._children[v]),_.each(_.keys(this._in[v]),removeEdge),delete this._in[v],delete this._preds[v],_.each(_.keys(this._out[v]),removeEdge),delete this._out[v],delete this._sucs[v],--this._nodeCount}return this},Graph.prototype.setParent=function(v,parent){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(_.isUndefined(parent))parent=GRAPH_NODE;else{for(var ancestor=parent+="";!_.isUndefined(ancestor);ancestor=this.parent(ancestor))if(ancestor===v)throw new Error("Setting "+parent+" as parent of "+v+" would create create a cycle");this.setNode(parent)}return this.setNode(v),this._removeFromParentsChildList(v),this._parent[v]=parent,this._children[parent][v]=!0,this},Graph.prototype._removeFromParentsChildList=function(v){delete this._children[this._parent[v]][v]},Graph.prototype.parent=function(v){if(this._isCompound){var parent=this._parent[v];if(parent!==GRAPH_NODE)return parent}},Graph.prototype.children=function(v){if(_.isUndefined(v)&&(v=GRAPH_NODE),this._isCompound){var children=this._children[v];if(children)return _.keys(children)}else{if(v===GRAPH_NODE)return this.nodes();if(this.hasNode(v))return[]}},Graph.prototype.predecessors=function(v){var predsV=this._preds[v];if(predsV)return _.keys(predsV)},Graph.prototype.successors=function(v){var sucsV=this._sucs[v];if(sucsV)return _.keys(sucsV)},Graph.prototype.neighbors=function(v){var preds=this.predecessors(v);if(preds)return _.union(preds,this.successors(v))},Graph.prototype.filterNodes=function(filter){var copy=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});copy.setGraph(this.graph()),_.each(this._nodes,function(value,v){filter(v)&&copy.setNode(v,value)},this),_.each(this._edgeObjs,function(e){copy.hasNode(e.v)&&copy.hasNode(e.w)&&copy.setEdge(e,this.edge(e))},this);var self=this,parents={};return this._isCompound&&_.each(copy.nodes(),function(v){copy.setParent(v,function findParent(v){var parent=self.parent(v);return void 0===parent||copy.hasNode(parent)?parents[v]=parent:parent in parents?parents[parent]:findParent(parent)}(v))}),copy},Graph.prototype.setDefaultEdgeLabel=function(newDefault){return _.isFunction(newDefault)||(newDefault=_.constant(newDefault)),this._defaultEdgeLabelFn=newDefault,this},Graph.prototype.edgeCount=function(){return this._edgeCount},Graph.prototype.edges=function(){return _.values(this._edgeObjs)},Graph.prototype.setPath=function(vs,value){var self=this,args=arguments;return _.reduce(vs,function(v,w){return 1<args.length?self.setEdge(v,w,value):self.setEdge(v,w),w}),this},Graph.prototype.setEdge=function(){var v,w,name,value,valueSpecified=!1,arg0=arguments[0];"object"==typeof arg0&&null!==arg0&&"v"in arg0?(v=arg0.v,w=arg0.w,name=arg0.name,2===arguments.length&&(value=arguments[1],valueSpecified=!0)):(v=arg0,w=arguments[1],name=arguments[3],2<arguments.length&&(value=arguments[2],valueSpecified=!0)),v=""+v,w=""+w,_.isUndefined(name)||(name=""+name);var e=edgeArgsToId(this._isDirected,v,w,name);if(_.has(this._edgeLabels,e))return valueSpecified&&(this._edgeLabels[e]=value),this;if(!_.isUndefined(name)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(v),this.setNode(w),this._edgeLabels[e]=valueSpecified?value:this._defaultEdgeLabelFn(v,w,name);var edgeObj=function(isDirected,v_,w_,name){var v=""+v_,w=""+w_;if(!isDirected&&w<v){var tmp=v;v=w,w=tmp}var edgeObj={v:v,w:w};name&&(edgeObj.name=name);return edgeObj}(this._isDirected,v,w,name);return v=edgeObj.v,w=edgeObj.w,Object.freeze(edgeObj),this._edgeObjs[e]=edgeObj,incrementOrInitEntry(this._preds[w],v),incrementOrInitEntry(this._sucs[v],w),this._in[w][e]=edgeObj,this._out[v][e]=edgeObj,this._edgeCount++,this},Graph.prototype.edge=function(v,w,name){var e=1===arguments.length?edgeObjToId(this._isDirected,v):edgeArgsToId(this._isDirected,v,w,name);return this._edgeLabels[e]},Graph.prototype.hasEdge=function(v,w,name){var e=1===arguments.length?edgeObjToId(this._isDirected,v):edgeArgsToId(this._isDirected,v,w,name);return _.has(this._edgeLabels,e)},Graph.prototype.removeEdge=function(v,w,name){var e=1===arguments.length?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name),edge=this._edgeObjs[e];return edge&&(v=edge.v,w=edge.w,delete this._edgeLabels[e],delete this._edgeObjs[e],decrementOrRemoveEntry(this._preds[w],v),decrementOrRemoveEntry(this._sucs[v],w),delete this._in[w][e],delete this._out[v][e],this._edgeCount--),this},Graph.prototype.inEdges=function(v,u){var inV=this._in[v];if(inV){var edges=_.values(inV);return u?_.filter(edges,function(edge){return edge.v===u}):edges}},Graph.prototype.outEdges=function(v,w){var outV=this._out[v];if(outV){var edges=_.values(outV);return w?_.filter(edges,function(edge){return edge.w===w}):edges}},Graph.prototype.nodeEdges=function(v,w){var inEdges=this.inEdges(v,w);if(inEdges)return inEdges.concat(this.outEdges(v,w))}},function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,root;root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global,__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(21),__webpack_require__(10),exports],void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(_,$,exports){root.Backbone=function(root,Backbone,_,$){var previousBackbone=root.Backbone,slice=Array.prototype.slice;Backbone.VERSION="1.3.3",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var addUnderscoreMethods=function(Class,methods,attribute){_.each(methods,function(length,method){_[method]&&(Class.prototype[method]=function(length,method,attribute){switch(length){case 1:return function(){return _[method](this[attribute])};case 2:return function(value){return _[method](this[attribute],value)};case 3:return function(iteratee,context){return _[method](this[attribute],cb(iteratee,this),context)};case 4:return function(iteratee,defaultVal,context){return _[method](this[attribute],cb(iteratee,this),defaultVal,context)};default:return function(){var args=slice.call(arguments);args.unshift(this[attribute]);return _[method].apply(_,args)}}}(length,method,attribute))})},cb=function(iteratee,instance){return _.isFunction(iteratee)?iteratee:_.isObject(iteratee)&&!instance._isModel(iteratee)?modelMatcher(iteratee):_.isString(iteratee)?function(model){return model.get(iteratee)}:iteratee},modelMatcher=function(attrs){var matcher=_.matches(attrs);return function(model){return matcher(model.attributes)}},Events=Backbone.Events={},eventSplitter=/\s+/,eventsApi=function(iteratee,events,name,callback,opts){var names,i=0;if(name&&"object"==typeof name){void 0!==callback&&"context"in opts&&void 0===opts.context&&(opts.context=callback);for(names=_.keys(name);i<names.length;i++)events=eventsApi(iteratee,events,names[i],name[names[i]],opts)}else if(name&&eventSplitter.test(name))for(names=name.split(eventSplitter);i<names.length;i++)events=iteratee(events,names[i],callback,opts);else events=iteratee(events,name,callback,opts);return events};Events.on=function(name,callback,context){return internalOn(this,name,callback,context)};var internalOn=function(obj,name,callback,context,listening){if(obj._events=eventsApi(onApi,obj._events||{},name,callback,{context:context,ctx:obj,listening:listening}),listening){var listeners=obj._listeners||(obj._listeners={});listeners[listening.id]=listening}return obj};Events.listenTo=function(obj,name,callback){if(!obj)return this;var id=obj._listenId||(obj._listenId=_.uniqueId("l")),listeningTo=this._listeningTo||(this._listeningTo={}),listening=listeningTo[id];if(!listening){var thisId=this._listenId||(this._listenId=_.uniqueId("l"));listening=listeningTo[id]={obj:obj,objId:id,id:thisId,listeningTo:listeningTo,count:0}}return internalOn(obj,name,callback,this,listening),this};var onApi=function(events,name,callback,options){if(callback){var handlers=events[name]||(events[name]=[]),context=options.context,ctx=options.ctx,listening=options.listening;listening&&listening.count++,handlers.push({callback:callback,context:context,ctx:context||ctx,listening:listening})}return events};Events.off=function(name,callback,context){return this._events&&(this._events=eventsApi(offApi,this._events,name,callback,{context:context,listeners:this._listeners})),this},Events.stopListening=function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;for(var ids=obj?[obj._listenId]:_.keys(listeningTo),i=0;i<ids.length;i++){var listening=listeningTo[ids[i]];if(!listening)break;listening.obj.off(name,callback,this)}return this};var offApi=function(events,name,callback,options){if(events){var listening,i=0,context=options.context,listeners=options.listeners;if(name||callback||context){for(var names=name?[name]:_.keys(events);i<names.length;i++){name=names[i];var handlers=events[name];if(!handlers)break;for(var remaining=[],j=0;j<handlers.length;j++){var handler=handlers[j];callback&&callback!==handler.callback&&callback!==handler.callback._callback||context&&context!==handler.context?remaining.push(handler):(listening=handler.listening)&&0==--listening.count&&(delete listeners[listening.id],delete listening.listeningTo[listening.objId])}remaining.length?events[name]=remaining:delete events[name]}return events}for(var ids=_.keys(listeners);i<ids.length;i++)listening=listeners[ids[i]],delete listeners[listening.id],delete listening.listeningTo[listening.objId]}};Events.once=function(name,callback,context){var events=eventsApi(onceMap,{},name,callback,_.bind(this.off,this));return"string"==typeof name&&null==context&&(callback=void 0),this.on(events,callback,context)},Events.listenToOnce=function(obj,name,callback){var events=eventsApi(onceMap,{},name,callback,_.bind(this.stopListening,this,obj));return this.listenTo(obj,events)};var onceMap=function(map,name,callback,offer){if(callback){var once=map[name]=_.once(function(){offer(name,once),callback.apply(this,arguments)});once._callback=callback}return map};Events.trigger=function(name){if(!this._events)return this;for(var length=Math.max(0,arguments.length-1),args=Array(length),i=0;i<length;i++)args[i]=arguments[i+1];return eventsApi(triggerApi,this._events,name,void 0,args),this};var triggerApi=function(objEvents,name,callback,args){if(objEvents){var events=objEvents[name],allEvents=objEvents.all;events&&allEvents&&(allEvents=allEvents.slice()),events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,[name].concat(args))}return objEvents},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}};Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options=options||{},this.cid=_.uniqueId(this.cidPrefix),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{});var defaults=_.result(this,"defaults");attrs=_.defaults(_.extend({},defaults,attrs),defaults),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},matches:function(attrs){return!!_.iteratee(attrs,this)(this.attributes)},set:function(key,val,options){if(null==key)return this;var attrs;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=options||{},!this._validate(attrs,options))return!1;var unset=options.unset,silent=options.silent,changes=[],changing=this._changing;this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={});var current=this.attributes,changed=this.changed,prev=this._previousAttributes;for(var attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete changed[attr]:changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(this.idAttribute in attrs&&(this.id=this.get(this.idAttribute)),!silent){changes.length&&(this._pending=options);for(var i=0;i<changes.length;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return!!this.hasChanged()&&_.clone(this.changed);var old=this._changing?this._previousAttributes:this.attributes,changed={};for(var attr in diff){var val=diff[attr];_.isEqual(old[attr],val)||(changed[attr]=val)}return!!_.size(changed)&&changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=_.extend({parse:!0},options);var model=this,success=options.success;return options.success=function(resp){var serverAttrs=options.parse?model.parse(resp,options):resp;if(!model.set(serverAttrs,options))return!1;success&&success.call(options.context,model,resp,options),model.trigger("sync",model,resp,options)},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs;null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val;var wait=(options=_.extend({validate:!0,parse:!0},options)).wait;if(attrs&&!wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;var model=this,success=options.success,attributes=this.attributes;options.success=function(resp){model.attributes=attributes;var serverAttrs=options.parse?model.parse(resp,options):resp;if(wait&&(serverAttrs=_.extend({},attrs,serverAttrs)),serverAttrs&&!model.set(serverAttrs,options))return!1;success&&success.call(options.context,model,resp,options),model.trigger("sync",model,resp,options)},wrapError(this,options),attrs&&wait&&(this.attributes=_.extend({},attributes,attrs));var method=this.isNew()?"create":options.patch?"patch":"update";"patch"!=method||options.attrs||(options.attrs=attrs);var xhr=this.sync(method,this,options);return this.attributes=attributes,xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,wait=options.wait,destroy=function(){model.stopListening(),model.trigger("destroy",model,model.collection,options)},xhr=!(options.success=function(resp){wait&&destroy(),success&&success.call(options.context,model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)});return this.isNew()?_.defer(options.success):(wrapError(this,options),xhr=this.sync("delete",this,options)),wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;var id=this.get(this.idAttribute);return base.replace(/[^\/]$/,"$&/")+encodeURIComponent(id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend({},options,{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return!error||(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1)}}),addUnderscoreMethods(Model,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var Collection=Backbone.Collection=function(models,options){(options=options||{}).model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1},splice=function(array,insert,at){at=Math.min(Math.max(at,0),array.length);var i,tail=Array(array.length-at),length=insert.length;for(i=0;i<tail.length;i++)tail[i]=array[i+at];for(i=0;i<length;i++)array[i+at]=insert[i];for(i=0;i<tail.length;i++)array[i+length+at]=tail[i]};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){options=_.extend({},options);var singular=!_.isArray(models);models=singular?[models]:models.slice();var removed=this._removeModels(models,options);return!options.silent&&removed.length&&(options.changes={added:[],merged:[],removed:removed},this.trigger("update",this,options)),singular?removed[0]:removed},set:function(models,options){if(null!=models){(options=_.extend({},setOptions,options)).parse&&!this._isModel(models)&&(models=this.parse(models,options)||[]);var singular=!_.isArray(models);models=singular?[models]:models.slice();var at=options.at;null!=at&&(at=+at),at>this.length&&(at=this.length),at<0&&(at+=this.length+1);var model,i,set=[],toAdd=[],toMerge=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,sort=!1,sortable=this.comparator&&null==at&&!1!==options.sort,sortAttr=_.isString(this.comparator)?this.comparator:null;for(i=0;i<models.length;i++){model=models[i];var existing=this.get(model);if(existing){if(merge&&model!==existing){var attrs=this._isModel(model)?model.attributes:model;options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),toMerge.push(existing),sortable&&!sort&&(sort=existing.hasChanged(sortAttr))}modelMap[existing.cid]||(modelMap[existing.cid]=!0,set.push(existing)),models[i]=existing}else add&&(model=models[i]=this._prepareModel(model,options))&&(toAdd.push(model),this._addReference(model,options),modelMap[model.cid]=!0,set.push(model))}if(remove){for(i=0;i<this.length;i++)model=this.models[i],modelMap[model.cid]||toRemove.push(model);toRemove.length&&this._removeModels(toRemove,options)}var orderChanged=!1,replace=!sortable&&add&&remove;if(set.length&&replace?(orderChanged=this.length!==set.length||_.some(this.models,function(m,index){return m!==set[index]}),this.models.length=0,splice(this.models,set,0),this.length=this.models.length):toAdd.length&&(sortable&&(sort=!0),splice(this.models,toAdd,null==at?this.length:at),this.length=this.models.length),sort&&this.sort({silent:!0}),!options.silent){for(i=0;i<toAdd.length;i++)null!=at&&(options.index=at+i),(model=toAdd[i]).trigger("add",model,this,options);(sort||orderChanged)&&this.trigger("sort",this,options),(toAdd.length||toRemove.length||toMerge.length)&&(options.changes={added:toAdd,removed:toRemove,merged:toMerge},this.trigger("update",this,options))}return singular?models[0]:models}},reset:function(models,options){options=options?_.clone(options):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options)},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options)},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(null!=obj)return this._byId[obj]||this._byId[this.modelId(obj.attributes||obj)]||obj.cid&&this._byId[obj.cid]},has:function(obj){return null!=this.get(obj)},at:function(index){return index<0&&(index+=this.length),this.models[index]},where:function(attrs,first){return this[first?"find":"filter"](attrs)},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){var comparator=this.comparator;if(!comparator)throw new Error("Cannot sort a set without a comparator");options=options||{};var length=comparator.length;return _.isFunction(comparator)&&(comparator=_.bind(comparator,this)),1===length||_.isString(comparator)?this.models=this.sortBy(comparator):this.models.sort(comparator),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return this.map(attr+"")},fetch:function(options){var success=(options=_.extend({parse:!0},options)).success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success.call(options.context,collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){var wait=(options=options?_.clone(options):{}).wait;if(!(model=this._prepareModel(model,options)))return!1;wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(m,resp,callbackOpts){wait&&collection.add(m,callbackOpts),success&&success.call(callbackOpts.context,m,resp,callbackOpts)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(attrs){return attrs[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(this._isModel(attrs))return attrs.collection||(attrs.collection=this),attrs;var model=new(((options=options?_.clone(options):{}).collection=this).model)(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_removeModels:function(models,options){for(var removed=[],i=0;i<models.length;i++){var model=this.get(models[i]);if(model){var index=this.indexOf(model);this.models.splice(index,1),this.length--,delete this._byId[model.cid];var id=this.modelId(model.attributes);null!=id&&delete this._byId[id],options.silent||(options.index=index,model.trigger("remove",model,this,options)),removed.push(model),this._removeReference(model,options)}}return removed},_isModel:function(model){return model instanceof Model},_addReference:function(model,options){this._byId[model.cid]=model;var id=this.modelId(model.attributes);null!=id&&(this._byId[id]=model),model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){delete this._byId[model.cid];var id=this.modelId(model.attributes);null!=id&&delete this._byId[id],this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if(model){if(("add"===event||"remove"===event)&&collection!==this)return;if("destroy"===event&&this.remove(model,options),"change"===event){var prevId=this.modelId(model.previousAttributes()),id=this.modelId(model.attributes);prevId!==id&&(null!=prevId&&delete this._byId[prevId],null!=id&&(this._byId[id]=model))}}this.trigger.apply(this,arguments)}}),addUnderscoreMethods(Collection,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments)},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(element){return this.undelegateEvents(),this._setElement(element),this.delegateEvents(),this},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el),this.el=this.$el[0]},delegateEvents:function(events){if(!(events=events||_.result(this,"events")))return this;for(var key in this.undelegateEvents(),events){var method=events[key];if(_.isFunction(method)||(method=this[method]),method){var match=key.match(delegateEventSplitter);this.delegate(match[1],match[2],_.bind(method,this))}}return this},delegate:function(eventName,selector,listener){return this.$el.on(eventName+".delegateEvents"+this.cid,selector,listener),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(eventName,selector,listener){return this.$el.off(eventName+".delegateEvents"+this.cid,selector,listener),this},_createElement:function(tagName){return document.createElement(tagName)},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"));else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs.class=_.result(this,"className")),this.setElement(this._createElement(_.result(this,"tagName"))),this._setAttributes(attrs)}},_setAttributes:function(attributes){this.$el.attr(attributes)}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options=options||{},{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){if(xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend)return beforeSend.apply(this,arguments)}}"GET"===params.type||options.emulateJSON||(params.processData=!1);var error=options.error;options.error=function(xhr,textStatus,errorThrown){options.textStatus=textStatus,options.errorThrown=errorThrown,error&&error.call(options.context,xhr,textStatus,errorThrown)};var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var methodMap={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){(options=options||{}).routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback=callback||this[name];var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);!1!==router.execute(callback,args,name)&&(router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args))}),this},execute:function(callback,args,name){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],this.checkUrl=_.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){var path=this.location.pathname.replace(/[^\/]$/,"$&/");return path===this.root&&!this.getSearch()},matchRoot:function(){var path=this.decodeFragment(this.location.pathname),rootPath=path.slice(0,this.root.length-1)+"/";return rootPath===this.root},decodeFragment:function(fragment){return decodeURI(fragment.replace(/%25/g,"%2525"))},getSearch:function(){var match=this.location.href.replace(/#.*/,"").match(/\?.+/);return match?match[0]:""},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getPath:function(){var path=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===path.charAt(0)?path.slice(1):path},getFragment:function(fragment){return null==fragment&&(fragment=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");if(History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||7<document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(rootStripper,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var rootPath=this.root.slice(0,-1)||"/";return this.location.replace(rootPath+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var body=document.body,iWindow=body.insertBefore(this.iframe,body.firstChild).contentWindow;iWindow.document.open(),iWindow.document.close(),iWindow.location.hash="#"+this.fragment}var addEventListener=window.addEventListener||function(eventName,listener){return attachEvent("on"+eventName,listener)};if(this._usePushState?addEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?addEventListener("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var removeEventListener=window.removeEventListener||function(eventName,listener){return detachEvent("on"+eventName,listener)};this._usePushState?removeEventListener("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&removeEventListener("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe&&(current=this.getHash(this.iframe.contentWindow)),current===this.fragment)return!1;this.iframe&&this.navigate(current),this.loadUrl()},loadUrl:function(fragment){return!!this.matchRoot()&&(fragment=this.fragment=this.getFragment(fragment),_.some(this.handlers,function(handler){if(handler.route.test(fragment))return handler.callback(fragment),!0}))},navigate:function(fragment,options){if(!History.started)return!1;options&&!0!==options||(options={trigger:!!options}),fragment=this.getFragment(fragment||"");var rootPath=this.root;""!==fragment&&"?"!==fragment.charAt(0)||(rootPath=rootPath.slice(0,-1)||"/");var url=rootPath+fragment;if(fragment=this.decodeFragment(fragment.replace(pathStripper,"")),this.fragment!==fragment){if(this.fragment=fragment,this._usePushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);if(this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getHash(this.iframe.contentWindow)){var iWindow=this.iframe.contentWindow;options.replace||(iWindow.document.open(),iWindow.document.close()),this._updateHash(iWindow.location,fragment,options.replace)}}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;Model.extend=Collection.extend=Router.extend=View.extend=History.extend=function(protoProps,staticProps){var parent=this,child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}return _.extend(child,parent,staticProps),child.prototype=_.create(parent.prototype,protoProps),(child.prototype.constructor=child).__super__=parent.prototype,child};var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error.call(options.context,model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}(root,exports,_,$)}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}).call(this,__webpack_require__(6))},function(module,exports){module.exports=window.jQuery},function(module,exports,__webpack_require__){var lib=__webpack_require__(22);module.exports={Graph:lib.Graph,json:__webpack_require__(24),alg:__webpack_require__(25),version:lib.version}},function(module,exports,__webpack_require__){var _=__webpack_require__(2),PriorityQueue=__webpack_require__(13);module.exports=function(g,source,weightFn,edgeFn){return function(g,source,weightFn,edgeFn){function updateNeighbors(edge){var w=edge.v!==v?edge.v:edge.w,wEntry=results[w],weight=weightFn(edge),distance=vEntry.distance+weight;if(weight<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+edge+" Weight: "+weight);distance<wEntry.distance&&(wEntry.distance=distance,wEntry.predecessor=v,pq.decrease(w,distance))}var v,vEntry,results={},pq=new PriorityQueue;g.nodes().forEach(function(v){var distance=v===source?0:Number.POSITIVE_INFINITY;results[v]={distance:distance},pq.add(v,distance)});for(;0<pq.size()&&(v=pq.removeMin(),(vEntry=results[v]).distance!==Number.POSITIVE_INFINITY);)edgeFn(v).forEach(updateNeighbors);return results}(g,String(source),weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})};var DEFAULT_WEIGHT_FUNC=_.constant(1)},function(module,exports,__webpack_require__){var _=__webpack_require__(2);function PriorityQueue(){this._arr=[],this._keyIndices={}}(module.exports=PriorityQueue).prototype.size=function(){return this._arr.length},PriorityQueue.prototype.keys=function(){return this._arr.map(function(x){return x.key})},PriorityQueue.prototype.has=function(key){return _.has(this._keyIndices,key)},PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];if(void 0!==index)return this._arr[index].priority},PriorityQueue.prototype.min=function(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key},PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;if(key=String(key),_.has(keyIndices,key))return!1;var arr=this._arr,index=arr.length;return keyIndices[key]=index,arr.push({key:key,priority:priority}),this._decrease(index),!0},PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();return delete this._keyIndices[min.key],this._heapify(0),min.key},PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority)throw new Error("New priority is greater than current priority. Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority);this._arr[index].priority=priority,this._decrease(index)},PriorityQueue.prototype._heapify=function(i){var arr=this._arr,l=2*i,r=1+l,largest=i;l<arr.length&&(largest=arr[l].priority<arr[largest].priority?l:largest,r<arr.length&&(largest=arr[r].priority<arr[largest].priority?r:largest),largest!==i&&(this._swap(i,largest),this._heapify(largest)))},PriorityQueue.prototype._decrease=function(index){for(var parent,arr=this._arr,priority=arr[index].priority;0!==index&&!(arr[parent=index>>1].priority<priority);)this._swap(index,parent),index=parent},PriorityQueue.prototype._swap=function(i,j){var arr=this._arr,keyIndices=this._keyIndices,origArrI=arr[i],origArrJ=arr[j];arr[i]=origArrJ,arr[j]=origArrI,keyIndices[origArrJ.key]=i,keyIndices[origArrI.key]=j}},function(module,exports,__webpack_require__){var _=__webpack_require__(2);module.exports=function(g){var index=0,stack=[],visited={},results=[];return g.nodes().forEach(function(v){_.has(visited,v)||!function dfs(v){var entry=visited[v]={onStack:!0,lowlink:index,index:index++};stack.push(v);g.successors(v).forEach(function(w){_.has(visited,w)?visited[w].onStack&&(entry.lowlink=Math.min(entry.lowlink,visited[w].index)):(dfs(w),entry.lowlink=Math.min(entry.lowlink,visited[w].lowlink))});if(entry.lowlink===entry.index){for(var w,cmpt=[];w=stack.pop(),visited[w].onStack=!1,cmpt.push(w),v!==w;);results.push(cmpt)}}(v)}),results}},function(module,exports,__webpack_require__){var _=__webpack_require__(2);function topsort(g){var visited={},stack={},results=[];if(_.each(g.sinks(),function visit(node){if(_.has(stack,node))throw new CycleException;_.has(visited,node)||(stack[node]=!0,visited[node]=!0,_.each(g.predecessors(node),visit),delete stack[node],results.push(node))}),_.size(visited)!==g.nodeCount())throw new CycleException;return results}function CycleException(){}(module.exports=topsort).CycleException=CycleException},function(module,exports,__webpack_require__){var _=__webpack_require__(2);module.exports=function(g,vs,order){_.isArray(vs)||(vs=[vs]);var acc=[],visited={};return _.each(vs,function(v){if(!g.hasNode(v))throw new Error("Graph does not have node: "+v);!function doDfs(g,v,postorder,visited,acc){_.has(visited,v)||(visited[v]=!0,postorder||acc.push(v),_.each(g.neighbors(v),function(w){doDfs(g,w,postorder,visited,acc)}),postorder&&acc.push(v))}(g,v,"post"===order,visited,acc)}),acc}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),Graph=__webpack_require__(3).Graph,slack=__webpack_require__(7).slack;function tightTree(t,g){return _.each(t.nodes(),function dfs(v){_.each(g.nodeEdges(v),function(e){var edgeV=e.v,w=v===edgeV?e.w:edgeV;t.hasNode(w)||slack(g,e)||(t.setNode(w,{}),t.setEdge(v,w,{}),dfs(w))})}),t.nodeCount()}function findMinSlackEdge(t,g){return _.min(g.edges(),function(e){if(t.hasNode(e.v)!==t.hasNode(e.w))return slack(g,e)})}function shiftRanks(t,g,delta){_.each(t.nodes(),function(v){g.node(v).rank+=delta})}module.exports=function(g){var edge,delta,t=new Graph({directed:!1}),start=g.nodes()[0],size=g.nodeCount();t.setNode(start,{});for(;tightTree(t,g)<size;)edge=findMinSlackEdge(t,g),delta=t.hasNode(edge.v)?slack(g,edge):-slack(g,edge),shiftRanks(t,g,delta);return t}},function(module,exports){var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;function ws(uri,protocols,opts){return protocols?new WebSocket(uri,protocols):new WebSocket(uri)}module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype)},function(module,exports,__webpack_require__){(function(module){(function(){var parentRequire;window.require=(parentRequire="function"==typeof require?require:function(){throw new Error("Module '"+module+"' not found")},function(module){switch(module){case"lodash":return __webpack_require__(5);case"rappid":return __webpack_require__(20);case"backbone":return __webpack_require__(9)}return parentRequire(module)})}).call(window)}).call(this,__webpack_require__(4)(module))},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*! Rappid v2.0.0 - HTML5 Diagramming Framework

Copyright (c) 2015 client IO

 2016-05-26 


This Source Code Form is subject to the terms of the Rappid License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/
/*! Rappid v2.0.0 - HTML5 Diagramming Framework

Copyright (c) 2015 client IO

 2016-05-26 


This Source Code Form is subject to the terms of the Rappid License
, v. 2.0. If a copy of the Rappid License was not distributed with this
file, You can obtain one at http://jointjs.com/license/rappid_v2.txt
 or from the Rappid archive as was distributed by client IO. See the LICENSE file.*/
__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(9),__webpack_require__(5),__webpack_require__(10)],void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(Backbone,_,$){return Backbone.$=$,function(root,Backbone,_,$){var V,g=function(){var math=Math,abs=math.abs,cos=math.cos,sin=math.sin,sqrt=math.sqrt,mmin=math.min,mmax=math.max,atan2=(math.atan,math.atan2),round=(math.acos,math.round),floor=math.floor,PI=math.PI,random=math.random,toDeg=function(rad){return 180*rad/PI%360},toRad=function(deg,over360){return(deg=(over360=over360||!1)?deg:deg%360)*PI/180},snapToGrid=function(val,gridSize){return gridSize*Math.round(val/gridSize)},normalizeAngle=function(angle){return angle%360+(angle<0?360:0)};function point(x,y){if(!(this instanceof point))return new point(x,y);if("string"==typeof x){var xy=x.split(-1===x.indexOf("@")?" ":"@");x=parseInt(xy[0],10),y=parseInt(xy[1],10)}else Object(x)===x&&(y=x.y,x=x.x);this.x=void 0===x?0:x,this.y=void 0===y?0:y}function line(p1,p2){if(!(this instanceof line))return new line(p1,p2);this.start=point(p1),this.end=point(p2)}function rect(x,y,w,h){if(!(this instanceof rect))return new rect(x,y,w,h);Object(x)===x&&(y=x.y,w=x.width,h=x.height,x=x.x),this.x=void 0===x?0:x,this.y=void 0===y?0:y,this.width=void 0===w?0:w,this.height=void 0===h?0:h}function ellipse(c,a,b){return this instanceof ellipse?c instanceof ellipse?new ellipse(point(c),c.a,c.b):(c=point(c),this.x=c.x,this.y=c.y,this.a=a,void(this.b=b)):new ellipse(c,a,b)}point.prototype={toString:function(){return this.x+"@"+this.y},adhereToRect:function(r){return r.containsPoint(this)||(this.x=mmin(mmax(this.x,r.x),r.x+r.width),this.y=mmin(mmax(this.y,r.y),r.y+r.height)),this},theta:function(p){var y=-((p=point(p)).y-this.y),x=p.x-this.x,rad=0==y.toFixed(10)&&0==x.toFixed(10)?0:atan2(y,x);return rad<0&&(rad=2*PI+rad),180*rad/PI},distance:function(p){return line(this,p).length()},manhattanDistance:function(p){return abs(p.x-this.x)+abs(p.y-this.y)},offset:function(dx,dy){return this.x+=dx||0,this.y+=dy||0,this},magnitude:function(){return sqrt(this.x*this.x+this.y*this.y)||.01},update:function(x,y){return this.x=x||0,this.y=y||0,this},round:function(decimals){return this.x=decimals?this.x.toFixed(decimals):round(this.x),this.y=decimals?this.y.toFixed(decimals):round(this.y),this},normalize:function(len){var s=(len||1)/this.magnitude();return this.x=s*this.x,this.y=s*this.y,this},difference:function(p){return point(this.x-p.x,this.y-p.y)},bearing:function(p){return line(this,p).bearing()},toPolar:function(o){o=o&&point(o)||point(0,0);var x=this.x,y=this.y;return this.x=sqrt((x-o.x)*(x-o.x)+(y-o.y)*(y-o.y)),this.y=toRad(o.theta(point(x,y))),this},rotate:function(o,angle){angle=(angle+360)%360,this.toPolar(o),this.y+=toRad(angle);var p=point.fromPolar(this.x,this.y,o);return this.x=p.x,this.y=p.y,this},move:function(ref,distance){var theta=toRad(point(ref).theta(this));return this.offset(cos(theta)*distance,-sin(theta)*distance)},scale:function(sx,sy,o){return o=o&&point(o)||point(0,0),this.x=o.x+sx*(this.x-o.x),this.y=o.y+sy*(this.y-o.y),this},changeInAngle:function(dx,dy,ref){return point(this).offset(-dx,-dy).theta(ref)-this.theta(ref)},equals:function(p){return this.x===p.x&&this.y===p.y},snapToGrid:function(gx,gy){return this.x=snapToGrid(this.x,gx),this.y=snapToGrid(this.y,gy||gx),this},reflection:function(ref){return point(ref).move(this,this.distance(ref))},clone:function(){return point(this)},toJSON:function(){return{x:this.x,y:this.y}}},point.fromPolar=function(r,angle,o){o=o&&point(o)||point(0,0);var x=abs(r*cos(angle)),y=abs(r*sin(angle)),deg=normalizeAngle(toDeg(angle));return deg<90?y=-y:deg<180?(x=-x,y=-y):deg<270&&(x=-x),point(o.x+x,o.y+y)},point.random=function(x1,x2,y1,y2){return point(floor(random()*(x2-x1+1)+x1),floor(random()*(y2-y1+1)+y1))},line.prototype={toString:function(){return this.start.toString()+" "+this.end.toString()},length:function(){return sqrt(this.squaredLength())},squaredLength:function(){var x0=this.start.x,y0=this.start.y,x1=this.end.x,y1=this.end.y;return(x0-=x1)*x0+(y0-=y1)*y0},midpoint:function(){return point((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},intersection:function(l){var pt1Dir=point(this.end.x-this.start.x,this.end.y-this.start.y),pt2Dir=point(l.end.x-l.start.x,l.end.y-l.start.y),det=pt1Dir.x*pt2Dir.y-pt1Dir.y*pt2Dir.x,deltaPt=point(l.start.x-this.start.x,l.start.y-this.start.y),alpha=deltaPt.x*pt2Dir.y-deltaPt.y*pt2Dir.x,beta=deltaPt.x*pt1Dir.y-deltaPt.y*pt1Dir.x;if(0==det||alpha*det<0||beta*det<0)return null;if(0<det){if(det<alpha||det<beta)return null}else if(alpha<det||beta<det)return null;return point(this.start.x+alpha*pt1Dir.x/det,this.start.y+alpha*pt1Dir.y/det)},bearing:function(){var lat1=toRad(this.start.y),lat2=toRad(this.end.y),lon1=this.start.x,lon2=this.end.x,dLon=toRad(lon2-lon1),y=sin(dLon)*cos(lat2),x=cos(lat1)*sin(lat2)-sin(lat1)*cos(lat2)*cos(dLon),brng=toDeg(atan2(y,x)),index=brng-22.5;return index<0&&(index+=360),["NE","E","SE","S","SW","W","NW","N"][index=parseInt(index/45)]},pointAt:function(t){var x=(1-t)*this.start.x+t*this.end.x,y=(1-t)*this.start.y+t*this.end.y;return point(x,y)},pointOffset:function(p){return((this.end.x-this.start.x)*(p.y-this.start.y)-(this.end.y-this.start.y)*(p.x-this.start.x))/2},clone:function(){return line(this)}},rect.fromEllipse=function(e){return rect((e=ellipse(e)).x-e.a,e.y-e.b,2*e.a,2*e.b)},rect.prototype={toString:function(){return this.origin().toString()+" "+this.corner().toString()},equals:function(r){var mr=g.rect(this).normalize(),nr=g.rect(r).normalize();return mr.x===nr.x&&mr.y===nr.y&&mr.width===nr.width&&mr.height===nr.height},origin:function(){return point(this.x,this.y)},corner:function(){return point(this.x+this.width,this.y+this.height)},topRight:function(){return point(this.x+this.width,this.y)},bottomLeft:function(){return point(this.x,this.y+this.height)},center:function(){return point(this.x+this.width/2,this.y+this.height/2)},topMiddle:function(){return point(this.x+this.width/2,this.y)},bottomMiddle:function(){return point(this.x+this.width/2,this.y+this.height)},leftMiddle:function(){return point(this.x,this.y+this.height/2)},rightMiddle:function(){return point(this.x+this.width,this.y+this.height/2)},intersect:function(r){var myOrigin=this.origin(),myCorner=this.corner(),rOrigin=r.origin(),rCorner=r.corner();if(rCorner.x<=myOrigin.x||rCorner.y<=myOrigin.y||rOrigin.x>=myCorner.x||rOrigin.y>=myCorner.y)return null;var x=Math.max(myOrigin.x,rOrigin.x),y=Math.max(myOrigin.y,rOrigin.y);return rect(x,y,Math.min(myCorner.x,rCorner.x)-x,Math.min(myCorner.y,rCorner.y)-y)},union:function(r){var myOrigin=this.origin(),myCorner=this.corner(),rOrigin=r.origin(),rCorner=r.corner(),originX=Math.min(myOrigin.x,rOrigin.x),originY=Math.min(myOrigin.y,rOrigin.y),cornerX=Math.max(myCorner.x,rCorner.x),cornerY=Math.max(myCorner.y,rCorner.y);return rect(originX,originY,cornerX-originX,cornerY-originY)},sideNearestToPoint:function(p){var distToLeft=(p=point(p)).x-this.x,distToRight=this.x+this.width-p.x,distToTop=p.y-this.y,distToBottom=this.y+this.height-p.y,closest=distToLeft,side="left";return distToRight<closest&&(closest=distToRight,side="right"),distToTop<closest&&(closest=distToTop,side="top"),distToBottom<closest&&(closest=distToBottom,side="bottom"),side},containsPoint:function(p){return(p=point(p)).x>=this.x&&p.x<=this.x+this.width&&p.y>=this.y&&p.y<=this.y+this.height},containsRect:function(r){var r0=rect(this).normalize(),r1=rect(r).normalize(),w0=r0.width,h0=r0.height,w1=r1.width,h1=r1.height;if(!(w0&&h0&&w1&&h1))return!1;var x0=r0.x,y0=r0.y,x1=r1.x,y1=r1.y;return w1+=x1,w0+=x0,h1+=y1,h0+=y0,x0<=x1&&w1<=w0&&y0<=y1&&h1<=h0},pointNearestToPoint:function(p){if(p=point(p),this.containsPoint(p)){var side=this.sideNearestToPoint(p);switch(side){case"right":return point(this.x+this.width,p.y);case"left":return point(this.x,p.y);case"bottom":return point(p.x,this.y+this.height);case"top":return point(p.x,this.y)}}return p.adhereToRect(this)},intersectionWithLineFromCenterToPoint:function(p,angle){p=point(p);var result,center=point(this.x+this.width/2,this.y+this.height/2);angle&&p.rotate(center,angle);for(var sides=[line(this.origin(),this.topRight()),line(this.topRight(),this.corner()),line(this.corner(),this.bottomLeft()),line(this.bottomLeft(),this.origin())],connector=line(center,p),i=sides.length-1;0<=i;--i){var intersection=sides[i].intersection(connector);if(null!==intersection){result=intersection;break}}return result&&angle&&result.rotate(center,-angle),result},moveAndExpand:function(r){return this.x+=r.x||0,this.y+=r.y||0,this.width+=r.width||0,this.height+=r.height||0,this},round:function(decimals){return this.x=decimals?this.x.toFixed(decimals):round(this.x),this.y=decimals?this.y.toFixed(decimals):round(this.y),this.width=decimals?this.width.toFixed(decimals):round(this.width),this.height=decimals?this.height.toFixed(decimals):round(this.height),this},normalize:function(){var newx=this.x,newy=this.y,newwidth=this.width,newheight=this.height;return this.width<0&&(newx=this.x+this.width,newwidth=-this.width),this.height<0&&(newy=this.y+this.height,newheight=-this.height),this.x=newx,this.y=newy,this.width=newwidth,this.height=newheight,this},bbox:function(angle){var theta=toRad(angle||0),st=abs(sin(theta)),ct=abs(cos(theta)),w=this.width*ct+this.height*st,h=this.width*st+this.height*ct;return rect(this.x+(this.width-w)/2,this.y+(this.height-h)/2,w,h)},scale:function(sx,sy,o){var origin=this.origin().scale(sx,sy,o);return this.x=origin.x,this.y=origin.y,this.width*=sx,this.height*=sy,this},snapToGrid:function(gx,gy){var origin=this.origin().snapToGrid(gx,gy),corner=this.corner().snapToGrid(gx,gy);return this.x=origin.x,this.y=origin.y,this.width=corner.x-origin.x,this.height=corner.y-origin.y,this},clone:function(){return rect(this)},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}}},ellipse.fromRect=function(r){return ellipse((r=rect(r)).center(),r.width/2,r.height/2)},ellipse.prototype={toString:function(){return point(this.x,this.y).toString()+" "+this.a+" "+this.b},bbox:function(){return rect(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},equals:function(e){return(e=ellipse(e)).x===this.x&&e.y===this.y&&e.a===this.a&&e.b===this.b},intersectionWithLineFromCenterToPoint:function(p,angle){p=point(p),angle&&p.rotate(point(this.x,this.y),angle);var result,dx=p.x-this.x,dy=p.y-this.y;if(0==dx)return result=this.bbox().pointNearestToPoint(p),angle?result.rotate(point(this.x,this.y),-angle):result;var m=dy/dx,mSquared=m*m,aSquared=this.a*this.a,bSquared=this.b*this.b,x=sqrt(1/(1/aSquared+mSquared/bSquared)),y=m*(x=dx<0?-x:x);return result=point(this.x+x,this.y+y),angle?result.rotate(point(this.x,this.y),-angle):result},clone:function(){return ellipse(this)}};var bezier={curveThroughPoints:function(points){for(var controlPoints=this.getCurveControlPoints(points),path=["M",points[0].x,points[0].y],i=0;i<controlPoints[0].length;i++)path.push("C",controlPoints[0][i].x,controlPoints[0][i].y,controlPoints[1][i].x,controlPoints[1][i].y,points[i+1].x,points[i+1].y);return path},getCurveControlPoints:function(knots){var i,firstControlPoints=[],secondControlPoints=[],n=knots.length-1;if(1==n)return firstControlPoints[0]=point((2*knots[0].x+knots[1].x)/3,(2*knots[0].y+knots[1].y)/3),secondControlPoints[0]=point(2*firstControlPoints[0].x-knots[0].x,2*firstControlPoints[0].y-knots[0].y),[firstControlPoints,secondControlPoints];var rhs=[];for(i=1;i<n-1;i++)rhs[i]=4*knots[i].x+2*knots[i+1].x;rhs[0]=knots[0].x+2*knots[1].x,rhs[n-1]=(8*knots[n-1].x+knots[n].x)/2;var x=this.getFirstControlPoints(rhs);for(i=1;i<n-1;++i)rhs[i]=4*knots[i].y+2*knots[i+1].y;rhs[0]=knots[0].y+2*knots[1].y,rhs[n-1]=(8*knots[n-1].y+knots[n].y)/2;var y=this.getFirstControlPoints(rhs);for(i=0;i<n;i++)firstControlPoints.push(point(x[i],y[i])),i<n-1?secondControlPoints.push(point(2*knots[i+1].x-x[i+1],2*knots[i+1].y-y[i+1])):secondControlPoints.push(point((knots[n].x+x[n-1])/2,(knots[n].y+y[n-1])/2));return[firstControlPoints,secondControlPoints]},getFirstControlPoints:function(rhs){var n=rhs.length,x=[],tmp=[],b=2;x[0]=rhs[0]/b;for(var i=1;i<n;i++)tmp[i]=1/b,b=(i<n-1?4:3.5)-tmp[i],x[i]=(rhs[i]-x[i-1])/b;for(i=1;i<n;i++)x[n-i-1]-=tmp[n-i]*x[n-i];return x},getInversionSolver:function(p0,p1,p2,p3){var pts=arguments;function l(i,j){var pi=pts[i],pj=pts[j];return function(p){var w=(i%3?3:1)*(j%3?3:1),lij=p.x*(pi.y-pj.y)+p.y*(pj.x-pi.x)+pi.x*pj.y-pi.y*pj.x;return w*lij}}return function(p){var ct=3*l(2,3)(p1),c1=l(1,3)(p0)/ct,c2=-l(2,3)(p0)/ct,la=c1*l(3,1)(p)+c2*(l(3,0)(p)+l(2,1)(p))+l(2,0)(p),lb=c1*l(3,0)(p)+c2*l(2,0)(p)+l(1,0)(p);return lb/(lb-la)}},getCurveDivider:function(p0,p1,p2,p3){return function(t){var l=line(p0,p1).pointAt(t),m=line(p1,p2).pointAt(t),n=line(p2,p3).pointAt(t),p=line(l,m).pointAt(t),q=line(m,n).pointAt(t),r=line(p,q).pointAt(t);return[{p0:p0,p1:l,p2:p,p3:r},{p0:r,p1:q,p2:n,p3:p3}]}}};return{toDeg:toDeg,toRad:toRad,snapToGrid:snapToGrid,normalizeAngle:normalizeAngle,point:point,line:line,rect:rect,ellipse:ellipse,bezier:bezier,scale:{linear:function(domain,range,value){var domainSpan=domain[1]-domain[0];var rangeSpan=range[1]-range[0];return(value-domain[0])/domainSpan*rangeSpan+range[0]||0}}}}();V=function(){"use strict";var hasSvg="object"==typeof window&&!(!window.SVGAngle&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));if(!hasSvg)return function(){throw new Error("SVG is required to use Vectorizer.")};var ns={xmlns:"http://www.w3.org/2000/svg",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink"},V=function(el,attrs,children){if(!(this instanceof V))return V.apply(Object.create(V.prototype),arguments);if(el){if(V.isV(el)&&(el=el.node),attrs=attrs||{},V.isString(el))if("svg"===el.toLowerCase())el=V.createSvgDocument();else if("<"===el[0]){var svgDoc=V.createSvgDocument(el);if(1<svgDoc.childNodes.length){var i,len,arrayOfVels=[];for(i=0,len=svgDoc.childNodes.length;i<len;i++){var childNode=svgDoc.childNodes[i];arrayOfVels.push(new V(document.importNode(childNode,!0)))}return arrayOfVels}el=document.importNode(svgDoc.firstChild,!0)}else el=document.createElementNS(ns.xmlns,el);return this.node=el,this.node.id||(this.node.id=V.uniqueId()),this.setAttributes(attrs),children&&this.append(children),this}};V.prototype.getTransformToElement=function(toElem){return toElem.getScreenCTM().inverse().multiply(this.node.getScreenCTM())},V.prototype.transform=function(matrix){if(V.isUndefined(matrix))return this.node.parentNode?this.getTransformToElement(this.node.parentNode):this.node.getScreenCTM();var svgTransform=V.createSVGTransform(matrix);return this.node.transform.baseVal.appendItem(svgTransform),this},V.prototype.translate=function(tx,ty,opt){opt=opt||{},ty=ty||0;var transformAttr=this.attr("transform")||"",transform=V.parseTransformString(transformAttr);if(V.isUndefined(tx))return transform.translate;transformAttr=transformAttr.replace(/translate\([^\)]*\)/g,"").trim();var newTx=opt.absolute?tx:transform.translate.tx+tx,newTy=opt.absolute?ty:transform.translate.ty+ty,newTranslate="translate("+newTx+","+newTy+")";return this.attr("transform",(newTranslate+" "+transformAttr).trim()),this},V.prototype.rotate=function(angle,cx,cy,opt){opt=opt||{};var transformAttr=this.attr("transform")||"",transform=V.parseTransformString(transformAttr);if(V.isUndefined(angle))return transform.rotate;transformAttr=transformAttr.replace(/rotate\([^\)]*\)/g,"").trim(),angle%=360;var newAngle=opt.absolute?angle:transform.rotate.angle+angle,newOrigin=void 0!==cx&&void 0!==cy?","+cx+","+cy:"",newRotate="rotate("+newAngle+newOrigin+")";return this.attr("transform",(transformAttr+" "+newRotate).trim()),this},V.prototype.scale=function(sx,sy){sy=V.isUndefined(sy)?sx:sy;var transformAttr=this.attr("transform")||"",transform=V.parseTransformString(transformAttr);if(V.isUndefined(sx))return transform.scale;transformAttr=transformAttr.replace(/scale\([^\)]*\)/g,"").trim();var newScale="scale("+sx+","+sy+")";return this.attr("transform",(transformAttr+" "+newScale).trim()),this},V.prototype.bbox=function(withoutTransformations,target){if(!this.node.ownerSVGElement)return{x:0,y:0,width:0,height:0};var box;try{box={x:(box=this.node.getBBox()).x,y:box.y,width:box.width,height:box.height}}catch(e){box={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}if(withoutTransformations)return box;var matrix=this.getTransformToElement(target||this.node.ownerSVGElement);return V.transformRect(box,matrix)},V.prototype.text=function(content,opt){content=V.sanitizeText(content),opt=opt||{};var tspan,lines=content.split("\n"),y=this.attr("y");y||this.attr("y","0.8em"),this.attr("display",content?null:"none"),this.attr("xml:space","preserve"),this.node.textContent="";var textNode=this.node;if(opt.textPath){var defs=this.find("defs");0===defs.length&&(defs=V("defs"),this.append(defs));var d=Object(opt.textPath)===opt.textPath?opt.textPath.d:opt.textPath;if(d){var path=V("path",{d:d});defs.append(path)}var textPath=V("textPath");!opt.textPath["xlink:href"]&&path&&textPath.attr("xlink:href","#"+path.node.id),Object(opt.textPath)===opt.textPath&&textPath.attr(opt.textPath),this.append(textPath),textNode=textPath.node}for(var offset=0,i=0;i<lines.length;i++){var line=lines[i],lineHeight=opt.lineHeight||"1em";"auto"===opt.lineHeight&&(lineHeight="1.5em");var vLine=V("tspan",{dy:0==i?"0em":lineHeight,x:this.attr("x")||0});if(vLine.addClass("v-line"),line)if(opt.annotations){for(var maxFontSize=0,lineAnnotations=V.annotateString(lines[i],V.isArray(opt.annotations)?opt.annotations:[opt.annotations],{offset:-offset,includeAnnotationIndices:opt.includeAnnotationIndices}),j=0;j<lineAnnotations.length;j++){var annotation=lineAnnotations[j];if(V.isObject(annotation)){var fontSize=parseInt(annotation.attrs["font-size"],10);fontSize&&maxFontSize<fontSize&&(maxFontSize=fontSize),tspan=V("tspan",annotation.attrs),opt.includeAnnotationIndices&&tspan.attr("annotations",annotation.annotations),annotation.attrs.class&&tspan.addClass(annotation.attrs.class),tspan.node.textContent=annotation.t}else tspan=document.createTextNode(annotation||" ");vLine.append(tspan)}"auto"===opt.lineHeight&&maxFontSize&&0!==i&&vLine.attr("dy",1.2*maxFontSize+"px")}else vLine.node.textContent=line;else vLine.addClass("v-empty-line"),vLine.node.style.opacity=0,vLine.node.textContent="-";V(textNode).append(vLine),offset+=line.length+1}return this},V.prototype.removeAttr=function(name){var qualifiedName=V.qualifyAttr(name),el=this.node;return qualifiedName.ns?el.hasAttributeNS(qualifiedName.ns,qualifiedName.local)&&el.removeAttributeNS(qualifiedName.ns,qualifiedName.local):el.hasAttribute(name)&&el.removeAttribute(name),this},V.prototype.attr=function(name,value){if(V.isUndefined(name)){for(var attributes=this.node.attributes,attrs={},i=0;i<attributes.length;i++)attrs[attributes[i].nodeName]=attributes[i].nodeValue;return attrs}if(V.isString(name)&&V.isUndefined(value))return this.node.getAttribute(name);if("object"==typeof name)for(var attrName in name)name.hasOwnProperty(attrName)&&this.setAttribute(attrName,name[attrName]);else this.setAttribute(name,value);return this},V.prototype.remove=function(){return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this},V.prototype.empty=function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);return this},V.prototype.setAttributes=function(attrs){for(var key in attrs)attrs.hasOwnProperty(key)&&this.setAttribute(key,attrs[key]);return this},V.prototype.append=function(els){V.isArray(els)||(els=[els]);for(var i=0,len=els.length;i<len;i++)this.node.appendChild(V.toNode(els[i]));return this},V.prototype.prepend=function(el){return this.node.insertBefore(V.isV(el)?el.node:el,this.node.firstChild),this},V.prototype.prepend=function(els){var child=this.node.firstChild;return child?V(child).before(els):this.append(els)},V.prototype.before=function(els){var node=this.node,parent=node.parentNode;if(parent){V.isArray(els)||(els=[els]);for(var i=0,len=els.length;i<len;i++)parent.insertBefore(V.toNode(els[i]),node)}return this},V.prototype.svg=function(){return this.node instanceof window.SVGSVGElement?this:V(this.node.ownerSVGElement)},V.prototype.defs=function(){var defs=this.svg().node.getElementsByTagName("defs");return defs&&defs.length?V(defs[0]):void 0},V.prototype.clone=function(){var clone=V(this.node.cloneNode(!0));return clone.node.id=V.uniqueId(),clone},V.prototype.findOne=function(selector){var found=this.node.querySelector(selector);return found?V(found):void 0},V.prototype.find=function(selector){var vels=[],nodes=this.node.querySelectorAll(selector);if(nodes)for(var i=0;i<nodes.length;i++)vels.push(V(nodes[i]));return vels},V.prototype.index=function(){for(var index=0,node=this.node.previousSibling;node;)1===node.nodeType&&index++,node=node.previousSibling;return index},V.prototype.findParentByClass=function(className,terminator){for(var ownerSVGElement=this.node.ownerSVGElement,node=this.node.parentNode;node&&node!==terminator&&node!==ownerSVGElement;){var vel=V(node);if(vel.hasClass(className))return vel;node=node.parentNode}return null},V.prototype.toLocalPoint=function(x,y){var svg=this.svg().node,p=svg.createSVGPoint();p.x=x,p.y=y;try{var globalPoint=p.matrixTransform(svg.getScreenCTM().inverse()),globalToLocalMatrix=this.getTransformToElement(svg).inverse()}catch(e){return p}return globalPoint.matrixTransform(globalToLocalMatrix)},V.prototype.translateCenterToPoint=function(p){var bbox=this.bbox(),center=g.rect(bbox).center();this.translate(p.x-center.x,p.y-center.y)},V.prototype.translateAndAutoOrient=function(position,reference,target){var s=this.scale();this.attr("transform",""),this.scale(s.sx,s.sy);var svg=this.svg().node,bbox=this.bbox(!1,target),translateToOrigin=svg.createSVGTransform();translateToOrigin.setTranslate(-bbox.x-bbox.width/2,-bbox.y-bbox.height/2);var rotateAroundOrigin=svg.createSVGTransform(),angle=g.point(position).changeInAngle(position.x-reference.x,position.y-reference.y,reference);rotateAroundOrigin.setRotate(angle,0,0);var translateFinal=svg.createSVGTransform(),finalPosition=g.point(position).move(reference,bbox.width/2);translateFinal.setTranslate(position.x+(position.x-finalPosition.x),position.y+(position.y-finalPosition.y));var ctm=this.getTransformToElement(target),transform=svg.createSVGTransform();transform.setMatrix(translateFinal.matrix.multiply(rotateAroundOrigin.matrix.multiply(translateToOrigin.matrix.multiply(ctm))));var decomposition=V.decomposeMatrix(transform.matrix);return this.translate(decomposition.translateX,decomposition.translateY),this.rotate(decomposition.rotation),this},V.prototype.animateAlongPath=function(attrs,path){var animateMotion=V("animateMotion",attrs),mpath=V("mpath",{"xlink:href":"#"+V(path).node.id});animateMotion.append(mpath),this.append(animateMotion);try{animateMotion.node.beginElement()}catch(e){if("fake"===document.documentElement.getAttribute("smiling")){var animation=animateMotion.node;animation.animators=[];var animationID=animation.getAttribute("id");animationID&&(id2anim[animationID]=animation);for(var targets=getTargets(animation),i=0,len=targets.length;i<len;i++){var target=targets[i],animator=new Animator(animation,target,i);animators.push(animator),(animation.animators[i]=animator).register()}}}},V.prototype.hasClass=function(className){return new RegExp("(\\s|^)"+className+"(\\s|$)").test(this.node.getAttribute("class"))},V.prototype.addClass=function(className){if(!this.hasClass(className)){var prevClasses=this.node.getAttribute("class")||"";this.node.setAttribute("class",(prevClasses+" "+className).trim())}return this},V.prototype.removeClass=function(className){if(this.hasClass(className)){var newClasses=this.node.getAttribute("class").replace(new RegExp("(\\s|^)"+className+"(\\s|$)","g"),"$2");this.node.setAttribute("class",newClasses)}return this},V.prototype.toggleClass=function(className,toAdd){var toRemove=V.isUndefined(toAdd)?this.hasClass(className):!toAdd;return toRemove?this.removeClass(className):this.addClass(className),this},V.prototype.sample=function(interval){interval=interval||1;for(var sample,node=this.node,length=node.getTotalLength(),samples=[],distance=0;distance<length;)sample=node.getPointAtLength(distance),samples.push({x:sample.x,y:sample.y,distance:distance}),distance+=interval;return samples},V.prototype.convertToPath=function(){var path=V("path");path.attr(this.attr());var d=this.convertToPathData();return d&&path.attr("d",d),path},V.prototype.convertToPathData=function(){var tagName=this.node.tagName.toUpperCase();switch(tagName){case"PATH":return this.attr("d");case"LINE":return V.convertLineToPathData(this.node);case"POLYGON":return V.convertPolygonToPathData(this.node);case"POLYLINE":return V.convertPolylineToPathData(this.node);case"ELLIPSE":return V.convertEllipseToPathData(this.node);case"CIRCLE":return V.convertCircleToPathData(this.node);case"RECT":return V.convertRectToPathData(this.node)}throw new Error(tagName+" cannot be converted to PATH.")},V.prototype.findIntersection=function(ref,target){var svg=this.svg().node;target=target||svg;var bbox=g.rect(this.bbox(!1,target)),center=bbox.center();if(bbox.intersectionWithLineFromCenterToPoint(ref)){var spot,tagName=this.node.localName.toUpperCase();if("RECT"===tagName){var gRect=g.rect(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height"))),rectMatrix=this.getTransformToElement(target),rectMatrixComponents=V.decomposeMatrix(rectMatrix),resetRotation=svg.createSVGTransform();resetRotation.setRotate(-rectMatrixComponents.rotation,center.x,center.y);var rect=V.transformRect(gRect,resetRotation.matrix.multiply(rectMatrix));spot=g.rect(rect).intersectionWithLineFromCenterToPoint(ref,rectMatrixComponents.rotation)}else if("PATH"===tagName||"POLYGON"===tagName||"POLYLINE"===tagName||"CIRCLE"===tagName||"ELLIPSE"===tagName){var i,sample,gp,centerDistance,refDistance,distance,pathNode="PATH"===tagName?this:this.convertToPath(),samples=pathNode.sample(),minDistance=1/0,closestSamples=[];for(i=0;i<samples.length;i++)sample=samples[i],gp=(gp=V.createSVGPoint(sample.x,sample.y)).matrixTransform(this.getTransformToElement(target)),sample=g.point(gp),centerDistance=sample.distance(center),refDistance=1.1*sample.distance(ref),(distance=centerDistance+refDistance)<minDistance?(minDistance=distance,closestSamples=[{sample:sample,refDistance:refDistance}]):distance<minDistance+1&&closestSamples.push({sample:sample,refDistance:refDistance});closestSamples.sort(function(a,b){return a.refDistance-b.refDistance}),closestSamples[0]&&(spot=closestSamples[0].sample)}return spot}},V.prototype.setAttribute=function(name,value){var el=this.node;if(null===value)return this.removeAttr(name),this;var qualifiedName=V.qualifyAttr(name);return qualifiedName.ns?el.setAttributeNS(qualifiedName.ns,name,value):"id"===name?el.id=value:el.setAttribute(name,value),this},V.createSvgDocument=function(content){var svg='<svg xmlns="'+ns.xmlns+'" xmlns:xlink="'+ns.xlink+'" version="1.1">'+(content||"")+"</svg>",xml=V.parseXML(svg,{async:!1});return xml.documentElement},V.idCounter=0,V.uniqueId=function(){var id=++V.idCounter+"";return"v-"+id},V.sanitizeText=function(text){return(text||"").replace(/ /g," ")},V.isUndefined=function(value){return void 0===value},V.isString=function(value){return"string"==typeof value},V.isObject=function(value){return value&&"object"==typeof value},V.isArray=Array.isArray,V.parseXML=function(data,opt){var xml;opt=opt||{};try{var parser=new DOMParser;V.isUndefined(opt.async)||(parser.async=opt.async),xml=parser.parseFromString(data,"text/xml")}catch(error){xml=void 0}if(!xml||xml.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+data);return xml},V.qualifyAttr=function(name){if(-1===name.indexOf(":"))return{ns:null,local:name};var combinedKey=name.split(":");return{ns:ns[combinedKey[0]],local:combinedKey[1]}},V.parseTransformString=function(transform){var translate,rotate,scale;if(transform){var separator=/[ ,]+/,translateMatch=transform.match(/translate\((.*)\)/);translateMatch&&(translate=translateMatch[1].split(separator));var rotateMatch=transform.match(/rotate\((.*)\)/);rotateMatch&&(rotate=rotateMatch[1].split(separator));var scaleMatch=transform.match(/scale\((.*)\)/);scaleMatch&&(scale=scaleMatch[1].split(separator))}var sx=scale&&scale[0]?parseFloat(scale[0]):1;return{translate:{tx:translate&&translate[0]?parseInt(translate[0],10):0,ty:translate&&translate[1]?parseInt(translate[1],10):0},rotate:{angle:rotate&&rotate[0]?parseInt(rotate[0],10):0,cx:rotate&&rotate[1]?parseInt(rotate[1],10):void 0,cy:rotate&&rotate[2]?parseInt(rotate[2],10):void 0},scale:{sx:sx,sy:scale&&scale[1]?parseFloat(scale[1]):sx}}},V.deltaTransformPoint=function(matrix,point){var dx=point.x*matrix.a+point.y*matrix.c+0,dy=point.x*matrix.b+point.y*matrix.d+0;return{x:dx,y:dy}},V.decomposeMatrix=function(matrix){var px=V.deltaTransformPoint(matrix,{x:0,y:1}),py=V.deltaTransformPoint(matrix,{x:1,y:0}),skewX=180/Math.PI*Math.atan2(px.y,px.x)-90,skewY=180/Math.PI*Math.atan2(py.y,py.x);return{translateX:matrix.e,translateY:matrix.f,scaleX:Math.sqrt(matrix.a*matrix.a+matrix.b*matrix.b),scaleY:Math.sqrt(matrix.c*matrix.c+matrix.d*matrix.d),skewX:skewX,skewY:skewY,rotation:skewX}},V.isV=function(object){return object instanceof V},V.isVElement=V.isV;var svgDocument=V("svg").node;return V.createSVGMatrix=function(matrix){var svgMatrix=svgDocument.createSVGMatrix();for(var component in matrix)svgMatrix[component]=matrix[component];return svgMatrix},V.createSVGTransform=function(matrix){return V.isUndefined(matrix)?svgDocument.createSVGTransform():(matrix instanceof SVGMatrix||(matrix=V.createSVGMatrix(matrix)),svgDocument.createSVGTransformFromMatrix(matrix))},V.createSVGPoint=function(x,y){var p=svgDocument.createSVGPoint();return p.x=x,p.y=y,p},V.transformRect=function(r,matrix){var p=svgDocument.createSVGPoint();p.x=r.x,p.y=r.y;var corner1=p.matrixTransform(matrix);p.x=r.x+r.width,p.y=r.y;var corner2=p.matrixTransform(matrix);p.x=r.x+r.width,p.y=r.y+r.height;var corner3=p.matrixTransform(matrix);p.x=r.x,p.y=r.y+r.height;var corner4=p.matrixTransform(matrix),minX=Math.min(corner1.x,corner2.x,corner3.x,corner4.x),maxX=Math.max(corner1.x,corner2.x,corner3.x,corner4.x),minY=Math.min(corner1.y,corner2.y,corner3.y,corner4.y),maxY=Math.max(corner1.y,corner2.y,corner3.y,corner4.y);return{x:minX,y:minY,width:maxX-minX,height:maxY-minY}},V.transformPoint=function(p,matrix){return V.createSVGPoint(p.x,p.y).matrixTransform(matrix)},V.styleToObject=function(styleString){for(var ret={},styles=styleString.split(";"),i=0;i<styles.length;i++){var style=styles[i],pair=style.split("=");ret[pair[0].trim()]=pair[1].trim()}return ret},V.createSlicePathData=function(innerRadius,outerRadius,startAngle,endAngle){var svgArcMax=2*Math.PI-1e-6,r0=innerRadius,r1=outerRadius,a0=startAngle,a1=endAngle,da=(a1<a0&&(da=a0,a0=a1,a1=da),a1-a0),df=da<Math.PI?"0":"1",c0=Math.cos(a0),s0=Math.sin(a0),c1=Math.cos(a1),s1=Math.sin(a1);return svgArcMax<=da?r0?"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"M0,"+r0+"A"+r0+","+r0+" 0 1,0 0,"+-r0+"A"+r0+","+r0+" 0 1,0 0,"+r0+"Z":"M0,"+r1+"A"+r1+","+r1+" 0 1,1 0,"+-r1+"A"+r1+","+r1+" 0 1,1 0,"+r1+"Z":r0?"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L"+r0*c1+","+r0*s1+"A"+r0+","+r0+" 0 "+df+",0 "+r0*c0+","+r0*s0+"Z":"M"+r1*c0+","+r1*s0+"A"+r1+","+r1+" 0 "+df+",1 "+r1*c1+","+r1*s1+"L0,0Z"},V.mergeAttrs=function(a,b){for(var attr in b)"class"===attr?a[attr]=a[attr]?a[attr]+" "+b[attr]:b[attr]:"style"===attr?V.isObject(a[attr])&&V.isObject(b[attr])?a[attr]=V.mergeAttrs(a[attr],b[attr]):V.isObject(a[attr])?a[attr]=V.mergeAttrs(a[attr],V.styleToObject(b[attr])):V.isObject(b[attr])?a[attr]=V.mergeAttrs(V.styleToObject(a[attr]),b[attr]):a[attr]=V.mergeAttrs(V.styleToObject(a[attr]),V.styleToObject(b[attr])):a[attr]=b[attr];return a},V.annotateString=function(t,annotations,opt){annotations=annotations||[];for(var batch,item,prev,offset=(opt=opt||{}).offset||0,compacted=[],ret=[],i=0;i<t.length;i++){item=ret[i]=t[i];for(var j=0;j<annotations.length;j++){var annotation=annotations[j],start=annotation.start+offset,end=annotation.end+offset;start<=i&&i<end&&(V.isObject(item)?item.attrs=V.mergeAttrs(V.mergeAttrs({},item.attrs),annotation.attrs):item=ret[i]={t:t[i],attrs:annotation.attrs},opt.includeAnnotationIndices&&(item.annotations||(item.annotations=[])).push(j))}(prev=ret[i-1])?V.isObject(item)&&V.isObject(prev)?JSON.stringify(item.attrs)===JSON.stringify(prev.attrs)?batch.t+=item.t:(compacted.push(batch),batch=item):batch=V.isObject(item)?(compacted.push(batch),item):V.isObject(prev)?(compacted.push(batch),item):(batch||"")+item:batch=item}return batch&&compacted.push(batch),compacted},V.findAnnotationsAtIndex=function(annotations,index){var found=[];return annotations&&annotations.forEach(function(annotation){annotation.start<index&&index<=annotation.end&&found.push(annotation)}),found},V.findAnnotationsBetweenIndexes=function(annotations,start,end){var found=[];return annotations&&annotations.forEach(function(annotation){(start>=annotation.start&&start<annotation.end||end>annotation.start&&end<=annotation.end||annotation.start>=start&&annotation.end<end)&&found.push(annotation)}),found},V.shiftAnnotations=function(annotations,index,offset){return annotations&&annotations.forEach(function(annotation){annotation.start<index&&annotation.end>=index?annotation.end+=offset:annotation.start>=index&&(annotation.start+=offset,annotation.end+=offset)}),annotations},V.convertLineToPathData=function(line){var d=["M",(line=V(line)).attr("x1"),line.attr("y1"),"L",line.attr("x2"),line.attr("y2")].join(" ");return d},V.convertPolygonToPathData=function(polygon){polygon=V(polygon);var points=V.getPointsFromSvgNode(polygon.node);return 0<points.length?V.svgPointsToPath(points):null},V.convertPolylineToPathData=function(polyline){var points=V.getPointsFromSvgNode(polyline.node);return 0<points.length?V.svgPointsToPath(points):null},V.svgPointsToPath=function(points){var i;for(i=0;i<points.length;i++)points[i]=points[i].x+" "+points[i].y;return"M "+points.join(" L")+" Z"},V.getPointsFromSvgNode=function(node){var i,points=[];for(i=0;i<node.points.numberOfItems;i++)points.push(node.points.getItem(i));return points},V.KAPPA=.5522847498307935,V.convertCircleToPathData=function(circle){circle=V(circle);var cx=parseFloat(circle.attr("cx"))||0,cy=parseFloat(circle.attr("cy"))||0,r=parseFloat(circle.attr("r")),cd=r*V.KAPPA,d=["M",cx,cy-r,"C",cx+cd,cy-r,cx+r,cy-cd,cx+r,cy,"C",cx+r,cy+cd,cx+cd,cy+r,cx,cy+r,"C",cx-cd,cy+r,cx-r,cy+cd,cx-r,cy,"C",cx-r,cy-cd,cx-cd,cy-r,cx,cy-r,"Z"].join(" ");return d},V.convertEllipseToPathData=function(ellipse){ellipse=V(ellipse);var cx=parseFloat(ellipse.attr("cx"))||0,cy=parseFloat(ellipse.attr("cy"))||0,rx=parseFloat(ellipse.attr("rx")),ry=parseFloat(ellipse.attr("ry"))||rx,cdx=rx*V.KAPPA,cdy=ry*V.KAPPA,d=["M",cx,cy-ry,"C",cx+cdx,cy-ry,cx+rx,cy-cdy,cx+rx,cy,"C",cx+rx,cy+cdy,cx+cdx,cy+ry,cx,cy+ry,"C",cx-cdx,cy+ry,cx-rx,cy+cdy,cx-rx,cy,"C",cx-rx,cy-cdy,cx-cdx,cy-ry,cx,cy-ry,"Z"].join(" ");return d},V.convertRectToPathData=function(rect){rect=V(rect);var d,x=parseFloat(rect.attr("x"))||0,y=parseFloat(rect.attr("y"))||0,width=parseFloat(rect.attr("width"))||0,height=parseFloat(rect.attr("height"))||0,rx=parseFloat(rect.attr("rx"))||0,ry=parseFloat(rect.attr("ry"))||0,bbox=g.rect(x,y,width,height);if(rx||ry){var r=x+width,b=y+height;d=["M",x+rx,y,"L",r-rx,y,"Q",r,y,r,y+ry,"L",r,y+height-ry,"Q",r,b,r-rx,b,"L",x+rx,b,"Q",x,b,x,b-rx,"L",x,y+ry,"Q",x,y,x+rx,y,"Z"].join(" ")}else d=["M",bbox.origin().x,bbox.origin().y,"H",bbox.corner().x,"V",bbox.corner().y,"H",bbox.origin().x,"V",bbox.origin().y,"Z"].join(" ");return d},V.rectToPath=function(r){var topRx=r.rx||r["top-rx"]||0,bottomRx=r.rx||r["bottom-rx"]||0,topRy=r.ry||r["top-ry"]||0,bottomRy=r.ry||r["bottom-ry"]||0;return["M",r.x,r.y+topRy,"v",r.height-topRy-bottomRy,"a",bottomRx,bottomRy,0,0,0,bottomRx,bottomRy,"h",r.width-2*bottomRx,"a",bottomRx,bottomRy,0,0,0,bottomRx,-bottomRy,"v",-(r.height-bottomRy-topRy),"a",topRx,topRy,0,0,0,-topRx,-topRy,"h",-(r.width-2*topRx),"a",topRx,topRy,0,0,0,-topRx,topRy].join(" ")},V.toNode=function(el){return V.isV(el)?el.node:el.nodeName&&el||el[0]},V}();var joint={version:"0.9.7",dia:{},ui:{},layout:{},shapes:{},format:{},connectors:{},highlighters:{},routers:{},mvc:{views:{}},setTheme:function(theme,opt){opt=opt||{},_.invoke(joint.mvc.views,"setTheme",theme,opt),joint.mvc.View.prototype.defaultTheme=theme},env:{_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))}},addTest:function(name,fn){return joint.env._tests[name]=fn},test:function(name){var fn=joint.env._tests[name];if(!fn)throw new Error('Test not defined ("'+name+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var result=joint.env._results[name];if(void 0!==result)return result;try{result=fn()}catch(error){result=!1}return joint.env._results[name]=result}},util:{hashCode:function(str){var hash=0;if(0==str.length)return hash;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);hash=(hash<<5)-hash+c,hash&=hash}return hash},getByPath:function(obj,path,delim){delim=delim||"/";for(var key,keys=path.split(delim);keys.length;){if(key=keys.shift(),!(Object(obj)===obj&&key in obj))return;obj=obj[key]}return obj},setByPath:function(obj,path,value,delim){delim=delim||"/";var keys=path.split(delim),diver=obj,i=0;if(-1<path.indexOf(delim)){for(var len=keys.length;i<len-1;i++)diver=diver[keys[i]]||(diver[keys[i]]={});diver[keys[len-1]]=value}else obj[path]=value;return obj},unsetByPath:function(obj,path,delim){delim=delim||"/";var i=path.lastIndexOf(delim);if(-1<i){var parent=joint.util.getByPath(obj,path.substr(0,i),delim);parent&&delete parent[path.slice(i+1)]}else delete obj[path];return obj},flattenObject:function(obj,delim,stop){delim=delim||"/";var ret={};for(var key in obj)if(obj.hasOwnProperty(key)){var shouldGoDeeper="object"==typeof obj[key];if(shouldGoDeeper&&stop&&stop(obj[key])&&(shouldGoDeeper=!1),shouldGoDeeper){var flatObject=this.flattenObject(obj[key],delim,stop);for(var flatKey in flatObject)flatObject.hasOwnProperty(flatKey)&&(ret[key+delim+flatKey]=flatObject[flatKey])}else ret[key]=obj[key]}return ret},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},guid:function(obj){return this.guid.id=this.guid.id||1,obj.id=void 0===obj.id?"j_"+this.guid.id++:obj.id,obj.id},mixin:function(){for(var target=arguments[0],i=1,l=arguments.length;i<l;i++){var extension=arguments[i];Object(extension)!==extension&&!_.isFunction(extension)&&null==extension||_.each(extension,function(copy,key){if(this.mixin.deep&&Object(copy)===copy)return target[key]||(target[key]=_.isArray(copy)?[]:{}),void this.mixin(target[key],copy);target[key]!==copy&&(this.mixin.supplement&&target.hasOwnProperty(key)||(target[key]=copy))},this)}return target},supplement:function(){this.mixin.supplement=!0;var ret=this.mixin.apply(this,arguments);return this.mixin.supplement=!1,ret},deepMixin:function(){this.mixin.deep=!0;var ret=this.mixin.apply(this,arguments);return this.mixin.deep=!1,ret},deepSupplement:function(){this.mixin.deep=this.mixin.supplement=!0;var ret=this.mixin.apply(this,arguments);return this.mixin.deep=this.mixin.supplement=!1,ret},normalizeEvent:function(evt){var touchEvt=evt.originalEvent&&evt.originalEvent.changedTouches&&evt.originalEvent.changedTouches[0];if(touchEvt){for(var property in evt)void 0===touchEvt[property]&&(touchEvt[property]=evt[property]);return touchEvt}return evt},nextFrame:function(){var raf;if("undefined"!=typeof window&&(raf=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!raf){var lastTime=0;raf=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}}return function(callback,context){return raf(context?_.bind(callback,context):callback)}}(),cancelFrame:function(){var caf,client="undefined"!=typeof window;return client&&(caf=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),caf=caf||clearTimeout,client?_.bind(caf,window):caf}(),shapePerimeterConnectionPoint:function(linkView,view,magnet,reference){var bbox,spot;if(!magnet){var scalable=view.$(".scalable")[0],rotatable=view.$(".rotatable")[0];scalable&&scalable.firstChild?magnet=scalable.firstChild:rotatable&&rotatable.firstChild&&(magnet=rotatable.firstChild)}return magnet?(spot=V(magnet).findIntersection(reference,linkView.paper.viewport))||(bbox=g.rect(V(magnet).bbox(!1,linkView.paper.viewport))):(bbox=view.model.getBBox(),spot=bbox.intersectionWithLineFromCenterToPoint(reference)),spot||bbox.center()},breakText:function(text,size,styles,opt){opt=opt||{};var width=size.width,height=size.height,svgDocument=opt.svgDocument||V("svg").node,textElement=V("<text><tspan></tspan></text>").attr(styles||{}).node,textSpan=textElement.firstChild,textNode=document.createTextNode("");textElement.style.opacity=0,textElement.style.display="block",textSpan.style.display="block",textSpan.appendChild(textNode),svgDocument.appendChild(textElement),opt.svgDocument||document.body.appendChild(svgDocument);for(var p,words=text.split(" "),full=[],lines=[],i=0,l=0,len=words.length;i<len;i++){var word=words[i];if(textNode.data=lines[l]?lines[l]+" "+word:word,textSpan.getComputedTextLength()<=width)lines[l]=textNode.data,p&&(full[l++]=!0,p=0);else{if(!lines[l]||p){var partition=!!p;if(p=word.length-1,partition||!p){if(!p){if(!lines[l]){lines=[];break}words.splice(i,2,word+words[i+1]),len--,full[l++]=!0,i--;continue}words[i]=word.substring(0,p),words[i+1]=word.substring(p)+words[i+1]}else words.splice(i,1,word.substring(0,p),word.substring(p)),len++,l&&!full[l-1]&&l--;i--;continue}l++,i--}if(void 0!==height){var lh=lh||1.25*textElement.getBBox().height;if(lh*lines.length>height){lines.splice(Math.floor(height/lh));break}}}return opt.svgDocument?svgDocument.removeChild(textElement):document.body.removeChild(svgDocument),lines.join("\n")},imageToDataUri:function(url,callback){if(!url||"data:"===url.substr(0,"data:".length))return setTimeout(function(){callback(null,url)},0);var canvas=document.createElement("canvas"),img=document.createElement("img");img.onload=function(){var ctx=canvas.getContext("2d");canvas.width=img.width,canvas.height=img.height,ctx.drawImage(img,0,0);try{url.split(".").pop();var dataUri=canvas.toDataURL("jpeg")}catch(e){if(/\.svg$/.test(url)){var xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xhr.open("GET",url,!1),xhr.send(null);var svg=xhr.responseText;return callback(null,"data:image/svg+xml,"+encodeURIComponent(svg))}console.error(img.src,"fails to convert",e)}callback(null,dataUri)},img.ononerror=function(){callback(new Error("Failed to load image."))},img.src=url},getElementBBox:function(el){var bbox,$el=$(el),offset=$el.offset();if(el.ownerSVGElement){bbox=V(el).bbox();var crect=el.getBoundingClientRect(),strokeWidthX=(crect.width-bbox.width)/2,strokeWidthY=(crect.height-bbox.height)/2;bbox.x=offset.left+strokeWidthX,bbox.y=offset.top+strokeWidthY}else bbox={x:offset.left,y:offset.top,width:$el.outerWidth(),height:$el.outerHeight()};return bbox},sortElements:function(elements,comparator){var $elements=$(elements),placements=$elements.map(function(){var parentNode=this.parentNode,nextSibling=parentNode.insertBefore(document.createTextNode(""),this.nextSibling);return function(){if(parentNode===this)throw new Error("You can't sort elements if any one is a descendant of another.");parentNode.insertBefore(this,nextSibling),parentNode.removeChild(nextSibling)}});return Array.prototype.sort.call($elements,comparator).each(function(i){placements[i].call(this)})},setAttributesBySelector:function(element,attrs){var $element=$(element);_.each(attrs,function(attrs,selector){var $elements=$element.find(selector).addBack().filter(selector);_.has(attrs,"class")&&($elements.addClass(attrs.class),attrs=_.omit(attrs,"class")),$elements.attr(attrs)})},normalizeSides:function(box){return Object(box)!==box?{top:box=box||0,bottom:box,left:box,right:box}:{top:box.top||0,bottom:box.bottom||0,left:box.left||0,right:box.right||0}},timing:{linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(1<=t)return 1;var t2=t*t,t3=t2*t;return 4*(t<.5?t3:3*(t-t2)+t3-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var a=0,b=1;;a+=b,b/=2)if((7-4*a)/11<=t){var q=(11-6*a-11*t)/4;return-q*q+b*b}},reverse:function(f){return function(t){return 1-f(1-t)}},reflect:function(f){return function(t){return.5*(t<.5?f(2*t):2-f(2-2*t))}},clamp:function(f,n,x){return n=n||0,x=x||1,function(t){var r=f(t);return r<n?n:x<r?x:r}},back:function(s){return s=s||1.70158,function(t){return t*t*((s+1)*t-s)}},elastic:function(x){return x=x||1.5,function(t){return Math.pow(2,10*(t-1))*Math.cos(20*Math.PI*x/3*t)}}},interpolate:{number:function(a,b){var d=b-a;return function(t){return a+d*t}},object:function(a,b){var s=_.keys(a);return function(t){var i,p,r={};for(i=s.length-1;-1!=i;i--)p=s[i],r[p]=a[p]+(b[p]-a[p])*t;return r}},hexColor:function(a,b){var ca=parseInt(a.slice(1),16),cb=parseInt(b.slice(1),16),ra=255&ca,rd=(255&cb)-ra,ga=65280&ca,gd=(65280&cb)-ga,ba=16711680&ca,bd=(16711680&cb)-ba;return function(t){var r=ra+rd*t&255,g=ga+gd*t&65280,b=ba+bd*t&16711680;return"#"+(1<<24|r|g|b).toString(16).slice(1)}},unit:function(a,b){var r=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,ma=r.exec(a),mb=r.exec(b),p=mb[1].indexOf("."),f=0<p?mb[1].length-p-1:0;a=+ma[1];var d=+mb[1]-a,u=ma[2];return function(t){return(a+d*t).toFixed(f)+u}}},filter:{outline:function(args){var margin=_.isFinite(args.margin)?args.margin:2,width=_.isFinite(args.width)?args.width:1;return joint.util.template('<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>')({color:args.color||"blue",opacity:_.isFinite(args.opacity)?args.opacity:1,outerRadius:margin+width,innerRadius:margin})},highlight:function(args){return joint.util.template('<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>')({color:args.color||"red",width:_.isFinite(args.width)?args.width:1,blur:_.isFinite(args.blur)?args.blur:0,opacity:_.isFinite(args.opacity)?args.opacity:1})},blur:function(args){var x=_.isFinite(args.x)?args.x:2;return joint.util.template('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:_.isFinite(args.y)?[x,args.y]:x})},dropShadow:function(args){var tpl="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return joint.util.template(tpl)({dx:args.dx||0,dy:args.dy||0,opacity:_.isFinite(args.opacity)?args.opacity:1,color:args.color||"black",blur:_.isFinite(args.blur)?args.blur:4})},grayscale:function(args){var amount=_.isFinite(args.amount)?args.amount:1;return joint.util.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-amount),b:.7152-.7152*(1-amount),c:.0722-.0722*(1-amount),d:.2126-.2126*(1-amount),e:.7152+.2848*(1-amount),f:.0722-.0722*(1-amount),g:.2126-.2126*(1-amount),h:.0722+.9278*(1-amount)})},sepia:function(args){var amount=_.isFinite(args.amount)?args.amount:1;return joint.util.template('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-amount),b:.769-.769*(1-amount),c:.189-.189*(1-amount),d:.349-.349*(1-amount),e:.686+.314*(1-amount),f:.168-.168*(1-amount),g:.272-.272*(1-amount),h:.534-.534*(1-amount),i:.131+.869*(1-amount)})},saturate:function(args){var amount=_.isFinite(args.amount)?args.amount:1;return joint.util.template('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-amount})},hueRotate:function(args){return joint.util.template('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:args.angle||0})},invert:function(args){var amount=_.isFinite(args.amount)?args.amount:1;return joint.util.template('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:amount,amount2:1-amount})},brightness:function(args){return joint.util.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:_.isFinite(args.amount)?args.amount:1})},contrast:function(args){var amount=_.isFinite(args.amount)?args.amount:1;return joint.util.template('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:amount,amount2:.5-amount/2})}},format:{number:function(specifier,value,locale){locale=locale||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var match=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i.exec(specifier),fill=match[1]||" ",align=match[2]||">",sign=match[3]||"",symbol=match[4]||"",zfill=match[5],width=+match[6],comma=match[7],precision=match[8],type=match[9],scale=1,prefix="",suffix="",integer=!1;switch(precision=precision&&+precision.substring(1),(zfill||"0"===fill&&"="===align)&&(zfill=fill="0",align="=",comma&&(width-=Math.floor((width-1)/4))),type){case"n":comma=!0,type="g";break;case"%":scale=100,suffix="%",type="f";break;case"p":scale=100,suffix="%",type="r";break;case"b":case"o":case"x":case"X":"#"===symbol&&(prefix="0"+type.toLowerCase());case"c":case"d":integer=!0,precision=0;break;case"s":scale=-1,type="r"}"$"===symbol&&(prefix=locale.currency[0],suffix=locale.currency[1]),"r"!=type||precision||(type="g"),null!=precision&&("g"==type?precision=Math.max(1,Math.min(21,precision)):"e"!=type&&"f"!=type||(precision=Math.max(0,Math.min(20,precision))));var zcomma=zfill&&comma;if(integer&&value%1)return"";var negative=value<0||0===value&&1/value<0?(value=-value,"-"):sign,fullSuffix=suffix;if(scale<0){var unit=this.prefix(value,precision);value=unit.scale(value),fullSuffix=unit.symbol+suffix}else value*=scale;var i=(value=this.convert(type,value,precision)).lastIndexOf("."),before=i<0?value:value.substring(0,i),after=i<0?"":locale.decimal+value.substring(i+1);function formatGroup(value){for(var i=value.length,t=[],j=0,g=locale.grouping[0];0<i&&0<g;)t.push(value.substring(i-=g,i+g)),g=locale.grouping[j=(j+1)%locale.grouping.length];return t.reverse().join(locale.thousands)}!zfill&&comma&&locale.grouping&&(before=formatGroup(before));var length=prefix.length+before.length+after.length+(zcomma?0:negative.length),padding=length<width?new Array(length=width-length+1).join(fill):"";return zcomma&&(before=formatGroup(padding+before)),negative+=prefix,value=before+after,("<"===align?negative+value+padding:">"===align?padding+negative+value:"^"===align?padding.substring(0,length>>=1)+negative+value+padding.substring(length):negative+(zcomma?value:padding+value))+fullSuffix},string:function(formatString,value){for(var fieldDelimiterIndex,fieldDelimiter="{",endPlaceholder=!1,formattedStringArray=[];-1!==(fieldDelimiterIndex=formatString.indexOf(fieldDelimiter));){var pieceFormatedString,formatSpec,fieldName;if(pieceFormatedString=formatString.slice(0,fieldDelimiterIndex),endPlaceholder){formatSpec=pieceFormatedString.split(":"),fieldName=formatSpec.shift().split("."),pieceFormatedString=value;for(var i=0;i<fieldName.length;i++)pieceFormatedString=pieceFormatedString[fieldName[i]];formatSpec.length&&(pieceFormatedString=this.number(formatSpec,pieceFormatedString))}formattedStringArray.push(pieceFormatedString),formatString=formatString.slice(fieldDelimiterIndex+1),fieldDelimiter=(endPlaceholder=!endPlaceholder)?"}":"{"}return formattedStringArray.push(formatString),formattedStringArray.join("")},convert:function(type,value,precision){switch(type){case"b":return value.toString(2);case"c":return String.fromCharCode(value);case"o":return value.toString(8);case"x":return value.toString(16);case"X":return value.toString(16).toUpperCase();case"g":return value.toPrecision(precision);case"e":return value.toExponential(precision);case"f":return value.toFixed(precision);case"r":return(value=this.round(value,this.precision(value,precision))).toFixed(Math.max(0,Math.min(20,this.precision(value*(1+1e-15),precision))));default:return value+""}},round:function(value,precision){return precision?Math.round(value*(precision=Math.pow(10,precision)))/precision:Math.round(value)},precision:function(value,precision){return precision-(value?Math.ceil(Math.log(value)/Math.LN10):1)},prefix:function(value,precision){var prefixes=_.map(["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"],function(d,i){var k=Math.pow(10,3*Math.abs(8-i));return{scale:8<i?function(d){return d/k}:function(d){return d*k},symbol:d}}),i=0;return value&&(value<0&&(value*=-1),precision&&(value=this.round(value,this.precision(value,precision))),i=1+Math.floor(1e-12+Math.log(value)/Math.LN10),i=Math.max(-24,Math.min(24,3*Math.floor((i<=0?i+1:i-1)/3)))),prefixes[8+i/3]}},template:function(html){var regex=/<%= ([^ ]+) %>|\$\{ ?([^\{\} ]+) ?\}|\{\{([^\{\} ]+)\}\}/g;return function(data){return html.replace(regex,function(match){for(var args=Array.prototype.slice.call(arguments),attr=_.find(args.slice(1,4),function(_attr){return!!_attr}),attrArray=attr.split("."),value=data[attrArray.shift()];!_.isUndefined(value)&&attrArray.length;)value=value[attrArray.shift()];return _.isUndefined(value)?"":value})}},toggleFullScreen:function(el){function prefixedResult(el,prop){for(var prefixes=["webkit","moz","ms","o",""],i=0;i<prefixes.length;i++){var prefix=prefixes[i],propName=prefix?prefix+prop:prop.substr(0,1).toLowerCase()+prop.substr(1);if(!_.isUndefined(el[propName]))return _.isFunction(el[propName])?el[propName]():el[propName]}}el=el||document.body,prefixedResult(document,"FullScreen")||prefixedResult(document,"IsFullScreen")?prefixedResult(document,"CancelFullScreen"):prefixedResult(el,"RequestFullScreen")},wrapWith:function(object,methods,wrapper){if(_.isString(wrapper)){if(!joint.util.wrappers[wrapper])throw new Error('Unknown wrapper: "'+wrapper+'"');wrapper=joint.util.wrappers[wrapper]}if(!_.isFunction(wrapper))throw new Error("Wrapper must be a function.");_.each(methods,function(method){object[method]=wrapper(object[method])})},wrappers:{cells:function(fn){return function(){var args=Array.prototype.slice.call(arguments),cells=0<args.length&&_.first(args)||[],opt=1<args.length&&_.last(args)||{};return _.isArray(cells)||(opt instanceof joint.dia.Cell?(cells=args,opt={}):cells=_.initial(args)),fn.call(this,cells,opt)}}}}};joint.mvc.View=Backbone.View.extend({options:{},theme:null,themeClassNamePrefix:"joint-theme-",requireSetThemeOverride:!1,defaultTheme:"default",constructor:function(options){Backbone.View.call(this,options)},initialize:function(options){this.requireSetThemeOverride=options&&!!options.theme,this.options=_.extend({},this.options,options),_.bindAll(this,"setTheme","onSetTheme","remove","onRemove"),(joint.mvc.views[this.cid]=this).setTheme(this.options.theme||this.defaultTheme),this._ensureElClassName(),this.init()},_ensureElClassName:function(){var className=_.result(this,"className");this.$el.addClass(className)},init:function(){},onRender:function(){},setTheme:function(theme,opt){if(opt=opt||{},!this.theme||!this.requireSetThemeOverride||opt.override)return this.theme&&this.$el.removeClass(this.themeClassNamePrefix+this.theme),this.$el.addClass(this.themeClassNamePrefix+theme),this.onSetTheme(this.theme,theme),this.theme=theme,this},onSetTheme:function(oldTheme,newTheme){},remove:function(){return this.onRemove(),joint.mvc.views[this.cid]=null,Backbone.View.prototype.remove.apply(this,arguments),this},onRemove:function(){}}),joint.mvc.View._extend=joint.mvc.View.extend,joint.mvc.View.extend=function(protoProps,staticProps){var render=(protoProps=protoProps||{}).render||this.prototype.render||null;return protoProps.render=function(){return render&&render.apply(this,arguments),this.onRender(),this},joint.mvc.View._extend.call(this,protoProps,staticProps)},joint.dia.GraphCells=Backbone.Collection.extend({cellNamespace:joint.shapes,initialize:function(models,opt){opt.cellNamespace&&(this.cellNamespace=opt.cellNamespace),this.graph=opt.graph},model:function(attrs,options){var collection=options.collection,namespace=collection.cellNamespace,cell=new("link"===attrs.type?joint.dia.Link:joint.util.getByPath(namespace,attrs.type,".")||joint.dia.Element)(attrs,options);return cell.graph=collection.graph,cell},comparator:function(model){return model.get("z")||0}}),joint.dia.Graph=Backbone.Model.extend({_batches:{},initialize:function(attrs,opt){opt=opt||{};var cells=new joint.dia.GraphCells([],{model:opt.cellModel,cellNamespace:opt.cellNamespace,graph:this});Backbone.Model.prototype.set.call(this,"cells",cells),cells.on("all",this.trigger,this),this.on("change:z",this._sortOnChangeZ,this),this.on("batch:stop",this._onBatchStop,this),this._out={},this._in={},this._nodes={},this._edges={},cells.on("add",this._restructureOnAdd,this),cells.on("remove",this._restructureOnRemove,this),cells.on("reset",this._restructureOnReset,this),cells.on("change:source",this._restructureOnChangeSource,this),cells.on("change:target",this._restructureOnChangeTarget,this),cells.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.hasActiveBatch("to-front")||this.hasActiveBatch("to-back")||this.get("cells").sort()},_onBatchStop:function(data){var batchName=data&&data.batchName;"to-front"!==batchName&&"to-back"!==batchName||this.hasActiveBatch(batchName)||this.get("cells").sort()},_restructureOnAdd:function(cell){if(cell.isLink()){this._edges[cell.id]=!0;var source=cell.get("source"),target=cell.get("target");source.id&&((this._out[source.id]||(this._out[source.id]={}))[cell.id]=!0),target.id&&((this._in[target.id]||(this._in[target.id]={}))[cell.id]=!0)}else this._nodes[cell.id]=!0},_restructureOnRemove:function(cell){if(cell.isLink()){delete this._edges[cell.id];var source=cell.get("source"),target=cell.get("target");source.id&&this._out[source.id]&&this._out[source.id][cell.id]&&delete this._out[source.id][cell.id],target.id&&this._in[target.id]&&this._in[target.id][cell.id]&&delete this._in[target.id][cell.id]}else delete this._nodes[cell.id]},_restructureOnReset:function(cells){cells=cells.models,this._out={},this._in={},this._nodes={},this._edges={},_.each(cells,this._restructureOnAdd,this)},_restructureOnChangeSource:function(link){var prevSource=link.previous("source");prevSource.id&&this._out[prevSource.id]&&delete this._out[prevSource.id][link.id];var source=link.get("source");source.id&&((this._out[source.id]||(this._out[source.id]={}))[link.id]=!0)},_restructureOnChangeTarget:function(link){var prevTarget=link.previous("target");prevTarget.id&&this._in[prevTarget.id]&&delete this._in[prevTarget.id][link.id];var target=link.get("target");target.id&&((this._in[target.id]||(this._in[target.id]={}))[link.id]=!0)},getOutboundEdges:function(node){return this._out&&this._out[node]||{}},getInboundEdges:function(node){return this._in&&this._in[node]||{}},toJSON:function(){var json=Backbone.Model.prototype.toJSON.apply(this,arguments);return json.cells=this.get("cells").toJSON(),json},fromJSON:function(json,opt){if(!json.cells)throw new Error("Graph JSON must contain cells array.");return this.set(json,opt)},set:function(key,val,opt){var attrs;return"object"==typeof key?(attrs=key,opt=val):(attrs={})[key]=val,attrs.hasOwnProperty("cells")&&(this.resetCells(attrs.cells,opt),attrs=_.omit(attrs,"cells")),Backbone.Model.prototype.set.call(this,attrs,opt)},clear:function(opt){opt=_.extend({},opt,{clear:!0});var collection=this.get("cells");if(0===collection.length)return this;this.startBatch("clear",opt);for(var cells=collection.sortBy(function(cell){return cell.isLink()?1:2});cells.shift().remove(opt),0<cells.length;);return this.stopBatch("clear"),this},_prepareCell:function(cell){var attrs;if(cell instanceof Backbone.Model?(attrs=cell.attributes,cell.graph=this):attrs=cell,!_.isString(attrs.type))throw new TypeError("dia.Graph: cell type must be a string.");return cell},maxZIndex:function(){var lastCell=this.get("cells").last();return lastCell&&lastCell.get("z")||0},addCell:function(cell,options){return _.isArray(cell)?this.addCells(cell,options):(cell instanceof Backbone.Model?cell.has("z")||cell.set("z",this.maxZIndex()+1):_.isUndefined(cell.z)&&(cell.z=this.maxZIndex()+1),this.get("cells").add(this._prepareCell(cell),options||{}),this)},addCells:function(cells,opt){return cells.length&&(opt.position=cells.length,this.startBatch("add"),_.each(cells,function(cell){opt.position--,this.addCell(cell,opt)},this),this.stopBatch("add")),this},resetCells:function(cells,opt){return this.get("cells").reset(_.map(cells,this._prepareCell,this),opt),this},removeCells:function(cells,opt){return cells.length&&(this.startBatch("remove"),_.invoke(cells,"remove",opt),this.stopBatch("remove")),this},_removeCell:function(cell,collection,options){(options=options||{}).clear||(options.disconnectLinks?this.disconnectLinks(cell,options):this.removeLinks(cell,options)),this.get("cells").remove(cell,{silent:!0}),delete cell.graph},getCell:function(id){return this.get("cells").get(id)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return _.map(this._nodes,function(exists,node){return this.getCell(node)},this)},getLinks:function(){return _.map(this._edges,function(exists,edge){return this.getCell(edge)},this)},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(model,opt){var inbound=(opt=opt||{}).inbound,outbound=opt.outbound;_.isUndefined(inbound)&&_.isUndefined(outbound)&&(inbound=outbound=!0);var links=[],edges={};if(outbound&&_.each(this.getOutboundEdges(model.id),function(exists,edge){edges[edge]||(links.push(this.getCell(edge)),edges[edge]=!0)},this),inbound&&_.each(this.getInboundEdges(model.id),function(exists,edge){edges[edge]||(links.push(this.getCell(edge)),edges[edge]=!0)},this),opt.deep){var embeddedCells=model.getEmbeddedCells({deep:!0}),embeddedEdges={};_.each(embeddedCells,function(cell){cell.isLink()&&(embeddedEdges[cell.id]=!0)}),_.each(embeddedCells,function(cell){cell.isLink()||(outbound&&_.each(this.getOutboundEdges(cell.id),function(exists,edge){edges[edge]||embeddedEdges[edge]||(links.push(this.getCell(edge)),edges[edge]=!0)},this),inbound&&_.each(this.getInboundEdges(cell.id),function(exists,edge){edges[edge]||embeddedEdges[edge]||(links.push(this.getCell(edge)),edges[edge]=!0)},this))},this)}return links},getNeighbors:function(model,opt){var inbound=(opt=opt||{}).inbound,outbound=opt.outbound;_.isUndefined(inbound)&&_.isUndefined(outbound)&&(inbound=outbound=!0);var neighbors=_.transform(this.getConnectedLinks(model,opt),function(res,link){var source=link.get("source"),target=link.get("target"),loop=link.hasLoop(opt);if(inbound&&_.has(source,"id")&&!res[source.id]){var sourceElement=this.getCell(source.id);!loop&&(!sourceElement||sourceElement===model||opt.deep&&sourceElement.isEmbeddedIn(model))||(res[source.id]=sourceElement)}if(outbound&&_.has(target,"id")&&!res[target.id]){var targetElement=this.getCell(target.id);!loop&&(!targetElement||targetElement===model||opt.deep&&targetElement.isEmbeddedIn(model))||(res[target.id]=targetElement)}},{},this);return _.values(neighbors)},getCommonAncestor:function(){var cellsAncestors=_.map(arguments,function(cell){for(var ancestors=[],parentId=cell.get("parent");parentId;)ancestors.push(parentId),parentId=this.getCell(parentId).get("parent");return ancestors},this);cellsAncestors=_.sortBy(cellsAncestors,"length");var commonAncestor=_.find(cellsAncestors.shift(),function(ancestor){return _.every(cellsAncestors,function(cellAncestors){return _.contains(cellAncestors,ancestor)})});return this.getCell(commonAncestor)},getSuccessors:function(element,opt){opt=opt||{};var res=[];return this.search(element,function(el){el!==element&&res.push(el)},_.extend({},opt,{outbound:!0})),res},cloneCells:function(cells){cells=_.unique(cells);var cloneMap=_.transform(cells,function(map,cell){map[cell.id]=cell.clone()},{});return _.each(cells,function(cell){var clone=cloneMap[cell.id];if(clone.isLink()){var source=clone.get("source"),target=clone.get("target");source.id&&cloneMap[source.id]&&clone.prop("source/id",cloneMap[source.id].id),target.id&&cloneMap[target.id]&&clone.prop("target/id",cloneMap[target.id].id)}var parent=cell.get("parent");parent&&cloneMap[parent]&&clone.set("parent",cloneMap[parent].id);var embeds=_.reduce(cell.get("embeds"),function(newEmbeds,embed){return cloneMap[embed]&&newEmbeds.push(cloneMap[embed].id),newEmbeds},[]);_.isEmpty(embeds)||clone.set("embeds",embeds)}),cloneMap},cloneSubgraph:function(cells,opt){var subgraph=this.getSubgraph(cells,opt);return this.cloneCells(subgraph)},getSubgraph:function(cells,opt){opt=opt||{};var subgraph=[],cellMap={},elements=[],links=[];return _.each(cells,function(cell){if(cellMap[cell.id]||(subgraph.push(cell),(cellMap[cell.id]=cell).isLink()?links.push(cell):elements.push(cell)),opt.deep){var embeds=cell.getEmbeddedCells({deep:!0});_.each(embeds,function(embed){cellMap[embed.id]||(subgraph.push(embed),(cellMap[embed.id]=embed).isLink()?links.push(embed):elements.push(embed))})}}),_.each(links,function(link){var source=link.get("source"),target=link.get("target");if(source.id&&!cellMap[source.id]){var sourceElement=this.getCell(source.id);subgraph.push(sourceElement),cellMap[sourceElement.id]=sourceElement,elements.push(sourceElement)}if(target.id&&!cellMap[target.id]){var targetElement=this.getCell(target.id);subgraph.push(this.getCell(target.id)),cellMap[targetElement.id]=targetElement,elements.push(targetElement)}},this),_.each(elements,function(element){var links=this.getConnectedLinks(element,opt);_.each(links,function(link){var source=link.get("source"),target=link.get("target");!cellMap[link.id]&&source.id&&cellMap[source.id]&&target.id&&cellMap[target.id]&&(subgraph.push(link),cellMap[link.id]=link)})},this),subgraph},getPredecessors:function(element,opt){opt=opt||{};var res=[];return this.search(element,function(el){el!==element&&res.push(el)},_.extend({},opt,{inbound:!0})),res},search:function(element,iteratee,opt){(opt=opt||{}).breadthFirst?this.bfs(element,iteratee,opt):this.dfs(element,iteratee,opt)},bfs:function(element,iteratee,opt){opt=opt||{};var visited={},distance={},queue=[];for(queue.push(element),distance[element.id]=0;0<queue.length;){var next=queue.shift();if(!visited[next.id]){if(!(visited[next.id]=!0)===iteratee(next,distance[next.id]))return;_.each(this.getNeighbors(next,opt),function(neighbor){distance[neighbor.id]=distance[next.id]+1,queue.push(neighbor)})}}},dfs:function(element,iteratee,opt,_visited,_distance){opt=opt||{};var visited=_visited||{},distance=_distance||0;!1!==iteratee(element,distance)&&(visited[element.id]=!0,_.each(this.getNeighbors(element,opt),function(neighbor){visited[neighbor.id]||this.dfs(neighbor,iteratee,opt,visited,distance+1)},this))},getSources:function(){var sources=[];return _.each(this._nodes,function(exists,node){this._in[node]&&!_.isEmpty(this._in[node])||sources.push(this.getCell(node))},this),sources},getSinks:function(){var sinks=[];return _.each(this._nodes,function(exists,node){this._out[node]&&!_.isEmpty(this._out[node])||sinks.push(this.getCell(node))},this),sinks},isSource:function(element){return!this._in[element.id]||_.isEmpty(this._in[element.id])},isSink:function(element){return!this._out[element.id]||_.isEmpty(this._out[element.id])},isSuccessor:function(elementA,elementB){var isSuccessor=!1;return this.search(elementA,function(element){if(element===elementB&&element!==elementA)return!(isSuccessor=!0)},{outbound:!0}),isSuccessor},isPredecessor:function(elementA,elementB){var isPredecessor=!1;return this.search(elementA,function(element){if(element===elementB&&element!==elementA)return!(isPredecessor=!0)},{inbound:!0}),isPredecessor},isNeighbor:function(elementA,elementB,opt){var inbound=(opt=opt||{}).inbound,outbound=opt.outbound;_.isUndefined(inbound)&&_.isUndefined(outbound)&&(inbound=outbound=!0);var isNeighbor=!1;return _.each(this.getConnectedLinks(elementA,opt),function(link){var source=link.get("source"),target=link.get("target");return link.hasLoop(opt),inbound&&_.has(source,"id")&&source.id===elementB.id?!(isNeighbor=!0):outbound&&_.has(target,"id")&&target.id===elementB.id?!(isNeighbor=!0):void 0}),isNeighbor},disconnectLinks:function(model,options){_.each(this.getConnectedLinks(model),function(link){link.set(link.get("source").id===model.id?"source":"target",g.point(0,0),options)})},removeLinks:function(model,options){_.invoke(this.getConnectedLinks(model),"remove",options)},findModelsFromPoint:function(p){return _.filter(this.getElements(),function(el){return el.getBBox().containsPoint(p)})},findModelsInArea:function(rect,opt){rect=g.rect(rect);var method=(opt=_.defaults(opt||{},{strict:!1})).strict?"containsRect":"intersect";return _.filter(this.getElements(),function(el){return rect[method](el.getBBox())})},findModelsUnderElement:function(element,opt){opt=_.defaults(opt||{},{searchBy:"bbox"});var bbox=element.getBBox(),elements="bbox"==opt.searchBy?this.findModelsInArea(bbox):this.findModelsFromPoint(bbox[opt.searchBy]());return _.reject(elements,function(el){return element.id==el.id||el.isEmbeddedIn(element)})},getBBox:function(cells,opt){return this.getCellsBBox(cells||this.getElements(),opt)},getCellsBBox:function(cells,opt){return _.reduce(cells,function(memo,cell){return cell.isLink()?memo:memo?memo.union(cell.getBBox(opt)):cell.getBBox(opt)},null)},translate:function(dx,dy,opt){var cells=_.reject(this.getCells(),function(cell){return cell.isEmbedded()});_.invoke(cells,"translate",dx,dy,opt)},resize:function(width,height,opt){return this.resizeCells(width,height,this.getCells(),opt)},resizeCells:function(width,height,cells,opt){var bbox=this.getCellsBBox(cells);if(bbox){var sx=Math.max(width/bbox.width,0),sy=Math.max(height/bbox.height,0);_.invoke(cells,"scale",sx,sy,bbox.origin(),opt)}return this},startBatch:function(name,data){return data=data||{},this._batches[name]=(this._batches[name]||0)+1,this.trigger("batch:start",_.extend({},data,{batchName:name}))},stopBatch:function(name,data){return data=data||{},this._batches[name]=(this._batches[name]||0)-1,this.trigger("batch:stop",_.extend({},data,{batchName:name}))},hasActiveBatch:function(name){return name?this._batches[name]:_.any(this._batches,function(batches){return 0<batches})}}),joint.util.wrapWith(joint.dia.Graph.prototype,["resetCells","addCells","removeCells"],"cells"),joint.dia.Cell=Backbone.Model.extend({constructor:function(attributes,options){var defaults,attrs=attributes||{};this.cid=_.uniqueId("c"),this.attributes={},options&&options.collection&&(this.collection=options.collection),options&&options.parse&&(attrs=this.parse(attrs,options)||{}),(defaults=_.result(this,"defaults"))&&(attrs=_.merge({},defaults,attrs)),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)},translate:function(dx,dy,opt){throw new Error("Must define a translate() method.")},toJSON:function(){var defaultAttrs=this.constructor.prototype.defaults.attrs||{},attrs=this.attributes.attrs,finalAttrs={};_.each(attrs,function(attr,selector){var defaultAttr=defaultAttrs[selector];_.each(attr,function(value,name){_.isObject(value)&&!_.isArray(value)?_.each(value,function(value2,name2){defaultAttr&&defaultAttr[name]&&_.isEqual(defaultAttr[name][name2],value2)||(finalAttrs[selector]=finalAttrs[selector]||{},(finalAttrs[selector][name]||(finalAttrs[selector][name]={}))[name2]=value2)}):defaultAttr&&_.isEqual(defaultAttr[name],value)||(finalAttrs[selector]=finalAttrs[selector]||{},finalAttrs[selector][name]=value)})});var attributes=_.cloneDeep(_.omit(this.attributes,"attrs"));return attributes.attrs=finalAttrs,attributes},initialize:function(options){options&&options.id||this.set("id",joint.util.uuid(),{silent:!0}),this._transitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},processPorts:function(){var previousPorts=this.ports,ports={};_.each(this.get("attrs"),function(attrs,selector){attrs&&attrs.port&&(_.isUndefined(attrs.port.id)?ports[attrs.port]={id:attrs.port}:ports[attrs.port.id]=attrs.port)});var removedPorts={};if(_.each(previousPorts,function(port,id){ports[id]||(removedPorts[id]=!0)}),this.graph&&!_.isEmpty(removedPorts)){var inboundLinks=this.graph.getConnectedLinks(this,{inbound:!0});_.each(inboundLinks,function(link){removedPorts[link.get("target").port]&&link.remove()});var outboundLinks=this.graph.getConnectedLinks(this,{outbound:!0});_.each(outboundLinks,function(link){removedPorts[link.get("source").port]&&link.remove()})}this.ports=ports},remove:function(opt){opt=opt||{};var graph=this.graph;graph&&graph.startBatch("remove");var parentCellId=this.get("parent");return parentCellId&&(graph&&graph.getCell(parentCellId)).unembed(this),_.invoke(this.getEmbeddedCells(),"remove",opt),this.trigger("remove",this,this.collection,opt),graph&&graph.stopBatch("remove"),this},toFront:function(opt){if(this.graph){opt=opt||{};var z=(this.graph.getLastCell().get("z")||0)+1;if(this.startBatch("to-front").set("z",z,opt),opt.deep){var cells=this.getEmbeddedCells({deep:!0,breadthFirst:!0});_.each(cells,function(cell){cell.set("z",++z,opt)})}this.stopBatch("to-front")}return this},toBack:function(opt){if(this.graph){opt=opt||{};var z=(this.graph.getFirstCell().get("z")||0)-1;if(this.startBatch("to-back"),opt.deep){var cells=this.getEmbeddedCells({deep:!0,breadthFirst:!0});_.eachRight(cells,function(cell){cell.set("z",z--,opt)})}this.set("z",z,opt).stopBatch("to-back")}return this},embed:function(cell,opt){if(this===cell||this.isEmbeddedIn(cell))throw new Error("Recursive embedding not allowed.");this.startBatch("embed");var embeds=_.clone(this.get("embeds")||[]);return embeds[cell.isLink()?"unshift":"push"](cell.id),cell.set("parent",this.id,opt),this.set("embeds",_.uniq(embeds),opt),this.stopBatch("embed"),this},unembed:function(cell,opt){return this.startBatch("unembed"),cell.unset("parent",opt),this.set("embeds",_.without(this.get("embeds"),cell.id),opt),this.stopBatch("unembed"),this},getAncestors:function(){var ancestors=[],parentId=this.get("parent");if(!this.graph)return ancestors;for(;void 0!==parentId;){var parent=this.graph.getCell(parentId);if(void 0===parent)break;ancestors.push(parent),parentId=parent.get("parent")}return ancestors},getEmbeddedCells:function(opt){if(opt=opt||{},this.graph){var cells;if(opt.deep)if(opt.breadthFirst){cells=[];for(var queue=this.getEmbeddedCells();0<queue.length;){var parent=queue.shift();cells.push(parent),queue.push.apply(queue,parent.getEmbeddedCells())}}else cells=this.getEmbeddedCells(),_.each(cells,function(cell){cells.push.apply(cells,cell.getEmbeddedCells(opt))});else cells=_.map(this.get("embeds"),this.graph.getCell,this.graph);return cells}return[]},isEmbeddedIn:function(cell,opt){var cellId=_.isString(cell)?cell:cell.id,parentId=this.get("parent");if(opt=_.defaults({deep:!0},opt),this.graph&&opt.deep){for(;parentId;){if(parentId===cellId)return!0;parentId=this.graph.getCell(parentId).get("parent")}return!1}return parentId===cellId},isEmbedded:function(){return!!this.get("parent")},clone:function(opt){if((opt=opt||{}).deep)return _.values(joint.dia.Graph.prototype.cloneCells.call(null,[this].concat(this.getEmbeddedCells({deep:!0}))));var clone=Backbone.Model.prototype.clone.apply(this,arguments);return clone.set("id",joint.util.uuid()),clone.unset("embeds"),clone.unset("parent"),clone},prop:function(props,value,opt){if(_.isString(props)){if(1<arguments.length){var path=props,pathArray=path.split("/"),property=pathArray[0];if(pathArray.shift(),(opt=opt||{}).propertyPath=path,opt.propertyValue=value,0===pathArray.length)return this.set(property,value,opt);var update={},initializer=update,prevProperty=property;_.each(pathArray,function(key){initializer=initializer[prevProperty]=_.isFinite(Number(key))?[]:{},prevProperty=key}),update=joint.util.setByPath(update,path,value,"/");var baseAttributes=_.merge({},this.attributes);opt.rewrite&&joint.util.unsetByPath(baseAttributes,path,"/");var attributes=_.merge(baseAttributes,update);return this.set(property,attributes[property],opt)}return joint.util.getByPath(this.attributes,props,"/")}return this.set(_.merge({},this.attributes,props),value)},removeProp:function(path,opt){(opt=opt||{}).dirty=!0;var pathArray=path.split("/");if(1===pathArray.length)return this.unset(path,opt);var property=pathArray[0],nestedPath=pathArray.slice(1).join("/"),propertyValue=_.merge({},this.get(property));return joint.util.unsetByPath(propertyValue,nestedPath,"/"),this.set(property,propertyValue,opt)},attr:function(attrs,value,opt){var args=Array.prototype.slice.call(arguments);return _.isString(attrs)?args[0]="attrs/"+attrs:args[0]={attrs:attrs},this.prop.apply(this,args)},removeAttr:function(path,opt){return _.isArray(path)?(_.each(path,function(p){this.removeAttr(p,opt)},this),this):this.removeProp("attrs/"+path,opt)},transition:function(path,value,opt,delim){delim=delim||"/";var defaults={duration:100,delay:10,timingFunction:joint.util.timing.linear,valueFunction:joint.util.interpolate.number};opt=_.extend(defaults,opt);var interpolatingFunction,firstFrameTime=0,setter=_.bind(function(runtime){var id,progress,propertyValue;(progress=(runtime-=firstFrameTime=firstFrameTime||runtime)/opt.duration)<1?this._transitionIds[path]=id=joint.util.nextFrame(setter):(progress=1,delete this._transitionIds[path]),propertyValue=interpolatingFunction(opt.timingFunction(progress)),opt.transitionId=id,this.prop(path,propertyValue,opt),id||this.trigger("transition:end",this,path)},this),initiator=_.bind(function(callback){this.stopTransitions(path),interpolatingFunction=opt.valueFunction(joint.util.getByPath(this.attributes,path,delim),value),this._transitionIds[path]=joint.util.nextFrame(callback),this.trigger("transition:start",this,path)},this);return _.delay(initiator,opt.delay,setter)},getTransitions:function(){return _.keys(this._transitionIds)},stopTransitions:function(path,delim){delim=delim||"/";var pathArray=path&&path.split(delim);return _(this._transitionIds).keys().filter(pathArray&&function(key){return _.isEqual(pathArray,key.split(delim).slice(0,pathArray.length))}).each(function(key){joint.util.cancelFrame(this._transitionIds[key]),delete this._transitionIds[key],this.trigger("transition:end",this,key)},this),this},addTo:function(graph,opt){return graph.addCell(this,opt),this},findView:function(paper){return paper.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(name,opt){return this.graph&&this.graph.startBatch(name,_.extend({},opt,{cell:this})),this},stopBatch:function(name,opt){return this.graph&&this.graph.stopBatch(name,_.extend({},opt,{cell:this})),this}}),joint.dia.CellView=joint.mvc.View.extend({tagName:"g",attributes:function(){return{"model-id":this.model.id}},constructor:function(options){options.id=options.id||joint.util.guid(this),joint.mvc.View.call(this,options)},init:function(){_.bindAll(this,"remove","update"),this.$el.data("view",this),this.listenTo(this.model,"change:attrs",this.onChangeAttrs)},onChangeAttrs:function(cell,attrs,opt){return opt.dirty?this.render():this.update(cell,attrs,opt)},can:function(feature){var interactive=_.isFunction(this.options.interactive)?this.options.interactive(this):this.options.interactive;return _.isObject(interactive)&&!1!==interactive[feature]||_.isBoolean(interactive)&&!1!==interactive},_ensureElement:function(){var el;if(this.el)el=_.result(this,"el");else{var attrs=_.extend({id:this.id},_.result(this,"attributes"));this.className&&(attrs.class=_.result(this,"className")),el=V(_.result(this,"tagName"),attrs).node}this.setElement(el,!1)},_setElement:function(el){this.$el=el instanceof Backbone.$?el:Backbone.$(el),this.el=this.$el[0],this.vel=V(this.el)},findBySelector:function(selector){return"."===selector?this.$el:this.$el.find(selector)},notify:function(eventName){if(this.paper){var args=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[eventName].concat(args)),this.paper.trigger.apply(this.paper,[eventName,this].concat(args))}},getStrokeBBox:function(el){var isMagnet=!!el;el=el||this.el;var strokeWidth,bbox=V(el).bbox(!1,this.paper.viewport);return strokeWidth=isMagnet?V(el).attr("stroke-width"):this.model.attr("rect/stroke-width")||this.model.attr("circle/stroke-width")||this.model.attr("ellipse/stroke-width")||this.model.attr("path/stroke-width"),strokeWidth=parseFloat(strokeWidth)||0,g.rect(bbox).moveAndExpand({x:-strokeWidth/2,y:-strokeWidth/2,width:strokeWidth,height:strokeWidth})},getBBox:function(){return g.rect(this.vel.bbox())},highlight:function(el,opt){return el=el&&this.$(el)[0]||this.el,(opt=opt||{}).partial=el!=this.el,this.notify("cell:highlight",el,opt),this},unhighlight:function(el,opt){return el=el&&this.$(el)[0]||this.el,(opt=opt||{}).partial=el!=this.el,this.notify("cell:unhighlight",el,opt),this},findMagnet:function(el){var $el=this.$(el);if(0!==$el.length&&$el[0]!==this.el)return $el.attr("magnet")?$el[0]:this.findMagnet($el.parent());var attrs=this.model.get("attrs")||{};return attrs["."]&&!1===attrs["."].magnet?void 0:this.el},applyFilter:function(selector,filter){var $selected=_.isString(selector)?this.findBySelector(selector):$(selector),filterId=filter.name+this.paper.svg.id+joint.util.hashCode(JSON.stringify(filter));if(!this.paper.svg.getElementById(filterId)){var filterSVGString=joint.util.filter[filter.name]&&joint.util.filter[filter.name](filter.args||{});if(!filterSVGString)throw new Error("Non-existing filter "+filter.name);var filterElement=V(filterSVGString);filterElement.attr({filterUnits:"objectBoundingBox",x:-1,y:-1,width:3,height:3}),filter.attrs&&filterElement.attr(filter.attrs),filterElement.node.id=filterId,V(this.paper.svg).defs().append(filterElement)}$selected.each(function(){V(this).attr("filter","url(#"+filterId+")")})},applyGradient:function(selector,attr,gradient){var $selected=_.isString(selector)?this.findBySelector(selector):$(selector),gradientId=gradient.type+this.paper.svg.id+joint.util.hashCode(JSON.stringify(gradient));if(!this.paper.svg.getElementById(gradientId)){var gradientSVGString=["<"+gradient.type+">",_.map(gradient.stops,function(stop){return'<stop offset="'+stop.offset+'" stop-color="'+stop.color+'" stop-opacity="'+(_.isFinite(stop.opacity)?stop.opacity:1)+'" />'}).join(""),"</"+gradient.type+">"].join(""),gradientElement=V(gradientSVGString);gradient.attrs&&gradientElement.attr(gradient.attrs),gradientElement.node.id=gradientId,V(this.paper.svg).defs().append(gradientElement)}$selected.each(function(){V(this).attr(attr,"url(#"+gradientId+")")})},getSelector:function(el,prevSelector){if(el===this.el)return prevSelector;var nthChild=V(el).index()+1,selector=el.tagName+":nth-child("+nthChild+")";return prevSelector&&(selector+=" > "+prevSelector),this.getSelector(el.parentNode,selector)},pointerdblclick:function(evt,x,y){this.notify("cell:pointerdblclick",evt,x,y)},pointerclick:function(evt,x,y){this.notify("cell:pointerclick",evt,x,y)},pointerdown:function(evt,x,y){this.model.graph&&(this.model.startBatch("pointer"),this._graph=this.model.graph),this.notify("cell:pointerdown",evt,x,y)},pointermove:function(evt,x,y){this.notify("cell:pointermove",evt,x,y)},pointerup:function(evt,x,y){this.notify("cell:pointerup",evt,x,y),this._graph&&(this._graph.stopBatch("pointer",{cell:this.model}),delete this._graph)},mouseover:function(evt){this.notify("cell:mouseover",evt)},mouseout:function(evt){this.notify("cell:mouseout",evt)},mousewheel:function(evt,x,y,delta){this.notify("cell:mousewheel",evt,x,y,delta)},contextmenu:function(evt,x,y){this.notify("cell:contextmenu",evt,x,y)},onSetTheme:function(oldTheme,newTheme){oldTheme&&this.vel.removeClass(this.themeClassNamePrefix+oldTheme),this.vel.addClass(this.themeClassNamePrefix+newTheme)},setInteractivity:function(value){this.options.interactive=value}}),joint.dia.Element=joint.dia.Cell.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},isElement:function(){return!0},position:function(x,y,opt){var isSetter=_.isNumber(y);if((opt=(isSetter?opt:x)||{}).parentRelative){if(!this.graph)throw new Error("Element must be part of a graph.");var parent=this.graph.getCell(this.get("parent")),parentPosition=parent&&!parent.isLink()?parent.get("position"):{x:0,y:0}}if(isSetter)return opt.parentRelative&&(x+=parentPosition.x,y+=parentPosition.y),this.set("position",{x:x,y:y},opt);var elementPosition=g.point(this.get("position"));return opt.parentRelative?elementPosition.difference(parentPosition):elementPosition},translate:function(tx,ty,opt){if(ty=ty||0,0===(tx=tx||0)&&0===ty)return this;(opt=opt||{}).translateBy=opt.translateBy||this.id;var position=this.get("position")||{x:0,y:0};if(opt.restrictedArea&&opt.translateBy===this.id){var bbox=this.getBBox({deep:!0}),ra=opt.restrictedArea,dx=position.x-bbox.x,dy=position.y-bbox.y,x=Math.max(ra.x+dx,Math.min(ra.x+ra.width+dx-bbox.width,position.x+tx)),y=Math.max(ra.y+dy,Math.min(ra.y+ra.height+dy-bbox.height,position.y+ty));tx=x-position.x,ty=y-position.y}var translatedPosition={x:position.x+tx,y:position.y+ty};return opt.tx=tx,opt.ty=ty,opt.transition?(_.isObject(opt.transition)||(opt.transition={}),this.transition("position",translatedPosition,_.extend({},opt.transition,{valueFunction:joint.util.interpolate.object}))):(this.set("position",translatedPosition,opt),_.invoke(this.getEmbeddedCells(),"translate",tx,ty,opt)),this},resize:function(width,height,opt){if(opt=opt||{},this.startBatch("resize",opt),opt.direction){var currentSize=this.get("size");switch(opt.direction){case"left":case"right":height=currentSize.height;break;case"top":case"bottom":width=currentSize.width}var angle=g.normalizeAngle(this.get("angle")||0),quadrant={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[opt.direction];opt.absolute&&(quadrant+=Math.floor((angle+45)/90),quadrant%=4);var bbox=this.getBBox(),fixedPoint=bbox[["bottomLeft","corner","topRight","origin"][quadrant]](),imageFixedPoint=g.point(fixedPoint).rotate(bbox.center(),-angle),radius=Math.sqrt(width*width+height*height)/2,alpha=quadrant*Math.PI/2;alpha+=Math.atan(quadrant%2==0?height/width:width/height),alpha-=g.toRad(angle);var center=g.point.fromPolar(radius,alpha,imageFixedPoint),origin=g.point(center).offset(width/-2,height/-2);this.set("size",{width:width,height:height},opt),this.position(origin.x,origin.y,opt)}else this.set("size",{width:width,height:height},opt);return this.stopBatch("resize",opt),this},scale:function(sx,sy,origin,opt){var scaledBBox=this.getBBox().scale(sx,sy,origin);return this.startBatch("scale",opt),this.position(scaledBBox.x,scaledBBox.y,opt),this.resize(scaledBBox.width,scaledBBox.height,opt),this.stopBatch("scale"),this},fitEmbeds:function(opt){if(opt=opt||{},!this.graph)throw new Error("Element must be part of a graph.");var embeddedCells=this.getEmbeddedCells();if(0<embeddedCells.length){this.startBatch("fit-embeds",opt),opt.deep&&_.invoke(embeddedCells,"fitEmbeds",opt);var bbox=this.graph.getCellsBBox(embeddedCells),padding=joint.util.normalizeSides(opt.padding);bbox.moveAndExpand({x:-padding.left,y:-padding.top,width:padding.right+padding.left,height:padding.bottom+padding.top}),this.set({position:{x:bbox.x,y:bbox.y},size:{width:bbox.width,height:bbox.height}},opt),this.stopBatch("fit-embeds")}return this},rotate:function(angle,absolute,origin){if(origin){var center=this.getBBox().center(),size=this.get("size"),position=this.get("position");center.rotate(origin,this.get("angle")-angle);var dx=center.x-size.width/2-position.x,dy=center.y-size.height/2-position.y;this.startBatch("rotate",{angle:angle,absolute:absolute,origin:origin}),this.translate(dx,dy),this.rotate(angle,absolute),this.stopBatch("rotate")}else this.set("angle",absolute?angle:(this.get("angle")+angle)%360);return this},getBBox:function(opt){if((opt=opt||{}).deep&&this.graph){var elements=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return elements.push(this),this.graph.getCellsBBox(elements)}var position=this.get("position"),size=this.get("size");return g.rect(position.x,position.y,size.width,size.height)}}),joint.dia.ElementView=joint.dia.CellView.extend({SPECIAL_ATTRIBUTES:["style","text","html","ref-x","ref-y","ref-dx","ref-dy","ref-width","ref-height","ref","x-alignment","y-alignment","port"],className:function(){return"element "+this.model.get("type").replace(/\./g," ")},initialize:function(){_.bindAll(this,"translate","resize","rotate"),joint.dia.CellView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:position",this.translate),this.listenTo(this.model,"change:size",this.resize),this.listenTo(this.model,"change:angle",this.rotate)},update:function(cell,renderingOnlyAttrs){var allAttrs=this.model.get("attrs"),rotatable=this.rotatableNode;if(rotatable){var rotation=rotatable.attr("transform");rotatable.attr("transform","")}var relativelyPositioned=[],nodesBySelector={};_.each(renderingOnlyAttrs||allAttrs,function(attrs,selector){var $selected=this.findBySelector(selector);if(0!==$selected.length){nodesBySelector[selector]=$selected;var specialAttributes=this.SPECIAL_ATTRIBUTES.slice();_.isObject(attrs.filter)&&(specialAttributes.push("filter"),this.applyFilter($selected,attrs.filter)),_.isObject(attrs.fill)&&(specialAttributes.push("fill"),this.applyGradient($selected,"fill",attrs.fill)),_.isObject(attrs.stroke)&&(specialAttributes.push("stroke"),this.applyGradient($selected,"stroke",attrs.stroke)),_.isUndefined(attrs.text)||($selected.each(function(){V(this).text(attrs.text+"",{lineHeight:attrs.lineHeight,textPath:attrs.textPath,annotations:attrs.annotations})}),specialAttributes.push("lineHeight","textPath","annotations"));var finalAttributes=_.omit(attrs,specialAttributes);$selected.each(function(){V(this).attr(finalAttributes)}),attrs.port&&$selected.attr("port",_.isUndefined(attrs.port.id)?attrs.port:attrs.port.id),attrs.style&&$selected.css(attrs.style),_.isUndefined(attrs.html)||$selected.each(function(){$(this).html(attrs.html+"")}),_.isUndefined(attrs["ref-x"])&&_.isUndefined(attrs["ref-y"])&&_.isUndefined(attrs["ref-dx"])&&_.isUndefined(attrs["ref-dy"])&&_.isUndefined(attrs["x-alignment"])&&_.isUndefined(attrs["y-alignment"])&&_.isUndefined(attrs["ref-width"])&&_.isUndefined(attrs["ref-height"])||_.each($selected,function(el,index,list){var $el=$(el);$el.selector=list.selector,relativelyPositioned.push($el)})}},this);var size=this.model.get("size"),bbox={x:0,y:0,width:size.width,height:size.height};renderingOnlyAttrs=renderingOnlyAttrs||{},_.each(relativelyPositioned,function($el){var renderingOnlyElAttrs=renderingOnlyAttrs[$el.selector],elAttrs=renderingOnlyElAttrs?_.merge({},allAttrs[$el.selector],renderingOnlyElAttrs):allAttrs[$el.selector];this.positionRelative(V($el[0]),bbox,elAttrs,nodesBySelector)},this),rotatable&&rotatable.attr("transform",rotation||"")},positionRelative:function(vel,bbox,attributes,nodesBySelector){var ref=attributes.ref,refDx=parseFloat(attributes["ref-dx"]),refDy=parseFloat(attributes["ref-dy"]),yAlignment=attributes["y-alignment"],xAlignment=attributes["x-alignment"],refY=attributes["ref-y"],refYPercentage=_.isString(refY)&&"%"===refY.slice(-1);refY=parseFloat(refY),refYPercentage&&(refY/=100);var refX=attributes["ref-x"],refXPercentage=_.isString(refX)&&"%"===refX.slice(-1);refX=parseFloat(refX),refXPercentage&&(refX/=100);var refWidth=attributes["ref-width"],refWidthPercentage=_.isString(refWidth)&&"%"===refWidth.slice(-1);refWidth=parseFloat(refWidth),refWidthPercentage&&(refWidth/=100);var refHeight=attributes["ref-height"],refHeightPercentage=_.isString(refHeight)&&"%"===refHeight.slice(-1);refHeight=parseFloat(refHeight),refHeightPercentage&&(refHeight/=100);var scalable=vel.findParentByClass("scalable",this.el);if(ref){var vref;if(!(vref=nodesBySelector&&nodesBySelector[ref]?V(nodesBySelector[ref][0]):"."===ref?this.vel:this.vel.findOne(ref)))throw new Error("dia.ElementView: reference does not exists.");bbox=vref.bbox(!1,this.el)}vel.attr("transform")&&vel.attr("transform",vel.attr("transform").replace(/translate\([^)]*\)/g,"").trim()||""),isFinite(refWidth)&&(refWidthPercentage||0<=refWidth&&refWidth<=1?vel.attr("width",refWidth*bbox.width):vel.attr("width",Math.max(refWidth+bbox.width,0))),isFinite(refHeight)&&(refHeightPercentage||0<=refHeight&&refHeight<=1?vel.attr("height",refHeight*bbox.height):vel.attr("height",Math.max(refHeight+bbox.height,0)));var scale,tx=0,ty=0;if(isFinite(refDx)&&(tx=scalable?(scale=scale||scalable.scale(),bbox.x+bbox.width+refDx/scale.sx):bbox.x+bbox.width+refDx),isFinite(refDy)&&(ty=scalable?(scale=scale||scalable.scale(),bbox.y+bbox.height+refDy/scale.sy):bbox.y+bbox.height+refDy),isFinite(refX)&&(tx=refXPercentage||0<refX&&refX<1?bbox.x+bbox.width*refX:scalable?(scale=scale||scalable.scale(),bbox.x+refX/scale.sx):bbox.x+refX),isFinite(refY)&&(ty=refYPercentage||0<refY&&refY<1?bbox.y+bbox.height*refY:scalable?(scale=scale||scalable.scale(),bbox.y+refY/scale.sy):bbox.y+refY),!_.isUndefined(yAlignment)||!_.isUndefined(xAlignment)){var velBBox=vel.bbox(!1,this.paper.viewport);"middle"===yAlignment?ty-=velBBox.height/2:"bottom"===yAlignment?ty-=velBBox.height:isFinite(yAlignment)&&(ty+=-1<yAlignment&&yAlignment<1?velBBox.height*yAlignment:yAlignment),"middle"===xAlignment?tx-=velBBox.width/2:"right"===xAlignment?tx-=velBBox.width:isFinite(xAlignment)&&(tx+=-1<xAlignment&&xAlignment<1?velBBox.width*xAlignment:xAlignment)}vel.translate(tx,ty)},renderMarkup:function(){var markup=this.model.get("markup")||this.model.markup;if(!markup)throw new Error("properties.markup is missing while the default render() implementation is used.");var nodes=V(markup);this.vel.append(nodes)},render:function(){return this.$el.empty(),this.renderMarkup(),this.rotatableNode=this.vel.findOne(".rotatable"),this.scalableNode=this.vel.findOne(".scalable"),this.update(),this.resize(),this.rotate(),this.translate(),this},scale:function(sx,sy){this.vel.scale(sx,sy)},resize:function(){var size=this.model.get("size")||{width:1,height:1},angle=this.model.get("angle")||0,scalable=this.scalableNode;if(scalable){var scalableBbox=scalable.bbox(!0);scalable.attr("transform","scale("+size.width/(scalableBbox.width||1)+","+size.height/(scalableBbox.height||1)+")");var rotatable=this.rotatableNode,rotation=rotatable&&rotatable.attr("transform");if(rotation&&"null"!==rotation){rotatable.attr("transform",rotation+" rotate("+-angle+","+size.width/2+","+size.height/2+")");var rotatableBbox=scalable.bbox(!1,this.paper.viewport);this.model.set("position",{x:rotatableBbox.x,y:rotatableBbox.y}),this.rotate()}this.update()}},translate:function(model,changes,opt){var position=this.model.get("position")||{x:0,y:0};this.vel.attr("transform","translate("+position.x+","+position.y+")")},rotate:function(){var rotatable=this.rotatableNode;if(rotatable){var angle=this.model.get("angle")||0,size=this.model.get("size")||{width:1,height:1},ox=size.width/2,oy=size.height/2;rotatable.attr("transform","rotate("+angle+","+ox+","+oy+")")}},getBBox:function(opt){if(opt&&opt.useModelGeometry){var noTransformationBBox=this.model.getBBox().bbox(this.model.get("angle")),transformationMatrix=this.paper.viewport.getCTM();return g.rect(V.transformRect(noTransformationBBox,transformationMatrix))}return joint.dia.CellView.prototype.getBBox.apply(this,arguments)},prepareEmbedding:function(opt){var model=(opt=opt||{}).model||this.model,paper=opt.paper||this.paper;model.startBatch("to-front",opt),model.toFront({deep:!0,ui:!0}),_.invoke(paper.model.getConnectedLinks(model,{deep:!0}),"toFront",{ui:!0}),model.stopBatch("to-front");var parentId=model.get("parent");parentId&&paper.model.getCell(parentId).unembed(model,{ui:!0})},processEmbedding:function(opt){var model=(opt=opt||{}).model||this.model,paper=opt.paper||this.paper,paperOptions=paper.options,candidates=paper.model.findModelsUnderElement(model,{searchBy:paperOptions.findParentBy});paperOptions.frontParentOnly&&(candidates=candidates.slice(-1));for(var newCandidateView=null,prevCandidateView=this._candidateEmbedView,i=candidates.length-1;0<=i;i--){var candidate=candidates[i];if(prevCandidateView&&prevCandidateView.model.id==candidate.id){newCandidateView=prevCandidateView;break}var view=candidate.findView(paper);if(paperOptions.validateEmbedding.call(paper,this,view)){newCandidateView=view;break}}newCandidateView&&newCandidateView!=prevCandidateView&&(prevCandidateView&&prevCandidateView.unhighlight(null,{embedding:!0}),this._candidateEmbedView=newCandidateView.highlight(null,{embedding:!0})),!newCandidateView&&prevCandidateView&&(prevCandidateView.unhighlight(null,{embedding:!0}),delete this._candidateEmbedView)},finalizeEmbedding:function(opt){opt=opt||{};var candidateView=this._candidateEmbedView,model=opt.model||this.model,paper=opt.paper||this.paper;candidateView&&(candidateView.model.embed(model,{ui:!0}),candidateView.unhighlight(null,{embedding:!0}),delete this._candidateEmbedView),_.invoke(paper.model.getConnectedLinks(model,{deep:!0}),"reparent",{ui:!0})},pointerdown:function(evt,x,y){var paper=this.paper;if(evt.target.getAttribute("magnet")&&this.can("addLinkFromMagnet")&&paper.options.validateMagnet.call(paper,this,evt.target)){this.model.startBatch("add-link");var link=paper.getDefaultLink(this,evt.target);link.set({source:{id:this.model.id,selector:this.getSelector(evt.target),port:evt.target.getAttribute("port")},target:{x:x,y:y}}),paper.model.addCell(link);var linkView=this._linkView=paper.findViewByModel(link);linkView.pointerdown(evt,x,y),linkView.startArrowheadMove("target",{whenNotAllowed:"remove"})}else this._dx=x,this._dy=y,this.restrictedArea=paper.getRestrictedArea(this),joint.dia.CellView.prototype.pointerdown.apply(this,arguments),this.notify("element:pointerdown",evt,x,y)},pointermove:function(evt,x,y){if(this._linkView)this._linkView.pointermove(evt,x,y);else{var grid=this.paper.options.gridSize;if(this.can("elementMove")){var position=this.model.get("position"),tx=g.snapToGrid(position.x,grid)-position.x+g.snapToGrid(x-this._dx,grid),ty=g.snapToGrid(position.y,grid)-position.y+g.snapToGrid(y-this._dy,grid);this.model.translate(tx,ty,{restrictedArea:this.restrictedArea,ui:!0}),this.paper.options.embeddingMode&&(this._inProcessOfEmbedding||(this.prepareEmbedding(),this._inProcessOfEmbedding=!0),this.processEmbedding())}this._dx=g.snapToGrid(x,grid),this._dy=g.snapToGrid(y,grid),joint.dia.CellView.prototype.pointermove.apply(this,arguments),this.notify("element:pointermove",evt,x,y)}},pointerup:function(evt,x,y){this._linkView?(this._linkView.pointerup(evt,x,y),this._linkView=null,this.model.stopBatch("add-link")):(this._inProcessOfEmbedding&&(this.finalizeEmbedding(),this._inProcessOfEmbedding=!1),this.notify("element:pointerup",evt,x,y),joint.dia.CellView.prototype.pointerup.apply(this,arguments))}}),joint.dia.Link=joint.dia.Cell.extend({markup:['<path class="connection" stroke="black" d="M 0 0 0 0"/>','<path class="marker-source" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="marker-target" fill="black" stroke="black" d="M 0 0 0 0"/>','<path class="connection-wrap" d="M 0 0 0 0"/>','<g class="labels"/>','<g class="marker-vertices"/>','<g class="marker-arrowheads"/>','<g class="link-tools"/>'].join(""),labelMarkup:['<g class="label">',"<rect />","<text />","</g>"].join(""),toolMarkup:['<g class="link-tool">','<g class="tool-remove" event="remove">','<circle r="11" />','<path transform="scale(.8) translate(-16, -16)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z" />',"<title>Remove link.</title>","</g>",'<g class="tool-options" event="link:options">','<circle r="11" transform="translate(25)"/>','<path fill="white" transform="scale(.55) translate(29, -16)" d="M31.229,17.736c0.064-0.571,0.104-1.148,0.104-1.736s-0.04-1.166-0.104-1.737l-4.377-1.557c-0.218-0.716-0.504-1.401-0.851-2.05l1.993-4.192c-0.725-0.91-1.549-1.734-2.458-2.459l-4.193,1.994c-0.647-0.347-1.334-0.632-2.049-0.849l-1.558-4.378C17.165,0.708,16.588,0.667,16,0.667s-1.166,0.041-1.737,0.105L12.707,5.15c-0.716,0.217-1.401,0.502-2.05,0.849L6.464,4.005C5.554,4.73,4.73,5.554,4.005,6.464l1.994,4.192c-0.347,0.648-0.632,1.334-0.849,2.05l-4.378,1.557C0.708,14.834,0.667,15.412,0.667,16s0.041,1.165,0.105,1.736l4.378,1.558c0.217,0.715,0.502,1.401,0.849,2.049l-1.994,4.193c0.725,0.909,1.549,1.733,2.459,2.458l4.192-1.993c0.648,0.347,1.334,0.633,2.05,0.851l1.557,4.377c0.571,0.064,1.148,0.104,1.737,0.104c0.588,0,1.165-0.04,1.736-0.104l1.558-4.377c0.715-0.218,1.399-0.504,2.049-0.851l4.193,1.993c0.909-0.725,1.733-1.549,2.458-2.458l-1.993-4.193c0.347-0.647,0.633-1.334,0.851-2.049L31.229,17.736zM16,20.871c-2.69,0-4.872-2.182-4.872-4.871c0-2.69,2.182-4.872,4.872-4.872c2.689,0,4.871,2.182,4.871,4.872C20.871,18.689,18.689,20.871,16,20.871z"/>',"<title>Link options.</title>","</g>","</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>"].join(""),arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<path class="marker-arrowhead" end="<%= end %>" d="M 26 0 L 0 13 L 26 26 z" />',"</g>"].join(""),defaults:{type:"link",source:{},target:{}},isLink:function(){return!0},disconnect:function(){return this.set({source:g.point(0,0),target:g.point(0,0)})},label:function(idx,value){idx=idx||0;var labels=this.get("labels")||[];if(0===arguments.length||1===arguments.length)return labels[idx];var newValue=_.merge({},labels[idx],value),newLabels=labels.slice();return newLabels[idx]=newValue,this.set({labels:newLabels})},translate:function(tx,ty,opt){return(opt=opt||{}).translateBy=opt.translateBy||this.id,opt.tx=tx,opt.ty=ty,this.applyToPoints(function(p){return{x:(p.x||0)+tx,y:(p.y||0)+ty}},opt)},scale:function(sx,sy,origin,opt){return this.applyToPoints(function(p){return g.point(p).scale(sx,sy,origin).toJSON()},opt)},applyToPoints:function(fn,opt){if(!_.isFunction(fn))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var attrs={},source=this.get("source");source.id||(attrs.source=fn(source));var target=this.get("target");target.id||(attrs.target=fn(target));var vertices=this.get("vertices");return vertices&&0<vertices.length&&(attrs.vertices=_.map(vertices,fn)),this.set(attrs,opt)},reparent:function(opt){var newParent;if(this.graph){var source=this.graph.getCell(this.get("source").id),target=this.graph.getCell(this.get("target").id),prevParent=this.graph.getCell(this.get("parent"));source&&target&&(newParent=this.graph.getCommonAncestor(source,target)),!prevParent||newParent&&newParent.id===prevParent.id||prevParent.unembed(this,opt),newParent&&newParent.embed(this,opt)}return newParent},hasLoop:function(opt){opt=opt||{};var sourceId=this.get("source").id,targetId=this.get("target").id;if(!sourceId||!targetId)return!1;var loop=sourceId===targetId;if(!loop&&opt.deep&&this.graph){var sourceElement=this.graph.getCell(sourceId),targetElement=this.graph.getCell(targetId);loop=sourceElement.isEmbeddedIn(targetElement)||targetElement.isEmbeddedIn(sourceElement)}return loop},getSourceElement:function(){var source=this.get("source");return source&&source.id&&this.graph&&this.graph.getCell(source.id)||null},getTargetElement:function(){var target=this.get("target");return target&&target.id&&this.graph&&this.graph.getCell(target.id)||null},getRelationshipAncestor:function(){var connectionAncestor;if(this.graph){var cells=_.compact([this,this.getSourceElement(),this.getTargetElement()]);connectionAncestor=this.graph.getCommonAncestor.apply(this.graph,cells)}return connectionAncestor||null},isRelationshipEmbeddedIn:function(element){var elementId=_.isString(element)?element:element.id,ancestor=this.getRelationshipAncestor();return!!ancestor&&(ancestor.id===elementId||ancestor.isEmbeddedIn(elementId))}},{endsEqual:function(a,b){var portsEqual=a.port===b.port||!a.port&&!b.port;return a.id===b.id&&portsEqual}}),joint.dia.LinkView=joint.dia.CellView.extend({className:function(){return _.unique(this.model.get("type").split(".").concat("link")).join(" ")},options:{shortLinkLength:100,doubleLinkTools:!1,longLinkLength:160,linkToolsOffset:40,doubleLinkToolsOffset:60,sampleInterval:50},_z:null,initialize:function(options){joint.dia.CellView.prototype.initialize.apply(this,arguments),"function"!=typeof this.constructor.prototype.watchSource&&(this.constructor.prototype.watchSource=this.createWatcher("source"),this.constructor.prototype.watchTarget=this.createWatcher("target")),this._labelCache={},this._markerCache={},this.startListening()},startListening:function(){var model=this.model;this.listenTo(model,"change:markup",this.render),this.listenTo(model,"change:smooth change:manhattan change:router change:connector",this.update),this.listenTo(model,"change:toolMarkup",this.onToolsChange),this.listenTo(model,"change:labels change:labelMarkup",this.onLabelsChange),this.listenTo(model,"change:vertices change:vertexMarkup",this.onVerticesChange),this.listenTo(model,"change:source",this.onSourceChange),this.listenTo(model,"change:target",this.onTargetChange)},onSourceChange:function(cell,source,opt){this.watchSource(cell,source),opt.translateBy&&this.model.get("target").id||(opt.updateConnectionOnly=!0,this.update(this.model,null,opt))},onTargetChange:function(cell,target,opt){this.watchTarget(cell,target),opt.translateBy||(opt.updateConnectionOnly=!0,this.update(this.model,null,opt))},onVerticesChange:function(cell,changed,opt){this.renderVertexMarkers(),opt.translateBy&&opt.translateBy!==this.model.id||(opt.updateConnectionOnly=!0,this.update(cell,null,opt))},onToolsChange:function(){this.renderTools().updateToolsPosition()},onLabelsChange:function(){this.renderLabels().updateLabelPositions()},render:function(){this.$el.empty();var model=this.model,children=V(model.get("markup")||model.markup);if(_.isArray(children)||(children=[children]),this._V={},_.each(children,function(child){var c=child.attr("class");c&&(this._V[$.camelCase(c)]=child)},this),!this._V.connection)throw new Error("link: no connection path in the markup");return this.renderTools(),this.renderVertexMarkers(),this.renderArrowheadMarkers(),this.vel.append(children),this.renderLabels(),this.watchSource(model,model.get("source")).watchTarget(model,model.get("target")).update(),this},renderLabels:function(){if(!this._V.labels)return this;this._labelCache={};var $labels=$(this._V.labels.node).empty(),labels=this.model.get("labels")||[];if(!labels.length)return this;var labelTemplate=joint.util.template(this.model.get("labelMarkup")||this.model.labelMarkup),labelNodeInstance=V(labelTemplate()),canLabelMove=this.can("labelMove");return _.each(labels,function(label,idx){var labelNode=labelNodeInstance.clone().node;V(labelNode).attr("label-idx",idx),canLabelMove&&V(labelNode).attr("cursor","move"),this._labelCache[idx]=V(labelNode);var $text=$(labelNode).find("text"),$rect=$(labelNode).find("rect"),textAttributes=_.extend({"text-anchor":"middle","font-size":14},joint.util.getByPath(label,"attrs/text","/"));$text.attr(_.omit(textAttributes,"text")),_.isUndefined(textAttributes.text)||V($text[0]).text(textAttributes.text+"",{annotations:textAttributes.annotations}),$labels.append(labelNode);var textBbox=V($text[0]).bbox(!0,$labels[0]);V($text[0]).translate(0,-textBbox.height/2);var rectAttributes=_.extend({fill:"white",rx:3,ry:3},joint.util.getByPath(label,"attrs/rect","/"));$rect.attr(_.extend(rectAttributes,{x:textBbox.x,y:textBbox.y-textBbox.height/2,width:textBbox.width,height:textBbox.height}))},this),this},renderTools:function(){if(!this._V.linkTools)return this;var tool2,$tools=$(this._V.linkTools.node).empty(),toolTemplate=joint.util.template(this.model.get("toolMarkup")||this.model.toolMarkup),tool=V(toolTemplate());return $tools.append(tool.node),this._toolCache=tool,this.options.doubleLinkTools&&(tool2=this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup?(toolTemplate=joint.util.template(this.model.get("doubleToolMarkup")||this.model.doubleToolMarkup),V(toolTemplate())):tool.clone(),$tools.append(tool2.node),this._tool2Cache=tool2),this},renderVertexMarkers:function(){if(!this._V.markerVertices)return this;var $markerVertices=$(this._V.markerVertices.node).empty(),markupTemplate=joint.util.template(this.model.get("vertexMarkup")||this.model.vertexMarkup);return _.each(this.model.get("vertices"),function(vertex,idx){$markerVertices.append(V(markupTemplate(_.extend({idx:idx},vertex))).node)}),this},renderArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;var $markerArrowheads=$(this._V.markerArrowheads.node);$markerArrowheads.empty();var markupTemplate=joint.util.template(this.model.get("arrowheadMarkup")||this.model.arrowheadMarkup);return this._V.sourceArrowhead=V(markupTemplate({end:"source"})),this._V.targetArrowhead=V(markupTemplate({end:"target"})),$markerArrowheads.append(this._V.sourceArrowhead.node,this._V.targetArrowhead.node),this},update:function(model,attributes,opt){return(opt=opt||{}).updateConnectionOnly||this.updateAttributes(),this.updateConnection(opt),this.updateLabelPositions(),this.updateToolsPosition(),this.updateArrowheadMarkers(),this.options.perpendicular=null,this.updatePostponed=!1,this},updateConnection:function(opt){opt=opt||{};var route,model=this.model;if(opt.translateBy&&model.isRelationshipEmbeddedIn(opt.translateBy)){var tx=opt.tx||0,ty=opt.ty||0;route=this.route=_.map(this.route,function(point){return g.point(point).offset(tx,ty)}),this._translateConnectionPoints(tx,ty)}else route=this.route=this.findRoute(model.get("vertices")||[],opt),this._findConnectionPoints(route);var pathData=this.getPathData(route);this._V.connection.attr("d",pathData),this._V.connectionWrap&&this._V.connectionWrap.attr("d",pathData),this._translateAndAutoOrientArrows(this._V.markerSource,this._V.markerTarget)},updateAttributes:function(){_.each(this.model.get("attrs"),function(attrs,selector){var processedAttributes=[];_.isObject(attrs.fill)&&(this.applyGradient(selector,"fill",attrs.fill),processedAttributes.push("fill")),_.isObject(attrs.stroke)&&(this.applyGradient(selector,"stroke",attrs.stroke),processedAttributes.push("stroke")),_.isObject(attrs.filter)&&(this.applyFilter(selector,attrs.filter),processedAttributes.push("filter")),0<processedAttributes.length&&(processedAttributes.unshift(attrs),attrs=_.omit.apply(_,processedAttributes)),this.findBySelector(selector).attr(attrs)},this)},_findConnectionPoints:function(vertices){var sourcePoint,targetPoint,sourceMarkerPoint,targetMarkerPoint,firstVertex=_.first(vertices);sourcePoint=this.getConnectionPoint("source",this.model.get("source"),firstVertex||this.model.get("target")).round();var lastVertex=_.last(vertices);targetPoint=this.getConnectionPoint("target",this.model.get("target"),lastVertex||sourcePoint).round();var cache=this._markerCache;this._V.markerSource&&(cache.sourceBBox=cache.sourceBBox||this._V.markerSource.bbox(!0),sourceMarkerPoint=g.point(sourcePoint).move(firstVertex||targetPoint,cache.sourceBBox.width*this._V.markerSource.scale().sx*-1).round()),this._V.markerTarget&&(cache.targetBBox=cache.targetBBox||this._V.markerTarget.bbox(!0),targetMarkerPoint=g.point(targetPoint).move(lastVertex||sourcePoint,cache.targetBBox.width*this._V.markerTarget.scale().sx*-1).round()),cache.sourcePoint=sourceMarkerPoint||sourcePoint,cache.targetPoint=targetMarkerPoint||targetPoint,this.sourcePoint=sourcePoint,this.targetPoint=targetPoint},_translateConnectionPoints:function(tx,ty){var cache=this._markerCache;cache.sourcePoint.offset(tx,ty),cache.targetPoint.offset(tx,ty),this.sourcePoint.offset(tx,ty),this.targetPoint.offset(tx,ty)},updateLabelPositions:function(){if(!this._V.labels)return this;var labels=this.model.get("labels")||[];if(!labels.length)return this;var samples,connectionElement=this._V.connection.node,connectionLength=connectionElement.getTotalLength();return _.isNaN(connectionLength)||_.each(labels,function(label,idx){var position=label.position,distance=_.isObject(position)?position.distance:position,offset=_.isObject(position)?position.offset:{x:0,y:0};distance=_.isNaN(distance)?connectionLength/2:1<(distance=(distance=connectionLength<distance?connectionLength:distance)<0?connectionLength+distance:distance)?distance:connectionLength*distance;var labelCoordinates=connectionElement.getPointAtLength(distance);if(_.isObject(offset))labelCoordinates=g.point(labelCoordinates).offset(offset.x,offset.y);else if(_.isNumber(offset)){for(var closestSampleIndex,p,sqDistance,minSqDistance=1/0,i=0,len=(samples=samples||this._samples||this._V.connection.sample(this.options.sampleInterval)).length;i<len;i++)p=samples[i],(sqDistance=g.line(p,labelCoordinates).squaredLength())<minSqDistance&&(minSqDistance=sqDistance,closestSampleIndex=i);var prevSample=samples[closestSampleIndex-1],nextSample=samples[closestSampleIndex+1],angle=0;nextSample?angle=g.point(labelCoordinates).theta(nextSample):prevSample&&(angle=g.point(prevSample).theta(labelCoordinates)),labelCoordinates=g.point(labelCoordinates).offset(offset).rotate(labelCoordinates,angle-90)}this._labelCache[idx].attr("transform","translate("+labelCoordinates.x+", "+labelCoordinates.y+")")},this),this},updateToolsPosition:function(){if(!this._V.linkTools)return this;var scale="",offset=this.options.linkToolsOffset,connectionLength=this.getConnectionLength();if(!_.isNaN(connectionLength)){connectionLength<this.options.shortLinkLength&&(scale="scale(.5)",offset/=2);var toolPosition=this.getPointAtLength(offset);if(this._toolCache.attr("transform","translate("+toolPosition.x+", "+toolPosition.y+") "+scale),this.options.doubleLinkTools&&connectionLength>=this.options.longLinkLength){var doubleLinkToolsOffset=this.options.doubleLinkToolsOffset||offset;toolPosition=this.getPointAtLength(connectionLength-doubleLinkToolsOffset),this._tool2Cache.attr("transform","translate("+toolPosition.x+", "+toolPosition.y+") "+scale),this._tool2Cache.attr("visibility","visible")}else this.options.doubleLinkTools&&this._tool2Cache.attr("visibility","hidden")}return this},updateArrowheadMarkers:function(){if(!this._V.markerArrowheads)return this;if("none"===$.css(this._V.markerArrowheads.node,"display"))return this;var sx=this.getConnectionLength()<this.options.shortLinkLength?.5:1;return this._V.sourceArrowhead.scale(sx),this._V.targetArrowhead.scale(sx),this._translateAndAutoOrientArrows(this._V.sourceArrowhead,this._V.targetArrowhead),this},createWatcher:function(endType){var onModelChange=_.partial(this.onEndModelChange,endType);return function(link,end){end=end||{};var endModel=null,previousEnd=link.previous(endType)||{};return previousEnd.id&&this.stopListening(this.paper.getModelById(previousEnd.id),"change",onModelChange),end.id&&(endModel=this.paper.getModelById(end.id),this.listenTo(endModel,"change",onModelChange)),onModelChange.call(this,endModel,{cacheOnly:!0}),this}},onEndModelChange:function(endType,endModel,opt){var doUpdate=!opt.cacheOnly,model=this.model,end=model.get(endType)||{};if(endModel){var selector=this.constructor.makeSelector(end),oppositeEndType="source"==endType?"target":"source",oppositeEnd=model.get(oppositeEndType)||{},oppositeSelector=oppositeEnd.id&&this.constructor.makeSelector(oppositeEnd);if(opt.handleBy===this.cid&&selector==oppositeSelector)this[endType+"BBox"]=this[oppositeEndType+"BBox"],this[endType+"View"]=this[oppositeEndType+"View"],this[endType+"Magnet"]=this[oppositeEndType+"Magnet"];else if(opt.translateBy){var bbox=this[endType+"BBox"];bbox.x+=opt.tx,bbox.y+=opt.ty}else{var view=this.paper.findViewByModel(end.id),magnetElement=view.el.querySelector(selector);this[endType+"BBox"]=view.getStrokeBBox(magnetElement),this[endType+"View"]=view,this[endType+"Magnet"]=magnetElement}if(opt.handleBy===this.cid&&opt.translateBy&&model.isEmbeddedIn(endModel)&&!_.isEmpty(model.get("vertices"))&&(doUpdate=!1),!this.updatePostponed&&oppositeEnd.id){var oppositeEndModel=this.paper.getModelById(oppositeEnd.id);end.id===oppositeEnd.id&&(opt.handleBy=this.cid),(opt.handleBy===this.cid||opt.translateBy&&oppositeEndModel.isEmbeddedIn(opt.translateBy))&&(doUpdate=!(this.updatePostponed=!0))}}else this[endType+"BBox"]=g.rect(end.x||0,end.y||0,1,1),this[endType+"View"]=this[endType+"Magnet"]=null;doUpdate&&(opt.updateConnectionOnly=!0,this.update(model,null,opt))},_translateAndAutoOrientArrows:function(sourceArrow,targetArrow){sourceArrow&&sourceArrow.translateAndAutoOrient(this.sourcePoint,_.first(this.route)||this.targetPoint,this.paper.viewport),targetArrow&&targetArrow.translateAndAutoOrient(this.targetPoint,_.last(this.route)||this.sourcePoint,this.paper.viewport)},removeVertex:function(idx){var vertices=_.clone(this.model.get("vertices"));return vertices&&vertices.length&&(vertices.splice(idx,1),this.model.set("vertices",vertices,{ui:!0})),this},addVertex:function(vertex){for(var vertices=(this.model.get("vertices")||[]).slice(),originalVertices=vertices.slice(),path=this._V.connection.node.cloneNode(!1),originalPathLength=path.getTotalLength(),idx=vertices.length+1;idx--&&(vertices.splice(idx,0,vertex),V(path).attr("d",this.getPathData(this.findRoute(vertices))),20<path.getTotalLength()-originalPathLength);)vertices=originalVertices.slice();return-1===idx&&(idx=0,vertices.splice(idx,0,vertex)),this.model.set("vertices",vertices,{ui:!0}),idx},sendToken:function(token,duration,callback){duration=duration||1e3,V(this.paper.viewport).append(token),V(token).animateAlongPath({dur:duration+"ms",repeatCount:1},this._V.connection.node),_.delay(function(){V(token).remove(),callback&&callback()},duration)},findRoute:function(oldVertices){var namespace=joint.routers,router=this.model.get("router"),defaultRouter=this.paper.options.defaultRouter;if(!router)if(this.model.get("manhattan"))router={name:"orthogonal"};else{if(!defaultRouter)return oldVertices;router=defaultRouter}var args=router.args||{},routerFn=_.isFunction(router)?router:namespace[router.name];if(!_.isFunction(routerFn))throw new Error('unknown router: "'+router.name+'"');return routerFn.call(this,oldVertices||[],args,this)},getPathData:function(vertices){var namespace=joint.connectors,connector=this.model.get("connector"),defaultConnector=this.paper.options.defaultConnector;connector=connector||(this.model.get("smooth")?{name:"smooth"}:defaultConnector||{});var connectorFn=_.isFunction(connector)?connector:namespace[connector.name],args=connector.args||{};if(!_.isFunction(connectorFn))throw new Error('unknown connector: "'+connector.name+'"');return connectorFn.call(this,this._markerCache.sourcePoint,this._markerCache.targetPoint,vertices||this.model.get("vertices")||{},args,this)},getConnectionPoint:function(end,selectorOrPoint,referenceSelectorOrPoint){var spot;if(_.isEmpty(selectorOrPoint)&&(selectorOrPoint={x:0,y:0}),_.isEmpty(referenceSelectorOrPoint)&&(referenceSelectorOrPoint={x:0,y:0}),selectorOrPoint.id){var reference,spotBbox="source"===end?this.sourceBBox:this.targetBBox;if(referenceSelectorOrPoint.id){var referenceBbox="source"===end?this.targetBBox:this.sourceBBox;reference=(reference=g.rect(referenceBbox).intersectionWithLineFromCenterToPoint(g.rect(spotBbox).center()))||g.rect(referenceBbox).center()}else reference=g.point(referenceSelectorOrPoint);if(this.paper.options.perpendicularLinks||this.options.perpendicular){var horizontalLineRect=g.rect(0,reference.y,this.paper.options.width,1),verticalLineRect=g.rect(reference.x,0,1,this.paper.options.height);if(horizontalLineRect.intersect(g.rect(spotBbox)))switch(g.rect(spotBbox).sideNearestToPoint(reference)){case"left":spot=g.point(spotBbox.x,reference.y);break;case"right":spot=g.point(spotBbox.x+spotBbox.width,reference.y);break;default:spot=g.rect(spotBbox).center()}else if(verticalLineRect.intersect(g.rect(spotBbox)))switch(g.rect(spotBbox).sideNearestToPoint(reference)){case"top":spot=g.point(reference.x,spotBbox.y);break;case"bottom":spot=g.point(reference.x,spotBbox.y+spotBbox.height);break;default:spot=g.rect(spotBbox).center()}else spot=(spot=g.rect(spotBbox).intersectionWithLineFromCenterToPoint(reference))||g.rect(spotBbox).center()}else if(this.paper.options.linkConnectionPoint){var view="target"===end?this.targetView:this.sourceView,magnet="target"===end?this.targetMagnet:this.sourceMagnet;spot=this.paper.options.linkConnectionPoint(this,view,magnet,reference)}else spot=(spot=g.rect(spotBbox).intersectionWithLineFromCenterToPoint(reference))||g.rect(spotBbox).center()}else spot=g.point(selectorOrPoint);return spot},getConnectionLength:function(){return this._V.connection.node.getTotalLength()},getPointAtLength:function(length){return this._V.connection.node.getPointAtLength(length)},_beforeArrowheadMove:function(){this._z=this.model.get("z"),this.model.toFront(),this.el.style.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets()},_afterArrowheadMove:function(){_.isNull(this._z)||(this.model.set("z",this._z,{ui:!0}),this._z=null),this.el.style.pointerEvents="visiblePainted",this.paper.options.markAvailable&&this._unmarkAvailableMagnets()},_createValidateConnectionArgs:function(arrowhead){var oppositeArrowhead,args=[];args[4]=arrowhead,args[5]=this;var i=0,j=0;oppositeArrowhead="source"===arrowhead?(i=2,"target"):(j=2,"source");var end=this.model.get(oppositeArrowhead);return end.id&&(args[i]=this.paper.findViewByModel(end.id),args[i+1]=end.selector&&args[i].el.querySelector(end.selector)),function(cellView,magnet){return args[j]=cellView,args[j+1]=cellView.el===magnet?void 0:magnet,args}},_markAvailableMagnets:function(){function isMagnetAvailable(view,magnet){var paper=view.paper;return paper.options.validateConnection.apply(paper,this._validateConnectionArgs(view,magnet))}var paper=this.paper,elements=paper.model.getElements();this._marked={},_.chain(elements).map(paper.findViewByModel,paper).each(function(view){var magnets=Array.prototype.slice.call(view.el.querySelectorAll("[magnet]"));"false"!==view.el.getAttribute("magnet")&&magnets.push(view.el);var availableMagnets=_.filter(magnets,_.partial(isMagnetAvailable,view),this);0<availableMagnets.length&&(_.each(availableMagnets,_.partial(view.highlight,_,{magnetAvailability:!0}),view),view.highlight(null,{elementAvailability:!0}),this._marked[view.model.id]=availableMagnets)},this).value()},_unmarkAvailableMagnets:function(){_.each(this._marked,function(markedMagnets,id){var view=this.paper.findViewByModel(id);view&&(_.each(markedMagnets,_.partial(view.unhighlight,_,{magnetAvailability:!0}),view),view.unhighlight(null,{elementAvailability:!0}))},this),this._marked=null},startArrowheadMove:function(end,opt){opt=_.defaults(opt||{},{whenNotAllowed:"revert"}),this._action="arrowhead-move",this._whenNotAllowed=opt.whenNotAllowed,this._arrowhead=end,this._initialMagnet=this[end+"Magnet"]||(this[end+"View"]?this[end+"View"].el:null),this._initialEnd=_.clone(this.model.get(end))||{x:0,y:0},this._validateConnectionArgs=this._createValidateConnectionArgs(this._arrowhead),this._beforeArrowheadMove()},pointerdown:function(evt,x,y){if(joint.dia.CellView.prototype.pointerdown.apply(this,arguments),this.notify("link:pointerdown",evt,x,y),this._dx=x,this._dy=y,null==evt.target.getAttribute("magnet")){var labelNode,className=evt.target.getAttribute("class"),parentClassName=evt.target.parentNode.getAttribute("class");switch(labelNode="label"===parentClassName?(className=parentClassName,evt.target.parentNode):evt.target,className){case"marker-vertex":this.can("vertexMove")&&(this._action="vertex-move",this._vertexIdx=evt.target.getAttribute("idx"));break;case"marker-vertex-remove":case"marker-vertex-remove-area":this.can("vertexRemove")&&this.removeVertex(evt.target.getAttribute("idx"));break;case"marker-arrowhead":this.can("arrowheadMove")&&this.startArrowheadMove(evt.target.getAttribute("end"));break;case"label":this.can("labelMove")&&(this._action="label-move",this._labelIdx=parseInt(V(labelNode).attr("label-idx"),10),this._samples=this._V.connection.sample(1),this._linkLength=this._V.connection.node.getTotalLength());break;default:var targetParentEvent=evt.target.parentNode.getAttribute("event");targetParentEvent?this.can("useLinkTools")&&("remove"===targetParentEvent?this.model.remove():this.notify(targetParentEvent,evt,x,y)):this.can("vertexAdd")&&(this._vertexIdx=this.addVertex({x:x,y:y}),this._action="vertex-move")}}},pointermove:function(evt,x,y){switch(this._action){case"vertex-move":var vertices=_.clone(this.model.get("vertices"));vertices[this._vertexIdx]={x:x,y:y},this.model.set("vertices",vertices,{ui:!0});break;case"label-move":for(var closestSample,closestSampleIndex,p,sqDistance,dragPoint={x:x,y:y},samples=(this.model.get("labels")[this._labelIdx],this._samples),minSqDistance=1/0,i=0,len=samples.length;i<len;i++)p=samples[i],(sqDistance=g.line(p,dragPoint).squaredLength())<minSqDistance&&(minSqDistance=sqDistance,closestSample=p,closestSampleIndex=i);var prevSample=samples[closestSampleIndex-1],nextSample=samples[closestSampleIndex+1],offset=(g.point(closestSample).distance(dragPoint),0);prevSample&&nextSample?offset=g.line(prevSample,nextSample).pointOffset(dragPoint):prevSample?offset=g.line(prevSample,closestSample).pointOffset(dragPoint):nextSample&&(offset=g.line(closestSample,nextSample).pointOffset(dragPoint)),this.model.label(this._labelIdx,{position:{distance:closestSample.distance/this._linkLength,offset:offset}});break;case"arrowhead-move":if(this.paper.options.snapLinks){var distance,r=this.paper.options.snapLinks.radius||50,viewsInArea=this.paper.findViewsInArea({x:x-r,y:y-r,width:2*r,height:2*r});this._closestView&&this._closestView.unhighlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),this._closestView=this._closestEnd=null;var minDistance=Number.MAX_VALUE,pointer=g.point(x,y);_.each(viewsInArea,function(view){"false"!==view.el.getAttribute("magnet")&&(distance=view.model.getBBox().center().distance(pointer))<r&&distance<minDistance&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(view,null))&&(minDistance=distance,this._closestView=view,this._closestEnd={id:view.model.id}),view.$("[magnet]").each(_.bind(function(index,magnet){var bbox=V(magnet).bbox(!1,this.paper.viewport);(distance=pointer.distance({x:bbox.x+bbox.width/2,y:bbox.y+bbox.height/2}))<r&&distance<minDistance&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(view,magnet))&&(minDistance=distance,this._closestView=view,this._closestEnd={id:view.model.id,selector:view.getSelector(magnet),port:magnet.getAttribute("port")})},this))},this),this._closestView&&this._closestView.highlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),this.model.set(this._arrowhead,this._closestEnd||{x:x,y:y},{ui:!0})}else{var target="mousemove"===evt.type?evt.target:document.elementFromPoint(evt.clientX,evt.clientY);this._targetEvent!==target&&(this._magnetUnderPointer&&this._viewUnderPointer.unhighlight(this._magnetUnderPointer,{connecting:!0}),this._viewUnderPointer=this.paper.findView(target),this._viewUnderPointer?(this._magnetUnderPointer=this._viewUnderPointer.findMagnet(target),this._magnetUnderPointer&&this.paper.options.validateConnection.apply(this.paper,this._validateConnectionArgs(this._viewUnderPointer,this._magnetUnderPointer))?this._magnetUnderPointer&&this._viewUnderPointer.highlight(this._magnetUnderPointer,{connecting:!0}):this._magnetUnderPointer=null):this._magnetUnderPointer=null),this._targetEvent=target,this.model.set(this._arrowhead,{x:x,y:y},{ui:!0})}}this._dx=x,this._dy=y,joint.dia.CellView.prototype.pointermove.apply(this,arguments),this.notify("link:pointermove",evt,x,y)},pointerup:function(evt,x,y){if("label-move"===this._action)this._samples=null;else if("arrowhead-move"===this._action){var magnetUnderPointer,paper=this.paper,paperOptions=paper.options,arrowhead=this._arrowhead,initialEnd=this._initialEnd;if(paperOptions.snapLinks)this._closestView&&(this._closestView.unhighlight(this._closestEnd.selector,{connecting:!0,snapping:!0}),magnetUnderPointer=this._closestView.findMagnet(this._closestEnd.selector)),this._closestView=this._closestEnd=null;else{var viewUnderPointer=this._viewUnderPointer;if(magnetUnderPointer=this._magnetUnderPointer,this._viewUnderPointer=null,this._magnetUnderPointer=null,magnetUnderPointer){viewUnderPointer.unhighlight(magnetUnderPointer,{connecting:!0});var selector=viewUnderPointer.getSelector(magnetUnderPointer),port=magnetUnderPointer.getAttribute("port"),arrowheadValue={id:viewUnderPointer.model.id};null!=selector&&(arrowheadValue.port=port),null!=port&&(arrowheadValue.selector=selector),this.model.set(arrowhead,arrowheadValue,{ui:!0})}}if(!paper.linkAllowed(this))switch(this._whenNotAllowed){case"remove":this.model.remove();break;case"revert":default:this.model.set(arrowhead,initialEnd,{ui:!0})}paperOptions.embeddingMode&&this.model.reparent()&&(this._z=null);var currentEnd=this.model.prop(arrowhead)||{};joint.dia.Link.endsEqual(initialEnd,currentEnd)||(initialEnd.id&&this.notify("link:disconnect",evt,paper.findViewByModel(initialEnd.id),this._initialMagnet,arrowhead),currentEnd.id&&this.notify("link:connect",evt,paper.findViewByModel(currentEnd.id),magnetUnderPointer,arrowhead)),this._afterArrowheadMove()}this._action=null,this._whenNotAllowed=null,this._initialMagnet=null,this._initialEnd=null,this._validateConnectionArgs=null,this.notify("link:pointerup",evt,x,y),joint.dia.CellView.prototype.pointerup.apply(this,arguments)}},{makeSelector:function(end){var selector='[model-id="'+end.id+'"]';return end.port?selector+=' [port="'+end.port+'"]':end.selector&&(selector+=" "+end.selector),selector}}),joint.dia.Paper=joint.mvc.View.extend({className:"paper",options:{width:800,height:600,origin:{x:0,y:0},gridSize:1,drawGrid:!1,perpendicularLinks:!1,elementView:joint.dia.ElementView,linkView:joint.dia.LinkView,snapLinks:!1,multiLinks:!0,guard:function(evt,view){return!1},highlighting:{default:{name:"stroke",options:{padding:3}},magnetAvailability:{name:"addClass",options:{className:"available-magnet"}},elementAvailability:{name:"addClass",options:{className:"available-cell"}}},preventContextMenu:!0,restrictTranslate:!1,markAvailable:!1,defaultLink:new joint.dia.Link,defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},validateMagnet:function(cellView,magnet){return"passive"!==magnet.getAttribute("magnet")},validateConnection:function(cellViewS,magnetS,cellViewT,magnetT,end,linkView){return("target"===end?cellViewT:cellViewS)instanceof joint.dia.ElementView},embeddingMode:!1,validateEmbedding:function(childView,parentView){return!0},findParentBy:"bbox",frontParentOnly:!0,interactive:{labelMove:!1},linkPinning:!0,clickThreshold:0,cellViewNamespace:joint.shapes,highlighterNamespace:joint.highlighters},events:{mousedown:"pointerdown",dblclick:"mousedblclick",click:"mouseclick",touchstart:"pointerdown",touchend:"mouseclick",touchmove:"pointermove",mousemove:"pointermove","mouseover .element":"cellMouseover","mouseover .link":"cellMouseover","mouseout .element":"cellMouseout","mouseout .link":"cellMouseout",contextmenu:"contextmenu",mousewheel:"mousewheel",DOMMouseScroll:"mousewheel"},_highlights:[],init:function(){_.bindAll(this,"pointerup"),this.model=this.options.model||new joint.dia.Graph,this.options.origin=_.clone(this.options.origin),this.options.defaultConnector=_.clone(this.options.defaultConnector),_.defaults(this.options.highlighting,this.constructor.prototype.options.highlighting),this.options.highlighting=_.cloneDeep(this.options.highlighting),this.svg=V("svg").node,this.viewport=V("g").addClass("viewport").node,this.defs=V("defs").node,V(this.svg).append([this.viewport,this.defs]),this.$el.append(this.svg),this.listenTo(this.model,"add",this.onCellAdded),this.listenTo(this.model,"remove",this.removeView),this.listenTo(this.model,"reset",this.resetViews),this.listenTo(this.model,"sort",this._onSort),this.listenTo(this.model,"batch:stop",this._onBatchStop),this.setOrigin(),this.setDimensions(),$(document).on("mouseup touchend",this.pointerup),this._mousemoved=0,this._views={},this.on("cell:highlight",this.onCellHighlight,this),this.on("cell:unhighlight",this.onCellUnhighlight,this)},_onSort:function(){this.model.hasActiveBatch("add")||this.sortViews()},_onBatchStop:function(data){"add"!==(data&&data.batchName)||this.model.hasActiveBatch("add")||this.sortViews()},onRemove:function(){this.removeViews(),$(document).off("mouseup touchend",this.pointerup)},setDimensions:function(width,height){width=this.options.width=width||this.options.width,height=this.options.height=height||this.options.height,V(this.svg).attr({width:width,height:height}),this.trigger("resize",width,height)},setOrigin:function(ox,oy){this.options.origin.x=ox||0,this.options.origin.y=oy||0,V(this.viewport).translate(ox,oy,{absolute:!0}),this.trigger("translate",ox,oy),this.options.drawGrid&&this.drawGrid()},fitToContent:function(gridWidth,gridHeight,padding,opt){padding=_.isObject(gridWidth)?(gridWidth=(opt=gridWidth).gridWidth||1,gridHeight=opt.gridHeight||1,opt.padding||0):(opt=opt||{},gridWidth=gridWidth||1,gridHeight=gridHeight||1,padding||0),padding=joint.util.normalizeSides(padding);var bbox=V(this.viewport).bbox(!0,this.svg),currentScale=V(this.viewport).scale();bbox.x*=currentScale.sx,bbox.y*=currentScale.sy,bbox.width*=currentScale.sx,bbox.height*=currentScale.sy;var calcWidth=Math.max(Math.ceil((bbox.width+bbox.x)/gridWidth),1)*gridWidth,calcHeight=Math.max(Math.ceil((bbox.height+bbox.y)/gridHeight),1)*gridHeight,tx=0,ty=0;("negative"==opt.allowNewOrigin&&bbox.x<0||"positive"==opt.allowNewOrigin&&0<=bbox.x||"any"==opt.allowNewOrigin)&&(tx=Math.ceil(-bbox.x/gridWidth)*gridWidth,calcWidth+=tx+=padding.left),("negative"==opt.allowNewOrigin&&bbox.y<0||"positive"==opt.allowNewOrigin&&0<=bbox.y||"any"==opt.allowNewOrigin)&&(ty=Math.ceil(-bbox.y/gridHeight)*gridHeight,calcHeight+=ty+=padding.top),calcWidth+=padding.right,calcHeight+=padding.bottom,calcWidth=Math.max(calcWidth,opt.minWidth||0),calcHeight=Math.max(calcHeight,opt.minHeight||0),calcWidth=Math.min(calcWidth,opt.maxWidth||Number.MAX_VALUE),calcHeight=Math.min(calcHeight,opt.maxHeight||Number.MAX_VALUE);var dimensionChange=calcWidth!=this.options.width||calcHeight!=this.options.height;tx==this.options.origin.x&&ty==this.options.origin.y||this.setOrigin(tx,ty),dimensionChange&&this.setDimensions(calcWidth,calcHeight)},scaleContentToFit:function(opt){var contentBBox=this.getContentBBox();if(contentBBox.width&&contentBBox.height){opt=opt||{},_.defaults(opt,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE});var padding=opt.padding,minScaleX=opt.minScaleX||opt.minScale,maxScaleX=opt.maxScaleX||opt.maxScale,minScaleY=opt.minScaleY||opt.minScale,maxScaleY=opt.maxScaleY||opt.maxScale,fittingBBox=opt.fittingBBox||{x:this.options.origin.x,y:this.options.origin.y,width:this.options.width,height:this.options.height};fittingBBox=g.rect(fittingBBox).moveAndExpand({x:padding,y:padding,width:-2*padding,height:-2*padding});var currentScale=V(this.viewport).scale(),newSx=fittingBBox.width/contentBBox.width*currentScale.sx,newSy=fittingBBox.height/contentBBox.height*currentScale.sy;if(opt.preserveAspectRatio&&(newSx=newSy=Math.min(newSx,newSy)),opt.scaleGrid){var gridSize=opt.scaleGrid;newSx=gridSize*Math.floor(newSx/gridSize),newSy=gridSize*Math.floor(newSy/gridSize)}newSx=Math.min(maxScaleX,Math.max(minScaleX,newSx)),newSy=Math.min(maxScaleY,Math.max(minScaleY,newSy)),this.scale(newSx,newSy);var contentTranslation=this.getContentBBox(),newOx=fittingBBox.x-contentTranslation.x,newOy=fittingBBox.y-contentTranslation.y;this.setOrigin(newOx,newOy)}},getContentBBox:function(){var crect=this.viewport.getBoundingClientRect(),screenCTM=this.viewport.getScreenCTM(),viewportCTM=this.viewport.getCTM();return g.rect({x:crect.left-screenCTM.e+viewportCTM.e,y:crect.top-screenCTM.f+viewportCTM.f,width:crect.width,height:crect.height})},getArea:function(){var transformationMatrix=this.viewport.getCTM().inverse(),noTransformationBBox={x:0,y:0,width:this.options.width,height:this.options.height};return g.rect(V.transformRect(noTransformationBBox,transformationMatrix))},getRestrictedArea:function(){return _.isFunction(this.options.restrictTranslate)?this.options.restrictTranslate.apply(this,arguments):!0===this.options.restrictTranslate?this.getArea():this.options.restrictTranslate||null},createViewForModel:function(cell){var optionalViewClass,defaultViewClass,namespace=this.options.cellViewNamespace,type=cell.get("type")+"View",namespaceViewClass=joint.util.getByPath(namespace,type,".");return defaultViewClass=cell.isLink()?(optionalViewClass=this.options.linkView,joint.dia.LinkView):(optionalViewClass=this.options.elementView,joint.dia.ElementView),new(optionalViewClass.prototype instanceof Backbone.View?namespaceViewClass||optionalViewClass:optionalViewClass.call(this,cell)||namespaceViewClass||defaultViewClass)({model:cell,interactive:this.options.interactive})},onCellAdded:function(cell,graph,opt){if(this.options.async&&!1!==opt.async&&_.isNumber(opt.position)){if(this._asyncCells=this._asyncCells||[],this._asyncCells.push(cell),0==opt.position){if(this._frameId)throw new Error("another asynchronous rendering in progress");this.asyncRenderViews(this._asyncCells,opt),delete this._asyncCells}}else this.renderView(cell)},removeView:function(cell){var view=this._views[cell.id];return view&&(view.remove(),delete this._views[cell.id]),view},renderView:function(cell){var view=this._views[cell.id]=this.createViewForModel(cell);return V(this.viewport).append(view.el),view.paper=this,view.render(),$(view.el).find("image").on("dragstart",function(){return!1}),view},beforeRenderViews:function(cells){return cells.sort(function(a){return a instanceof joint.dia.Link?1:-1}),cells},afterRenderViews:function(){this.sortViews()},resetViews:function(cellsCollection,opt){this.removeViews();var cells=cellsCollection.models.slice();cells=this.beforeRenderViews(cells,opt)||cells,this._frameId&&(joint.util.cancelFrame(this._frameId),delete this._frameId),this.options.async?this.asyncRenderViews(cells,opt):(_.each(cells,this.renderView,this),this.sortViews())},removeViews:function(){_.invoke(this._views,"remove"),this._views={}},asyncBatchAdded:_.noop,asyncRenderViews:function(cells,opt){if(this._frameId){var batchSize=this.options.async&&this.options.async.batchSize||50,batchCells=cells.splice(0,batchSize),collection=this.model.get("cells");_.each(batchCells,function(cell){cell.collection===collection&&this.renderView(cell)},this),this.asyncBatchAdded()}cells.length?this._frameId=joint.util.nextFrame(function(){this.asyncRenderViews(cells,opt)},this):(delete this._frameId,this.afterRenderViews(opt),this.trigger("render:done",opt))},sortViews:function(){var $cells=$(this.viewport).children("[model-id]"),cells=this.model.get("cells");joint.util.sortElements($cells,function(a,b){var cellA=cells.get($(a).attr("model-id")),cellB=cells.get($(b).attr("model-id"));return(cellA.get("z")||0)>(cellB.get("z")||0)?1:-1})},scale:function(sx,sy,ox,oy){sy=sy||sx,_.isUndefined(ox)&&(oy=ox=0),V(this.viewport).attr("transform","");var oldTx=this.options.origin.x,oldTy=this.options.origin.y;if(ox||oy||oldTx||oldTy){var newTx=oldTx-ox*(sx-1),newTy=oldTy-oy*(sy-1);this.setOrigin(newTx,newTy)}return V(this.viewport).scale(sx,sy),this.trigger("scale",sx,sy,ox,oy),this.options.drawGrid&&this.drawGrid(),this},rotate:function(deg,ox,oy){if(_.isUndefined(ox)){var bbox=this.viewport.getBBox();ox=bbox.width/2,oy=bbox.height/2}V(this.viewport).rotate(deg,ox,oy)},findView:function($el){for(var el=_.isString($el)?this.viewport.querySelector($el):$el instanceof $?$el[0]:$el;el&&el!==this.el&&el!==document;){var id=el.getAttribute("model-id");if(id)return this._views[id];el=el.parentNode}},findViewByModel:function(cell){var id=_.isString(cell)?cell:cell.id;return this._views[id]},findViewsFromPoint:function(p){p=g.point(p);var views=_.map(this.model.getElements(),this.findViewByModel,this);return _.filter(views,function(view){return view&&g.rect(view.vel.bbox(!1,this.viewport)).containsPoint(p)},this)},findViewsInArea:function(rect,opt){opt=_.defaults(opt||{},{strict:!1}),rect=g.rect(rect);var views=_.map(this.model.getElements(),this.findViewByModel,this),method=opt.strict?"containsRect":"intersect";return _.filter(views,function(view){return view&&rect[method](g.rect(view.vel.bbox(!1,this.viewport)))},this)},getModelById:function(id){return this.model.getCell(id)},snapToGrid:function(p){var localPoint=V(this.viewport).toLocalPoint(p.x,p.y);return{x:g.snapToGrid(localPoint.x,this.options.gridSize),y:g.snapToGrid(localPoint.y,this.options.gridSize)}},clientToLocalPoint:function(p){p=g.point(p);var fakeRect=V("rect",{width:this.options.width,height:this.options.height,x:0,y:0,opacity:0});V(this.svg).prepend(fakeRect);var paperOffset=$(this.svg).offset();fakeRect.remove();var scrollTop=document.body.scrollTop||document.documentElement.scrollTop,scrollLeft=document.body.scrollLeft||document.documentElement.scrollLeft;return p.offset(scrollLeft-paperOffset.left,scrollTop-paperOffset.top),V.transformPoint(p,this.viewport.getCTM().inverse())},linkAllowed:function(linkViewOrModel){var link;if(linkViewOrModel instanceof joint.dia.Link)link=linkViewOrModel;else{if(!(linkViewOrModel instanceof joint.dia.LinkView))throw new Error("Must provide link model or view.");link=linkViewOrModel.model}if(!this.options.multiLinks){var source=link.get("source"),target=link.get("target");if(source.id&&target.id){var sourceModel=link.getSourceElement();if(sourceModel){var connectedLinks=this.model.getConnectedLinks(sourceModel,{outbound:!0,inbound:!1});if(1<_.filter(connectedLinks,function(_link){var _source=_link.get("source"),_target=_link.get("target");return _source&&_source.id===source.id&&(!_source.port||_source.port===source.port)&&_target&&_target.id===target.id&&(!_target.port||_target.port===target.port)}).length)return!1}}}return!!(this.options.linkPinning||_.has(link.get("source"),"id")&&_.has(link.get("target"),"id"))},getDefaultLink:function(cellView,magnet){return _.isFunction(this.options.defaultLink)?this.options.defaultLink.call(this,cellView,magnet):this.options.defaultLink.clone()},resolveHighlighter:function(opt){var highlighterDef=(opt=opt||{}).highlighter,paperOpt=this.options;if(_.isUndefined(highlighterDef)){var type=_.chain(opt).pick("embedding","connecting","magnetAvailability","elementAvailability").keys().first().value();highlighterDef=type&&paperOpt.highlighting[type]||paperOpt.highlighting.default}if(!highlighterDef)return!1;var name=highlighterDef.name,highlighter=paperOpt.highlighterNamespace[name];if(!highlighter)throw new Error('Unknown highlighter ("'+name+'")');if("function"!=typeof highlighter.highlight)throw new Error('Highlighter ("'+name+'") is missing required highlight() method');if("function"!=typeof highlighter.unhighlight)throw new Error('Highlighter ("'+name+'") is missing required unhighlight() method');return{highlighter:highlighter,options:highlighterDef.options,name:name}},onCellHighlight:function(cellView,magnetEl,opt){if(opt=this.resolveHighlighter(opt)){var key=opt.name+magnetEl.id+JSON.stringify(opt.options);if(!this._highlights[key]){var highlighter=opt.highlighter;highlighter.highlight(cellView,magnetEl,_.clone(opt.options)),this._highlights[key]={cellView:cellView,magnetEl:magnetEl,opt:opt.options,highlighter:highlighter}}}},onCellUnhighlight:function(cellView,magnetEl,opt){if(opt=this.resolveHighlighter(opt)){var key=opt.name+magnetEl.id+JSON.stringify(opt.options),highlight=this._highlights[key];highlight&&(highlight.highlighter.unhighlight(highlight.cellView,highlight.magnetEl,highlight.opt),this._highlights[key]=null)}},mousedblclick:function(evt){evt.preventDefault(),evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(!this.guard(evt,view)){var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});view?view.pointerdblclick(evt,localPoint.x,localPoint.y):this.trigger("blank:pointerdblclick",evt,localPoint.x,localPoint.y)}},mouseclick:function(evt){if(this._mousemoved<=this.options.clickThreshold){evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(this.guard(evt,view))return;var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});view?view.pointerclick(evt,localPoint.x,localPoint.y):this.trigger("blank:pointerclick",evt,localPoint.x,localPoint.y)}},guard:function(evt,view){return!(!this.options.guard||!this.options.guard(evt,view))||!(view&&view.model&&view.model instanceof joint.dia.Cell)&&this.svg!==evt.target&&this.el!==evt.target&&!$.contains(this.svg,evt.target)},contextmenu:function(evt){evt=joint.util.normalizeEvent(evt),this.options.preventContextMenu&&evt.preventDefault();var view=this.findView(evt.target);if(!this.guard(evt,view)){var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});view?view.contextmenu(evt,localPoint.x,localPoint.y):this.trigger("blank:contextmenu",evt,localPoint.x,localPoint.y)}},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(!this.guard(evt,view)){evt.preventDefault(),this._mousemoved=0;var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});view?(this.sourceView=view).pointerdown(evt,localPoint.x,localPoint.y):this.trigger("blank:pointerdown",evt,localPoint.x,localPoint.y)}},pointermove:function(evt){if(this.sourceView){evt.preventDefault(),evt=joint.util.normalizeEvent(evt),this._mousemoved++;var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});this.sourceView.pointermove(evt,localPoint.x,localPoint.y)}},pointerup:function(evt){evt=joint.util.normalizeEvent(evt);var localPoint=this.snapToGrid({x:evt.clientX,y:evt.clientY});this.sourceView?(this.sourceView.pointerup(evt,localPoint.x,localPoint.y),this.sourceView=null):this.trigger("blank:pointerup",evt,localPoint.x,localPoint.y)},mousewheel:function(evt){evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(!this.guard(evt,view)){var originalEvent=evt.originalEvent,localPoint=this.snapToGrid({x:originalEvent.clientX,y:originalEvent.clientY}),delta=Math.max(-1,Math.min(1,originalEvent.wheelDelta||-originalEvent.detail));view?view.mousewheel(evt,localPoint.x,localPoint.y,delta):this.trigger("blank:mousewheel",evt,localPoint.x,localPoint.y,delta)}},cellMouseover:function(evt){evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(view){if(this.guard(evt,view))return;view.mouseover(evt)}},cellMouseout:function(evt){evt=joint.util.normalizeEvent(evt);var view=this.findView(evt.target);if(view){if(this.guard(evt,view))return;view.mouseout(evt)}},setGridSize:function(gridSize){return this.options.gridSize=gridSize,this.options.drawGrid&&this.drawGrid(),this},clearGrid:function(){return this.el.style.backgroundImage="none",this},drawGrid:function(opt){opt=_.defaults(opt||{},this.options.drawGrid,{color:"#aaa",thickness:1});var gridSize=this.options.gridSize;if(gridSize<=1)return this.clearGrid();var currentScale=V(this.viewport).scale(),scaleX=currentScale.sx,scaleY=currentScale.sy,originX=this.options.origin.x,originY=this.options.origin.y,gridX=gridSize*scaleX,gridY=gridSize*scaleY,canvas=document.createElement("canvas");canvas.width=gridX,canvas.height=gridY,gridX=0<=originX?originX%gridX:gridX+originX%gridX,gridY=0<=originY?originY%gridY:gridY+originY%gridY;var context=canvas.getContext("2d");context.beginPath(),context.rect(gridX,gridY,opt.thickness*scaleX,opt.thickness*scaleY),context.fillStyle=opt.color,context.fill();var backgroundImage=canvas.toDataURL("image/png");return this.el.style.backgroundImage='url("'+backgroundImage+'")',this},setInteractivity:function(value){this.options.interactive=value,_.invoke(this._views,"setInteractivity",value)}}),joint.shapes.basic={},joint.shapes.basic.Generic=joint.dia.Element.extend({defaults:joint.util.deepSupplement({type:"basic.Generic",attrs:{".":{fill:"#ffffff",stroke:"none"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.basic.Rect=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Rect",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:100,height:60},text:{fill:"#000000",text:"","font-size":14,"ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.TextView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:attrs",this.resize)}}),joint.shapes.basic.Text=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><text/></g></g>',defaults:joint.util.deepSupplement({type:"basic.Text",attrs:{text:{"font-size":18,fill:"#000000"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Circle=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Circle",size:{width:60,height:60},attrs:{circle:{fill:"#ffffff",stroke:"#000000",r:30,cx:30,cy:30},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Ellipse=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><ellipse/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Ellipse",size:{width:60,height:40},attrs:{ellipse:{fill:"#ffffff",stroke:"#000000",rx:30,ry:20,cx:30,cy:20},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-y":.5,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Polygon=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Polygon",size:{width:60,height:40},attrs:{polygon:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Polyline=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><polyline/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Polyline",size:{width:60,height:40},attrs:{polyline:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Image=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><image/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Image",attrs:{text:{"font-size":14,text:"","text-anchor":"middle","ref-x":.5,"ref-dy":20,"y-alignment":"middle",fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Path=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path/></g><text/></g>',defaults:joint.util.deepSupplement({type:"basic.Path",size:{width:60,height:60},attrs:{path:{fill:"#ffffff",stroke:"#000000"},text:{"font-size":14,text:"","text-anchor":"middle",ref:"path","ref-x":.5,"ref-dy":10,fill:"#000000","font-family":"Arial, helvetica, sans-serif"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.basic.Rhombus=joint.shapes.basic.Path.extend({defaults:joint.util.deepSupplement({type:"basic.Rhombus",attrs:{path:{d:"M 30 0 L 60 30 30 60 0 30 z"},text:{"ref-y":.5,"y-alignment":"middle"}}},joint.shapes.basic.Path.prototype.defaults)}),joint.shapes.basic.PortsModelInterface={initialize:function(){this.updatePortsAttrs(),this.on("change:inPorts change:outPorts",this.updatePortsAttrs,this),this.constructor.__super__.constructor.__super__.initialize.apply(this,arguments)},updatePortsAttrs:function(eventName){if(this._portSelectors){var newAttrs=_.omit(this.get("attrs"),this._portSelectors);this.set("attrs",newAttrs,{silent:!0})}this._portSelectors=[];var attrs={};_.each(this.get("inPorts"),function(portName,index,ports){var portAttributes=this.getPortAttrs(portName,index,ports.length,".inPorts","in");this._portSelectors=this._portSelectors.concat(_.keys(portAttributes)),_.extend(attrs,portAttributes)},this),_.each(this.get("outPorts"),function(portName,index,ports){var portAttributes=this.getPortAttrs(portName,index,ports.length,".outPorts","out");this._portSelectors=this._portSelectors.concat(_.keys(portAttributes)),_.extend(attrs,portAttributes)},this),this.attr(attrs,{silent:!0}),this.processPorts(),this.trigger("process:ports")},getPortSelector:function(name){var selector=".inPorts",index=this.get("inPorts").indexOf(name);if(index<0&&(selector=".outPorts",(index=this.get("outPorts").indexOf(name))<0))throw new Error("getPortSelector(): Port doesn't exist.");return selector+">g:nth-child("+(index+1)+")>.port-body"}},joint.shapes.basic.PortsViewInterface={initialize:function(){this.listenTo(this.model,"process:ports",this.update),joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){this.renderPorts(),joint.dia.ElementView.prototype.update.apply(this,arguments)},renderPorts:function(){var $inPorts=this.$(".inPorts").empty(),$outPorts=this.$(".outPorts").empty(),portTemplate=joint.util.template(this.model.portMarkup);_.each(_.filter(this.model.ports,function(p){return"in"===p.type}),function(port,index){$inPorts.append(V(portTemplate({id:index,port:port})).node)}),_.each(_.filter(this.model.ports,function(p){return"out"===p.type}),function(port,index){$outPorts.append(V(portTemplate({id:index,port:port})).node)})}},joint.shapes.basic.TextBlock=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable"><rect/></g>',joint.env.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>',"</g>"].join(""),defaults:joint.util.deepSupplement({type:"basic.TextBlock",attrs:{rect:{fill:"#ffffff",stroke:"#000000",width:80,height:100},text:{fill:"#000000","font-size":14,"font-family":"Arial, helvetica, sans-serif"},".content":{text:"",ref:"rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle","x-alignment":"middle"}},content:""},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){this.listenTo(this,"change:size",this.updateSize),this.listenTo(this,"change:content",this.updateContent),this.updateSize(this,this.get("size")),this.updateContent(this,this.get("content")),joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},updateSize:function(cell,size){this.attr({".fobj":_.clone(size),div:{style:_.clone(size)}})},updateContent:function(cell,content){joint.env.test("svgforeignobject")?this.attr({".content":{html:content}}):this.attr({".content":{text:content}})},setForeignObjectSize:function(){this.updateSize.apply(this,arguments)},setDivContent:function(){this.updateContent.apply(this,arguments)}}),joint.shapes.basic.TextBlockView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.noSVGForeignObjectElement=!joint.env.test("svgforeignobject"),joint.env.test("svgforeignobject")||this.listenTo(this.model,"change:content",function(cell){this.updateContent(cell)})},update:function(cell,renderingOnlyAttrs){if(joint.env.test("svgforeignobject")){var model=this.model,noTextAttrs=_.omit(renderingOnlyAttrs||model.get("attrs"),".content");joint.dia.ElementView.prototype.update.call(this,model,noTextAttrs),renderingOnlyAttrs&&!_.has(renderingOnlyAttrs,".content")||this.updateContent(model,renderingOnlyAttrs)}else joint.dia.ElementView.prototype.update.call(this,model,renderingOnlyAttrs)},updateContent:function(cell,renderingOnlyAttrs){var textAttrs=_.merge({},(renderingOnlyAttrs||cell.get("attrs"))[".content"]);textAttrs=_.omit(textAttrs,"text");var text=joint.util.breakText(cell.get("content"),cell.get("size"),textAttrs,{svgDocument:this.paper.svg}),attrs=joint.util.setByPath({},".content",textAttrs,"/");attrs[".content"].text=text,joint.dia.ElementView.prototype.update.call(this,cell,attrs)}}),joint.routers.manhattan=function(g,_,joint){"use strict";var config={step:10,perpendicular:!0,excludeEnds:[],excludeTypes:["basic.Text"],maximumLoops:2e3,startDirections:["left","right","top","bottom"],endDirections:["left","right","top","bottom"],directionMap:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},maxAllowedDirectionChange:90,paddingBox:function(){var step=this.step;return{x:-step,y:-step,width:2*step,height:2*step}},directions:function(){var step=this.step;return[{offsetX:step,offsetY:0,cost:step},{offsetX:0,offsetY:step,cost:step},{offsetX:-step,offsetY:0,cost:step},{offsetX:0,offsetY:-step,cost:step}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},fallbackRoute:_.constant(null),draggingRoute:null};function ObstacleMap(opt){this.map={},this.options=opt,this.mapGridSize=100}function SortedSet(){this.items=[],this.hash={},this.values={},this.OPEN=1,this.CLOSE=2}function normalizePoint(point){return g.point(0===point.x?0:Math.abs(point.x)/point.x,0===point.y?0:Math.abs(point.y)/point.y)}function reconstructRoute(parents,point,startCenter,endCenter){for(var parent,route=[],prevDiff=normalizePoint(endCenter.difference(point)),current=point;parent=parents[current];){var diff=normalizePoint(current.difference(parent));diff.equals(prevDiff)||(route.unshift(current),prevDiff=diff),current=parent}return normalizePoint(g.point(current).difference(startCenter)).equals(prevDiff)||route.unshift(current),route}function getRectPoints(bbox,directionList,opt){var step=opt.step,center=bbox.center();return _.chain(opt.directionMap).pick(directionList).map(function(direction){var x=direction.x*bbox.width/2,y=direction.y*bbox.height/2,point=center.clone().offset(x,y);return bbox.containsPoint(point)&&point.offset(direction.x*step,direction.y*step),point.snapToGrid(step)}).value()}function getDirectionAngle(start,end,dirLen){var q=360/dirLen;return Math.floor(g.normalizeAngle(start.theta(end)+q/2)/q)*q}function getDirectionChange(angle1,angle2){var dirChange=Math.abs(angle1-angle2);return 180<dirChange?360-dirChange:dirChange}function estimateCost(from,endPoints){for(var min=1/0,i=0,len=endPoints.length;i<len;i++){var cost=from.manhattanDistance(endPoints[i]);cost<min&&(min=cost)}return min}function findRoute(start,end,map,opt){var startPoints,endPoints,startCenter,endCenter,step=opt.step;if(start instanceof g.rect?(startPoints=getRectPoints(start,opt.startDirections,opt),startCenter=start.center().snapToGrid(step)):startPoints=[startCenter=start.clone().snapToGrid(step)],end instanceof g.rect?(endPoints=getRectPoints(end,opt.endDirections,opt),endCenter=end.center().snapToGrid(step)):(endCenter=end.clone().snapToGrid(step),endPoints=[endCenter]),startPoints=_.filter(startPoints,map.isPointAccessible,map),endPoints=_.filter(endPoints,map.isPointAccessible,map),0<startPoints.length&&0<endPoints.length){var dir,dirChange,openSet=new SortedSet,parents={},costs={};_.each(startPoints,function(point){var key=point.toString();openSet.add(key,estimateCost(point,endPoints)),costs[key]=0});for(var dirs=opt.directions,dirLen=dirs.length,loopsRemain=opt.maximumLoops,endPointsKeys=_.invoke(endPoints,"toString");!openSet.isEmpty()&&0<loopsRemain;){var currentKey=openSet.pop(),currentPoint=g.point(currentKey),currentDist=costs[currentKey],previousDirAngle=currentDirAngle,currentDirAngle=parents[currentKey]?getDirectionAngle(parents[currentKey],currentPoint,dirLen):null!=opt.previousDirAngle?opt.previousDirAngle:getDirectionAngle(startCenter,currentPoint,dirLen);if(0<=endPointsKeys.indexOf(currentKey)&&(dirChange=getDirectionChange(currentDirAngle,getDirectionAngle(currentPoint,endCenter,dirLen)),currentPoint.equals(endCenter)||dirChange<180))return opt.previousDirAngle=currentDirAngle,reconstructRoute(parents,currentPoint,startCenter,endCenter);for(var i=0;i<dirLen;i++)if(dirChange=getDirectionChange(currentDirAngle,(dir=dirs[i]).angle),!(previousDirAngle&&dirChange>opt.maxAllowedDirectionChange)){var neighborPoint=currentPoint.clone().offset(dir.offsetX,dir.offsetY),neighborKey=neighborPoint.toString();if(!openSet.isClose(neighborKey)&&map.isPointAccessible(neighborPoint)){var costFromStart=currentDist+dir.cost+opt.penalties[dirChange];(!openSet.isOpen(neighborKey)||costFromStart<costs[neighborKey])&&(parents[neighborKey]=currentPoint,costs[neighborKey]=costFromStart,openSet.add(neighborKey,costFromStart+estimateCost(neighborPoint,endPoints)))}}loopsRemain--}}return opt.fallbackRoute(startCenter,endCenter,opt)}function router(vertices,opt){!function(opt){opt.directions=_.result(opt,"directions"),opt.penalties=_.result(opt,"penalties"),opt.paddingBox=_.result(opt,"paddingBox"),_.each(opt.directions,function(direction){var point1=g.point(0,0),point2=g.point(direction.offsetX,direction.offsetY);direction.angle=g.normalizeAngle(point1.theta(point2))})}(opt),this.options.perpendicular=!!opt.perpendicular;for(var sourceBBox=g.rect(this.sourceBBox).moveAndExpand(opt.paddingBox),targetBBox=g.rect(this.targetBBox).moveAndExpand(opt.paddingBox),map=new ObstacleMap(opt).build(this.paper.model,this.model),oldVertices=_.map(vertices,g.point),newVertices=[],tailPoint=sourceBBox.center().snapToGrid(opt.step),i=0,len=oldVertices.length;i<=len;i++){var partialRoute=null,from=to||sourceBBox,to=oldVertices[i];if(!to&&(to=targetBBox,(!this.model.get("source").id||!this.model.get("target").id)&&_.isFunction(opt.draggingRoute))){var dragFrom=from instanceof g.rect?from.center():from;partialRoute=opt.draggingRoute(dragFrom,to.origin(),opt)}if(null===(partialRoute=partialRoute||findRoute(from,to,map,opt))){if(!_.isFunction(joint.routers.orthogonal))throw new Error("Manhattan requires the orthogonal router.");return joint.routers.orthogonal(vertices,opt,this)}var leadPoint=_.first(partialRoute);leadPoint&&leadPoint.equals(tailPoint)&&partialRoute.shift(),tailPoint=_.last(partialRoute)||tailPoint,Array.prototype.push.apply(newVertices,partialRoute)}return newVertices}return ObstacleMap.prototype.build=function(graph,link){var opt=this.options,excludedEnds=_.chain(opt.excludeEnds).map(link.get,link).pluck("id").map(graph.getCell,graph).value(),excludedAncestors=[],source=graph.getCell(link.get("source").id);source&&(excludedAncestors=_.union(excludedAncestors,_.map(source.getAncestors(),"id")));var target=graph.getCell(link.get("target").id);target&&(excludedAncestors=_.union(excludedAncestors,_.map(target.getAncestors(),"id")));var mapGridSize=this.mapGridSize;return _.chain(graph.getElements()).difference(excludedEnds).reject(function(element){return _.contains(opt.excludeTypes,element.get("type"))||_.contains(excludedAncestors,element.id)}).invoke("getBBox").invoke("moveAndExpand",opt.paddingBox).foldl(function(map,bbox){for(var origin=bbox.origin().snapToGrid(mapGridSize),corner=bbox.corner().snapToGrid(mapGridSize),x=origin.x;x<=corner.x;x+=mapGridSize)for(var y=origin.y;y<=corner.y;y+=mapGridSize){var gridKey=x+"@"+y;map[gridKey]=map[gridKey]||[],map[gridKey].push(bbox)}return map},this.map).value(),this},ObstacleMap.prototype.isPointAccessible=function(point){var mapKey=point.clone().snapToGrid(this.mapGridSize).toString();return _.every(this.map[mapKey],function(obstacle){return!obstacle.containsPoint(point)})},SortedSet.prototype.add=function(item,value){this.hash[item]?this.items.splice(this.items.indexOf(item),1):this.hash[item]=this.OPEN,this.values[item]=value;var index=_.sortedIndex(this.items,item,function(i){return this.values[i]},this);this.items.splice(index,0,item)},SortedSet.prototype.remove=function(item){this.hash[item]=this.CLOSE},SortedSet.prototype.isOpen=function(item){return this.hash[item]===this.OPEN},SortedSet.prototype.isClose=function(item){return this.hash[item]===this.CLOSE},SortedSet.prototype.isEmpty=function(){return 0===this.items.length},SortedSet.prototype.pop=function(){var item=this.items.shift();return this.remove(item),item},function(vertices,opt,linkView){return router.call(linkView,vertices,_.extend({},config,opt))}}(g,_,joint),joint.routers.metro=function(){if(!_.isFunction(joint.routers.manhattan))throw new Error("Metro requires the manhattan router.");var config={diagonalCost:null,directions:function(){var step=this.step,diagonalCost=this.diagonalCost||Math.ceil(Math.sqrt(step*step<<1));return[{offsetX:step,offsetY:0,cost:step},{offsetX:step,offsetY:step,cost:diagonalCost},{offsetX:0,offsetY:step,cost:step},{offsetX:-step,offsetY:step,cost:diagonalCost},{offsetX:-step,offsetY:0,cost:step},{offsetX:-step,offsetY:-step,cost:diagonalCost},{offsetX:0,offsetY:-step,cost:step},{offsetX:step,offsetY:-step,cost:diagonalCost}]},maxAllowedDirectionChange:45,fallbackRoute:function(from,to,opts){var theta=from.theta(to),a={x:to.x,y:from.y},b={x:from.x,y:to.y};if(90<theta%180){var t=a;a=b,b=t}var p1=theta%90<45?a:b,l1=g.line(from,p1),alpha=90*Math.ceil(theta/90),p2=g.point.fromPolar(l1.squaredLength(),g.toRad(135+alpha),p1),l2=g.line(to,p2),point=l1.intersection(l2);return point?[point.round(),to]:[to]}};return function(vertices,opts,linkView){return joint.routers.manhattan(vertices,_.extend({},config,opts),linkView)}}(),joint.routers.normal=function(vertices,opt,linkView){return vertices},joint.routers.oneSide=function(vertices,opt,linkView){var coordinate,dimension,direction,side=opt.side||"bottom",padding=opt.padding||40,sourceBBox=linkView.sourceBBox,targetBBox=linkView.targetBBox,sourcePoint=sourceBBox.center(),targetPoint=targetBBox.center();switch(side){case"bottom":direction=1,coordinate="y",dimension="height";break;case"top":direction=-1,coordinate="y",dimension="height";break;case"left":direction=-1,coordinate="x",dimension="width";break;case"right":direction=1,coordinate="x",dimension="width";break;default:throw new Error("Router: invalid side")}return sourcePoint[coordinate]+=direction*(sourceBBox[dimension]/2+padding),targetPoint[coordinate]+=direction*(targetBBox[dimension]/2+padding),0<direction*(sourcePoint[coordinate]-targetPoint[coordinate])?targetPoint[coordinate]=sourcePoint[coordinate]:sourcePoint[coordinate]=targetPoint[coordinate],[sourcePoint].concat(vertices,targetPoint)},joint.routers.orthogonal=function(){var opposite={N:"S",S:"N",E:"W",W:"E"},radians={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function bearing(from,to){return from.x==to.x?from.y>to.y?"N":"S":from.y==to.y?from.x>to.x?"W":"E":null}function boxSize(bbox,brng){return bbox["W"==brng||"E"==brng?"width":"height"]}function expand(bbox,val){return g.rect(bbox).moveAndExpand({x:-val,y:-val,width:2*val,height:2*val})}function pointBox(p){return g.rect(p.x,p.y,0,0)}function freeJoin(p1,p2,bbox){var p=g.point(p1.x,p2.y);return bbox.containsPoint(p)&&(p=g.point(p2.x,p1.y)),p}function vertexVertex(from,to,brng){var p1=g.point(from.x,to.y),p2=g.point(to.x,from.y),d1=bearing(from,p1),d2=bearing(from,p2),xBrng=opposite[brng],p=d1==brng||d1!=xBrng&&(d2==xBrng||d2!=brng)?p1:p2;return{points:[p],direction:bearing(p,to)}}function elementVertex(from,to,fromBBox){var p=freeJoin(from,to,fromBBox);return{points:[p],direction:bearing(p,to)}}function vertexElement(from,to,toBBox,brng){var p,route={},pts=[g.point(from.x,to.y),g.point(to.x,from.y)],freePts=_.filter(pts,function(pt){return!toBBox.containsPoint(pt)}),freeBrngPts=_.filter(freePts,function(pt){return bearing(pt,from)!=brng});if(0<freeBrngPts.length)p=(p=_.filter(freeBrngPts,function(pt){return bearing(from,pt)==brng}).pop())||freeBrngPts[0],route.points=[p],route.direction=bearing(p,to);else{p=_.difference(pts,freePts)[0];var p2=g.point(to).move(p,-boxSize(toBBox,brng)/2),p1=freeJoin(p2,from,toBBox);route.points=[p1,p2],route.direction=bearing(p2,to)}return route}function elementElement(from,to,fromBBox,toBBox){var route=elementVertex(to,from,toBBox),p1=route.points[0];if(fromBBox.containsPoint(p1)){var p2=(route=elementVertex(from,to,fromBBox)).points[0];if(toBBox.containsPoint(p2)){var fromBorder=g.point(from).move(p2,-boxSize(fromBBox,bearing(from,p2))/2),toBorder=g.point(to).move(p1,-boxSize(toBBox,bearing(to,p1))/2),mid=g.line(fromBorder,toBorder).midpoint(),startRoute=elementVertex(from,mid,fromBBox),endRoute=vertexVertex(mid,to,startRoute.direction);route.points=[startRoute.points[0],endRoute.points[0]],route.direction=endRoute.direction}}return route}function insideElement(from,to,fromBBox,toBBox,brng){var p1,p2,p3,route={},bndry=expand(function(bbox1,bbox2){var x1=Math.min(bbox1.x,bbox2.x),y1=Math.min(bbox1.y,bbox2.y),x2=Math.max(bbox1.x+bbox1.width,bbox2.x+bbox2.width),y2=Math.max(bbox1.y+bbox1.height,bbox2.y+bbox2.height);return g.rect(x1,y1,x2-x1,y2-y1)}(fromBBox,toBBox),1),reversed=bndry.center().distance(to)>bndry.center().distance(from),start=reversed?to:from,end=reversed?from:to;return p2=freeJoin(p1=brng?(p1=g.point.fromPolar(bndry.width+bndry.height,radians[brng],start),bndry.pointNearestToPoint(p1).move(p1,-1)):bndry.pointNearestToPoint(start).move(start,1),end,bndry),p1.round().equals(p2.round())?(p2=g.point.fromPolar(bndry.width+bndry.height,g.toRad(p1.theta(start))+Math.PI/2,end),p3=freeJoin(p1,p2=bndry.pointNearestToPoint(p2).move(end,1).round(),bndry),route.points=reversed?[p2,p3,p1]:[p1,p3,p2]):route.points=reversed?[p2,p1]:[p1,p2],route.direction=bearing(reversed?p1:p2,to),route}return function(vertices,opt,linkView){var brng,padding=opt.elementPadding||20,orthogonalVertices=[],sourceBBox=expand(linkView.sourceBBox,padding),targetBBox=expand(linkView.targetBBox,padding);(vertices=_.map(vertices,g.point)).unshift(sourceBBox.center()),vertices.push(targetBBox.center());for(var i=0,max=vertices.length-1;i<max;i++){var route=null,from=vertices[i],to=vertices[i+1],isOrthogonal=!!bearing(from,to);if(0==i)i+1==max?sourceBBox.intersect(expand(targetBBox,1))?route=insideElement(from,to,sourceBBox,targetBBox):isOrthogonal||(route=elementElement(from,to,sourceBBox,targetBBox)):sourceBBox.containsPoint(to)?route=insideElement(from,to,sourceBBox,expand(pointBox(to),padding)):isOrthogonal||(route=elementVertex(from,to,sourceBBox));else if(i+1==max){var orthogonalLoop=isOrthogonal&&bearing(to,from)==brng;targetBBox.containsPoint(from)||orthogonalLoop?route=insideElement(from,to,expand(pointBox(from),padding),targetBBox,brng):isOrthogonal||(route=vertexElement(from,to,targetBBox,brng))}else isOrthogonal||(route=vertexVertex(from,to,brng));brng=route?(Array.prototype.push.apply(orthogonalVertices,route.points),route.direction):bearing(from,to),i+1<max&&orthogonalVertices.push(to)}return orthogonalVertices}}(),joint.connectors.normal=function(sourcePoint,targetPoint,vertices){var d=["M",sourcePoint.x,sourcePoint.y];return _.each(vertices,function(vertex){d.push(vertex.x,vertex.y)}),d.push(targetPoint.x,targetPoint.y),d.join(" ")},joint.connectors.rounded=function(sourcePoint,targetPoint,vertices,opts){var c1,c2,d1,d2,prev,next,offset=(opts=opts||{}).radius||10,d=["M",sourcePoint.x,sourcePoint.y];return _.each(vertices,function(vertex,index){prev=vertices[index-1]||sourcePoint,next=vertices[index+1]||targetPoint,d1=d2||g.point(vertex).distance(prev)/2,d2=g.point(vertex).distance(next)/2,c1=g.point(vertex).move(prev,-Math.min(offset,d1)).round(),c2=g.point(vertex).move(next,-Math.min(offset,d2)).round(),d.push(c1.x,c1.y,"S",vertex.x,vertex.y,c2.x,c2.y,"L")}),d.push(targetPoint.x,targetPoint.y),d.join(" ")},joint.connectors.smooth=function(sourcePoint,targetPoint,vertices){var d;if(vertices.length)d=g.bezier.curveThroughPoints([sourcePoint].concat(vertices).concat([targetPoint]));else{var controlPointX=(sourcePoint.x+targetPoint.x)/2;d=["M",sourcePoint.x,sourcePoint.y,"C",controlPointX,sourcePoint.y,controlPointX,targetPoint.y,targetPoint.x,targetPoint.y]}return d.join(" ")},joint.connectors.jumpover=function(_,g){var JUMP_TYPES=["arc","gap","cubic"],IGNORED_CONNECTORS=["smooth"];function createLines(sourcePoint,targetPoint,vertices){var points=[].concat(sourcePoint,vertices,targetPoint);return points.reduce(function(resultLines,point,idx){var nextPoint=points[idx+1];return null!=nextPoint&&(resultLines[idx]=g.line(point,nextPoint)),resultLines},[])}function updateJumpOver(){for(var updateList=this._jumpOverUpdateList,i=0;i<updateList.length;i++)updateList[i].update()}function sortPoints(p1,p2){return g.line(p1,p2).squaredLength()}function buildPath(lines,jumpSize,jumpType){var start=["M",lines[0].start.x,lines[0].start.y],paths=_(lines).map(function(line){if(line.isJump){var diff;if("arc"===jumpType){diff=line.start.difference(line.end);var xAxisRotate=Number(diff.x<0&&diff.y<0);return["A",jumpSize,jumpSize,0,0,xAxisRotate,line.end.x,line.end.y]}if("gap"===jumpType)return["M",line.end.x,line.end.y];if("cubic"===jumpType){diff=line.start.difference(line.end);var angle=line.start.theta(line.end),xOffset=.6*jumpSize,yOffset=1.35*jumpSize;diff.x<0&&diff.y<0&&(yOffset*=-1);var controlStartPoint=g.point(line.start.x+xOffset,line.start.y+yOffset).rotate(line.start,angle),controlEndPoint=g.point(line.end.x-xOffset,line.end.y+yOffset).rotate(line.end,angle);return["C",controlStartPoint.x,controlStartPoint.y,controlEndPoint.x,controlEndPoint.y,line.end.x,line.end.y]}}return["L",line.end.x,line.end.y]}).flatten().value();return[].concat(start,paths).join(" ")}return function(sourcePoint,targetPoint,vertices,opts){!function(jumpOverLinkView){var updateList=jumpOverLinkView.paper._jumpOverUpdateList;null==updateList&&(updateList=jumpOverLinkView.paper._jumpOverUpdateList=[],jumpOverLinkView.paper.on("cell:pointerup",updateJumpOver),jumpOverLinkView.paper.model.on("reset",function(){updateList=[]})),updateList.indexOf(jumpOverLinkView)<0&&(updateList.push(jumpOverLinkView),jumpOverLinkView.listenToOnce(jumpOverLinkView.model,"change:connector remove",function(){updateList.splice(updateList.indexOf(jumpOverLinkView),1)}))}(this);var jumpSize=opts.size||5,jumpType=opts.jump&&(""+opts.jump).toLowerCase(),ignoreConnectors=opts.ignoreConnectors||IGNORED_CONNECTORS;-1===JUMP_TYPES.indexOf(jumpType)&&(jumpType=JUMP_TYPES[0]);var paper=this.paper,allLinks=paper.model.getLinks();if(1===allLinks.length)return buildPath(createLines(sourcePoint,targetPoint,vertices),jumpSize,jumpType);var thisModel=this.model,thisIndex=allLinks.indexOf(thisModel),defaultConnector=paper.options.defaultConnector||{},links=allLinks.filter(function(link,idx){var connector=link.get("connector")||defaultConnector;return!(_.contains(ignoreConnectors,connector.name)||thisIndex<idx&&"jumpover"===connector.name)}),linkViews=links.map(function(link){return paper.findViewByModel(link)}),thisLines=createLines(sourcePoint,targetPoint,vertices),linkLines=linkViews.map(function(linkView){return null==linkView?[]:linkView===this?thisLines:createLines(linkView.sourcePoint,linkView.targetPoint,linkView.route)},this);return buildPath(thisLines.reduce(function(resultLines,thisLine){var intersections=_(links).map(function(link,i){return link===thisModel?null:function(line,crossCheckLines){return _(crossCheckLines).map(function(crossCheckLine){return line.intersection(crossCheckLine)}).compact().value()}(thisLine,linkLines[i])}).flatten().compact().sortBy(_.partial(sortPoints,thisLine.start)).value();return 0<intersections.length?resultLines.push.apply(resultLines,function(line,intersections,jumpSize){return intersections.reduce(function(resultLines,point,idx){if(!0===point.skip)return resultLines;var lastLine=resultLines.pop()||line,jumpStart=g.point(point).move(lastLine.start,-jumpSize),jumpEnd=g.point(point).move(lastLine.start,+jumpSize),nextPoint=intersections[idx+1];if(null!=nextPoint){var distance=jumpEnd.distance(nextPoint);distance<=jumpSize&&(jumpEnd=nextPoint.move(lastLine.start,distance),nextPoint.skip=!0)}else if(jumpStart.distance(lastLine.end)<2*jumpSize+1)return resultLines.push(lastLine),resultLines;if(jumpEnd.distance(lastLine.start)<2*jumpSize+1)return resultLines.push(lastLine),resultLines;var jumpLine=g.line(jumpStart,jumpEnd);return jumpLine.isJump=!0,resultLines.push(g.line(lastLine.start,jumpStart),jumpLine,g.line(jumpEnd,lastLine.end)),resultLines},[])}(thisLine,intersections,jumpSize)):resultLines.push(thisLine),resultLines},[]),jumpSize,jumpType)}}(_,g),joint.highlighters.addClass={className:"highlighted",highlight:function(cellView,magnetEl,opt){var className=opt.className||this.className;V(magnetEl).addClass(className)},unhighlight:function(cellView,magnetEl,opt){var className=opt.className||this.className;V(magnetEl).removeClass(className)}},joint.highlighters.opacity={highlight:function(cellView,magnetEl,opt){V(magnetEl).addClass("joint-highlight-opacity")},unhighlight:function(cellView,magnetEl,opt){V(magnetEl).removeClass("joint-highlight-opacity")}},joint.highlighters.stroke={defaultOptions:{padding:3,rx:0,ry:0},_views:{},highlight:function(cellView,magnetEl,opt){if(!this._views[magnetEl.id]){opt=_.defaults(opt||{},this.defaultOptions);var magnetVel=V(magnetEl),magnetBBox=magnetVel.bbox(!0);try{var pathData=magnetVel.convertToPathData()}catch(error){pathData=V.rectToPath(_.extend({},opt,magnetBBox))}var highlightVel=V("path").attr({d:pathData,class:"joint-highlight-stroke","pointer-events":"none"});highlightVel.transform(cellView.el.getCTM().inverse()),highlightVel.transform(magnetEl.getCTM());var padding=opt.padding;if(padding){var cx=magnetBBox.x+magnetBBox.width/2,cy=magnetBBox.y+magnetBBox.height/2,sx=(magnetBBox.width+padding)/magnetBBox.width,sy=(magnetBBox.height+padding)/magnetBBox.height;highlightVel.transform({a:sx,b:0,c:0,d:sy,e:cx-sx*cx,f:cy-sy*cy})}var highlightView=this._views[magnetEl.id]=new joint.mvc.View({el:highlightVel.node,$el:highlightVel});highlightView.listenTo(cellView.model,"remove",highlightView.remove),cellView.vel.append(highlightVel)}},unhighlight:function(cellView,magnetEl,opt){opt=_.defaults(opt||{},this.defaultOptions),this._views[magnetEl.id]&&(this._views[magnetEl.id].remove(),this._views[magnetEl.id]=null)}},joint.shapes.erd={},joint.shapes.erd.Entity=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Entity",size:{width:150,height:60},attrs:{".outer":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"100,0 100,60 0,60 0,0"},".inner":{fill:"#2ECC71",stroke:"#27AE60","stroke-width":2,points:"95,5 95,55 5,55 5,5",display:"none"},text:{text:"Entity","font-family":"Arial","font-size":14,ref:".outer","ref-x":.5,"ref-y":.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.erd.WeakEntity=joint.shapes.erd.Entity.extend({defaults:joint.util.deepSupplement({type:"erd.WeakEntity",attrs:{".inner":{display:"auto"},text:{text:"Weak Entity"}}},joint.shapes.erd.Entity.prototype.defaults)}),joint.shapes.erd.Relationship=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="outer"/><polygon class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Relationship",size:{width:80,height:80},attrs:{".outer":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,0 80,40 40,80 0,40"},".inner":{fill:"#3498DB",stroke:"#2980B9","stroke-width":2,points:"40,5 75,40 40,75 5,40",display:"none"},text:{text:"Relationship","font-family":"Arial","font-size":12,ref:".","ref-x":.5,"ref-y":.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.erd.IdentifyingRelationship=joint.shapes.erd.Relationship.extend({defaults:joint.util.deepSupplement({type:"erd.IdentifyingRelationship",attrs:{".inner":{display:"auto"},text:{text:"Identifying"}}},joint.shapes.erd.Relationship.prototype.defaults)}),joint.shapes.erd.Attribute=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><ellipse class="outer"/><ellipse class="inner"/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.Attribute",size:{width:100,height:50},attrs:{ellipse:{transform:"translate(50, 25)"},".outer":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:50,ry:25,fill:"#E67E22"},".inner":{stroke:"#D35400","stroke-width":2,cx:0,cy:0,rx:45,ry:20,fill:"#E67E22",display:"none"},text:{"font-family":"Arial","font-size":14,ref:".","ref-x":.5,"ref-y":.5,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.erd.Multivalued=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Multivalued",attrs:{".inner":{display:"block"},text:{text:"multivalued"}}},joint.shapes.erd.Attribute.prototype.defaults)}),joint.shapes.erd.Derived=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Derived",attrs:{".outer":{"stroke-dasharray":"3,5"},text:{text:"derived"}}},joint.shapes.erd.Attribute.prototype.defaults)}),joint.shapes.erd.Key=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Key",attrs:{ellipse:{"stroke-width":4},text:{text:"key","font-weight":"800","text-decoration":"underline"}}},joint.shapes.erd.Attribute.prototype.defaults)}),joint.shapes.erd.Normal=joint.shapes.erd.Attribute.extend({defaults:joint.util.deepSupplement({type:"erd.Normal",attrs:{text:{text:"Normal"}}},joint.shapes.erd.Attribute.prototype.defaults)}),joint.shapes.erd.ISA=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon/></g><text/></g>',defaults:joint.util.deepSupplement({type:"erd.ISA",size:{width:100,height:50},attrs:{polygon:{points:"0,0 50,50 100,0",fill:"#F1C40F",stroke:"#F39C12","stroke-width":2},text:{text:"ISA","font-size":18,ref:"polygon","ref-x":.5,"ref-y":.3,"x-alignment":"middle","y-alignment":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.erd.Line=joint.dia.Link.extend({defaults:{type:"erd.Line"},cardinality:function(value){this.set("labels",[{position:-20,attrs:{text:{dy:-8,text:value}}}])}}),joint.shapes.fsa={},joint.shapes.fsa.State=joint.shapes.basic.Circle.extend({defaults:joint.util.deepSupplement({type:"fsa.State",attrs:{circle:{"stroke-width":3},text:{"font-weight":"800"}}},joint.shapes.basic.Circle.prototype.defaults)}),joint.shapes.fsa.StartState=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle/></g></g>',defaults:joint.util.deepSupplement({type:"fsa.StartState",size:{width:20,height:20},attrs:{circle:{transform:"translate(10, 10)",r:10,fill:"#000000"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.fsa.EndState=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>',defaults:joint.util.deepSupplement({type:"fsa.EndState",size:{width:20,height:20},attrs:{".outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#000000"},".inner":{transform:"translate(10, 10)",r:6,fill:"#000000"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.fsa.Arrow=joint.dia.Link.extend({defaults:joint.util.deepSupplement({type:"fsa.Arrow",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}},smooth:!0},joint.dia.Link.prototype.defaults)}),joint.shapes.org={},joint.shapes.org.Member=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="card"/><image/></g><text class="rank"/><text class="name"/></g>',defaults:joint.util.deepSupplement({type:"org.Member",size:{width:180,height:70},attrs:{rect:{width:170,height:60},".card":{fill:"#FFFFFF",stroke:"#000000","stroke-width":2,"pointer-events":"visiblePainted",rx:10,ry:10},image:{width:48,height:48,ref:".card","ref-x":10,"ref-y":5},".rank":{"text-decoration":"underline",ref:".card","ref-x":.9,"ref-y":.2,"font-family":"Courier New","font-size":14,"text-anchor":"end"},".name":{"font-weight":"800",ref:".card","ref-x":.9,"ref-y":.6,"font-family":"Courier New","font-size":14,"text-anchor":"end"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.org.Arrow=joint.dia.Link.extend({defaults:{type:"org.Arrow",source:{selector:".card"},target:{selector:".card"},attrs:{".connection":{stroke:"#585858","stroke-width":3}},z:-1}}),joint.shapes.chess={},joint.shapes.chess.KingWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;"><path      d="M 22.5,11.63 L 22.5,6"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 20,8 L 25,8"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path      d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"      style="fill:#ffffff; stroke:#000000; stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 11.5,30 C 17,27 27,27 32.5,30"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5"      style="fill:none; stroke:#000000;" />    <path      d="M 11.5,37 C 17,34 27,34 32.5,37"      style="fill:none; stroke:#000000;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KingWhite",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.KingBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path       d="M 22.5,11.63 L 22.5,6"       style="fill:none; stroke:#000000; stroke-linejoin:miter;"       id="path6570" />    <path       d="M 22.5,25 C 22.5,25 27,17.5 25.5,14.5 C 25.5,14.5 24.5,12 22.5,12 C 20.5,12 19.5,14.5 19.5,14.5 C 18,17.5 22.5,25 22.5,25"       style="fill:#000000;fill-opacity:1; stroke-linecap:butt; stroke-linejoin:miter;" />    <path       d="M 11.5,37 C 17,40.5 27,40.5 32.5,37 L 32.5,30 C 32.5,30 41.5,25.5 38.5,19.5 C 34.5,13 25,16 22.5,23.5 L 22.5,27 L 22.5,23.5 C 19,16 9.5,13 6.5,19.5 C 3.5,25.5 11.5,29.5 11.5,29.5 L 11.5,37 z "       style="fill:#000000; stroke:#000000;" />    <path       d="M 20,8 L 25,8"       style="fill:none; stroke:#000000; stroke-linejoin:miter;" />    <path       d="M 32,29.5 C 32,29.5 40.5,25.5 38.03,19.85 C 34.15,14 25,18 22.5,24.5 L 22.51,26.6 L 22.5,24.5 C 20,18 9.906,14 6.997,19.85 C 4.5,25.5 11.85,28.85 11.85,28.85"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,30 C 17,27 27,27 32.5,30 M 11.5,33.5 C 17,30.5 27,30.5 32.5,33.5 M 11.5,37 C 17,34 27,34 32.5,37"       style="fill:none; stroke:#ffffff;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KingBlack",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.QueenWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(-1,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(15.5,-5.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(32,-1)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(7,-4.5)" />    <path      d="M 9 13 A 2 2 0 1 1  5,13 A 2 2 0 1 1  9 13 z"      transform="translate(24,-4)" />    <path      d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38,14 L 31,25 L 31,11 L 25.5,24.5 L 22.5,9.5 L 19.5,24.5 L 14,10.5 L 14,25 L 7,14 L 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z "      style="stroke-linecap:butt;" />    <path      d="M 11.5,30 C 15,29 30,29 33.5,30"      style="fill:none;" />    <path      d="M 12,33.5 C 18,32.5 27,32.5 33,33.5"      style="fill:none;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.QueenWhite",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.QueenBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:none;">      <circle cx="6"    cy="12" r="2.75" />      <circle cx="14"   cy="9"  r="2.75" />      <circle cx="22.5" cy="8"  r="2.75" />      <circle cx="31"   cy="9"  r="2.75" />      <circle cx="39"   cy="12" r="2.75" />    </g>    <path       d="M 9,26 C 17.5,24.5 30,24.5 36,26 L 38.5,13.5 L 31,25 L 30.7,10.9 L 25.5,24.5 L 22.5,10 L 19.5,24.5 L 14.3,10.9 L 14,25 L 6.5,13.5 L 9,26 z"       style="stroke-linecap:butt; stroke:#000000;" />    <path       d="M 9,26 C 9,28 10.5,28 11.5,30 C 12.5,31.5 12.5,31 12,33.5 C 10.5,34.5 10.5,36 10.5,36 C 9,37.5 11,38.5 11,38.5 C 17.5,39.5 27.5,39.5 34,38.5 C 34,38.5 35.5,37.5 34,36 C 34,36 34.5,34.5 33,33.5 C 32.5,31 32.5,31.5 33.5,30 C 34.5,28 36,28 36,26 C 27.5,24.5 17.5,24.5 9,26 z"       style="stroke-linecap:butt;" />    <path       d="M 11,38.5 A 35,35 1 0 0 34,38.5"       style="fill:none; stroke:#000000; stroke-linecap:butt;" />    <path       d="M 11,29 A 35,35 1 0 1 34,29"       style="fill:none; stroke:#ffffff;" />    <path       d="M 12.5,31.5 L 32.5,31.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 11.5,34.5 A 35,35 1 0 0 33.5,34.5"       style="fill:none; stroke:#ffffff;" />    <path       d="M 10.5,37.5 A 35,35 1 0 0 34.5,37.5"       style="fill:none; stroke:#ffffff;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.QueenBlack",size:{width:42,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.RookWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14"      style="stroke-linecap:butt;" />    <path      d="M 34,14 L 31,17 L 14,17 L 11,14" />    <path      d="M 31,17 L 31,29.5 L 14,29.5 L 14,17"      style="stroke-linecap:butt; stroke-linejoin:miter;" />    <path      d="M 31,29.5 L 32.5,32 L 12.5,32 L 14,29.5" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.RookWhite",size:{width:32,height:34}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.RookBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 9,39 L 36,39 L 36,36 L 9,36 L 9,39 z "      style="stroke-linecap:butt;" />    <path      d="M 12.5,32 L 14,29.5 L 31,29.5 L 32.5,32 L 12.5,32 z "      style="stroke-linecap:butt;" />    <path      d="M 12,36 L 12,32 L 33,32 L 33,36 L 12,36 z "      style="stroke-linecap:butt;" />    <path      d="M 14,29.5 L 14,16.5 L 31,16.5 L 31,29.5 L 14,29.5 z "      style="stroke-linecap:butt;stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 11,14 L 34,14 L 31,16.5 L 14,16.5 z "      style="stroke-linecap:butt;" />    <path      d="M 11,14 L 11,9 L 15,9 L 15,11 L 20,11 L 20,9 L 25,9 L 25,11 L 30,11 L 30,9 L 34,9 L 34,14 L 11,14 z "      style="stroke-linecap:butt;" />    <path      d="M 12,35.5 L 33,35.5 L 33,35.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 13,31.5 L 32,31.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,29.5 L 31,29.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 14,16.5 L 31,16.5"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />    <path      d="M 11,14 L 34,14"      style="fill:none; stroke:#ffffff; stroke-width:1; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.RookBlack",size:{width:32,height:34}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.BishopWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#ffffff; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path      d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"      style="fill:none; stroke:#000000; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.BishopWhite",size:{width:38,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.BishopBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-rule:evenodd; fill-opacity:1; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:round; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <g style="fill:#000000; stroke:#000000; stroke-linecap:butt;">       <path        d="M 9,36 C 12.39,35.03 19.11,36.43 22.5,34 C 25.89,36.43 32.61,35.03 36,36 C 36,36 37.65,36.54 39,38 C 38.32,38.97 37.35,38.99 36,38.5 C 32.61,37.53 25.89,38.96 22.5,37.5 C 19.11,38.96 12.39,37.53 9,38.5 C 7.646,38.99 6.677,38.97 6,38 C 7.354,36.06 9,36 9,36 z" />      <path        d="M 15,32 C 17.5,34.5 27.5,34.5 30,32 C 30.5,30.5 30,30 30,30 C 30,27.5 27.5,26 27.5,26 C 33,24.5 33.5,14.5 22.5,10.5 C 11.5,14.5 12,24.5 17.5,26 C 17.5,26 15,27.5 15,30 C 15,30 14.5,30.5 15,32 z" />      <path        d="M 25 8 A 2.5 2.5 0 1 1  20,8 A 2.5 2.5 0 1 1  25 8 z" />    </g>    <path       d="M 17.5,26 L 27.5,26 M 15,30 L 30,30 M 22.5,15.5 L 22.5,20.5 M 20,18 L 25,18"       style="fill:none; stroke:#ffffff; stroke-linejoin:miter;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.BishopBlack",size:{width:38,height:38}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.KnightWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#ffffff; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#000000; stroke:#000000;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#000000; stroke:#000000;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KnightWhite",size:{width:38,height:37}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.KnightBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><g style="opacity:1; fill:none; fill-opacity:1; fill-rule:evenodd; stroke:#000000; stroke-width:1.5; stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;">    <path      d="M 22,10 C 32.5,11 38.5,18 38,39 L 15,39 C 15,30 25,32.5 23,18"      style="fill:#000000; stroke:#000000;" />    <path      d="M 24,18 C 24.38,20.91 18.45,25.37 16,27 C 13,29 13.18,31.34 11,31 C 9.958,30.06 12.41,27.96 11,28 C 10,28 11.19,29.23 10,30 C 9,30 5.997,31 6,26 C 6,24 12,14 12,14 C 12,14 13.89,12.1 14,10.5 C 13.27,9.506 13.5,8.5 13.5,7.5 C 14.5,6.5 16.5,10 16.5,10 L 18.5,10 C 18.5,10 19.28,8.008 21,7 C 22,7 22,10 22,10"      style="fill:#000000; stroke:#000000;" />    <path      d="M 9.5 25.5 A 0.5 0.5 0 1 1 8.5,25.5 A 0.5 0.5 0 1 1 9.5 25.5 z"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 15 15.5 A 0.5 1.5 0 1 1  14,15.5 A 0.5 1.5 0 1 1  15 15.5 z"      transform="matrix(0.866,0.5,-0.5,0.866,9.693,-5.173)"      style="fill:#ffffff; stroke:#ffffff;" />    <path      d="M 24.55,10.4 L 24.1,11.85 L 24.6,12 C 27.75,13 30.25,14.49 32.5,18.75 C 34.75,23.01 35.75,29.06 35.25,39 L 35.2,39.5 L 37.45,39.5 L 37.5,39 C 38,28.94 36.62,22.15 34.25,17.66 C 31.88,13.17 28.46,11.02 25.06,10.5 L 24.55,10.4 z "      style="fill:#ffffff; stroke:none;" />  </g></g></g>',defaults:joint.util.deepSupplement({type:"chess.KnightBlack",size:{width:38,height:37}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.PawnWhite=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#ffffff; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>',defaults:joint.util.deepSupplement({type:"chess.PawnWhite",size:{width:28,height:33}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chess.PawnBlack=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><path d="M 22,9 C 19.79,9 18,10.79 18,13 C 18,13.89 18.29,14.71 18.78,15.38 C 16.83,16.5 15.5,18.59 15.5,21 C 15.5,23.03 16.44,24.84 17.91,26.03 C 14.91,27.09 10.5,31.58 10.5,39.5 L 33.5,39.5 C 33.5,31.58 29.09,27.09 26.09,26.03 C 27.56,24.84 28.5,23.03 28.5,21 C 28.5,18.59 27.17,16.5 25.22,15.38 C 25.71,14.71 26,13.89 26,13 C 26,10.79 24.21,9 22,9 z "  style="opacity:1; fill:#000000; fill-opacity:1; fill-rule:nonzero; stroke:#000000; stroke-width:1.5; stroke-linecap:round; stroke-linejoin:miter; stroke-miterlimit:4; stroke-dasharray:none; stroke-opacity:1;" /></g></g>',defaults:joint.util.deepSupplement({type:"chess.PawnBlack",size:{width:28,height:33}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.pn={},joint.shapes.pn.Place=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="root"/><g class="tokens" /></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"pn.Place",size:{width:50,height:50},attrs:{".root":{r:25,fill:"#ffffff",stroke:"#000000",transform:"translate(25, 25)"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:".root",fill:"#000000","font-size":12},".tokens > circle":{fill:"#000000",r:5},".tokens.one > circle":{transform:"translate(25, 25)"},".tokens.two > circle:nth-child(1)":{transform:"translate(19, 25)"},".tokens.two > circle:nth-child(2)":{transform:"translate(31, 25)"},".tokens.three > circle:nth-child(1)":{transform:"translate(18, 29)"},".tokens.three > circle:nth-child(2)":{transform:"translate(25, 19)"},".tokens.three > circle:nth-child(3)":{transform:"translate(32, 29)"},".tokens.alot > text":{transform:"translate(25, 18)","text-anchor":"middle",fill:"#000000"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.pn.PlaceView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.model.on("change:tokens",function(){this.renderTokens(),this.update()},this)},render:function(){joint.dia.ElementView.prototype.render.apply(this,arguments),this.renderTokens(),this.update()},renderTokens:function(){var $tokens=this.$(".tokens").empty();$tokens[0].className.baseVal="tokens";var tokens=this.model.get("tokens");if(tokens)switch(tokens){case 1:$tokens[0].className.baseVal+=" one",$tokens.append(V("<circle/>").node);break;case 2:$tokens[0].className.baseVal+=" two",$tokens.append(V("<circle/>").node,V("<circle/>").node);break;case 3:$tokens[0].className.baseVal+=" three",$tokens.append(V("<circle/>").node,V("<circle/>").node,V("<circle/>").node);break;default:$tokens[0].className.baseVal+=" alot",$tokens.append(V("<text/>").text(tokens+"").node)}}}),joint.shapes.pn.Transition=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="root"/></g></g><text class="label"/>',defaults:joint.util.deepSupplement({type:"pn.Transition",size:{width:12,height:50},attrs:{rect:{width:12,height:50,fill:"#000000",stroke:"#000000"},".label":{"text-anchor":"middle","ref-x":.5,"ref-y":-20,ref:"rect",fill:"#000000","font-size":12}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.pn.Link=joint.dia.Link.extend({defaults:joint.util.deepSupplement({type:"pn.Link",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z"}}},joint.dia.Link.prototype.defaults)}),joint.shapes.devs={},joint.shapes.devs.Model=joint.shapes.basic.Generic.extend(_.extend({},joint.shapes.basic.PortsModelInterface,{markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><text class="label"/><g class="inPorts"/><g class="outPorts"/></g>',portMarkup:'<g class="port port<%= id %>"><circle class="port-body"/><text class="port-label"/></g>',defaults:joint.util.deepSupplement({type:"devs.Model",size:{width:1,height:1},inPorts:[],outPorts:[],attrs:{".":{magnet:!1},".body":{width:150,height:250,stroke:"#000000"},".port-body":{r:10,magnet:!0,stroke:"#000000"},text:{"pointer-events":"none"},".label":{text:"Model","ref-x":.5,"ref-y":10,ref:".body","text-anchor":"middle",fill:"#000000"},".inPorts .port-label":{x:-15,dy:4,"text-anchor":"end",fill:"#000000"},".outPorts .port-label":{x:15,dy:4,fill:"#000000"}}},joint.shapes.basic.Generic.prototype.defaults),getPortAttrs:function(portName,index,total,selector,type){var attrs={},portSelector=selector+">.port"+index,portBodySelector=portSelector+">.port-body";return attrs[portSelector+">.port-label"]={text:portName},attrs[portBodySelector]={port:{id:portName||_.uniqueId(type),type:type}},attrs[portSelector]={ref:".body","ref-y":(index+.5)*(1/total)},".outPorts"===selector&&(attrs[portSelector]["ref-dx"]=0),attrs}})),joint.shapes.devs.Atomic=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"devs.Atomic",size:{width:80,height:80},attrs:{".body":{fill:"salmon"},".label":{text:"Atomic"},".inPorts .port-body":{fill:"PaleGreen"},".outPorts .port-body":{fill:"Tomato"}}},joint.shapes.devs.Model.prototype.defaults)}),joint.shapes.devs.Coupled=joint.shapes.devs.Model.extend({defaults:joint.util.deepSupplement({type:"devs.Coupled",size:{width:200,height:300},attrs:{".body":{fill:"seaGreen"},".label":{text:"Coupled"},".inPorts .port-body":{fill:"PaleGreen"},".outPorts .port-body":{fill:"Tomato"}}},joint.shapes.devs.Model.prototype.defaults)}),joint.shapes.devs.Link=joint.dia.Link.extend({defaults:{type:"devs.Link",attrs:{".connection":{"stroke-width":2}}}}),joint.shapes.devs.ModelView=joint.dia.ElementView.extend(joint.shapes.basic.PortsViewInterface),joint.shapes.devs.AtomicView=joint.shapes.devs.ModelView,joint.shapes.devs.CoupledView=joint.shapes.devs.ModelView,joint.shapes.uml={},joint.shapes.uml.Class=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-class-name-rect"/><rect class="uml-class-attrs-rect"/><rect class="uml-class-methods-rect"/>',"</g>",'<text class="uml-class-name-text"/><text class="uml-class-attrs-text"/><text class="uml-class-methods-text"/>',"</g>"].join(""),defaults:joint.util.deepSupplement({type:"uml.Class",attrs:{rect:{width:200},".uml-class-name-rect":{stroke:"black","stroke-width":2,fill:"#3498db"},".uml-class-attrs-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-methods-rect":{stroke:"black","stroke-width":2,fill:"#2980b9"},".uml-class-name-text":{ref:".uml-class-name-rect","ref-y":.5,"ref-x":.5,"text-anchor":"middle","y-alignment":"middle","font-weight":"bold",fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-attrs-text":{ref:".uml-class-attrs-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"},".uml-class-methods-text":{ref:".uml-class-methods-rect","ref-y":5,"ref-x":5,fill:"black","font-size":12,"font-family":"Times New Roman"}},name:[],attributes:[],methods:[]},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){this.on("change:name change:attributes change:methods",function(){this.updateRectangles(),this.trigger("uml-update")},this),this.updateRectangles(),joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},getClassName:function(){return this.get("name")},updateRectangles:function(){var attrs=this.get("attrs"),rects=[{type:"name",text:this.getClassName()},{type:"attrs",text:this.get("attributes")},{type:"methods",text:this.get("methods")}],offsetY=0;_.each(rects,function(rect){var lines=_.isArray(rect.text)?rect.text:[rect.text],rectHeight=20*lines.length+20;attrs[".uml-class-"+rect.type+"-text"].text=lines.join("\n"),attrs[".uml-class-"+rect.type+"-rect"].height=rectHeight,attrs[".uml-class-"+rect.type+"-rect"].transform="translate(0,"+offsetY+")",offsetY+=rectHeight})}}),joint.shapes.uml.ClassView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"uml-update",function(){this.update(),this.resize()})}}),joint.shapes.uml.Abstract=joint.shapes.uml.Class.extend({defaults:joint.util.deepSupplement({type:"uml.Abstract",attrs:{".uml-class-name-rect":{fill:"#e74c3c"},".uml-class-attrs-rect":{fill:"#c0392b"},".uml-class-methods-rect":{fill:"#c0392b"}}},joint.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Abstract>>",this.get("name")]}}),joint.shapes.uml.AbstractView=joint.shapes.uml.ClassView,joint.shapes.uml.Interface=joint.shapes.uml.Class.extend({defaults:joint.util.deepSupplement({type:"uml.Interface",attrs:{".uml-class-name-rect":{fill:"#f1c40f"},".uml-class-attrs-rect":{fill:"#f39c12"},".uml-class-methods-rect":{fill:"#f39c12"}}},joint.shapes.uml.Class.prototype.defaults),getClassName:function(){return["<<Interface>>",this.get("name")]}}),joint.shapes.uml.InterfaceView=joint.shapes.uml.ClassView,joint.shapes.uml.Generalization=joint.dia.Link.extend({defaults:{type:"uml.Generalization",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"}}}}),joint.shapes.uml.Implementation=joint.dia.Link.extend({defaults:{type:"uml.Implementation",attrs:{".marker-target":{d:"M 20 0 L 0 10 L 20 20 z",fill:"white"},".connection":{"stroke-dasharray":"3,3"}}}}),joint.shapes.uml.Aggregation=joint.dia.Link.extend({defaults:{type:"uml.Aggregation",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"white"}}}}),joint.shapes.uml.Composition=joint.dia.Link.extend({defaults:{type:"uml.Composition",attrs:{".marker-target":{d:"M 40 10 L 20 20 L 0 10 L 20 0 z",fill:"black"}}}}),joint.shapes.uml.Association=joint.dia.Link.extend({defaults:{type:"uml.Association"}}),joint.shapes.uml.State=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<rect class="uml-state-body"/>',"</g>",'<path class="uml-state-separator"/>','<text class="uml-state-name"/>','<text class="uml-state-events"/>',"</g>"].join(""),defaults:joint.util.deepSupplement({type:"uml.State",attrs:{".uml-state-body":{width:200,height:200,rx:10,ry:10,fill:"#ecf0f1",stroke:"#bdc3c7","stroke-width":3},".uml-state-separator":{stroke:"#bdc3c7","stroke-width":2},".uml-state-name":{ref:".uml-state-body","ref-x":.5,"ref-y":5,"text-anchor":"middle",fill:"#000000","font-family":"Courier New","font-size":14},".uml-state-events":{ref:".uml-state-separator","ref-x":5,"ref-y":5,fill:"#000000","font-family":"Courier New","font-size":14}},name:"State",events:[]},joint.shapes.basic.Generic.prototype.defaults),initialize:function(){this.on({"change:name":this.updateName,"change:events":this.updateEvents,"change:size":this.updatePath},this),this.updateName(),this.updateEvents(),this.updatePath(),joint.shapes.basic.Generic.prototype.initialize.apply(this,arguments)},updateName:function(){this.attr(".uml-state-name/text",this.get("name"))},updateEvents:function(){this.attr(".uml-state-events/text",this.get("events").join("\n"))},updatePath:function(){var d="M 0 20 L "+this.get("size").width+" 20";this.attr(".uml-state-separator/d",d,{silent:!0})}}),joint.shapes.uml.StartState=joint.shapes.basic.Circle.extend({defaults:joint.util.deepSupplement({type:"uml.StartState",attrs:{circle:{fill:"#34495e",stroke:"#2c3e50","stroke-width":2,rx:1}}},joint.shapes.basic.Circle.prototype.defaults)}),joint.shapes.uml.EndState=joint.shapes.basic.Generic.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="outer"/><circle class="inner"/></g></g>',defaults:joint.util.deepSupplement({type:"uml.EndState",size:{width:20,height:20},attrs:{"circle.outer":{transform:"translate(10, 10)",r:10,fill:"#ffffff",stroke:"#2c3e50"},"circle.inner":{transform:"translate(10, 10)",r:6,fill:"#34495e"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.uml.Transition=joint.dia.Link.extend({defaults:{type:"uml.Transition",attrs:{".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#34495e",stroke:"#2c3e50"},".connection":{stroke:"#2c3e50"}}}}),joint.shapes.logic={},joint.shapes.logic.Gate=joint.shapes.basic.Generic.extend({defaults:joint.util.deepSupplement({type:"logic.Gate",size:{width:80,height:40},attrs:{".":{magnet:!1},".body":{width:100,height:50},circle:{r:7,stroke:"black",fill:"transparent","stroke-width":2}}},joint.shapes.basic.Generic.prototype.defaults),operation:function(){return!0}}),joint.shapes.logic.IO=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><path class="wire"/><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"logic.IO",size:{width:60,height:30},attrs:{".body":{fill:"white",stroke:"black","stroke-width":2},".wire":{ref:".body","ref-y":.5,stroke:"black"},text:{fill:"black",ref:".body","ref-x":.5,"ref-y":.5,"y-alignment":"middle","text-anchor":"middle","font-weight":"bold","font-variant":"small-caps","text-transform":"capitalize","font-size":"14px"}}},joint.shapes.logic.Gate.prototype.defaults)}),joint.shapes.logic.Input=joint.shapes.logic.IO.extend({defaults:joint.util.deepSupplement({type:"logic.Input",attrs:{".wire":{"ref-dx":0,d:"M 0 0 L 23 0"},circle:{ref:".body","ref-dx":30,"ref-y":.5,magnet:!0,class:"output",port:"out"},text:{text:"input"}}},joint.shapes.logic.IO.prototype.defaults)}),joint.shapes.logic.Output=joint.shapes.logic.IO.extend({defaults:joint.util.deepSupplement({type:"logic.Output",attrs:{".wire":{"ref-x":0,d:"M 0 0 L -23 0"},circle:{ref:".body","ref-x":-30,"ref-y":.5,magnet:"passive",class:"input",port:"in"},text:{text:"output"}}},joint.shapes.logic.IO.prototype.defaults)}),joint.shapes.logic.Gate11=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input"/><circle class="output"/></g>',defaults:joint.util.deepSupplement({type:"logic.Gate11",attrs:{".input":{ref:".body","ref-x":-2,"ref-y":.5,magnet:"passive",port:"in"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},joint.shapes.logic.Gate.prototype.defaults)}),joint.shapes.logic.Gate21=joint.shapes.logic.Gate.extend({markup:'<g class="rotatable"><g class="scalable"><image class="body"/></g><circle class="input input1"/><circle  class="input input2"/><circle class="output"/></g>',defaults:joint.util.deepSupplement({type:"logic.Gate21",attrs:{".input1":{ref:".body","ref-x":-2,"ref-y":.3,magnet:"passive",port:"in1"},".input2":{ref:".body","ref-x":-2,"ref-y":.7,magnet:"passive",port:"in2"},".output":{ref:".body","ref-dx":2,"ref-y":.5,magnet:!0,port:"out"}}},joint.shapes.logic.Gate.prototype.defaults)}),joint.shapes.logic.Repeater=joint.shapes.logic.Gate11.extend({defaults:joint.util.deepSupplement({type:"logic.Repeater",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzIuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICA8L2c+Cjwvc3ZnPgo="}}},joint.shapes.logic.Gate11.prototype.defaults),operation:function(input){return input}}),joint.shapes.logic.Not=joint.shapes.logic.Gate11.extend({defaults:joint.util.deepSupplement({type:"logic.Not",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PVCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjgiCiAgICAgaW5rc2NhcGU6Y3g9Ijg0LjY4NTM1MiIKICAgICBpbmtzY2FwZTpjeT0iMTUuMjg4NjI4IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzkuMTU2OTEsMjUgTCA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAyOS4wNDM0NzgsMjUgTCA1LjA0MzQ3ODEsMjUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgZD0iTSAyOC45Njg3NSwyLjU5Mzc1IEwgMjguOTY4NzUsNSBMIDI4Ljk2ODc1LDQ1IEwgMjguOTY4NzUsNDcuNDA2MjUgTCAzMS4xMjUsNDYuMzQzNzUgTCA3Mi4xNTYyNSwyNi4zNDM3NSBMIDcyLjE1NjI1LDIzLjY1NjI1IEwgMzEuMTI1LDMuNjU2MjUgTCAyOC45Njg3NSwyLjU5Mzc1IHogTSAzMS45Njg3NSw3LjQwNjI1IEwgNjguMDkzNzUsMjUgTCAzMS45Njg3NSw0Mi41OTM3NSBMIDMxLjk2ODc1LDcuNDA2MjUgeiIKICAgICAgIGlkPSJwYXRoMjYzOCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2NjY2NjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDI2NzEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzYiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA4MCwyNSBBIDQsNCAwIDEgMSA3MiwyNSBBIDQsNCAwIDEgMSA4MCwyNSB6IgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEsMCkiIC8+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate11.prototype.defaults),operation:function(input){return!input}}),joint.shapes.logic.Or=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Or",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik9SIEFOU0kuc3ZnIgogICBpbmtzY2FwZTpvdXRwdXRfZXh0ZW5zaW9uPSJvcmcuaW5rc2NhcGUub3V0cHV0LnN2Zy5pbmtzY2FwZSI+CiAgPGRlZnMKICAgICBpZD0iZGVmczQiPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTAgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjcxNCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iMSA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMC41IDogMC4zMzMzMzMzMyA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODA2IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyODE5IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjM3Mi4wNDcyNCA6IDM1MC43ODczOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI3NDQuMDk0NDggOiA1MjYuMTgxMDkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzc3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49Ijc1IDogNDAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTUwIDogNjAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDYwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTMyNzUiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNTAgOiAzMy4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iMTAwIDogNTAgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDUwIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTU1MzMiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzIgOiAyMS4zMzMzMzMgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNjQgOiAzMiA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMzIgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjU1NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDE2LjY2NjY2NyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDI1IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAyNSA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iNCIKICAgICBpbmtzY2FwZTpjeD0iMTEzLjAwMDM5IgogICAgIGlua3NjYXBlOmN5PSIxMi44OTM3MzEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9ImcyNTYwIgogICAgIHNob3dncmlkPSJmYWxzZSIKICAgICBpbmtzY2FwZTpncmlkLWJib3g9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1wb2ludHM9InRydWUiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAwMDAiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMzk5IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijg3NCIKICAgICBpbmtzY2FwZTp3aW5kb3cteD0iMzciCiAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii00IgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Im0gNzAsMjUgYyAyMCwwIDI1LDAgMjUsMCIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMSwxNSA1LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzIsMzUgNSwzNSIKICAgICAgIGlkPSJwYXRoMzk0NCIgLz4KICAgIDxnCiAgICAgICBpZD0iZzI1NjAiCiAgICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDI2LjUsLTM5LjUpIj4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return input1||input2}}),joint.shapes.logic.And=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.And",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IkFORCBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI4IgogICAgIGlua3NjYXBlOmN4PSI1Ni42OTgzNDgiCiAgICAgaW5rc2NhcGU6Y3k9IjI1LjMyNjg5OSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZvbnQtc2l6ZTptZWRpdW07Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpub3JtYWw7Zm9udC1zdHJldGNoOm5vcm1hbDt0ZXh0LWluZGVudDowO3RleHQtYWxpZ246c3RhcnQ7dGV4dC1kZWNvcmF0aW9uOm5vbmU7bGluZS1oZWlnaHQ6bm9ybWFsO2xldHRlci1zcGFjaW5nOm5vcm1hbDt3b3JkLXNwYWNpbmc6bm9ybWFsO3RleHQtdHJhbnNmb3JtOm5vbmU7ZGlyZWN0aW9uOmx0cjtibG9jay1wcm9ncmVzc2lvbjp0Yjt3cml0aW5nLW1vZGU6bHItdGI7dGV4dC1hbmNob3I6c3RhcnQ7ZmlsbDojMDAwMDAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDozO21hcmtlcjpub25lO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGU7Zm9udC1mYW1pbHk6Qml0c3RyZWFtIFZlcmEgU2FuczstaW5rc2NhcGUtZm9udC1zcGVjaWZpY2F0aW9uOkJpdHN0cmVhbSBWZXJhIFNhbnMiCiAgICAgICBkPSJNIDMwLDUgTCAzMCw2LjQyODU3MTQgTCAzMCw0My41NzE0MjkgTCAzMCw0NSBMIDMxLjQyODU3MSw0NSBMIDUwLjQ3NjE5LDQ1IEMgNjEuNzQ0MDk4LDQ1IDcwLjQ3NjE5LDM1Ljk5OTk1NSA3MC40NzYxOSwyNSBDIDcwLjQ3NjE5LDE0LjAwMDA0NSA2MS43NDQwOTksNS4wMDAwMDAyIDUwLjQ3NjE5LDUgQyA1MC40NzYxOSw1IDUwLjQ3NjE5LDUgMzEuNDI4NTcxLDUgTCAzMCw1IHogTSAzMi44NTcxNDMsNy44NTcxNDI5IEMgNDAuODM0MjY0LDcuODU3MTQyOSA0NS45MTgzNjgsNy44NTcxNDI5IDQ4LjA5NTIzOCw3Ljg1NzE0MjkgQyA0OS4yODU3MTQsNy44NTcxNDI5IDQ5Ljg4MDk1Miw3Ljg1NzE0MjkgNTAuMTc4NTcxLDcuODU3MTQyOSBDIDUwLjMyNzM4MSw3Ljg1NzE0MjkgNTAuNDA5MjI3LDcuODU3MTQyOSA1MC40NDY0MjksNy44NTcxNDI5IEMgNTAuNDY1MDI5LDcuODU3MTQyOSA1MC40NzE1NDMsNy44NTcxNDI5IDUwLjQ3NjE5LDcuODU3MTQyOSBDIDYwLjIzNjg1Myw3Ljg1NzE0MyA2Ny4xNDI4NTcsMTUuNDk3MDk4IDY3LjE0Mjg1NywyNSBDIDY3LjE0Mjg1NywzNC41MDI5MDIgNTkuNzYwNjYyLDQyLjE0Mjg1NyA1MCw0Mi4xNDI4NTcgTCAzMi44NTcxNDMsNDIuMTQyODU3IEwgMzIuODU3MTQzLDcuODU3MTQyOSB6IgogICAgICAgaWQ9InBhdGgyODg0IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NzY2NjY3Nzc3NzY2NjIiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return input1&&input2}}),joint.shapes.logic.Nor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Nor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5PUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjY3NzY0NCIKICAgICBpbmtzY2FwZTpjeT0iMjIuMTAyMzQ0IgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjM3IgogICAgIGlua3NjYXBlOndpbmRvdy15PSItNCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc5LDI1IEMgOTksMjUgOTUsMjUgOTUsMjUiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEsMTUgNSwxNSIKICAgICAgIGlkPSJwYXRoMzA2MSIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoxLjk5OTk5OTg4O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMyLDM1IDUsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgc3R5bGU9ImZpbGw6bm9uZTtmaWxsLW9wYWNpdHk6MTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWpvaW46bWl0ZXI7bWFya2VyOm5vbmU7c3Ryb2tlLW9wYWNpdHk6MTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlIgogICAgICAgICBpZD0icGF0aDI2MDQiCiAgICAgICAgIHNvZGlwb2RpOmN4PSI3NSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjI1IgogICAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgICAgc29kaXBvZGk6cnk9IjQiCiAgICAgICAgIGQ9Ik0gNzksMjUgQSA0LDQgMCAxIDEgNzEsMjUgQSA0LDQgMCAxIDEgNzksMjUgeiIKICAgICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTI2LjUsMzkuNSkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return!(input1||input2)}}),joint.shapes.logic.Nand=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Nand",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9Ik5BTkQgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgaWQ9ImJhc2UiCiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6em9vbT0iMTYiCiAgICAgaW5rc2NhcGU6Y3g9Ijc4LjI4MzMwNyIKICAgICBpbmtzY2FwZTpjeT0iMTYuNDQyODQzIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiCiAgICAgc2hvd2dyaWQ9InRydWUiCiAgICAgaW5rc2NhcGU6Z3JpZC1iYm94PSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtcG9pbnRzPSJ0cnVlIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwMDAwIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTM5OSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI4NzQiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjMzIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOnNuYXAtYmJveD0idHJ1ZSI+CiAgICA8aW5rc2NhcGU6Z3JpZAogICAgICAgaWQ9IkdyaWRGcm9tUHJlMDQ2U2V0dGluZ3MiCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBvcmlnaW54PSIwcHgiCiAgICAgICBvcmlnaW55PSIwcHgiCiAgICAgICBzcGFjaW5neD0iMXB4IgogICAgICAgc3BhY2luZ3k9IjFweCIKICAgICAgIGNvbG9yPSIjMDAwMGZmIgogICAgICAgZW1wY29sb3I9IiMwMDAwZmYiCiAgICAgICBvcGFjaXR5PSIwLjIiCiAgICAgICBlbXBvcGFjaXR5PSIwLjQiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPG1ldGFkYXRhCiAgICAgaWQ9Im1ldGFkYXRhNyI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGcKICAgICBpbmtzY2FwZTpsYWJlbD0iTGF5ZXIgMSIKICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgIGlkPSJsYXllcjEiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjI7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gNzksMjUgQyA5MS44LDI1IDk1LDI1IDk1LDI1IgogICAgICAgaWQ9InBhdGgzMDU5IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDMxLDE1IDUsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMiwzNSA1LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmb250LXNpemU6bWVkaXVtO2ZvbnQtc3R5bGU6bm9ybWFsO2ZvbnQtdmFyaWFudDpub3JtYWw7Zm9udC13ZWlnaHQ6bm9ybWFsO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1pbmRlbnQ6MDt0ZXh0LWFsaWduOnN0YXJ0O3RleHQtZGVjb3JhdGlvbjpub25lO2xpbmUtaGVpZ2h0Om5vcm1hbDtsZXR0ZXItc3BhY2luZzpub3JtYWw7d29yZC1zcGFjaW5nOm5vcm1hbDt0ZXh0LXRyYW5zZm9ybTpub25lO2RpcmVjdGlvbjpsdHI7YmxvY2stcHJvZ3Jlc3Npb246dGI7d3JpdGluZy1tb2RlOmxyLXRiO3RleHQtYW5jaG9yOnN0YXJ0O2ZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MzttYXJrZXI6bm9uZTt2aXNpYmlsaXR5OnZpc2libGU7ZGlzcGxheTppbmxpbmU7b3ZlcmZsb3c6dmlzaWJsZTtlbmFibGUtYmFja2dyb3VuZDphY2N1bXVsYXRlO2ZvbnQtZmFtaWx5OkJpdHN0cmVhbSBWZXJhIFNhbnM7LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjpCaXRzdHJlYW0gVmVyYSBTYW5zIgogICAgICAgZD0iTSAzMCw1IEwgMzAsNi40Mjg1NzE0IEwgMzAsNDMuNTcxNDI5IEwgMzAsNDUgTCAzMS40Mjg1NzEsNDUgTCA1MC40NzYxOSw0NSBDIDYxLjc0NDA5OCw0NSA3MC40NzYxOSwzNS45OTk5NTUgNzAuNDc2MTksMjUgQyA3MC40NzYxOSwxNC4wMDAwNDUgNjEuNzQ0MDk5LDUuMDAwMDAwMiA1MC40NzYxOSw1IEMgNTAuNDc2MTksNSA1MC40NzYxOSw1IDMxLjQyODU3MSw1IEwgMzAsNSB6IE0gMzIuODU3MTQzLDcuODU3MTQyOSBDIDQwLjgzNDI2NCw3Ljg1NzE0MjkgNDUuOTE4MzY4LDcuODU3MTQyOSA0OC4wOTUyMzgsNy44NTcxNDI5IEMgNDkuMjg1NzE0LDcuODU3MTQyOSA0OS44ODA5NTIsNy44NTcxNDI5IDUwLjE3ODU3MSw3Ljg1NzE0MjkgQyA1MC4zMjczODEsNy44NTcxNDI5IDUwLjQwOTIyNyw3Ljg1NzE0MjkgNTAuNDQ2NDI5LDcuODU3MTQyOSBDIDUwLjQ2NTAyOSw3Ljg1NzE0MjkgNTAuNDcxNTQzLDcuODU3MTQyOSA1MC40NzYxOSw3Ljg1NzE0MjkgQyA2MC4yMzY4NTMsNy44NTcxNDMgNjcuMTQyODU3LDE1LjQ5NzA5OCA2Ny4xNDI4NTcsMjUgQyA2Ny4xNDI4NTcsMzQuNTAyOTAyIDU5Ljc2MDY2Miw0Mi4xNDI4NTcgNTAsNDIuMTQyODU3IEwgMzIuODU3MTQzLDQyLjE0Mjg1NyBMIDMyLjg1NzE0Myw3Ljg1NzE0MjkgeiIKICAgICAgIGlkPSJwYXRoMjg4NCIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2Njc2NjY2Nzc3Nzc2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDQwMDgiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return!(input1&&input2)}}),joint.shapes.logic.Xor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Xor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhPUiBBTlNJLnN2ZyIKICAgaW5rc2NhcGU6b3V0cHV0X2V4dGVuc2lvbj0ib3JnLmlua3NjYXBlLm91dHB1dC5zdmcuaW5rc2NhcGUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0Ij4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSI1MCA6IDE1IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIyNSA6IDEwIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3MTQiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEgOiAwLjUgOiAxIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjAuNSA6IDAuMzMzMzMzMzMgOiAxIgogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgwNiIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjgxOSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzNzIuMDQ3MjQgOiAzNTAuNzg3MzkgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNzQ0LjA5NDQ4IDogNTI2LjE4MTA5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MjYuMTgxMDkgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMjc3NyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI3NSA6IDQwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjE1MCA6IDYwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA2MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUzMjc1IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjUwIDogMzMuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjEwMCA6IDUwIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiA1MCA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmU1NTMzIgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjMyIDogMjEuMzMzMzMzIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjY0IDogMzIgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDMyIDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI1NTciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxNi42NjY2NjcgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAyNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMjUgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICA8L2RlZnM+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJiYXNlIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxLjAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAuMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnpvb209IjUuNjU2ODU0MiIKICAgICBpbmtzY2FwZTpjeD0iMjUuOTM4MTE2IgogICAgIGlua3NjYXBlOmN5PSIxNy4yMzAwNSIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyO3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJtIDcwLDI1IGMgMjAsMCAyNSwwIDI1LDAiCiAgICAgICBpZD0icGF0aDMwNTkiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5ODg7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzAuMzg1NzE3LDE1IEwgNC45OTk5OTk4LDE1IgogICAgICAgaWQ9InBhdGgzMDYxIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOm5vbmU7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuOTk5OTk5NzY7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgIGQ9Ik0gMzEuMzYyMDkxLDM1IEwgNC45OTk5OTk4LDM1IgogICAgICAgaWQ9InBhdGgzOTQ0IiAvPgogICAgPGcKICAgICAgIGlkPSJnMjU2MCIKICAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjYuNSwtMzkuNSkiPgogICAgICA8cGF0aAogICAgICAgICBpZD0icGF0aDM1MTYiCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi4yNSw4MS41MDAwMDUgQyAtMy44NDczNzQsODQuMTQ0NDA1IC00LjUsODQuNTAwMDA1IC00LjUsODQuNTAwMDA1IEwgLTguMTU2MjUsODQuNTAwMDA1IEwgLTYuMTU2MjUsODIuMDYyNTA1IEMgLTYuMTU2MjUsODIuMDYyNTA1IC0wLjUsNzUuMDYyNDUxIC0wLjUsNjQuNSBDIC0wLjUsNTMuOTM3NTQ5IC02LjE1NjI1LDQ2LjkzNzUgLTYuMTU2MjUsNDYuOTM3NSBMIC04LjE1NjI1LDQ0LjUgTCAtNC41LDQ0LjUgQyAtMy43MTg3NSw0NS40Mzc1IC0zLjA3ODEyNSw0Ni4xNTYyNSAtMi4yODEyNSw0Ny41IEMgLTAuNDA4NTMxLDUwLjU5OTgxNSAyLjUsNTYuNTI2NjQ2IDIuNSw2NC41IEMgMi41LDcyLjQ1MDY1IC0wLjM5NjY5Nyw3OC4zNzk0MjUgLTIuMjUsODEuNTAwMDA1IHoiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY3NjY2Njc2MiIC8+CiAgICAgIDxwYXRoCiAgICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwMDA7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjM7c3Ryb2tlLWxpbmVjYXA6YnV0dDtzdHJva2UtbGluZWpvaW46bWl0ZXI7c3Ryb2tlLW9wYWNpdHk6MSIKICAgICAgICAgZD0iTSAtMi40MDYyNSw0NC41IEwgLTAuNDA2MjUsNDYuOTM3NSBDIC0wLjQwNjI1LDQ2LjkzNzUgNS4yNSw1My45Mzc1NDkgNS4yNSw2NC41IEMgNS4yNSw3NS4wNjI0NTEgLTAuNDA2MjUsODIuMDYyNSAtMC40MDYyNSw4Mi4wNjI1IEwgLTIuNDA2MjUsODQuNSBMIDAuNzUsODQuNSBMIDE0Ljc1LDg0LjUgQyAxNy4xNTgwNzYsODQuNTAwMDAxIDIyLjQzOTY5OSw4NC41MjQ1MTQgMjguMzc1LDgyLjA5Mzc1IEMgMzQuMzEwMzAxLDc5LjY2Mjk4NiA0MC45MTE1MzYsNzQuNzUwNDg0IDQ2LjA2MjUsNjUuMjE4NzUgTCA0NC43NSw2NC41IEwgNDYuMDYyNSw2My43ODEyNSBDIDM1Ljc1OTM4Nyw0NC43MTU1OSAxOS41MDY1NzQsNDQuNSAxNC43NSw0NC41IEwgMC43NSw0NC41IEwgLTIuNDA2MjUsNDQuNSB6IE0gMy40Njg3NSw0Ny41IEwgMTQuNzUsNDcuNSBDIDE5LjQzNDE3Myw0Ny41IDMzLjAzNjg1LDQ3LjM2OTc5MyA0Mi43MTg3NSw2NC41IEMgMzcuOTUxOTY0LDcyLjkyOTA3NSAzMi4xOTc0NjksNzcuMTgzOTEgMjcsNzkuMzEyNSBDIDIxLjYzOTMzOSw4MS41MDc5MjQgMTcuMTU4MDc1LDgxLjUwMDAwMSAxNC43NSw4MS41IEwgMy41LDgxLjUgQyA1LjM3MzU4ODQsNzguMzkxNTY2IDguMjUsNzIuNDUwNjUgOC4yNSw2NC41IEMgOC4yNSw1Ni41MjY2NDYgNS4zNDE0Njg2LDUwLjU5OTgxNSAzLjQ2ODc1LDQ3LjUgeiIKICAgICAgICAgaWQ9InBhdGg0OTczIgogICAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjc2NjY2NzY2NjY2NjY2Njc2Njc2MiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K"}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return(!input1||input2)&&(input1||!input2)}}),joint.shapes.logic.Xnor=joint.shapes.logic.Gate21.extend({defaults:joint.util.deepSupplement({type:"logic.Xnor",attrs:{image:{"xlink:href":"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIKICAgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMDAiCiAgIGhlaWdodD0iNTAiCiAgIGlkPSJzdmcyIgogICBzb2RpcG9kaTp2ZXJzaW9uPSIwLjMyIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ2IgogICB2ZXJzaW9uPSIxLjAiCiAgIHNvZGlwb2RpOmRvY25hbWU9IlhOT1IgQU5TSS5zdmciCiAgIGlua3NjYXBlOm91dHB1dF9leHRlbnNpb249Im9yZy5pbmtzY2FwZS5vdXRwdXQuc3ZnLmlua3NjYXBlIj4KICA8ZGVmcwogICAgIGlkPSJkZWZzNCI+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogMTUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfej0iNTAgOiAxNSA6IDEiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMjUgOiAxMCA6IDEiCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNzE0IiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDAuNSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxIDogMC41IDogMSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIwLjUgOiAwLjMzMzMzMzMzIDogMSIKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MDYiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI4MTkiCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iMzcyLjA0NzI0IDogMzUwLjc4NzM5IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9Ijc0NC4wOTQ0OCA6IDUyNi4xODEwOSA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTI2LjE4MTA5IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgICA8aW5rc2NhcGU6cGVyc3BlY3RpdmUKICAgICAgIGlkPSJwZXJzcGVjdGl2ZTI3NzciCiAgICAgICBpbmtzY2FwZTpwZXJzcDNkLW9yaWdpbj0iNzUgOiA0MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxNTAgOiA2MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNjAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlMzI3NSIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSI1MCA6IDMzLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSIxMDAgOiA1MCA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF95PSIwIDogMTAwMCA6IDAiCiAgICAgICBpbmtzY2FwZTp2cF94PSIwIDogNTAgOiAxIgogICAgICAgc29kaXBvZGk6dHlwZT0iaW5rc2NhcGU6cGVyc3AzZCIgLz4KICAgIDxpbmtzY2FwZTpwZXJzcGVjdGl2ZQogICAgICAgaWQ9InBlcnNwZWN0aXZlNTUzMyIKICAgICAgIGlua3NjYXBlOnBlcnNwM2Qtb3JpZ2luPSIzMiA6IDIxLjMzMzMzMyA6IDEiCiAgICAgICBpbmtzY2FwZTp2cF96PSI2NCA6IDMyIDogMSIKICAgICAgIGlua3NjYXBlOnZwX3k9IjAgOiAxMDAwIDogMCIKICAgICAgIGlua3NjYXBlOnZwX3g9IjAgOiAzMiA6IDEiCiAgICAgICBzb2RpcG9kaTp0eXBlPSJpbmtzY2FwZTpwZXJzcDNkIiAvPgogICAgPGlua3NjYXBlOnBlcnNwZWN0aXZlCiAgICAgICBpZD0icGVyc3BlY3RpdmUyNTU3IgogICAgICAgaW5rc2NhcGU6cGVyc3AzZC1vcmlnaW49IjI1IDogMTYuNjY2NjY3IDogMSIKICAgICAgIGlua3NjYXBlOnZwX3o9IjUwIDogMjUgOiAxIgogICAgICAgaW5rc2NhcGU6dnBfeT0iMCA6IDEwMDAgOiAwIgogICAgICAgaW5rc2NhcGU6dnBfeD0iMCA6IDI1IDogMSIKICAgICAgIHNvZGlwb2RpOnR5cGU9Imlua3NjYXBlOnBlcnNwM2QiIC8+CiAgPC9kZWZzPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0iYmFzZSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMS4wIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp6b29tPSI0IgogICAgIGlua3NjYXBlOmN4PSI5NS43MjM2NiIKICAgICBpbmtzY2FwZTpjeT0iLTI2Ljc3NTAyMyIKICAgICBpbmtzY2FwZTpkb2N1bWVudC11bml0cz0icHgiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIGlua3NjYXBlOmdyaWQtYmJveD0idHJ1ZSIKICAgICBpbmtzY2FwZTpncmlkLXBvaW50cz0idHJ1ZSIKICAgICBncmlkdG9sZXJhbmNlPSIxMDAwMCIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEzOTkiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iODc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIzMyIKICAgICBpbmtzY2FwZTp3aW5kb3cteT0iMCIKICAgICBpbmtzY2FwZTpzbmFwLWJib3g9InRydWUiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJHcmlkRnJvbVByZTA0NlNldHRpbmdzIgogICAgICAgdHlwZT0ieHlncmlkIgogICAgICAgb3JpZ2lueD0iMHB4IgogICAgICAgb3JpZ2lueT0iMHB4IgogICAgICAgc3BhY2luZ3g9IjFweCIKICAgICAgIHNwYWNpbmd5PSIxcHgiCiAgICAgICBjb2xvcj0iIzAwMDBmZiIKICAgICAgIGVtcGNvbG9yPSIjMDAwMGZmIgogICAgICAgb3BhY2l0eT0iMC4yIgogICAgICAgZW1wb3BhY2l0eT0iMC40IgogICAgICAgZW1wc3BhY2luZz0iNSIKICAgICAgIHZpc2libGU9InRydWUiCiAgICAgICBlbmFibGVkPSJ0cnVlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTciPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDpub25lO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDoyLjAwMDAwMDI0O3N0cm9rZS1saW5lY2FwOmJ1dHQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDc4LjMzMzMzMiwyNSBDIDkxLjY2NjY2NiwyNSA5NSwyNSA5NSwyNSIKICAgICAgIGlkPSJwYXRoMzA1OSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk4ODtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMC4zODU3MTcsMTUgTCA0Ljk5OTk5OTgsMTUiCiAgICAgICBpZD0icGF0aDMwNjEiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS45OTk5OTk3NjtzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgZD0iTSAzMS4zNjIwOTEsMzUgTCA0Ljk5OTk5OTgsMzUiCiAgICAgICBpZD0icGF0aDM5NDQiIC8+CiAgICA8ZwogICAgICAgaWQ9ImcyNTYwIgogICAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgyNi41LC0zOS41KSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGlkPSJwYXRoMzUxNiIKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjI1LDgxLjUwMDAwNSBDIC0zLjg0NzM3NCw4NC4xNDQ0MDUgLTQuNSw4NC41MDAwMDUgLTQuNSw4NC41MDAwMDUgTCAtOC4xNTYyNSw4NC41MDAwMDUgTCAtNi4xNTYyNSw4Mi4wNjI1MDUgQyAtNi4xNTYyNSw4Mi4wNjI1MDUgLTAuNSw3NS4wNjI0NTEgLTAuNSw2NC41IEMgLTAuNSw1My45Mzc1NDkgLTYuMTU2MjUsNDYuOTM3NSAtNi4xNTYyNSw0Ni45Mzc1IEwgLTguMTU2MjUsNDQuNSBMIC00LjUsNDQuNSBDIC0zLjcxODc1LDQ1LjQzNzUgLTMuMDc4MTI1LDQ2LjE1NjI1IC0yLjI4MTI1LDQ3LjUgQyAtMC40MDg1MzEsNTAuNTk5ODE1IDIuNSw1Ni41MjY2NDYgMi41LDY0LjUgQyAyLjUsNzIuNDUwNjUgLTAuMzk2Njk3LDc4LjM3OTQyNSAtMi4yNSw4MS41MDAwMDUgeiIKICAgICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2Njc2NjY2NzYyIgLz4KICAgICAgPHBhdGgKICAgICAgICAgc3R5bGU9ImZpbGw6IzAwMDAwMDtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MztzdHJva2UtbGluZWNhcDpidXR0O3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2Utb3BhY2l0eToxIgogICAgICAgICBkPSJNIC0yLjQwNjI1LDQ0LjUgTCAtMC40MDYyNSw0Ni45Mzc1IEMgLTAuNDA2MjUsNDYuOTM3NSA1LjI1LDUzLjkzNzU0OSA1LjI1LDY0LjUgQyA1LjI1LDc1LjA2MjQ1MSAtMC40MDYyNSw4Mi4wNjI1IC0wLjQwNjI1LDgyLjA2MjUgTCAtMi40MDYyNSw4NC41IEwgMC43NSw4NC41IEwgMTQuNzUsODQuNSBDIDE3LjE1ODA3Niw4NC41MDAwMDEgMjIuNDM5Njk5LDg0LjUyNDUxNCAyOC4zNzUsODIuMDkzNzUgQyAzNC4zMTAzMDEsNzkuNjYyOTg2IDQwLjkxMTUzNiw3NC43NTA0ODQgNDYuMDYyNSw2NS4yMTg3NSBMIDQ0Ljc1LDY0LjUgTCA0Ni4wNjI1LDYzLjc4MTI1IEMgMzUuNzU5Mzg3LDQ0LjcxNTU5IDE5LjUwNjU3NCw0NC41IDE0Ljc1LDQ0LjUgTCAwLjc1LDQ0LjUgTCAtMi40MDYyNSw0NC41IHogTSAzLjQ2ODc1LDQ3LjUgTCAxNC43NSw0Ny41IEMgMTkuNDM0MTczLDQ3LjUgMzMuMDM2ODUsNDcuMzY5NzkzIDQyLjcxODc1LDY0LjUgQyAzNy45NTE5NjQsNzIuOTI5MDc1IDMyLjE5NzQ2OSw3Ny4xODM5MSAyNyw3OS4zMTI1IEMgMjEuNjM5MzM5LDgxLjUwNzkyNCAxNy4xNTgwNzUsODEuNTAwMDAxIDE0Ljc1LDgxLjUgTCAzLjUsODEuNSBDIDUuMzczNTg4NCw3OC4zOTE1NjYgOC4yNSw3Mi40NTA2NSA4LjI1LDY0LjUgQyA4LjI1LDU2LjUyNjY0NiA1LjM0MTQ2ODYsNTAuNTk5ODE1IDMuNDY4NzUsNDcuNSB6IgogICAgICAgICBpZD0icGF0aDQ5NzMiCiAgICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NzY2NjY3NjY2NjY2NjY2NzY2NzYyIgLz4KICAgIDwvZz4KICAgIDxwYXRoCiAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICBzdHlsZT0iZmlsbDpub25lO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTojMDAwMDAwO3N0cm9rZS13aWR0aDozO3N0cm9rZS1saW5lam9pbjptaXRlcjttYXJrZXI6bm9uZTtzdHJva2Utb3BhY2l0eToxO3Zpc2liaWxpdHk6dmlzaWJsZTtkaXNwbGF5OmlubGluZTtvdmVyZmxvdzp2aXNpYmxlO2VuYWJsZS1iYWNrZ3JvdW5kOmFjY3VtdWxhdGUiCiAgICAgICBpZD0icGF0aDM1NTEiCiAgICAgICBzb2RpcG9kaTpjeD0iNzUiCiAgICAgICBzb2RpcG9kaTpjeT0iMjUiCiAgICAgICBzb2RpcG9kaTpyeD0iNCIKICAgICAgIHNvZGlwb2RpOnJ5PSI0IgogICAgICAgZD0iTSA3OSwyNSBBIDQsNCAwIDEgMSA3MSwyNSBBIDQsNCAwIDEgMSA3OSwyNSB6IiAvPgogIDwvZz4KPC9zdmc+Cg=="}}},joint.shapes.logic.Gate21.prototype.defaults),operation:function(input1,input2){return(!input1||!input2)&&(input1||input2)}}),joint.shapes.logic.Wire=joint.dia.Link.extend({arrowheadMarkup:['<g class="marker-arrowhead-group marker-arrowhead-group-<%= end %>">','<circle class="marker-arrowhead" end="<%= end %>" r="7"/>',"</g>"].join(""),vertexMarkup:['<g class="marker-vertex-group" transform="translate(<%= x %>, <%= y %>)">','<circle class="marker-vertex" idx="<%= idx %>" r="10" />','<g class="marker-vertex-remove-group">','<path class="marker-vertex-remove-area" idx="<%= idx %>" d="M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z" transform="translate(5, -33)"/>','<path class="marker-vertex-remove" idx="<%= idx %>" transform="scale(.8) translate(9.5, -37)" d="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z">',"<title>Remove vertex.</title>","</path>","</g>","</g>"].join(""),defaults:joint.util.deepSupplement({type:"logic.Wire",attrs:{".connection":{"stroke-width":2},".marker-vertex":{r:7}},router:{name:"orthogonal"},connector:{name:"rounded",args:{radius:10}}},joint.dia.Link.prototype.defaults)});var graphlib=__webpack_require__(11),dagre=__webpack_require__(34);
/*!
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */
function RGBColor(color_string){this.ok=!1,"#"==color_string.charAt(0)&&(color_string=color_string.substr(1,6)),color_string=(color_string=color_string.replace(/ /g,"")).toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors)color_string==key&&(color_string=simple_colors[key]);for(var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)]}}],i=0;i<color_defs.length;i++){var re=color_defs[i].re,processor=color_defs[i].process,bits=re.exec(color_string);bits&&(channels=processor(bits),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:255<this.r?255:this.r,this.g=this.g<0||isNaN(this.g)?0:255<this.g?255:this.g,this.b=this.b<0||isNaN(this.b)?0:255<this.b?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var r=this.r.toString(16),g=this.g.toString(16),b=this.b.toString(16);return 1==r.length&&(r="0"+r),1==g.length&&(g="0"+g),1==b.length&&(b="0"+b),"#"+r+g+b},this.getHelpXML=function(){for(var examples=new Array,i=0;i<color_defs.length;i++)for(var example=color_defs[i].example,j=0;j<example.length;j++)examples[examples.length]=example[j];for(var sc in simple_colors)examples[examples.length]=sc;var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++)try{var list_item=document.createElement("li"),list_color=new RGBColor(examples[i]),example_div=document.createElement("div");example_div.style.cssText="margin: 3px; border: 1px solid black; background:"+list_color.toHex()+"; color:"+list_color.toHex(),example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div),list_item.appendChild(list_item_value),xml.appendChild(list_item)}catch(e){}return xml}}
/*!

StackBlur - a fast almost Gaussian Blur For Canvas

Version: 	0.5
Author:		Mario Klingemann
Contact: 	mario@quasimondo.com
Website:	http://www.quasimondo.com/StackBlurForCanvas
Twitter:	@quasimondo

In case you find this class useful - especially in commercial projects -
I am not totally unhappy for a small donation to my PayPal account
mario@quasimondo.de

Or support me on flattr: 
https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript

Copyright (c) 2010 Mario Klingemann

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
*/graphlib=graphlib||"undefined"!=typeof window&&window.graphlib,dagre=dagre||"undefined"!=typeof window&&window.dagre,joint.layout.DirectedGraph={layout:function(graphOrCells,opt){var graph;graph=graphOrCells instanceof joint.dia.Graph?graphOrCells:(new joint.dia.Graph).resetCells(graphOrCells),graphOrCells=null,opt=_.defaults(opt||{},{resizeClusters:!0,clusterPadding:10});var glGraph=graph.toGraphLib({directed:!0,multigraph:!0,compound:!0,setNodeLabel:function(element){return{width:element.get("size").width,height:element.get("size").height,rank:element.get("rank")}},setEdgeLabel:function(link){return{minLen:link.get("minLen")||1}},setEdgeName:function(link){return link.id}}),glLabel={};return opt.rankDir&&(glLabel.rankdir=opt.rankDir),opt.align&&(glLabel.align=opt.align),opt.nodeSep&&(glLabel.nodesep=opt.nodeSep),opt.edgeSep&&(glLabel.edgesep=opt.edgeSep),opt.rankSep&&(glLabel.ranksep=opt.rankSep),opt.marginX&&(glLabel.marginx=opt.marginX),opt.marginY&&(glLabel.marginy=opt.marginY),glGraph.setGraph(glLabel),dagre.layout(glGraph,{debugTiming:!!opt.debugTiming}),graph.startBatch("layout"),graph.fromGraphLib(glGraph,{importNode:function(v,gl){var element=this.getCell(v),glNode=gl.node(v);opt.setPosition?opt.setPosition(element,glNode):element.set("position",{x:glNode.x-glNode.width/2,y:glNode.y-glNode.height/2})},importEdge:function(edgeObj,gl){var link=this.getCell(edgeObj.name),glEdge=gl.edge(edgeObj),points=glEdge.points||[];opt.setLinkVertices&&(opt.setVertices?opt.setVertices(link,points):link.set("vertices",points.slice(1,points.length-1)))}}),opt.resizeClusters&&_.chain(glGraph.nodes()).filter(function(v){return 0<glGraph.children(v).length}).map(graph.getCell,graph).sortBy(function(cluster){return-cluster.getAncestors().length}).invoke("fitEmbeds",{padding:opt.clusterPadding}).value(),graph.stopBatch("layout"),glGraph.graph()},fromGraphLib:function(glGraph,opt){var importNode=(opt=opt||{}).importNode||_.noop,importEdge=opt.importEdge||_.noop,graph=this instanceof joint.dia.Graph?this:new joint.dia.Graph;return glGraph.nodes().forEach(function(node){importNode.call(graph,node,glGraph,graph,opt)}),glGraph.edges().forEach(function(edge){importEdge.call(graph,edge,glGraph,graph,opt)}),graph},toGraphLib:function(graph,opt){opt=opt||{};var glGraphType=_.pick(opt,"directed","compound","multigraph"),glGraph=new graphlib.Graph(glGraphType),setNodeLabel=opt.setNodeLabel||_.noop,setEdgeLabel=opt.setEdgeLabel||_.noop,setEdgeName=opt.setEdgeName||_.noop;return graph.get("cells").each(function(cell){if(cell.isLink()){var source=cell.get("source"),target=cell.get("target");if(!source.id||!target.id)return;glGraph.setEdge(source.id,target.id,setEdgeLabel(cell),setEdgeName(cell))}else glGraph.setNode(cell.id,setNodeLabel(cell)),glGraph.isCompound()&&cell.has("parent")&&glGraph.setParent(cell.id,cell.get("parent"))}),glGraph}},joint.dia.Graph.prototype.toGraphLib=function(opt){return joint.layout.DirectedGraph.toGraphLib(this,opt)},joint.dia.Graph.prototype.fromGraphLib=function(glGraph,opt){return joint.layout.DirectedGraph.fromGraphLib.call(this,glGraph,opt)},joint.shapes.chart={},joint.shapes.chart.Plot=joint.shapes.basic.Generic.extend({markup:['<clipPath class="clip"><rect/></clipPath>','<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="axis">','<g class="y-axis"><path/><g class="ticks"></g></g>','<g class="x-axis"><path/><g class="ticks"></g></g>','<g class="markings"></g>',"</g>",'<g class="data"><g class="series"></g></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>','<line class="guideline x-guideline" /><line class="guideline y-guideline" />',"</g>","</g>"].join(""),tickMarkup:'<g class="tick"><line/><text/></g>',pointMarkup:'<g class="point"><circle/><text/></g>',barMarkup:'<path class="bar"/>',markingMarkup:'<g class="marking"><rect/><text/></g>',serieMarkup:'<g><clipPath class="serie-clip"><rect/></clipPath><path/><g class="bars"></g><g class="points"></g></g>',legendItemMarkup:'<g class="legend-item"><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"chart.Plot",attrs:{".data path":{fill:"none",stroke:"black"},".data .bars rect":{fill:"none",stroke:"black"},".background rect":{fill:"white",stroke:"#e5e5e5",opacity:1},".background text":{fill:"black",text:"No data available.",ref:".","ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":.5,"ref-y":10,"text-anchor":"middle","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":.5,"ref-y":23,"text-anchor":"middle","y-alignment":"middle","font-size":10},".point":{display:"inline-block"},".point circle":{r:2,stroke:"black",fill:"black",opacity:.3},".point text":{fill:"black","font-size":8,"text-anchor":"middle",display:"none"},".axis path":{fill:"none",stroke:"black"},".axis .tick":{fill:"none",stroke:"black"},".y-axis .tick line":{fill:"none",stroke:"black",x2:2,y2:0,opacity:1},".x-axis .tick line":{fill:"none",stroke:"black",x2:0,y2:-3,opacity:1},".y-axis .tick text":{fill:"black",stroke:"none","font-size":10,"text-anchor":"end"},".x-axis .tick text":{fill:"black",stroke:"none","font-size":10,"text-anchor":"middle"},".y-axis .tick text > tspan":{dy:"-.5em",x:-5},".x-axis .tick text > tspan":{dy:".5em",x:0},".axis .markings":{fill:"black",stroke:"none","fill-opacity":1},".axis .markings text":{fill:"black","text-anchor":"end","font-size":10,dy:-5,dx:-5},".guideline":{"pointer-events":"none",display:"none"},".x-guideline":{stroke:"black",visibility:"hidden"},".y-guideline":{stroke:"black",visibility:"hidden"},".legend":{ref:".background","ref-x":10,"ref-y":10},".legend-item text":{fill:"black",transform:"translate(14, 0)","font-size":11},".legend-item circle":{r:5,transform:"translate(5,5)"},".legend-item":{cursor:"pointer"},".legend-item.disabled circle":{fill:"gray"},".legend-item.disabled text":{opacity:.5}}},joint.shapes.basic.Generic.prototype.defaults),legendPosition:function(pos,opt){opt=opt||{},this.trigger("batch:start"),this.removeAttr([".legend/ref-x",".legend/ref-y",".legend/ref-dx",".legend/ref-dy",".legend/x-alignment",".legend/y-alignment"],{silent:!0});var padding=opt.padding||10,attrs={n:{".legend":{"ref-x":.5,"x-alignment":-.5,"ref-y":padding}},ne:{".legend":{"ref-dx":-padding,"x-alignment":-.999,"ref-y":padding}},e:{".legend":{"ref-dx":-padding,"x-alignment":-.999,"ref-y":.5,"y-alignment":-.5}},se:{".legend":{"ref-dx":-padding,"ref-dy":-padding,"x-alignment":-.999,"y-alignment":-.999}},s:{".legend":{"ref-x":.5,"ref-dy":-padding,"x-alignment":-.5,"y-alignment":-.999}},sw:{".legend":{"ref-x":padding,"ref-dy":-padding,"y-alignment":-.999}},w:{".legend":{"ref-x":padding,"ref-y":.5,"y-alignment":-.5}},nw:{".legend":{"ref-x":padding,"ref-y":padding}},nnw:{".legend":{"ref-x":padding,"ref-y":-padding,"y-alignment":-.999}},nn:{".legend":{"ref-x":.5,"ref-y":-padding,"x-alignment":-.5,"y-alignment":-.999}},nne:{".legend":{"ref-dx":-padding,"ref-y":-padding,"x-alignment":-.999,"y-alignment":-.999}},nnee:{".legend":{"ref-dx":padding,"ref-y":-padding,"y-alignment":-.999}},nee:{".legend":{"ref-y":padding,"ref-dx":padding}},ee:{".legend":{"ref-dx":padding,"ref-y":.5,"y-alignment":-.5}},see:{".legend":{"ref-dx":padding,"ref-dy":-padding,"y-alignment":-.999}},ssee:{".legend":{"ref-dx":padding,"ref-dy":padding}},sse:{".legend":{"ref-dx":-padding,"ref-dy":padding,"x-alignment":-.999}},ss:{".legend":{"ref-x":.5,"ref-dy":padding,"x-alignment":-.5}},ssw:{".legend":{"ref-x":padding,"ref-dy":padding}},ssww:{".legend":{"ref-x":-padding,"ref-dy":padding,"x-alignment":-.999}},sww:{".legend":{"ref-x":-padding,"ref-dy":-padding,"x-alignment":-.999,"y-alignment":-.999}},ww:{".legend":{"ref-x":-padding,"ref-y":.5,"x-alignment":-.999,"y-alignment":-.5}},nww:{".legend":{"ref-x":-padding,"ref-y":padding,"x-alignment":-.999}},nnww:{".legend":{"ref-x":-padding,"ref-y":-padding,"x-alignment":-.999,"y-alignment":-.999}}};attrs[pos]&&this.attr(attrs[pos]),this.trigger("batch:stop")},addPoint:function(p,serieName,opt){opt=opt||{};var series=this.get("series"),serieIndex=_.findIndex(series,{name:serieName});if(-1===serieIndex)throw new Error("Serie "+serieName+" was not found.");var serie=_.cloneDeep(series[serieIndex]);serie.data.push(p),_.isFinite(opt.maxLen)&&serie.data.length>opt.maxLen&&serie.data.shift(),(series=series.slice())[serieIndex]=serie,this.set("series",series,opt)},lastPoint:function(serieName){return _.last(_.findWhere(this.get("series"),{name:serieName}).data)},firstPoint:function(serieName){return _.first(_.findWhere(this.get("series"),{name:serieName}).data)}}),joint.shapes.chart.PlotView=joint.dia.ElementView.extend({events:{mousemove:"onMouseMove",mouseout:"onMouseOut"},initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:series change:interpolate change:padding change:canvas change:markings change:axis",_.bind(function(){this.update()},this)),this.on("cell:pointerdown",this.onPointerDown,this),this._disabledSeries=[]},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments),this.elDataClipPath=this.$(".clip")[0],this.elDataClipPathRect=this.elDataClipPath.firstChild,this.elBackgroundRect=this.$(".background rect")[0],this.elBackgroundText=this.$(".background text")[0],this.elForeground=this.$(".foreground")[0],this.elForegroundRect=this.$(".foreground rect")[0],this.elDataSeries=this.$(".data .series")[0],this.elYAxisPath=this.$(".y-axis path")[0],this.elYAxisTicks=this.$(".y-axis .ticks")[0],this.elXAxisPath=this.$(".x-axis path")[0],this.elXAxisTicks=this.$(".x-axis .ticks")[0],this.elMarkings=this.$(".axis .markings")[0],this.elXGuideline=this.$(".x-guideline")[0],this.elYGuideline=this.$(".y-guideline")[0],this.elLegend=this.$(".legend")[0],this.elLegendItems=this.$(".legend-items")[0],this.elTick=V(this.model.tickMarkup),this.elMarking=V(this.model.markingMarkup),this.elLegendItem=V(this.model.legendItemMarkup),this.elPoint=V(this.model.pointMarkup),this.elBar=V(this.model.barMarkup),this.elSerie=V(this.model.serieMarkup),this.elDataClipPath.id="clip_"+this.cid,V(this.$(".data")[0]).attr("clip-path","url(#"+this.elDataClipPath.id+")"),V(this.elMarkings).attr("clip-path","url(#"+this.elDataClipPath.id+")")},update:function(){var series=this.filterSeries();this.calculateStats(series);var padding,size=this.model.get("size"),width=size.width,height=size.height;this.canvas=_.extend({x:0,y:0,width:width,height:height},this.model.get("canvas"));var defaultPadding={top:0,right:0,bottom:0,left:0},modelPadding=this.model.get("padding");padding=_.isObject(modelPadding)?_.extend({},defaultPadding,modelPadding):_.isUndefined(modelPadding)?defaultPadding:{top:modelPadding,right:2*modelPadding,bottom:2*modelPadding,left:modelPadding},this.canvas=g.rect(this.canvas).moveAndExpand(g.rect(padding.left,padding.top,-padding.right,-padding.bottom));var viewRect={x:0,y:0,width:width,height:height};V(this.elDataClipPathRect).attr(viewRect),V(this.elBackgroundRect).attr(viewRect),V(this.elForegroundRect).attr(viewRect),this.updateAxis(),this.updateMarkings(),this.isEmpty()?$(this.elBackgroundText).show():$(this.elBackgroundText).hide(),this.updateSeries(series),this.updateLegend(),joint.dia.ElementView.prototype.update.apply(this,arguments)},calculateStats:function(series){series=series||this.model.get("series");var xValues=[],yValues=[],xMap={},yMap={},bySerie={};_.each(series,function(serie,idx){var prev,stats=bySerie[serie.name||idx]||(bySerie[serie.name||idx]={});stats.decreasingX=!0,stats.decreasingY=!0,stats.nonDecreasingX=!0,stats.nonDecreasingY=!0,_.each(serie.data,function(dp){stats.minX=_.isUndefined(stats.minX)?dp.x:Math.min(stats.minX,dp.x),stats.maxX=_.isUndefined(stats.maxX)?dp.x:Math.max(stats.maxX,dp.x),stats.minY=_.isUndefined(stats.minY)?dp.y:Math.min(stats.minY,dp.y),stats.maxY=_.isUndefined(stats.maxY)?dp.y:Math.max(stats.maxY,dp.y),prev&&(stats.decreasingX=stats.decreasingX&&dp.x<prev.x,stats.decreasingY=stats.decreasingY&&dp.y<prev.y,stats.nonDecreasingX=stats.nonDecreasingX&&dp.x>=prev.x,stats.nonDecreasingY=stats.nonDecreasingY&&dp.y>=prev.y),_.contains(xValues,dp.x)||xValues.push(dp.x),_.contains(yValues,dp.y)||yValues.push(dp.y),(xMap[dp.x]||(xMap[dp.x]=[])).push({serie:serie,x:dp.x,y:dp.y}),(yMap[dp.y]||(yMap[dp.y]=[])).push({serie:serie,x:dp.x,y:dp.y}),prev=dp})});var axis=this.model.get("axis")||{},xAxis=axis["x-axis"]||{},yAxis=axis["y-axis"]||{};this.stats={minX:_.isUndefined(xAxis.min)?_.min(xValues):xAxis.min,maxX:_.isUndefined(xAxis.max)?_.max(xValues):xAxis.max,minY:_.isUndefined(yAxis.min)?_.min(yValues):yAxis.min,maxY:_.isUndefined(yAxis.max)?_.max(yValues):yAxis.max,bySerie:bySerie,xValues:xValues,yValues:yValues,xMap:xMap,yMap:yMap}},isEmpty:function(){return!this.stats.xValues.length},updateSeries:function(series){if(series=series||this.model.get("series"),this.elDataSeries.textContent="",!this.isEmpty()){var xDomain=[this.stats.minX,this.stats.maxX],yDomain=[this.stats.minY,this.stats.maxY],xRange=[this.canvas.x,this.canvas.x+this.canvas.width],yRange=[this.canvas.y+this.canvas.height,this.canvas.y],attrs=this.model.get("attrs");_.each(series,function(serie,i){var points=serie.data,transformedPoints=[],elSerie=this.elSerie.clone().attr("class",serie.name||"serie-"+i);V(this.elDataSeries).append(elSerie),_.each(points,function(p){var x=g.scale.linear(xDomain,xRange,p.x),y=g.scale.linear(yDomain,yRange,p.y);transformedPoints.push({x:x,y:y}),attrs[".point"]&&"none"!==attrs[".point"].display&&this.renderPoint(p,serie),serie.bars&&this.renderBar(p,serie)},this);var elSeriePathClip=elSerie.findOne(".serie-clip"),size=this.model.get("size"),stats=this.stats.bySerie[serie.name||i],minX=g.scale.linear(xDomain,xRange,stats.minX),maxX=g.scale.linear(xDomain,xRange,stats.maxX),elSeriePathClipRect=elSeriePathClip.findOne("rect");if(elSeriePathClipRect.attr(g.rect(minX,0,maxX-minX,size.height)),!serie.bars){var elSeriePath=elSerie.findOne("path");elSeriePath.attr({d:this.seriePathData(transformedPoints,serie,i),"clip-path":"url(#"+elSeriePathClip.node.id+")"})}},this)}},seriePathClipData:function(points,serie){var size=this.model.get("size"),firstPoint=_.first(points),d=(_.last(points),["M",firstPoint.x,firstPoint.y,"V",size.height+10]);return d.join(" ")},renderBar:function(p,serie){var xDomain=[this.stats.minX,this.stats.maxX],yDomain=[this.stats.minY,this.stats.maxY],xRange=[this.canvas.x,this.canvas.x+this.canvas.width],yRange=[this.canvas.y+this.canvas.height,this.canvas.y],x=g.scale.linear(xDomain,xRange,p.x),y=g.scale.linear(yDomain,yRange,p.y),definedBarWidth=serie.bars.barWidth||.8,barWidth=1<definedBarWidth?definedBarWidth:this.canvas.width/(this.stats.maxX-this.stats.minX)*definedBarWidth,barHeight=g.scale.linear(yDomain,yRange,0)-y,topRx=p["top-rx"]||serie.bars["top-rx"],topRy=p["top-ry"]||serie.bars["top-ry"],bottomRx=p["bottom-rx"]||serie.bars["bottom-rx"],bottomRy=p["bottom-ry"]||serie.bars["bottom-ry"],barX={left:x,middle:x-barWidth/2,right:x-barWidth}[serie.bars.align||"middle"],elBar=this.elBar.clone();elBar.attr({"data-serie":serie.name,"data-x":p.x,"data-y":p.y,d:V.rectToPath({x:barX,y:y,width:barWidth,height:barHeight,"top-rx":topRx,"top-ry":topRy,"bottom-rx":bottomRx,"bottom-ry":bottomRy})});var serieSelector=serie.name||"serie-"+this.model.get("series").indexOf(serie);return V(this.elDataSeries).findOne("."+serieSelector+" .bars").append(elBar),elBar.node},renderPoint:function(p,serie){var xDomain=[this.stats.minX,this.stats.maxX],yDomain=[this.stats.minY,this.stats.maxY],xRange=[this.canvas.x,this.canvas.x+this.canvas.width],yRange=[this.canvas.y+this.canvas.height,this.canvas.y],x=g.scale.linear(xDomain,xRange,p.x),y=g.scale.linear(yDomain,yRange,p.y),elPoint=this.elPoint.clone();elPoint.attr({"data-serie":serie.name,"data-x":p.x,"data-y":p.y}),elPoint.findOne("circle").attr({cx:x,cy:y}),elPoint.findOne("text").attr({x:x,dy:y}).text(this.pointLabel(p,serie));var serieSelector=serie.name||"serie-"+this.model.get("series").indexOf(serie);return V(this.elDataSeries).findOne("."+serieSelector+" .points").append(elPoint),elPoint.node},seriePathData:function(points,serie,idx){var d,i,p,interpolate=_.isUndefined(serie.interpolate)?this.model.get("interpolate"):serie.interpolate,pointsLength=points.length;switch(interpolate){case"bezier":d=g.bezier.curveThroughPoints(points);break;case"step":for(p=points[0],d=["M",p.x,p.y],i=1;i<pointsLength;i++)d.push("H",(p.x+points[i].x)/2,"V",points[i].y),p=points[i];break;case"stepBefore":for(d=["M",points[0].x,points[0].y],i=1;i<pointsLength;i++)d.push("V",points[i].y,"H",points[i].x);break;case"stepAfter":for(d=["M",points[0].x,points[0].y],i=1;i<pointsLength;i++)d.push("H",points[i].x,"V",points[i].y);break;default:for(d=["M"],i=0;i<pointsLength;i++)d.push(points[i].x,points[i].y)}return(d=this.fixPathForFill(d,points,serie,idx)).join(" ")},fixPathForFill:function(d,points,serie,idx){if(0===points.length)return d;var stats=this.stats.bySerie[serie.name||idx];if(!stats.nonDecreasingX)return d;var size=this.model.get("size"),firstPoint=_.first(points),lastPoint=_.last(points),dPrefix=["M",lastPoint.x,size.height+10,"H",firstPoint.x-10,"V",firstPoint.y];return d[0]="L",dPrefix.concat(d)},updateAxis:function(){var size=this.model.get("size"),width=size.width,height=size.height,axis=this.model.get("axis"),canvasHeightRatio=this.canvas.height/height;this.canvas.width;if(V(this.elYAxisPath).attr("d",["M",0,0,"L",0,height].join(" ")),V(this.elXAxisPath).attr("d",["M",0,height,"L",width,height].join(" ")),this.elXAxisTicks.textContent="",this.elYAxisTicks.textContent="",!this.isEmpty()){var xDomain=[this.stats.minX,this.stats.maxX],yDomain=[this.stats.minY,this.stats.maxY],xRange=[this.canvas.x,this.canvas.x+this.canvas.width],yRange=[0,this.canvas.height],yDomainSpan=yDomain[1]-yDomain[0],yAxis=axis&&axis["y-axis"]||{},xAxis=axis&&axis["x-axis"]||{},ticks=0<yDomainSpan?yAxis.ticks-1||10:0,tickStep=yDomainSpan/ticks/canvasHeightRatio,y=yDomain[0];_.each(_.range(ticks+1),function(i){var ty=g.scale.linear(yDomain,yRange,y),elTick=this.elTick.clone();elTick.translate(0,ty),V(this.elYAxisTicks).append(elTick);var tickValue=yDomain[1]-(y-yDomain[0]);tickValue+=g.scale.linear(yRange,yDomain,this.canvas.y)-yDomain[0],elTick.findOne("text").text(this.tickLabel(tickValue,yAxis)),y+=tickStep},this),_.each(this.stats.xValues,function(x,i){if(i%(xAxis.tickStep||1)==0){var tx=g.scale.linear(xDomain,xRange,x);if(!(width<tx)){var elTick=this.elTick.clone();elTick.translate(tx,height),V(this.elXAxisTicks).append(elTick),elTick.findOne("text").text(this.tickLabel(x,xAxis))}}},this)}},tickLabel:function(value,opt){if(_.isFunction(opt.tickFormat))return opt.tickFormat(value);var formatSpecifier=opt.tickFormat||".1f",label=joint.util.format.number(formatSpecifier,value);return label+(_.isFunction(opt.tickSuffix)?opt.tickSuffix(value):opt.tickSuffix||"")},pointLabel:function(p,opt){if(_.isFunction(opt.pointFormat))return opt.pointFormat(p);var formatSpecifier=opt.pointFormat||".1f",label=joint.util.format.number(formatSpecifier,p.y);return label+(opt.pointSuffix||"")},updateMarkings:function(){this.elMarkings.textContent="";var markings=this.model.get("markings");if(markings&&0!==markings.length){var size=this.model.get("size"),width=size.width,height=size.height,xDomain=[this.stats.minX,this.stats.maxX],yDomain=[this.stats.minY,this.stats.maxY],xRange=[this.canvas.x,this.canvas.x+this.canvas.width],yRange=[this.canvas.y,this.canvas.y+this.canvas.height];_.each(markings,function(marking,i){var start=marking.start||marking.end,end=marking.end||marking.start,startX=Math.min(firstDefined(start.x,this.stats.minX),firstDefined(end.x,this.stats.minX)),endX=Math.max(firstDefined(start.x,this.stats.maxX),firstDefined(end.x,this.stats.maxX)),startY=Math.min(firstDefined(start.y,this.stats.minY),firstDefined(end.y,this.stats.minY)),endY=Math.max(firstDefined(start.y,this.stats.maxY),firstDefined(end.y,this.stats.maxY)),isTrendLineX=_.isUndefined(start.x)||_.isUndefined(end.x),isTrendLineY=_.isUndefined(start.y)||_.isUndefined(end.y);isTrendLineX&&(xRange=[0,width]),isTrendLineY&&(yRange=[0,height]);var startTx=g.scale.linear(xDomain,xRange,startX),endTx=g.scale.linear(xDomain,xRange,endX),startTy=g.scale.linear(yDomain,yRange,startY),endTy=g.scale.linear(yDomain,yRange,endY),mx=startTx,my=yRange[1]-endTy+yRange[0],mw=endTx-startTx,mh=endTy-startTy;mw=Math.max(mw,1),mh=Math.max(mh,1);var elMarking=this.elMarking.clone();elMarking.findOne("rect").attr({x:mx,y:my,width:mw,height:mh}),elMarking.findOne("text").text(marking.label||"").attr({x:mx+mw,y:my});var className=elMarking.attr("class")+" "+(marking.name||"marking-"+i);elMarking.attr(_.extend({class:className},marking.attrs)),V(this.elMarkings).append(elMarking)},this)}function firstDefined(a,b){return _.isUndefined(a)?b:a}},updateLegend:function(){var series=this.model.get("series");this.elLegendItems.textContent="",_.each(series,function(serie,i){if((!_.isFunction(serie.showLegend)||serie.showLegend(serie,this.stats.bySerie[serie.name||i]))&&!1!==serie.showLegend){var elLegendItem=this.elLegendItem.clone();_.contains(this._disabledSeries,serie.name)&&elLegendItem.addClass("disabled"),elLegendItem.attr("data-serie",serie.name),elLegendItem.findOne("circle").attr({fill:this.getSerieColor(serie.name)}),elLegendItem.findOne("text").text(serie.label||serie.name),elLegendItem.translate(0,i*(serie.legendLabelLineHeight||16)),V(this.elLegendItems).append(elLegendItem)}},this)},getSerieColor:function(serieName){var attrs=this.model.get("attrs"),serieAttrs=_.find(attrs,function(attr,selector){if(_.contains(selector,serieName))return!0});return serieAttrs?serieAttrs.stroke||serieAttrs.fill:"black"},hideSerie:function(serieName){_.contains(this._disabledSeries,serieName)||this._disabledSeries.push(serieName);var series=this.filterSeries();this.update(series)},showSerie:function(serieName){this._disabledSeries=_.without(this._disabledSeries,serieName);var series=this.filterSeries();this.update(series)},filterSeries:function(series){return series=series||this.model.get("series"),series=_.reject(series,function(serie){return _.contains(this._disabledSeries,serie.name)},this)},onPointerDown:function(evt,x,y){var elLegendItem=$(evt.target).closest(".legend-item")[0];elLegendItem&&(V(elLegendItem).toggleClass("disabled"),V(elLegendItem).hasClass("disabled")?this.hideSerie(V(elLegendItem).attr("data-serie")):this.showSerie(V(elLegendItem).attr("data-serie")))},onMouseMove:function(evt){this.showGuidelines(evt.clientX,evt.clientY,evt)},onMouseOut:function(evt){this.hideGuidelines(),this.trigger("mouseout",evt)},showGuidelines:function(clientX,clientY,evt){var angle=this.model.get("angle"),bbox=this.model.getBBox(),localPoint=(this.model.get("series"),g.point(V(this.paper.viewport).toLocalPoint(clientX,clientY)).rotate(bbox.center(),angle));if(g.rect(bbox).containsPoint(localPoint)){var size=this.model.get("size"),x=localPoint.x-bbox.x,y=localPoint.y-bbox.y;V(this.elXGuideline).attr({x1:x,y1:0,x2:x,y2:size.height,visibility:"visible"}),V(this.elYGuideline).attr({x1:0,y1:y,x2:size.width,y2:y,visibility:"visible"});var dataX=g.scale.linear([this.canvas.x,this.canvas.x+this.canvas.width],[this.stats.minX,this.stats.maxX],x),dataY=g.scale.linear([this.canvas.y,this.canvas.y+this.canvas.height],[this.stats.minY,this.stats.maxY],y),dataPoint={x:dataX,y:this.stats.minY+this.stats.maxY-dataY},clientPoint={x:clientX,y:clientY},closestPoints=this.closestPoints(dataX);this.trigger("mouseover",dataPoint,clientPoint,closestPoints,evt)}},closestPoints:function(x){var xValuesIndex=_.sortedIndex(this.stats.xValues,x),xValue=this.stats.xValues[xValuesIndex],xValueBefore=this.stats.xValues[xValuesIndex-1],xClosest=_.isUndefined(xValueBefore)?xValue:Math.abs(x-xValue)<Math.abs(x-xValueBefore)?xValue:xValueBefore;return this.stats.xMap[xClosest]},hideGuidelines:function(){V(this.elXGuideline).attr("visibility","hidden"),V(this.elYGuideline).attr("visibility","hidden")}}),joint.shapes.chart.Pie=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable"></g>','<g class="background"><rect/><text/></g>','<g class="data"></g>','<g class="foreground">','<rect/><text class="caption"/><text class="subcaption"/>','<g class="legend"><g class="legend-items"></g></g>',"</g>","</g>"].join(""),sliceMarkup:'<g class="slice"/>',sliceFillMarkup:'<path class="slice-fill"/>',sliceBorderMarkup:'<path class="slice-border"/>',sliceInnerLabelMarkup:'<text class="slice-inner-label"/>',legendSerieMarkup:'<g class="legend-serie"><text/></g>',legendSliceMarkup:'<g class="legend-slice"><circle/><text/></g>',defaults:joint.util.deepSupplement({type:"chart.Pie",size:{width:200,height:200},pieHole:0,serieDefaults:{startAngle:0,degree:360,label:null,showLegend:!0,labelLineHeight:6},sliceDefaults:{innerLabel:"{percentage:.0f}%",innerLabelMargin:6,legendLabel:"{label}: {value}",legendLabelLineHeight:6,legendLabelMargin:14,offset:0,onClickEffect:{type:"offset",offset:20},onHoverEffect:null},series:[],attrs:{".background > rect":{opacity:0},".background > text":{fill:"black",text:"No data available.",ref:".background > rect","ref-x":.5,"ref-y":.5,"text-anchor":"middle","y-alignment":"middle",display:"none"},".foreground > rect":{fill:"white",stroke:"#e5e5e5",opacity:0,"pointer-events":"none"},".foreground .caption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":6,"text-anchor":"start","y-alignment":"middle","font-size":14},".foreground .subcaption":{fill:"black",text:"",ref:".foreground > rect","ref-x":2,"ref-y":18,"text-anchor":"start","y-alignment":"middle","font-size":10},".data":{ref:".background","ref-x":.5,"ref-y":.5},".slice":{cursor:"pointer"},".slice > .slice-fill":{stroke:"#ffffff","stroke-width":1,"fill-opacity":1},".slice.hover > .slice-fill":{"fill-opacity":.8},".slice > .slice-border":{"stroke-width":6,"stroke-opacity":.4,"fill-opacity":1,fill:"none",display:"none"},".slice.hover > .slice-border":{display:"block"},".slice > .slice-inner-label":{"text-anchor":"middle","font-size":"12",stroke:"none","stroke-width":"0",fill:"#ffffff"},".slice > .slice-inner-label > tspan":{dy:"-.5em"},".legend":{ref:".background","ref-dx":20,"ref-y":5},".legend-serie text":{fill:"grey",transform:"translate(2, 0)","font-size":13},".legend-slice":{cursor:"pointer"},".legend-slice text":{"font-weight":"normal",fill:"black","font-size":11},".legend-slice.hover text":{"font-weight":"bold"},".legend-slice circle":{r:5,transform:"translate(5,5)"}}},joint.shapes.basic.Generic.prototype.defaults),addSlice:function(slice,serieIndex,opt){opt=opt||{},serieIndex=serieIndex||0;var series=this.get("series");_.isUndefined(series[serieIndex])&&(series[serieIndex]={data:[]});var serie=_.cloneDeep(series[serieIndex]);serie.data.push(slice),(series=series.slice())[serieIndex]=serie,opt=1<serie.data.length?_.extend(opt,{changedSerieIndex:serieIndex}):opt,this.set("series",series,opt)},editSlice:function(slice,sliceIndex,serieIndex,opt){opt=opt||{},serieIndex=serieIndex||0;var series=this.get("series");if(_.isUndefined(series[serieIndex])||_.isUndefined(series[serieIndex].data[sliceIndex]))throw new Error("Slice "+sliceIndex+" on serie "+serieIndex+" was not found.");var serie=_.cloneDeep(series[serieIndex]);serie.data[sliceIndex]=_.extend(serie.data[sliceIndex],slice),(series=series.slice())[serieIndex]=serie,this.set("series",series,_.extend(opt,{changedSerieIndex:serieIndex}))}}),joint.shapes.chart.PieView=joint.dia.ElementView.extend({events:{"mouseover .slice":"onMouseOverSlice","mouseout .slice":"onMouseOverSlice","mousemove .slice":"onMouseMoveSlice","mouseover .legend-slice":"onEventLegendItem","mouseout .legend-slice":"onEventLegendItem"},initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:series change:serieDefaults change:sliceDefaults change:pieHole",function(model,attr,opt){this.update(null,null,opt.changedSerieIndex)}),this.on("cell:pointerclick",this.onClickSlice,this),this.on("cell:pointerclick",this.onEventLegendItem,this)},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments),this.elBackgroundRect=this.$(".background rect")[0],this.elBackgroundText=this.$(".background text")[0],this.elForegroundRect=this.$(".foreground rect")[0],this.elLegendItems=this.$(".legend-items")[0],this.elPie=this.$(".data")[0],this.elSlice=V(this.model.sliceMarkup),this.elSliceFill=V(this.model.sliceFillMarkup),this.elSliceBorder=V(this.model.sliceBorderMarkup),this.elSliceInnerLabel=V(this.model.sliceInnerLabelMarkup),this.elLegendSerie=V(this.model.legendSerieMarkup),this.elLegendSlice=V(this.model.legendSliceMarkup)},update:function(cell,renderingOnlyAttrs,serieIndex){var series=this.calculateSeries(serieIndex);serieIndex in series?$(this.elPie).find(".serie-"+serieIndex).remove():$(this.elPie).empty();var size=this.model.get("size");V(this.elBackgroundRect).attr(size),V(this.elForegroundRect).attr(size),series.length?$(this.elBackgroundText).hide():$(this.elBackgroundText).show(),_.each(series,function(serie,index){!_.isUndefined(serieIndex)&&serieIndex!==index||_.each(serie.data,function(slice){this.updateSlice(slice)},this)},this),this.updateLegend(),joint.dia.ElementView.prototype.update.apply(this,arguments)},calculateSeries:function(serieIndex){var series=_.cloneDeep(this.model.get("series")),serieDefaults=this.model.get("serieDefaults"),sliceDefaults=this.model.get("sliceDefaults"),size=this.model.get("size"),radius=_.min([size.width,size.height])/2,pieHole=this.model.get("pieHole"),outerRadius=radius,radiusStep=(radius-(pieHole=1<pieHole?pieHole:radius*pieHole))/series.length;return this._series=_.map(series,function(serie,index){if(!_.isUndefined(serieIndex)&&serieIndex!==index)return serie;var startAngle=(serie=_.defaults(serie,serieDefaults)).startAngle,total=_.reduce(serie.data,function(sum,slice){return sum+slice.value},0),circleDividedByTotal=serie.degree/total||0,percentageDividedByTotal=100/total;return serie.data=_.map(serie.data,function(slice,sliceIndex){(slice=_.defaults(slice,_.omit(sliceDefaults,"offset","onClickEffect","onHoverEffect"))).outerRadius=outerRadius,slice.innerRadius=outerRadius-radiusStep,index||((slice=_.defaults(slice,_.pick(sliceDefaults,"offset","onClickEffect","onHoverEffect"))).outer=!0,slice.offset=1<slice.offset?slice.offset:slice.offset*slice.outerRadius,slice.onClickEffect.offset=1<slice.onClickEffect.offset?slice.onClickEffect.offset:slice.onClickEffect.offset*slice.outerRadius),slice.serieIndex=index,slice.sliceIndex=sliceIndex,slice.innerLabelMargin=slice.innerLabelMargin<-1||1<slice.innerLabelMargin?slice.innerLabelMargin:slice.innerLabelMargin*slice.outerRadius,slice.percentage=slice.value*percentageDividedByTotal;var angle=slice.value*circleDividedByTotal;return slice.degree={angle:angle,start:startAngle,end:angle+startAngle},slice.rad={angle:g.toRad(slice.degree.angle,!0),start:g.toRad(slice.degree.start,!0),end:g.toRad(slice.degree.end,!0)},slice.middleangle=(slice.rad.start+slice.rad.end)/2,startAngle=slice.degree.end,slice}),outerRadius-=radiusStep,serie}),this._series},updateLegend:function(){var series=this._series;this.elLegendItems.textContent="";var xPadding=0,fontSizeLegendSerieText=parseInt(this.model.attr(".legend-serie text/font-size"),10),fontSizeLegendSliceText=parseInt(this.model.attr(".legend-slice text/font-size"),10);_.each(series,function(serie,serieIndex){if(serie.showLegend){if(serie.label){var elLegendSerie=this.elLegendSerie.clone();serie.name&&elLegendSerie.addClass(serie.name),elLegendSerie.attr({"data-serie":serieIndex}),elLegendSerie.findOne("text").text(serie.label),elLegendSerie.translate(0,xPadding),V(this.elLegendItems).append(elLegendSerie),xPadding+=fontSizeLegendSerieText+serie.labelLineHeight}_.each(serie.data,function(slice,sliceIndex){var elLegendSlice=this.elLegendSlice.clone(),slicefillColor=this.getSliceFillColor(sliceIndex,serieIndex);slice.name&&elLegendSlice.addClass(slice.name),elLegendSlice.attr({"data-serie":serieIndex,"data-slice":sliceIndex}),elLegendSlice.findOne("circle").attr({fill:slicefillColor}),elLegendSlice.findOne("text").text(joint.util.format.string(slice.legendLabel,slice)),elLegendSlice.findOne("text").translate(slice.legendLabelMargin),elLegendSlice.translate(0,xPadding),xPadding+=fontSizeLegendSliceText+slice.legendLabelLineHeight,V(this.elLegendItems).append(elLegendSlice),_.isObject(slicefillColor)&&this.applyGradient("#"+elLegendSlice.findOne("circle").attr("id"),"fill",slicefillColor)},this)}},this)},updateSlice:function(slice){var elSlice=this.elSlice.clone();V(this.elPie).append(elSlice);var elSliceFill=this.elSliceFill.clone(),slicefillColor=this.getSliceFillColor(slice.sliceIndex,slice.serieIndex);elSliceFill.attr({fill:slicefillColor,d:V.createSlicePathData(slice.innerRadius,slice.outerRadius,slice.rad.start,slice.rad.end)}),elSlice.append(elSliceFill),_.isObject(slicefillColor)&&this.applyGradient("#"+elSliceFill.attr("id"),"fill",slicefillColor);var elSliceBorder=this.elSliceBorder.clone(),borderStrokeWidth=parseInt(this.model.attr(".slice > .slice-border/stroke-width"),10),startPoint=g.point.fromPolar(slice.outerRadius+borderStrokeWidth/2,-slice.rad.start,g.point(0,0)),endPoint=g.point.fromPolar(slice.outerRadius+borderStrokeWidth/2,-slice.rad.end,g.point(0,0));elSliceBorder.attr({stroke:slicefillColor,d:this.drawArc(startPoint,endPoint,slice.outerRadius+borderStrokeWidth/2,slice.rad.start,slice.rad.end)}),elSlice.append(elSliceBorder),_.isObject(slicefillColor)&&this.applyGradient("#"+elSliceBorder.attr("id"),"stroke",slicefillColor);var elSliceInnerLabel=this.elSliceInnerLabel.clone();elSliceInnerLabel.text(joint.util.format.string(slice.innerLabel,slice)),elSlice.append(elSliceInnerLabel);var innerLabelBbox=elSliceInnerLabel.bbox(),radiusLabel=slice.outerRadius-innerLabelBbox.width/2-slice.innerLabelMargin;elSliceInnerLabel.translate(radiusLabel*Math.cos(-slice.middleangle),-radiusLabel*Math.sin(-slice.middleangle)),elSlice.attr({"data-serie":slice.serieIndex,"data-slice":slice.sliceIndex,"data-value":slice.value});var nameSerie=this._series[slice.serieIndex].name;return nameSerie&&elSlice.addClass(nameSerie),slice.name&&elSlice.addClass(slice.name),elSlice.addClass("serie-"+slice.serieIndex+" slice-"+slice.sliceIndex),slice.outer&&(elSlice.addClass("outer"),slice.offset&&(elSlice.addClass("clicked"),this.effectOnSlice(elSlice,slice,{type:"offset",offset:slice.offset}))),elSlice},getSliceFillColor:function(sliceIndex,serieIndex){serieIndex=serieIndex||0;var attrs=this.model.get("attrs"),sliceFillAttr=_.find(attrs,function(attr,selector){return-1<selector.indexOf(".serie-"+serieIndex+".slice-"+sliceIndex+" > .slice-fill")});return sliceFillAttr?sliceFillAttr.fill:this._series[serieIndex].data[sliceIndex].fill},onMouseMoveSlice:function(event){var elSlice=V(event.currentTarget),serieIndex=elSlice.attr("data-serie"),sliceIndex=elSlice.attr("data-slice"),slice=this._series[serieIndex].data[sliceIndex];this.trigger(event.type,slice,event)},mouseOverSlice:function(sliceIndex,serieIndex){serieIndex=serieIndex||0;var elSlice=V(this.$('.slice[data-serie="'+serieIndex+'"][data-slice="'+sliceIndex+'"]')[0]),slice=this._series[serieIndex].data[sliceIndex];elSlice.toggleClass("hover"),slice.outer&&!_.isEmpty(slice.onHoverEffect)&&this.effectOnSlice(elSlice,slice,slice.onHoverEffect,!elSlice.hasClass("hover"));var elLegendSlice=V(this.$('.legend-slice[data-serie="'+serieIndex+'"][data-slice="'+sliceIndex+'"]')[0]);elLegendSlice&&elLegendSlice.toggleClass("hover");var attrsForSliceAndLegend=_.filter(_.keys(this.model.get("attrs")),function(selector){return-1<selector.indexOf(".slice")||-1<selector.indexOf(".legend-slice")});joint.dia.ElementView.prototype.update.call(this,this.model,_.pick(this.model.get("attrs"),attrsForSliceAndLegend))},onMouseOverSlice:function(event){var elSlice=V(event.currentTarget),serieIndex=elSlice.attr("data-serie"),sliceIndex=elSlice.attr("data-slice");this.mouseOverSlice(sliceIndex,serieIndex);var slice=this._series[serieIndex].data[sliceIndex];this.trigger(event.type,slice,event)},clickSlice:function(sliceIndex,serieIndex){serieIndex=serieIndex||0;var elSlice=V(this.$('.slice[data-serie="'+serieIndex+'"][data-slice="'+sliceIndex+'"]')[0]),slice=this._series[serieIndex].data[sliceIndex];slice.outer&&(elSlice.hasClass("clicked")?(elSlice.removeClass("clicked"),this.model.get("series")[serieIndex].data[sliceIndex].offset=0,this.effectOnSlice(elSlice,slice,slice.onClickEffect,!0)):(elSlice.addClass("clicked"),this.model.get("series")[serieIndex].data[sliceIndex].offset=slice.onClickEffect.offset,this.effectOnSlice(elSlice,slice,slice.onClickEffect)))},onClickSlice:function(event){var elSlice=V($(event.target).closest(".slice.outer")[0]);if(elSlice){var serieIndex=elSlice.attr("data-serie"),sliceIndex=elSlice.attr("data-slice");this.clickSlice(sliceIndex,serieIndex);var slice=this._series[serieIndex].data[sliceIndex];this.trigger(event.type,slice,event)}},onEventLegendItem:function(event){var elLegendItem=V($(event.target).closest(".legend-slice")[0]);if(elLegendItem){var serieIndex=elLegendItem.attr("data-serie"),sliceIndex=elLegendItem.attr("data-slice");switch(event.type){case"click":this.clickSlice(sliceIndex,serieIndex);break;case"mouseover":case"mouseout":this.mouseOverSlice(sliceIndex,serieIndex)}}},effectOnSlice:function(elSlice,slice,effect,remove){switch(remove=remove||!1,effect.type){case"enlarge":remove?elSlice.scale(1):elSlice.scale(effect.scale||1.05);break;case"offset":remove?elSlice.translate(0,0,{absolute:!0}):elSlice.translate(effect.offset*Math.cos(-slice.middleangle),-effect.offset*Math.sin(-slice.middleangle))}},svgArcMax:2*Math.PI-1e-6,drawArc:function(startPoint,endPoint,radius,startAngle,endAngle){var largeArcFlag=0,sweepFlag=1,angle=endAngle-startAngle;return angle>Math.PI&&(largeArcFlag=1,angle>=this.svgArcMax&&(sweepFlag=largeArcFlag=0)),"M"+startPoint.x+","+startPoint.y+" A"+radius+","+radius+" 0 "+largeArcFlag+","+sweepFlag+" "+endPoint.x+","+endPoint.y}}),joint.shapes.chart.Knob=joint.shapes.chart.Pie.extend({defaults:joint.util.deepSupplement({type:"chart.Knob",sliceDefaults:{legendLabel:"{value:.0f}",outer:{offsetOnClick:0}},pieHole:.7,value:0,attrs:{".legend":{"ref-x":.5,"ref-y":.5,"x-alignment":-.9,"y-alignment":-.4},".legend-slice text":{"font-size":30},".legend-slice circle":{display:"none"},".slice-inner-label":{display:"none"},".slice-fill":{stroke:"none"}}},joint.shapes.chart.Pie.prototype.defaults),initialize:function(){this.set("series",this.getKnobSeries(),{silent:!0}),joint.shapes.chart.Pie.prototype.initialize.apply(this,arguments),this.on("change:value change:min change:max change:fill",this.updateKnob,this)},getKnobSeries:function(){var values=_.isArray(this.get("value"))?this.get("value"):[this.get("value")],fills=_.isArray(this.get("fill"))?this.get("fill"):[this.get("fill")],mins=_.isArray(this.get("min"))?this.get("min"):[this.get("min")],maxs=_.isArray(this.get("max"))?this.get("max"):[this.get("max")],series=_.map(values,function(value,i){var min=_.isUndefined(mins[i])?mins[0]:mins[i],max=_.isUndefined(maxs[i])?maxs[0]:maxs[i],fill=_.isUndefined(fills[i])?fills[0]:fills[i];return{degree:g.scale.linear([min,max],[0,360],value),data:[{value:value,fill:fill}],showLegend:!(0<i)}});return series},updateKnob:function(){this.set("series",this.getKnobSeries())}}),joint.shapes.chart.KnobView=joint.shapes.chart.PieView,joint.shapes.chart.Matrix=joint.shapes.basic.Generic.extend({markup:['<g class="rotatable">','<g class="scalable">','<g class="background"><rect/></g>','<g class="cells"/>','<g class="foreground"/>',"</g>",'<g class="labels">','<g class="rows"/>','<g class="columns"/>',"</g>","</g>"].join(""),cellMarkup:'<rect class="cell"/>',labelMarkup:'<text class="label"/>',gridLineMarkup:'<path class="grid-line"/>',defaults:joint.util.deepSupplement({type:"chart.Matrix",attrs:{".background rect":{fill:"#eeeeee"},".grid-line":{stroke:"white","stroke-width":2},".label":{fill:"black","alignment-baseline":"middle"},".labels .rows .label":{"text-anchor":"end"},".labels .columns .label":{"text-anchor":"start"}}},joint.shapes.basic.Generic.prototype.defaults)}),joint.shapes.chart.MatrixView=joint.dia.ElementView.extend({initialize:function(){joint.dia.ElementView.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"change:size",function(){this.renderLabels(),this.update()}),this.listenTo(this.model,"change:cells",function(){this.renderMarkup(),this.update()})},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments),this.elCells=this.$(".cells")[0],this.elRowLabels=this.$(".labels .rows")[0],this.elColumnLabels=this.$(".labels .columns")[0],this.elForeground=this.$(".foreground")[0],this.elCell=V(this.model.cellMarkup),this.elGridLine=V(this.model.gridLineMarkup);var cells=this.model.get("cells")||[],size=this.model.get("size");this.elBackgroundRect=this.$(".background rect")[0],V(this.elBackgroundRect).attr(size);var cellHeight=size.height/cells.length,cellWidth=size.width/cells.length,elCellsFragment=document.createDocumentFragment();this.elCells.textContent="",this.elForeground.textContent="";for(var elGridLinesFragment=document.createDocumentFragment(),i=0;i<cells.length;i++){var elGridLine=this.elGridLine.clone();elGridLine.addClass("horizontal"),elGridLine.attr("d","M 0 "+i*cellHeight+" "+size.width+" "+i*cellHeight),elGridLinesFragment.appendChild(elGridLine.node);for(var row=cells[i],j=0;j<row.length;j++){if(0===i){var elGridLine=this.elGridLine.clone();elGridLine.addClass("vertical"),elGridLine.attr("d","M "+j*cellWidth+" 0 "+j*cellWidth+" "+size.height),elGridLinesFragment.appendChild(elGridLine.node)}var cell=row[j];if(cell){var elCell=this.elCell.clone();elCell.attr(_.extend({x:j*cellWidth,y:i*cellHeight,width:cellWidth,height:cellHeight},cell)),elCellsFragment.appendChild(elCell.node)}}}this.elForeground.appendChild(elGridLinesFragment),this.elCells.appendChild(elCellsFragment),this.renderLabels()},renderLabels:function(){this.elLabel=V(this.model.labelMarkup);var cells=this.model.get("cells")||[],labels=this.model.get("labels")||{},rowLabels=labels.rows||[],columnLabels=labels.columns||[],size=this.model.get("size"),cellHeight=size.height/cells.length,cellWidth=size.width/cells.length;this.elRowLabels.textContent="",this.elColumnLabels.textContent="";for(var elRowLabelsFragment=document.createDocumentFragment(),i=0;i<rowLabels.length;i++){var label=labels.rows[i],elLabel=this.elLabel.clone();elLabel.text(label.text),elLabel.attr(_.extend({x:-(labels.padding||5),y:i*cellHeight+cellHeight/2,"text-anchor":"end","alignment-baseline":"middle","font-size":cellHeight,"data-row":i},_.omit(label,"text"))),elRowLabelsFragment.appendChild(elLabel.node)}this.elRowLabels.appendChild(elRowLabelsFragment);for(var elColumnLabelsFragment=document.createDocumentFragment(),j=0;j<columnLabels.length;j++){var label=labels.columns[j],elLabel=this.elLabel.clone();elLabel.text(label.text);var x=j*cellWidth+cellWidth/2,y=-(labels.padding||5);elLabel.attr(_.extend({x:x,y:y,"text-anchor":"start","alignment-baseline":"middle","font-size":cellWidth,"data-column":j},_.omit(label,"text"))),elLabel.rotate(-90,x,y),elColumnLabelsFragment.appendChild(elLabel.node)}this.elColumnLabels.appendChild(elColumnLabelsFragment)}}),joint.shapes.bpmn={},joint.shapes.bpmn.icons={none:"",message:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIGhlaWdodD0iNTEycHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiB3aWR0aD0iNTEycHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik00NzkuOTk4LDY0SDMyQzE0LjMyOSw2NCwwLDc4LjMxMiwwLDk2djMyMGMwLDE3LjY4OCwxNC4zMjksMzIsMzIsMzJoNDQ3Ljk5OEM0OTcuNjcxLDQ0OCw1MTIsNDMzLjY4OCw1MTIsNDE2Vjk2ICBDNTEyLDc4LjMxMiw0OTcuNjcxLDY0LDQ3OS45OTgsNjR6IE00MTYsMTI4TDI1NiwyNTZMOTYsMTI4SDQxNnogTTQ0OCwzODRINjRWMTYwbDE5MiwxNjBsMTkyLTE2MFYzODR6Ii8+PC9zdmc+",plus:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLjUsMTRIMTR2OC41YzAsMC4yNzYtMC4yMjQsMC41LTAuNSwwLjVoLTRDOS4yMjQsMjMsOSwyMi43NzYsOSwyMi41VjE0SDAuNSAgQzAuMjI0LDE0LDAsMTMuNzc2LDAsMTMuNXYtNEMwLDkuMjI0LDAuMjI0LDksMC41LDlIOVYwLjVDOSwwLjIyNCw5LjIyNCwwLDkuNSwwaDRDMTMuNzc2LDAsMTQsMC4yMjQsMTQsMC41VjloOC41ICBDMjIuNzc2LDksMjMsOS4yMjQsMjMsOS41djRDMjMsMTMuNzc2LDIyLjc3NiwxNCwyMi41LDE0eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",cross:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGQ9Ik0yMi4yNDUsNC4wMTVjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjEzOWwtNi4yNzYsNi4yN2MtMC4zMTMsMC4zMTItMC4zMTMsMC44MjYsMCwxLjE0bDYuMjczLDYuMjcyICBjMC4zMTMsMC4zMTMsMC4zMTMsMC44MjYsMCwxLjE0bC0yLjI4NSwyLjI3N2MtMC4zMTQsMC4zMTItMC44MjgsMC4zMTItMS4xNDIsMGwtNi4yNzEtNi4yNzFjLTAuMzEzLTAuMzEzLTAuODI4LTAuMzEzLTEuMTQxLDAgIGwtNi4yNzYsNi4yNjdjLTAuMzEzLDAuMzEzLTAuODI4LDAuMzEzLTEuMTQxLDBsLTIuMjgyLTIuMjhjLTAuMzEzLTAuMzEzLTAuMzEzLTAuODI2LDAtMS4xNGw2LjI3OC02LjI2OSAgYzAuMzEzLTAuMzEyLDAuMzEzLTAuODI2LDAtMS4xNEwxLjcwOSw1LjE0N2MtMC4zMTQtMC4zMTMtMC4zMTQtMC44MjcsMC0xLjE0bDIuMjg0LTIuMjc4QzQuMzA4LDEuNDE3LDQuODIxLDEuNDE3LDUuMTM1LDEuNzMgIEwxMS40MDUsOGMwLjMxNCwwLjMxNCwwLjgyOCwwLjMxNCwxLjE0MSwwLjAwMWw2LjI3Ni02LjI2N2MwLjMxMi0wLjMxMiwwLjgyNi0wLjMxMiwxLjE0MSwwTDIyLjI0NSw0LjAxNXoiLz48L3N2Zz4=",user:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/PjwhRE9DVFlQRSBzdmcgIFBVQkxJQyAnLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4nICAnaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkJz48c3ZnIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIGlkPSJMYXllcl8xIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxwYXRoIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTIyLDIwLjk5OGgtMWMwLDAtMSwwLTEtMVYxNy41YzAtMC4yNzctMC4yMjQtMC41LTAuNS0wLjVTMTksMTcuMjIzLDE5LDE3LjUgIGwtMC4wMDgsNC4yOTVjMCwwLjYwOS0yLjAxLDIuMjA1LTYuNDkyLDIuMjA1cy02LjQ5Mi0xLjU5Ni02LjQ5Mi0yLjIwNUw2LDE3LjVDNiwxNy4yMjMsNS43NzYsMTcsNS41LDE3UzUsMTcuMjIzLDUsMTcuNXYyLjQ5OCAgYzAsMS0xLDEtMSwxSDNjMCwwLTEsMC0xLTFWMTUuNzVjMC0yLjkyMiwyLjg5Mi01LjQwMSw2LjkzLTYuMzQxYzAsMCwxLjIzNCwxLjEwNywzLjU3LDEuMTA3czMuNTctMS4xMDcsMy41Ny0xLjEwNyAgYzQuMDM4LDAuOTQsNi45MywzLjQxOSw2LjkzLDYuMzQxdjQuMjQ4QzIzLDIwLjk5OCwyMiwyMC45OTgsMjIsMjAuOTk4eiBNMTIuNDc3LDljLTIuNDg1LDAtNC41LTIuMDE1LTQuNS00LjVTOS45OTEsMCwxMi40NzcsMCAgczQuNSwyLjAxNSw0LjUsNC41UzE0Ljk2Miw5LDEyLjQ3Nyw5eiIgZmlsbC1ydWxlPSJldmVub2RkIi8+PC9zdmc+",circle:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gULEBE3DEP64QAAAwlJREFUaN7dmktrU0EUx38ZmmBbfEIL2hSjkYKC1EW6EDFudC+404/gE6WKSvGxERQfIH4AX1T9EOKrCrYurVrbgsZWoaBVixDbpC6ci+Fyz9ybZG478cBs7syc+Z+5c86c+c8ksCPrgW1ADtgEbARafG1+AW+AYWAIGADGWUTZAJwHxoD5GssocA7ILiTwLcADoFQHcH8pAfeB7jiBtwO3gLJF4P5S1mO02wa/C5iMEbi/TAI7bYE/Y3m5VLOs+sLAJULqrgKHIxhZBp4DT4FX2jkLGoinq1M7fg7YDmwFVATd14CjFboiy5UIs/QBOAmka/izaeCU1hE2zuVqlZ8IUfgVOAA0WViiTcBBrdM0Zm9UhTuAOYOiRzXOeJh0Ak8M484B+TAlK4BPBiU3gWSMoTqpw6g0fgFYblJww9D5dojT25IEcMeA47rUsdsQLp9FmPmURSNSOqpJS2lzUKd+ocN3IBNx5mz+oXXADwHTXX/jjMFxjy1iwtgrYJoF1lY27BMafozZaaMspYKA7XRlw7f1xt4Y5biA7bXXIGv4TW0OGNCmsQRhzCidlwTJADDlgAFTwAuhLq+AHqHyMe6IhKVHAV1C5ZBDBkhYupThPPreIQNGJTJBGXKLLw4Z8NmQu/Fb8PCkQwakBIxFRWPLvAJmhMpWh4AuFb7PKGBaqFzjkAGrhe/TSjNrQZJ1yAAJy5gCRoTKnEMGSFhGFDBoOBu7IhKWQe8wLRFLHQ6A7zCcFNNK59vvAjoqYK8DBuwTCLBhTUD8Hweahj9S2jjU297VqzrU26BVmi2yEjXRKg1PbHnpqYla7AeWxAi+GbhHHdSit2mYyN2XQQ5kQTJ6Y6qL3PUkCr2+H7v0+jcs0eueRLngGNeKa9mxY73g8JzpEtHusorAQ/7e+e7WUWIl//jSVTrK7QEu6KgW9d7tYr3B44iBWPJfkZZ8pZ4r2VngkC0HywMTLNwN5YSBcKtZWoGzernEBbyox2iJc6Np2KcGfnHisYet1CDouc2yCjbhp07MrD+3+QNxi4JkAscRswAAAABJRU5ErkJggg==",service:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAB1RJREFUeNrMWltMVFcUHZAIRSAkSFACITRAVbQ/DVhHiRZC2y9jotFgqgmxKqShKdFCggZbEpP2h1Q/oLUg8GH0xy/LKwpDEEFsjKCM8kYkgAhTpggDMzCc7kX2mGF677w80J5khbnnntc+Zz/W2ReNxvsSQLhPWCBYGPhdTdjg7aBCCI/gVSfu+CHBfPz48ba7d+82AocOHfqT6mYIEV6Oua4CfE6YHxsbeyS49Pf3P6C6RYJ2vQTwVTtKHx+fXYRzhM0qTbYR/g4JCQmyVYSFhQXTHyMhUWXMzTzmTo3MorATHxH0eEXAriYrtCmNiop6tby8bLCdgNVqfR0ZGTlC735RaJ/EY+HhGSFhTVSIyg7CIO3mRHNzs44WOYydJuQQ/AjxhJ9hsFqt9qlwKElJSRB8nvAjIYYN+hucDMbCmMHBwZP03E/YLlUAKh8TnoSHh49NT0+vLG5paWk0JyfnPu9cJ8EUGho6cfTo0fbBwcFWRwH6+vpaYcy0yCk26Hb0zc7ObsFYaIOxaY5xqn9M2ClTgGw8wqM4LuzevXu6xMTEnitXrjTOz8/3Chfl7du3Ly5fvtyUkJDQrzRedXV1I2/KWZkCwCDrsMMWi+WV46Sk42+EhwV24VhnNpuHaY43NFct5pRtA7tw9BkZGQ/peVHIL+bDhw8/YrtKXJM4QOVrVNfV1TXKXr2d6mTK8EI+tk4KPrszNjY2mIJTiK+vb5iK+zX29vbqW1paLNRe7N271590PpF+hyq1hzpt3bpVTE5ODlDfFIU5FdfiTRxAkDKVlpY2QI2VVNvOHUIVXjJmUEcC6Rz7keGLffv2CdoMK5/AogzupCZA8aZNmwxkbEMKi18sKSmxqcF1QjohmgF6UYl3LPw7GxoYGBAbN24U+fn5puLi4qWqqqoBGdwJxZ+J2ZeEXF6U9dixYw+VdLi1tbWJF3/aycBn0aa9vb3J1q++vl4EBARAfYRM7oTSwpFzjjAeExMznJ6e/mRkZORfAoA20Mn8Re3KFAaD9zpH2MzP13GK1GcafSl+iIiICGEymd6Nh4BG7SbVNgNj8Zg7nQmwdPLkybahoaG22dnZbntu41i6u7sh7CzhM1fciZCKTUEf9M3KyhLJycnYBCGTO6FYmpqa3HKX5eXlDWysUW5wp0K0LSoqasvLyxP+/v7ixIkTQjZ3WhFAR8UbAdzgTmY/Pz9rfHy8KCgoEKOjo0I2d1pxzxhAr9e3GI3GZ87ogp0KpbriTrdv3+6ghS9XVlYaFxYWxFpxJ5QaltxMeAOOf+DAgQ4VI55mIy53hzuRx7GuNXfSsM5FwJURzhBK3HSjZ/8P3MmrQIYgxUJUcvDKx/OtW7c61ps7ObtSziHiqlEJ0AU+VqgfPI8lOjraajAYVNUGKgg7Kisra4RDwG9bnFAqZMTjcBBI3ziLA0ovQPL0cXFxg6STU84W1NPT8+DSpUtt8DY3btwwqqm2p9zJ1q+wsBAqC7uL9EQA3H+Fu+41NzdXkPELMmQhizvZeSc9bQ5OucAtATiKLsAPK+0KXCKIWW1trSBSJjIzM8EwxYULF4RM7mRf0tLSnrCX/JXwLW9CLPO4VVfKcHAj4kMvldwZ6ojzr5CywMBAsWXLFrFnz54VmjAxMSE84U4KQqziTvYFapqSktIJnkbtXjNvW+DU5ioB8vDIOrlq7Xfu3GmgINNHl47lixcvIiO3QszsuY273ElFgFXcSSVGTBFfew7eBv4GHucoAHz6Y+I1r23UgFRmED6e1QD8XZBOW7zlTk4EgE28rKioaHBnbNgnPJ+vw8UGrO8rcoVzdJ2MqKmp0ZEbC7l58yaSWacJn0LqoKCgcc1/XOg0nHqhBDt6XI+TsXvnNXdycQJpUCHouzOagTkxN9/mrKqZAE7QgloEOtR7zZ1cCFABRqpkxNgIMuKnmIsvQGaOJ9UepzLelzupjJnlzI2mpqZ28KKvcspHy2vY4I0AMrhTDOMLQhXeXbt2zftAJikd7yl3AmZAxXFK3lIJH08lUUo++aBSo+ki7vQBGaHTRBjdwJ7TghGENFqtNoAuPTvUEmFkDxN0Z7ZSkBymvlqltUj5DOQpd/Kk4HbG6pct5fuYp9xJQlk8depUK1/8P5EqgDvcydPV4g6gVMcutNmWd5IlgEvuhA8ixJl63LjU64uKinS4g+AW5niauE+wKn0vUwB3uNMcvM+RI0faQcKU0ioHDx60pVWMtmQWvj9jLFtaBXNwWmWXbBvYThiAO8TO8UIMHHAQaOIIPyEQ7d+/v9NRgN27d3exfv/AhG4D9zVgLIzJ7heJrW3SjdgVd7Jr8zsybfZUATyKU4tXVXKt9Txml2pqUdbXdDXuZPf+OySPkX+1CQBixtzmjEqfQL6tJaqtxU/ix3I9n4JaeUEInZmZGSHasVIxNTU1wx9TulTGNNGf35zN67eOFL6X4Hv+/Hkr3aN14PNEPYL5atgvjde4+1HBy3/PaXb49xwwzD/eZyP/EWAAQ3AUnjpOYHIAAAAASUVORK5CYII="},joint.shapes.bpmn.IconInterface={initialize:function(){this._parent=(this._parent||this).constructor.__super__,this._parent.initialize.apply(this,arguments),this.listenTo(this,"change:icon",this._onIconChange),this._onIconChange(this,this.get("icon")||"none")},_onIconChange:function(cell,icon){var icons=joint.shapes.bpmn.icons;if(!_.has(icons,icon))throw"BPMN: Unknown icon: "+icon;cell.attr("image/xlink:href",icons[icon])}},joint.shapes.bpmn.SubProcessInterface={initialize:function(){this._parent=(this._parent||this).constructor.__super__,this._parent.initialize.apply(this,arguments),this.listenTo(this,"change:subProcess",this._onSubProcessChange),this._onSubProcessChange(this,this.get("subProcess")||null)},_onSubProcessChange:function(cell,subProcess){cell.attr({".sub-process":{visibility:subProcess?"visible":"hidden","data-sub-process":subProcess||""}})}},joint.shapes.bpmn.ActivityView=joint.shapes.basic.TextBlockView,joint.shapes.bpmn.Activity=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body outer"/><rect class="body inner"/></g>',joint.env.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<path class="sub-process"/><image class="icon"/></g>'].join(""),defaults:joint.util.deepSupplement({size:{width:100,height:100},type:"bpmn.Activity",attrs:{rect:{rx:8,ry:8,width:100,height:100},".body":{fill:"#ffffff",stroke:"#000000"},".inner":{transform:"scale(0.9,0.9) translate(5,5)"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".inner","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",stroke:"#000000",fill:"transparent"},image:{ref:".inner","ref-x":5,width:20,height:20}},activityType:"task",subProcess:null},joint.shapes.basic.TextBlock.prototype.defaults),initialize:function(){joint.shapes.basic.TextBlock.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:activityType",this.onActivityTypeChange),this.listenTo(this,"change:subProcess",this.onSubProcessChange),this.onSubProcessChange(this,this.get("subProcess")),this.onActivityTypeChange(this,this.get("activityType"))},onActivityTypeChange:function(cell,type){switch(type){case"task":cell.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;case"transaction":cell.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1,"stroke-dasharray":"none"},path:{ref:".inner"},image:{ref:".inner"}});break;case"event-sub-process":cell.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1,"stroke-dasharray":"1,2"},path:{ref:".outer"},image:{ref:".outer"}});break;case"call-activity":cell.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5,"stroke-dasharray":"none"},path:{ref:".outer"},image:{ref:".outer"}});break;default:throw"BPMN: Unknown Activity Type: "+type}},onSubProcessChange:function(cell,subProcess){subProcess?cell.attr({".fobj div":{style:{verticalAlign:"baseline",paddingTop:10}},image:{"ref-dy":-25,"ref-y":""},text:{"ref-y":25}}):cell.attr({".fobj div":{style:{verticalAlign:"middle",paddingTop:0}},image:{"ref-dy":"","ref-y":5},text:{"ref-y":.5}})}}).extend(joint.shapes.bpmn.IconInterface).extend(joint.shapes.bpmn.SubProcessInterface),joint.shapes.bpmn.AnnotationView=joint.shapes.basic.TextBlockView,joint.shapes.bpmn.Annotation=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',joint.env.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<path class="stroke"/></g>'].join(""),defaults:joint.util.deepSupplement({size:{width:100,height:100},type:"bpmn.Annotation",attrs:{rect:{width:100,height:100},".body":{"fill-opacity":.1,fill:"#ffffff",stroke:"none"},".fobj div":{style:{textAlign:"left",paddingLeft:10}},".stroke":{stroke:"#000000",fill:"none","stroke-width":3}},wingLength:20},joint.shapes.basic.TextBlock.prototype.defaults),initialize:function(){joint.shapes.basic.TextBlock.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:size",this.onSizeChange),this.onSizeChange(this,this.get("size"))},onSizeChange:function(cell,size){cell.attr(".stroke",{d:cell.getStrokePathData(size.width,size.height,cell.get("wingLength"))})},getStrokePathData:function(width,height,wingLength){return["M",wingLength=Math.min(wingLength,width),"0 L 0 0 0",height,wingLength,height].join(" ")}}),joint.shapes.bpmn.Gateway=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/><image/></g></g><text class="label"/>',defaults:joint.util.deepSupplement({type:"bpmn.Gateway",size:{width:80,height:80},attrs:{".body":{points:"40,0 80,40 40,80 0,40",fill:"#ffffff",stroke:"#000000"},".label":{text:"",ref:".body","ref-x":.5,"ref-dy":20,"y-alignment":"middle","x-alignment":"middle","font-size":14,"font-family":"Arial, helvetica, sans-serif",fill:"#000000"},image:{width:40,height:40,"xlink:href":"",transform:"translate(20,20)"}}},joint.dia.Element.prototype.defaults)}).extend(joint.shapes.bpmn.IconInterface),joint.shapes.bpmn.Event=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><circle class="body outer"/><circle class="body inner"/><image/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Event",size:{width:60,height:60},attrs:{".body":{fill:"#ffffff",stroke:"#000000"},".outer":{"stroke-width":1,r:30,transform:"translate(30,30)"},".inner":{"stroke-width":1,r:26,transform:"translate(30,30)"},image:{width:40,height:40,"xlink:href":"",transform:"translate(10,10)"},".label":{text:"",fill:"#000000","font-family":"Arial","font-size":14,ref:".outer","ref-x":.5,"ref-dy":20,"x-alignment":"middle","y-alignment":"middle"}},eventType:"start"},joint.dia.Element.prototype.defaults),initialize:function(){joint.dia.Element.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:eventType",this.onEventTypeChange),this.onEventTypeChange(this,this.get("eventType"))},onEventTypeChange:function(cell,type){switch(type){case"start":cell.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":1}});break;case"end":cell.attr({".inner":{visibility:"hidden"},".outer":{"stroke-width":5}});break;case"intermediate":cell.attr({".inner":{visibility:"visible"},".outer":{"stroke-width":1}});break;default:throw"BPMN: Unknown Event Type: "+type}}}).extend(joint.shapes.bpmn.IconInterface),joint.shapes.bpmn.Pool=joint.dia.Element.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>','<svg overflow="hidden" class="blackbox-wrap"><text class="blackbox-label"/></svg>','<rect class="header"/><text class="label"/>','<g class="lanes"/>',"</g>"].join(""),laneMarkup:'<g class="lane"><rect class="lane-body"/><rect class="lane-header"/><text class="lane-label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Pool",size:{width:600,height:300},attrs:{".body":{fill:"#ffffff",stroke:"#000000",width:500,height:200,"pointer-events":"stroke"},".header":{fill:"#ffffff",stroke:"#000000",width:20,ref:".body","ref-height":1,"pointer-events":"visiblePainted"},".label":{fill:"#000000",transform:"rotate(-90)",ref:".header","ref-x":10,"ref-y":.5,"font-family":"Arial","font-size":14,"x-alignment":"middle","text-anchor":"middle"},".lane-body":{fill:"#ffffff",stroke:"#000000","pointer-events":"stroke"},".lane-header":{fill:"#ffffff",stroke:"#000000","pointer-events":"visiblePainted"},".lane-label":{fill:"#000000",transform:"rotate(-90)","text-anchor":"middle","font-family":"Arial","font-size":13},".blackbox-wrap":{ref:".body","ref-width":1,"ref-height":1},".blackbox-label":{text:"Black Box","text-anchor":"middle",transform:"translate(0,-7)"},".blackbox-label > tspan":{dx:"50%",dy:"50%"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.bpmn.PoolView=joint.dia.ElementView.extend({options:{headerWidth:20},initialize:function(){this.listenTo(this.model,"change:lanes",function(cell,lanes){this.renderLanes(lanes)}),joint.dia.ElementView.prototype.initialize.apply(this,arguments)},update:function(){return _.isUndefined(this.lanesAttrs)?this.renderLanes(this.model.get("lanes")):joint.dia.ElementView.prototype.update.call(this,this.model,_.merge({},this.model.get("attrs"),this.lanesAttrs||{}))},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments),this.$lanes=this.$(".lanes"),this.laneMarkup=V(this.model.laneMarkup)},renderLanes:function(lanes){lanes=lanes||{},this.index=0,this.lanesAttrs={".header":{width:this.options.headerWidth},".label":{text:lanes.label||""}},this.$lanes.empty(),lanes.sublanes&&this.renderSublanes(lanes.sublanes,0,0,1),this.update(this.model,_.merge({},this.model.get("attrs"),this.lanesAttrs))},renderSublanes:function(lanes,prevX,prevY,prevRatio){var headerWidth=this.options.headerWidth,ratio=1/lanes.length*prevRatio;_.each(lanes,function(lane,index){var className="lane"+this.index,bodySelector="."+className+" .lane-body",headerSelector="."+className+" .lane-header",labelSelector="."+className+" .lane-label";lane.name&&(className+=" "+lane.name),this.$lanes.append(this.laneMarkup.clone().addClass(className).node);var x=prevX+headerWidth,y=prevY+ratio*index;this.lanesAttrs[bodySelector]={ref:".body","ref-height":ratio,"ref-width":-x,"ref-x":x,"ref-y":y},this.lanesAttrs[headerSelector]={width:headerWidth,ref:".body","ref-height":ratio,"ref-x":x,"ref-y":y},this.lanesAttrs[labelSelector]={text:lane.label,ref:headerSelector,"ref-x":10,"ref-y":.5,"x-alignment":"middle"},this.index++,lane.sublanes&&this.renderSublanes(lane.sublanes,x,y,ratio)},this)}}),joint.shapes.bpmn.Group=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><rect class="body"/></g><rect class="label-rect"/><g class="label-group"><svg overflow="hidden" class="label-wrap"><text class="label"/></svg></g></g>',defaults:joint.util.deepSupplement({type:"bpmn.Group",size:{width:200,height:200},attrs:{".body":{width:200,height:200,stroke:"#000000","stroke-dasharray":"6,6","stroke-width":2,fill:"transparent",rx:15,ry:15,"pointer-events":"stroke"},".label-rect":{ref:".body","ref-width":.6,"ref-x":.4,"ref-y":-30,height:25,fill:"#ffffff",stroke:"#000000"},".label-group":{ref:".label-rect","ref-x":0,"ref-y":0},".label-wrap":{ref:".label-rect","ref-width":1,"ref-height":1},".label":{text:"",x:"50%",y:"1.3em","text-anchor":"middle","font-family":"Arial","font-size":14,fill:"#000000"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.bpmn.DataObject=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.DataObject",size:{width:60,height:80},attrs:{".body":{points:"20,0 60,0 60,80 0,80 0,20 20,0 20,20 0,20",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.bpmn.Conversation=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/><path class="sub-process"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Conversation",size:{width:100,height:100},attrs:{".body":{points:"25,0 75,0 100,50 75,100 25,100 0,50",stroke:"#000000",fill:"#ffffff"},".label":{text:"",ref:".body","ref-x":.5,"ref-dy":5,"text-anchor":"middle"},path:{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",fill:"#ffffff",stroke:"#000000","fill-opacity":0}},conversationType:"conversation"},joint.dia.Element.prototype.defaults),initialize:function(){joint.dia.Element.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:conversationType",this.onConversationTypeChange),this.onConversationTypeChange(this,this.get("conversationType"))},onConversationTypeChange:function(cell,type){switch(type){case"conversation":cell.attr("polygon/stroke-width",1);break;case"call-conversation":cell.attr("polygon/stroke-width",4);break;default:throw"BPMN: Unknown Conversation Type: "+type}}}).extend(joint.shapes.bpmn.SubProcessInterface),joint.shapes.bpmn.Choreography=joint.shapes.basic.TextBlock.extend({markup:['<g class="rotatable">','<g class="scalable"><rect class="body"/></g>',joint.env.test("svgforeignobject")?'<foreignObject class="fobj"><body xmlns="http://www.w3.org/1999/xhtml"><div class="content"/></body></foreignObject>':'<text class="content"/>','<text class="label"/><path class="sub-process"/><g class="participants"/>',"</g>"].join(""),participantMarkup:'<g class="participant"><rect class="participant-rect"/><text class="participant-label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Choreography",size:{width:60,height:80},attrs:{rect:{},".body":{width:60,height:80,stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"},".participant-rect":{stroke:"#000000",fill:"#aaaaaa",ref:".body","ref-width":1},".participant-label":{"text-anchor":"middle",ref:".participant_0 .participant-rect","ref-x":.5,"ref-y":.5,"y-alignment":"middle"},".sub-process":{d:"M 0 0 L 30 0 30 30 0 30 z M 15 4 L 15 26 M 4 15 L 26 15",ref:".body","ref-x":.5,"ref-dy":-30,"x-alignment":"middle",fill:"transparent",stroke:"#000000"}},participants:[],initiatingParticipant:0},joint.shapes.basic.TextBlock.prototype.defaults)}).extend(joint.shapes.bpmn.SubProcessInterface),joint.shapes.bpmn.ChoreographyView=joint.shapes.basic.TextBlockView.extend({options:{participantHeight:20},initialize:function(){this.listenTo(this.model,"change:participants",function(cell,participants){this.renderParticipants(participants)}),this.listenTo(this.model,"change:initiatingParticipant",this.layoutAndUpdate),joint.shapes.basic.TextBlockView.prototype.initialize.apply(this,arguments),joint.env.test("svgforeignobject")||this.stopListening(this.model,"change:content").listenTo(this.model,"change:content",function(cell){this.updateContent(cell,this.participantsAttrs)})},update:function(){return _.isUndefined(this.participantsAttrs)?this.renderParticipants(this.model.get("participants")):(this.layoutAndUpdate(),this)},renderMarkup:function(){joint.dia.ElementView.prototype.renderMarkup.apply(this,arguments),this.$participants=this.$(".participants"),this.participantMarkup=V(this.model.participantMarkup)},renderParticipants:function(participants){this.$participants.empty(),this.participantsAttrs={},_.each(participants,function(participant,index){var className="participant_"+index,selector="."+className;this.participantsAttrs[selector+" .participant-rect"]={height:this.options.participantHeight},this.participantsAttrs[selector+" .participant-label"]={text:participant},this.$participants.append(this.participantMarkup.clone().addClass(className).node)},this),this.layoutAndUpdate()},layoutAndUpdate:function(){var participants=this.model.get("participants")||[],count=participants.length,pHeight=this.options.participantHeight,eHeight=this.model.get("size").height,bHeight=Math.max(0,eHeight-pHeight*count),offsetY=0,initiator=this.model.get("initiatingParticipant"),i=Math.max(_.isNumber(initiator)?Math.abs(initiator):participants.indexOf(initiator),0),b=Math.min(i,count-2);_.each(participants,function(participant,index){var selector=".participant_"+index;this.participantsAttrs[selector]={transform:"translate(0,"+offsetY+")"},this.participantsAttrs[selector+" .participant-rect"].fill=i==index?this.model.attr(".body/fill"):this.model.attr(".participant-rect/fill"),this.participantsAttrs[selector+" .participant-rect"].stroke=i==index?this.model.attr(".body/stroke"):this.model.attr(".participant-rect/stroke"),offsetY+=pHeight+(b==index?bHeight:0)},this);var sp=count<2?0:b-count+1;this.participantsAttrs[".sub-process"]={"ref-dy":Math.max(-eHeight,sp*pHeight-30)};var c=count<2?0:b+1;this.participantsAttrs[".fobj div"]={style:{height:bHeight,paddingTop:pHeight*c}},this.participantsAttrs[".content"]={"ref-y":pHeight*c+bHeight/2};var attrs=_.merge({},this.model.get("attrs"),this.participantsAttrs||{});joint.shapes.basic.TextBlockView.prototype.update.call(this,this.model,attrs)}}),joint.shapes.bpmn.Message=joint.dia.Element.extend({markup:'<g class="rotatable"><g class="scalable"><polygon class="body"/></g><text class="label"/></g>',defaults:joint.util.deepSupplement({type:"bpmn.Message",size:{width:60,height:40},attrs:{".body":{points:"0,0 60,0 60,40 0,40 0,0 60,0 30,20 0,0",stroke:"#000000",fill:"#ffffff"},".label":{ref:".body","ref-x":.5,"ref-dy":5,text:"","text-anchor":"middle"}}},joint.dia.Element.prototype.defaults)}),joint.shapes.bpmn.Flow=joint.dia.Link.extend({defaults:{type:"bpmn.Flow",attrs:{".marker-source":{d:"M 0 0"},".marker-target":{d:"M 10 0 L 0 5 L 10 10 z",fill:"#000000"},".connection":{"stroke-dasharray":" ","stroke-width":1},".connection-wrap":{style:"",onMouseOver:"",onMouseOut:""}},flowType:"normal"},initialize:function(){joint.dia.Link.prototype.initialize.apply(this,arguments),this.listenTo(this,"change:flowType",this.onFlowTypeChange),this.onFlowTypeChange(this,this.get("flowType"))},onFlowTypeChange:function(cell,type){var attrs;switch(type){case"default":attrs={".marker-source":{d:"M 0 5 L 20 5 M 20 0 L 10 10",fill:"none"}};break;case"conditional":attrs={".marker-source":{d:"M 20 8 L 10 0 L 0 8 L 10 16 z",fill:"#FFF"}};break;case"normal":attrs={};break;case"message":attrs={".marker-target":{fill:"#FFF"},".connection":{"stroke-dasharray":"4,4"}};break;case"association":attrs={".marker-target":{d:"M 0 0"},".connection":{"stroke-dasharray":"4,4"}};break;case"conversation":attrs={".marker-target":{d:"M 0 0"},".connection":{"stroke-width":"7px"},".connection-wrap":{style:"stroke: #fff; stroke-width: 5px; opacity: 1;",onMouseOver:"var s=this.style;s.stroke='#000';s.strokeWidth=15;s.opacity=.4",onMouseOut:"var s=this.style;s.stroke='#fff';s.strokeWidth=5;s.opacity=1"}};break;default:throw"BPMN: Unknown Flow Type: "+type}cell.attr(_.merge({},this.defaults.attrs,attrs))}}),joint.dia.CommandManager=Backbone.Model.extend({defaults:{cmdBeforeAdd:null,cmdNameRegex:/^(?:add|remove|change:\w+)$/},PREFIX_LENGTH:7,initialize:function(options){_.bindAll(this,"initBatchCommand","storeBatchCommand"),this.graph=options.graph,this.reset(),this.listen()},listen:function(){this.listenTo(this.graph,"all",this.addCommand,this),this.listenTo(this.graph,"batch:start",this.initBatchCommand,this),this.listenTo(this.graph,"batch:stop",this.storeBatchCommand,this)},createCommand:function(options){var cmd={action:void 0,data:{id:void 0,type:void 0,previous:{},next:{}},batch:options&&options.batch};return cmd},push:function(cmd){this.redoStack=[],cmd.batch?(this.lastCmdIndex=Math.max(this.lastCmdIndex,0),this.trigger("batch",cmd)):(this.undoStack.push(cmd),this.trigger("add",cmd))},addCommand:function(cmdName,cell,graph,options){if((!options||!options.dry)&&this.get("cmdNameRegex").test(cmdName)&&("function"!=typeof this.get("cmdBeforeAdd")||this.get("cmdBeforeAdd").apply(this,arguments))){var command=void 0;if(this.batchCommand){if(command=this.batchCommand[Math.max(this.lastCmdIndex,0)],0<=this.lastCmdIndex&&(command.data.id!==cell.id||command.action!==cmdName)){var similarCommandIndex=_.findIndex(this.batchCommand,function(cmd,index){return cmd.data.id===cell.id&&cmd.action===cmdName},this);similarCommandIndex<0||"add"===cmdName||"remove"===cmdName?command=this.createCommand({batch:!0}):(command=this.batchCommand[similarCommandIndex],this.batchCommand.splice(similarCommandIndex,1)),this.lastCmdIndex=this.batchCommand.push(command)-1}}else command=this.createCommand({batch:!1});if("add"===cmdName||"remove"===cmdName)return command.action=cmdName,command.data.id=cell.id,command.data.type=cell.attributes.type,command.data.attributes=_.merge({},cell.toJSON()),command.options=options||{},void this.push(command);var changedAttribute=cmdName.substr(this.PREFIX_LENGTH);command.batch&&command.action||(command.action=cmdName,command.data.id=cell.id,command.data.type=cell.attributes.type,command.data.previous[changedAttribute]=_.clone(cell.previous(changedAttribute)),command.options=options||{}),command.data.next[changedAttribute]=_.clone(cell.get(changedAttribute)),this.push(command)}},initBatchCommand:function(){this.batchCommand?this.batchLevel++:(this.batchCommand=[this.createCommand({batch:!0})],this.lastCmdIndex=-1,this.batchLevel=0)},storeBatchCommand:function(){if(this.batchCommand&&this.batchLevel<=0){var batchCommand=this.filterBatchCommand(this.batchCommand);0<batchCommand.length&&(this.redoStack=[],this.undoStack.push(batchCommand),this.trigger("add",batchCommand)),this.batchCommand=null,this.lastCmdIndex=null,this.batchLevel=null}else this.batchCommand&&0<this.batchLevel&&this.batchLevel--},filterBatchCommand:function(batchCommand){for(var commands=batchCommand.slice(),filteredCommands=[];0<commands.length;){var command=commands.shift(),id=command.data.id;if(null!=command.action&&null!=id){if("add"===command.action){var removeIndex=_.findIndex(commands,{action:"remove",data:{id:id}});if(0<=removeIndex){commands=_.reject(commands,function(cmd,index){return index<=removeIndex&&cmd.data.id===id});continue}}else if("remove"===command.action){var addIndex=_.findIndex(commands,{action:"add",data:{id:id}});if(0<=addIndex){commands.splice(addIndex,1);continue}}else if(0===command.action.indexOf("change")&&_.isEqual(command.data.previous,command.data.next))continue;filteredCommands.push(command)}}return filteredCommands},revertCommand:function(command){var batchCommand;this.stopListening();for(var opt={commandManager:this.id||this.cid},i=(batchCommand=_.isArray(command)?command:[command]).length-1;0<=i;i--){var cmd=batchCommand[i],cell=this.graph.getCell(cmd.data.id);switch(cmd.action){case"add":cell.remove(opt);break;case"remove":this.graph.addCell(cmd.data.attributes,opt);break;default:var attribute=cmd.action.substr(this.PREFIX_LENGTH);cell.set(attribute,cmd.data.previous[attribute],opt)}}this.listen()},applyCommand:function(command){var batchCommand;this.stopListening();var opt={commandManager:this.id||this.cid};batchCommand=_.isArray(command)?command:[command];for(var i=0;i<batchCommand.length;i++){var cmd=batchCommand[i],cell=this.graph.getCell(cmd.data.id);switch(cmd.action){case"add":this.graph.addCell(cmd.data.attributes,opt);break;case"remove":cell.remove(opt);break;default:var attribute=cmd.action.substr(this.PREFIX_LENGTH);cell.set(attribute,cmd.data.next[attribute],opt)}}this.listen()},undo:function(){var command=this.undoStack.pop();command&&(this.revertCommand(command),this.redoStack.push(command))},redo:function(){var command=this.redoStack.pop();command&&(this.applyCommand(command),this.undoStack.push(command))},cancel:function(){this.hasUndo()&&(this.revertCommand(this.undoStack.pop()),this.redoStack=[])},reset:function(){this.undoStack=[],this.redoStack=[]},hasUndo:function(){return 0<this.undoStack.length},hasRedo:function(){return 0<this.redoStack.length}}),joint.dia.Validator=Backbone.Model.extend({initialize:function(options){this._map={},this._commandManager=options.commandManager,this.listenTo(this._commandManager,"add",this._onCommand)},defaults:{cancelInvalid:!0},_onCommand:function(command){return _.isArray(command)?_.find(command,function(singleCmd){return!this._validateCommand(singleCmd)},this):this._validateCommand(command)},_validateCommand:function(command){return!(!command.options||!1!==command.options.validation)||(_.each(this._map[command.action],function(route){var i=0;!function callbacks(err){var fn=route[i++];try{if(!fn)return void(handoverErr=err);fn(err,command,callbacks)}catch(err){callbacks(err)}}(handoverErr)}),!handoverErr||(this.get("cancelInvalid")&&this._commandManager.cancel(),this.trigger("invalid",handoverErr),!1));var handoverErr},validate:function(actions){var callbacks=Array.prototype.slice.call(arguments,1);return _.each(callbacks,function(callback){if(!_.isFunction(callback))throw new Error(actions+" requires callback functions.")}),_.each(actions.split(" "),function(action){(this._map[action]=this._map[action]||[]).push(callbacks)},this),this}}),joint.dia.Graph.prototype.constructTree=function(parent,opt,parentElement,collector){collector=collector||[];var children=_.isFunction(opt.children)?opt.children(parent):parent[opt.children||"children"];return parentElement||(parentElement=opt.makeElement(parent),collector.push(parentElement)),_.each(children,function(child){var childElement=opt.makeElement(child),link=opt.makeLink(parentElement,childElement);collector.push(childElement,link),this.constructTree(child,opt,childElement,collector)},this),collector},joint.dia.Graph.prototype.shortestPath=function(source,target,opt){opt=opt||{};var adjacencyList={};_.each(this.getLinks(),function(link){var sourceId=link.get("source").id,targetId=link.get("target").id;adjacencyList[sourceId]||(adjacencyList[sourceId]=[]),adjacencyList[targetId]||(adjacencyList[targetId]=[]),adjacencyList[sourceId].push(targetId),opt.directed||adjacencyList[targetId].push(sourceId)});var previous=joint.alg.Dijkstra(adjacencyList,source.id||source,opt.weight),path=[],u=target.id||target;for(previous[u]&&path.push(u);u=previous[u];)path.unshift(u);return path},joint.ui.PaperScroller=joint.mvc.View.extend({className:"paper-scroller",events:{mousedown:"pointerdown",mousemove:"pointermove",touchmove:"pointermove"},options:{paper:void 0,padding:function(){var minVisibleSize=Math.max(this.options.minVisiblePaperSize,1)||1,padding={};return padding.left=padding.right=Math.max(this.el.clientWidth-minVisibleSize,0),padding.top=padding.bottom=Math.max(this.el.clientHeight-minVisibleSize,0),padding},minVisiblePaperSize:50,autoResizePaper:!1,baseWidth:void 0,baseHeight:void 0,contentOptions:void 0},_padding:{paddingLeft:0,paddingTop:0},init:function(){_.bindAll(this,"startPanning","stopPanning","pan");var paper=this.options.paper,initScale=V(paper.viewport).scale();this._sx=initScale.sx,this._sy=initScale.sy,_.isUndefined(this.options.baseWidth)&&(this.options.baseWidth=paper.options.width),_.isUndefined(this.options.baseHeight)&&(this.options.baseHeight=paper.options.height),this.$el.append(paper.el),this.listenTo(paper,"scale",this.onScale),this.listenTo(paper,"resize",this.onResize),this.listenTo(paper,"beforeprint",this.onBeforePrint),this.listenTo(paper,"afterprint",this.onAfterPrint),this.options.autoResizePaper&&this.listenTo(paper.model,"change add remove reset",this.adjustPaper)},onResize:function(){this._center&&this.center(this._center.x,this._center.y)},onScale:function(sx,sy,ox,oy){this.adjustScale(sx,sy),this._sx=sx,this._sy=sy,(ox||oy)&&this.center(ox,oy)},onBeforePrint:function(){this._scrollLeftBeforePrint=this.el.scrollLeft,this._scrollTopBeforePrint=this.el.scrollTop},onAfterPrint:function(){this.el.scrollLeft=this._scrollLeftBeforePrint,this.el.scrollTop=this._scrollTopBeforePrint,this._scrollLeftBeforePrint=null,this._scrollTopBeforePrint=null},beforePaperManipulation:function(){this.$el.css("visibility","hidden")},afterPaperManipulation:function(){this.$el.css("visibility","visible")},toLocalPoint:function(x,y){var ctm=this.options.paper.viewport.getCTM();return x+=this.el.scrollLeft-this._padding.paddingLeft-ctm.e,x/=ctm.a,y+=this.el.scrollTop-this._padding.paddingTop-ctm.f,y/=ctm.d,g.point(x,y)},adjustPaper:function(){this._center=this.toLocalPoint(this.el.clientWidth/2,this.el.clientHeight/2);var options=_.extend({gridWidth:this.options.baseWidth,gridHeight:this.options.baseHeight,allowNewOrigin:"negative"},this.options.contentOptions);return this.options.paper.fitToContent(this.transformContentOptions(options)),this},adjustScale:function(sx,sy){var paperOptions=this.options.paper.options,fx=sx/this._sx,fy=sy/this._sy;this.options.paper.setOrigin(paperOptions.origin.x*fx,paperOptions.origin.y*fy),this.options.paper.setDimensions(paperOptions.width*fx,paperOptions.height*fy)},transformContentOptions:function(opt){var sx=this._sx,sy=this._sy;return opt.gridWidth&&(opt.gridWidth*=sx),opt.gridHeight&&(opt.gridHeight*=sy),opt.minWidth&&(opt.minWidth*=sx),opt.minHeight&&(opt.minHeight*=sy),_.isObject(opt.padding)?opt.padding={left:(opt.padding.left||0)*sx,right:(opt.padding.right||0)*sx,top:(opt.padding.top||0)*sy,bottom:(opt.padding.bottom||0)*sy}:_.isNumber(opt.padding)&&(opt.padding=opt.padding*sx),opt},center:function(x,y,opts){var ctm=this.options.paper.viewport.getCTM(),x1=-ctm.e,y1=-ctm.f,x2=x1+this.options.paper.options.width,y2=y1+this.options.paper.options.height;_.isUndefined(x)||_.isUndefined(y)?(x=(x1+x2)/2,y=(y1+y2)/2):(x*=ctm.a,y*=ctm.d);var p=this.getPadding(),cx=this.el.clientWidth/2,cy=this.el.clientHeight/2,left=cx-p.left-x+x1,right=cx-p.right+x-x2,top=cy-p.top-y+y1,bottom=cy-p.bottom+y-y2;return this.addPadding(Math.max(left,0),Math.max(right,0),Math.max(top,0),Math.max(bottom,0)),this.scroll(x,y,_.isUndefined(opts)?x||null:opts),this},centerContent:function(opts){var vbox=V(this.options.paper.viewport).bbox(!0,this.options.paper.svg);return this.center(vbox.x+vbox.width/2,vbox.y+vbox.height/2,opts),this},centerElement:function(element){this.checkElement(element,"centerElement");var center=element.getBBox().center();return this.center(center.x,center.y)},scroll:function(x,y,opt){var ctm=this.options.paper.viewport.getCTM(),change={};if(_.isNumber(x)){var cx=this.el.clientWidth/2;change.scrollLeft=x-cx+ctm.e+this._padding.paddingLeft}if(_.isNumber(y)){var cy=this.el.clientHeight/2;change.scrollTop=y-cy+ctm.f+this._padding.paddingTop}opt&&opt.animation?this.$el.animate(change,opt.animation):this.$el.prop(change)},scrollToElement:function(element,opts){this.checkElement(element,"scrollToElement");var center=element.getBBox().center(),sx=this._sx,sy=this._sy;return center.x*=sx,center.y*=sy,this.scroll(center.x,center.y,opts)},addPadding:function(left,right,top,bottom){var base=this.getPadding(),padding=this._padding={paddingLeft:Math.round(base.left+(left||0)),paddingTop:Math.round(base.top+(top||0))},margin={marginBottom:Math.round(base.bottom+(bottom||0)),marginRight:Math.round(base.right+(right||0))};return padding.paddingLeft=Math.min(padding.paddingLeft,this.el.clientWidth-1),padding.paddingTop=Math.min(padding.paddingTop,this.el.clientHeight-1),margin.marginRight=Math.min(margin.marginRight,this.el.clientWidth-1),margin.marginBottom=Math.min(margin.marginBottom,this.el.clientHeight-1),this.$el.css(padding),this.options.paper.$el.css(margin),this},zoom:function(value,opt){opt=opt||{};var ox,oy,center=this.toLocalPoint(this.el.clientWidth/2,this.el.clientHeight/2),sx=value,sy=value;if(opt.absolute||(sx+=this._sx,sy+=this._sy),opt.grid&&(sx=Math.round(sx/opt.grid)*opt.grid,sy=Math.round(sy/opt.grid)*opt.grid),opt.max&&(sx=Math.min(opt.max,sx),sy=Math.min(opt.max,sy)),opt.min&&(sx=Math.max(opt.min,sx),sy=Math.max(opt.min,sy)),_.isUndefined(opt.ox)||_.isUndefined(opt.oy))ox=center.x,oy=center.y;else{var fsx=sx/this._sx,fsy=sy/this._sy;ox=opt.ox-(opt.ox-center.x)/fsx,oy=opt.oy-(opt.oy-center.y)/fsy}return this.beforePaperManipulation(),this.options.paper.scale(sx,sy),this.center(ox,oy),this.afterPaperManipulation(),this},zoomToFit:function(opt){opt=opt||{};var paper=this.options.paper,paperOrigin=_.clone(paper.options.origin);return opt.fittingBBox=opt.fittingBBox||_.extend({},g.point(paperOrigin),{width:this.$el.width()+this._padding.paddingLeft,height:this.$el.height()+this._padding.paddingTop}),this.beforePaperManipulation(),paper.scaleContentToFit(opt),paper.setOrigin(paperOrigin.x,paperOrigin.y),this.adjustPaper().centerContent(),this.afterPaperManipulation(),this},startPanning:function(evt){evt=joint.util.normalizeEvent(evt),this._clientX=evt.clientX,this._clientY=evt.clientY,this.trigger("pan:start",evt),$(document.body).on({"mousemove.panning touchmove.panning":this.pan,"mouseup.panning touchend.panning":this.stopPanning}),$(window).on("mouseup.panning",this.stopPanning)},pan:function(evt){var dx=(evt=joint.util.normalizeEvent(evt)).clientX-this._clientX,dy=evt.clientY-this._clientY;this.el.scrollTop-=dy,this.el.scrollLeft-=dx,this._clientX=evt.clientX,this._clientY=evt.clientY},stopPanning:function(evt){$(document.body).off(".panning"),$(window).off(".panning"),this.trigger("pan:stop",evt)},pointerdown:function(evt){evt.target===this.el&&this.options.paper.pointerdown.apply(this.options.paper,arguments)},pointermove:function(evt){evt.target===this.el&&this.options.paper.pointermove.apply(this.options.paper,arguments)},getPadding:function(){var padding=this.options.padding;return _.isFunction(padding)&&(padding=padding.call(this)),joint.util.normalizeSides(padding)},getVisibleArea:function(){var inverseMatrix=this.options.paper.viewport.getCTM(),area={x:this.el.scrollLeft||0,y:this.el.scrollTop||0,width:this.el.clientWidth,height:this.el.clientHeight},transformedArea=g.rect(V.transformRect(area,inverseMatrix.inverse()));return transformedArea.x-=(this._padding.paddingLeft||0)/this._sx,transformedArea.y-=(this._padding.paddingTop||0)/this._sy,transformedArea},isElementVisible:function(element){return this.checkElement(element,"isElementVisible"),this.getVisibleArea().containsRect(element.getBBox())},isPointVisible:function(point){return this.getVisibleArea().containsPoint(point)},checkElement:function(element,methodName){if(!(element&&element instanceof joint.dia.Element))throw new TypeError("ui.PaperScroller."+methodName+"() accepts instance of joint.dia.Element only")},onRemove:function(){this.stopPanning()}}),joint.ui.Selection=joint.mvc.View.extend({options:{paper:void 0,graph:void 0,boxContent:function(boxElement){return joint.util.template("<%= length %> elements selected.")({length:this.model.length})},handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElements"}},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"}},{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"}}],useModelGeometry:!1,strictSelection:!1,rotateAngleGrid:15,allowTranslate:!0},className:"selection",events:{"mousedown .selection-box":"onSelectionBoxPointerDown","touchstart .selection-box":"onSelectionBoxPointerDown","mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown"},init:function(){if(this.options.model&&(this.options.collection=this.options.model),this.collection=this.options.collection||this.collection||new Backbone.Collection,this.model=this.collection,!this.options.paper)throw new Error("Selection: paper required");_.defaults(this.options,{graph:this.options.paper.model}),_.bindAll(this,"startSelecting","stopSelecting","adjustSelection","pointerup"),$(document.body).on("mousemove.selection touchmove.selection",this.adjustSelection),$(document).on("mouseup.selection touchend.selection",this.pointerup),this.listenTo(this.options.graph,"reset",this.cancelSelection),this.listenTo(this.options.paper,"scale translate",this.updateSelectionBoxes),this.listenTo(this.options.graph,"remove change",function(cell,opt){opt.selection!==this.cid&&this.updateSelectionBoxes()}),this.listenTo(this.model,"remove",this.onRemoveElement),this.listenTo(this.model,"reset",this.onResetElements),this.listenTo(this.model,"add",this.onAddElement),this.options.paper.$el.append(this.$el),this._boxCount=0,this.$selectionWrapper=this.createSelectionWrapper(),this.handles=[],_.each(this.options.handles,this.addHandle,this)},cancelSelection:function(){this.model.reset([],{ui:!0})},addHandle:function(opt){this.handles.push(opt);var $handle=$("<div/>",{class:"handle "+(opt.position||"")+" "+(opt.name||""),"data-action":opt.name});return opt.icon&&$handle.css("background-image","url("+opt.icon+")"),$handle.html(opt.content||""),this.$selectionWrapper.append($handle),_.each(opt.events,function(method,event){_.isString(method)?this.on("action:"+opt.name+":"+event,this[method],this):this.on("action:"+opt.name+":"+event,method)},this),this},stopSelecting:function(evt){switch(this._action){case"selecting":var offset=this.$el.offset(),width=this.$el.width(),height=this.$el.height(),paper=this.options.paper,localPoint=V(paper.viewport).toLocalPoint(offset.left,offset.top);localPoint.x-=window.pageXOffset,localPoint.y-=window.pageYOffset;var paperScale=V(paper.viewport).scale();width/=paperScale.sx,height/=paperScale.sy;var selectedArea=g.rect(localPoint.x,localPoint.y,width,height),elementViews=this.getElementsInSelectedArea(selectedArea),filter=this.options.filter;_.isArray(filter)?elementViews=_.reject(elementViews,function(view){return _.contains(filter,view.model)||_.contains(filter,view.model.get("type"))}):_.isFunction(filter)&&(elementViews=_.reject(elementViews,function(view){return filter(view.model)})),this.model.reset(_.pluck(elementViews,"model"),{ui:!0});break;case"translating":this.options.graph.stopBatch("selection-translate"),this.notify("selection-box:pointerup",evt);break;default:this._action||this.cancelSelection()}this._action=null},removeHandle:function(name){var handleIdx=_.findIndex(this.handles,{name:name}),handle=this.handles[handleIdx];return handle&&(_.each(handle.events,function(method,event){this.off("action:"+name+":"+event)},this),this.$(".handle."+name).remove(),this.handles.splice(handleIdx,1)),this},startSelecting:function(evt){evt=joint.util.normalizeEvent(evt),this.cancelSelection(),this._action="selecting",this._clientX=evt.clientX,this._clientY=evt.clientY;var paperElement=evt.target.parentElement||evt.target.parentNode,paperOffset=$(paperElement).offset(),paperScrollLeft=paperElement.scrollLeft,paperScrollTop=paperElement.scrollTop;this._offsetX=null==evt.offsetX?evt.clientX-paperOffset.left+window.pageXOffset+paperScrollLeft:evt.offsetX,this._offsetY=null==evt.offsetY?evt.clientY-paperOffset.top+window.pageYOffset+paperScrollTop:evt.offsetY,this.$el.css({width:1,height:1,left:this._offsetX,top:this._offsetY}),this.showLasso()},changeHandle:function(name,opt){var handle=_.findWhere(this.handles,{name:name});return handle&&(this.removeHandle(name),this.addHandle(_.merge({name:name},handle,opt))),this},onSelectionBoxPointerDown:function(evt){evt.stopPropagation(),evt=joint.util.normalizeEvent(evt),this.options.allowTranslate&&this.startTranslatingSelection(evt),this._activeElementView=this.getCellView(evt.target),this.notify("selection-box:pointerdown",evt)},startTranslatingSelection:function(evt){this._action="translating",this.options.graph.startBatch("selection-translate");var snappedClientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY});this._snappedClientX=snappedClientCoords.x,this._snappedClientY=snappedClientCoords.y},adjustSelection:function(evt){var dx,dy;switch(evt=joint.util.normalizeEvent(evt),this._action){case"selecting":dx=evt.clientX-this._clientX,dy=evt.clientY-this._clientY;var left=parseInt(this.$el.css("left"),10),top=parseInt(this.$el.css("top"),10);this.$el.css({left:dx<0?this._offsetX+dx:left,top:dy<0?this._offsetY+dy:top,width:Math.abs(dx),height:Math.abs(dy)});break;case"translating":var snappedClientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),snappedClientX=snappedClientCoords.x,snappedClientY=snappedClientCoords.y;if(dx=snappedClientX-this._snappedClientX,dy=snappedClientY-this._snappedClientY,dx||dy){var processedCells={};if(this.model.each(function(element){if(!processedCells[element.id]){var opt={selection:this.cid};element.translate(dx,dy,opt),_.each(element.getEmbeddedCells({deep:!0}),function(embed){processedCells[embed.id]=!0});var connectedLinks=this.options.graph.getConnectedLinks(element);_.each(connectedLinks,function(link){processedCells[link.id]||(link.translate(dx,dy,opt),processedCells[link.id]=!0)})}},this),this.boxesUpdated)1<this.model.length&&this.updateSelectionBoxes();else{var paperScale=V(this.options.paper.viewport).scale();this.$el.children(".selection-box").add(this.$selectionWrapper).css({left:"+="+dx*paperScale.sx,top:"+="+dy*paperScale.sy})}this._snappedClientX=snappedClientX,this._snappedClientY=snappedClientY}this.notify("selection-box:pointermove",evt);break;default:this._action&&this.pointermove(evt)}this.boxesUpdated=!1},notify:function(eventName,event){var args=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[eventName,this._activeElementView].concat(args))},getElementsInSelectedArea:function(selectedArea){var paper=this.options.paper,filterOpt={strict:this.options.strictSelection};if(this.options.useModelGeometry){var models=paper.model.findModelsInArea(selectedArea,filterOpt);return _.filter(_.map(models,paper.findViewByModel,paper))}return paper.findViewsInArea(selectedArea,filterOpt)},pointerup:function(evt){this._action&&(this.triggerAction(this._action,"pointerup",evt),this.stopSelecting(evt),this._activeElementView=null,this._action=null)},destroySelectionBox:function(element){this.$('[data-model="'+element.get("id")+'"]').remove(),0===this.$el.children(".selection-box").length&&this.hide(),this._boxCount=Math.max(0,this._boxCount-1)},hide:function(){this.$el.removeClass("lasso selected")},showSelected:function(){this.$el.addClass("selected")},showLasso:function(){this.$el.addClass("lasso")},destroyAllSelectionBoxes:function(){this.hide(),this.$el.children(".selection-box").remove(),this._boxCount=0},createSelectionBox:function(element){var elementView=element.findView(this.options.paper);if(elementView){var viewBBox=elementView.getBBox({useModelGeometry:this.options.useModelGeometry});$("<div/>").addClass("selection-box").attr("data-model",element.get("id")).css({left:viewBBox.x,top:viewBBox.y,width:viewBBox.width,height:viewBBox.height}).appendTo(this.el);this.showSelected(),this._boxCount++}},createSelectionWrapper:function(){var $selectionWrapper=$("<div/>",{class:"selection-wrapper"}),$box=$("<div/>",{class:"box"});return $selectionWrapper.append($box),$selectionWrapper.attr("data-selection-length",this.model.length),this.$el.prepend($selectionWrapper),$selectionWrapper},updateSelectionWrapper:function(){var origin={x:1/0,y:1/0},corner={x:0,y:0};if(this.model.each(function(cell){var view=this.options.paper.findViewByModel(cell);if(view){var bbox=view.getBBox({useModelGeometry:this.options.useModelGeometry});origin.x=Math.min(origin.x,bbox.x),origin.y=Math.min(origin.y,bbox.y),corner.x=Math.max(corner.x,bbox.x+bbox.width),corner.y=Math.max(corner.y,bbox.y+bbox.height)}},this),this.$selectionWrapper.css({left:origin.x,top:origin.y,width:corner.x-origin.x,height:corner.y-origin.y}).attr("data-selection-length",this.model.length),_.isFunction(this.options.boxContent)){var $box=this.$(".box"),content=this.options.boxContent.call(this,$box[0]);content&&$box.html(content)}},updateSelectionBoxes:function(){this._boxCount&&(this.hide(),_.each(this.$el.children(".selection-box"),function(element){var removedId=$(element).remove().attr("data-model"),removedModel=this.model.get(removedId);removedModel&&this.createSelectionBox(removedModel)},this),this.updateSelectionWrapper(),this.boxesUpdated=!0)},onRemove:function(){$(document.body).off(".selection",this.adjustSelection),$(document).off(".selection",this.pointerup)},onHandlePointerDown:function(evt){this._action=$(evt.target).closest(".handle").attr("data-action"),this._action&&(evt.preventDefault(),evt.stopPropagation(),evt=joint.util.normalizeEvent(evt),this._clientX=evt.clientX,this._clientY=evt.clientY,this._startClientX=this._clientX,this._startClientY=this._clientY,this.triggerAction(this._action,"pointerdown",evt))},getCellView:function(element){var cell=this.model.get(element.getAttribute("data-model"));return cell&&cell.findView(this.options.paper)},pointermove:function(evt){if(this._action){var clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),oldClientCoords=this.options.paper.snapToGrid({x:this._clientX,y:this._clientY}),dx=clientCoords.x-oldClientCoords.x,dy=clientCoords.y-oldClientCoords.y;this.triggerAction(this._action,"pointermove",evt,dx,dy,evt.clientX-this._startClientX,evt.clientY-this._startClientY),this._clientX=evt.clientX,this._clientY=evt.clientY}},triggerAction:function(action,eventName,evt){var args=Array.prototype.slice.call(arguments,2);args.unshift("action:"+action+":"+eventName),this.trigger.apply(this,args)},onRemoveElement:function(element){this.destroySelectionBox(element),this.updateSelectionWrapper()},onResetElements:function(elements){this.destroyAllSelectionBoxes(),elements.each(this.createSelectionBox,this),this.updateSelectionWrapper()},onAddElement:function(element){this.createSelectionBox(element),this.updateSelectionWrapper()},removeElements:function(evt){var cells=this.collection.toArray();this.cancelSelection(),this.options.graph.removeCells(cells,{selection:this.cid})},startRotating:function(evt){this.options.graph.trigger("batch:start");var center=this.options.graph.getBBox(this.model.models).center(),clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),initialAngles=_.transform(this.model.toArray(),function(res,element){res[element.id]=g.normalizeAngle(element.get("angle")||0)});this._rotation={center:center,clientAngle:g.point(clientCoords).theta(center),initialAngles:initialAngles}},startResizing:function(evt){var paper=this.options.paper,graph=this.options.graph,grid=paper.options.gridSize,elements=this.model.toArray(),selectionBBox=graph.getBBox(elements),elBBoxes=_.invoke(elements,"getBBox"),minElWidth=_.min(elBBoxes,"width").width,minElHeight=_.min(elBBoxes,"height").height;this._resize={cells:graph.getSubgraph(elements),bbox:selectionBBox,minWidth:grid*selectionBBox.width/minElWidth,minHeight:grid*selectionBBox.height/minElHeight},graph.trigger("batch:start")},doResize:function(evt,dx,dy){var opt=this._resize,bbox=opt.bbox,prevWidth=bbox.width,prevHeight=bbox.height,width=Math.max(prevWidth+dx,opt.minWidth),height=Math.max(prevHeight+dy,opt.minHeight);(.001<Math.abs(prevWidth-width)||.001<Math.abs(prevHeight-height))&&(this.options.graph.resizeCells(width,height,opt.cells,{selection:this.cid}),bbox.width=width,bbox.height=height)},doRotate:function(evt){var rotation=this._rotation,angleGrid=this.options.rotateAngleGrid,clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),theta=rotation.clientAngle-g.point(clientCoords).theta(rotation.center);this.model.each(function(element){var newAngle=g.snapToGrid(rotation.initialAngles[element.id]+theta,angleGrid);element.rotate(newAngle,!0,rotation.center)})},stopBatch:function(){this.options.graph.trigger("batch:stop")},getAction:function(){return this._action}}),joint.ui.SelectionView=joint.ui.Selection,joint.ui.Clipboard=Backbone.Collection.extend({LOCAL_STORAGE_KEY:"joint.ui.Clipboard.cells",defaults:{useLocalStorage:!0},copyElements:function(selection,graph,opt){this.options=_.extend({},this.defaults,opt),opt=this.options;var originalElements=selection.toArray(),clones=_.sortBy(graph.cloneSubgraph(originalElements,opt),function(cell){return cell.isLink()?2:1});return this.reset(clones),opt.useLocalStorage&&window.localStorage&&localStorage.setItem(this.LOCAL_STORAGE_KEY,JSON.stringify(this.toJSON())),originalElements},cutElements:function(selection,graph,opt){var elementsToRemove=this.copyElements(selection,graph,opt);return graph.trigger("batch:start",{batchName:"cut"}),_.invoke(elementsToRemove,"remove"),graph.trigger("batch:stop",{batchName:"cut"}),elementsToRemove},pasteCells:function(graph,opt){if((opt=_.defaults(opt||{},this.options)).useLocalStorage&&this.isEmpty()&&window.localStorage){var graphJSON={cells:JSON.parse(localStorage.getItem(this.LOCAL_STORAGE_KEY))},tmpGraph=(new joint.dia.Graph).fromJSON(graphJSON,{sort:!1});this.reset(tmpGraph.getCells())}var pastedCells=this.map(function(cell){return this.modifyCell(cell,opt)},this);return graph.trigger("batch:start",{batchName:"paste"}),graph.addCells(pastedCells),graph.trigger("batch:stop",{batchName:"paste"}),this.copyElements(this,graph),pastedCells},clear:function(){this.options={},this.reset([]),window.localStorage&&localStorage.removeItem(this.LOCAL_STORAGE_KEY)},modifyCell:function(cell,opt){return cell.unset("z"),cell.isLink()&&opt.link&&cell.set(opt.link),opt.translate&&cell.translate(opt.translate.dx||20,opt.translate.dy||20),cell.collection=null,cell}}),function(joint,_){"use strict";var LinkHalo=function(){this.options={handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElement"},icon:null},{name:"direction",position:"se",events:{pointerdown:"directionSwap"},icon:null}],bbox:function(cellView){var linkLength=.5*cellView.getConnectionLength();return cellView.getPointAtLength(linkLength)},typeCssName:"type-link",tinyThreshold:-1,smallThreshold:-1}};LinkHalo.prototype.directionSwap=function(){var model=this.options.cellView.model;model.set({source:model.get("target"),target:model.get("source")},{halo:this.cid})};var ElementHalo=function(){this.options={handles:[{name:"remove",position:"nw",events:{pointerdown:"removeElement"},icon:null},{name:"resize",position:"se",events:{pointerdown:"startResizing",pointermove:"doResize",pointerup:"stopBatch"},icon:null},{name:"clone",position:"n",events:{pointerdown:"startCloning",pointermove:"doClone",pointerup:"stopCloning"},icon:null},{name:"link",position:"e",events:{pointerdown:"startLinking",pointermove:"doLink",pointerup:"stopLinking"},icon:null},{name:"fork",position:"ne",events:{pointerdown:"startForking",pointermove:"doFork",pointerup:"stopForking"},icon:null},{name:"unlink",position:"w",events:{pointerdown:"unlinkElement"},icon:null},{name:"rotate",position:"sw",events:{pointerdown:"startRotating",pointermove:"doRotate",pointerup:"stopBatch"},icon:null}],bbox:function(cellView,halo){return cellView.getBBox({useModelGeometry:halo.options.useModelGeometry})},typeCssName:"type-element",tinyThreshold:40,smallThreshold:80,boxContent:function(cellView,boxElement){var tmpl=joint.util.template("x: <%= x %>, y: <%= y %>, width: <%= width %>, height: <%= height %>, angle: <%= angle %>"),bbox=this.getBBox();return tmpl({x:Math.floor(bbox.x),y:Math.floor(bbox.y),width:Math.floor(bbox.width),height:Math.floor(bbox.height),angle:Math.floor(cellView.model.get("angle")||0)})}}};ElementHalo.prototype.startLinking=function(evt,x,y){this.startBatch();var cellView=this.options.cellView,selector=$.data(evt.target,"selector"),link=this.options.paper.getDefaultLink(cellView,selector&&cellView.el.querySelector(selector));link.set("source",{id:cellView.model.id,selector:selector}),link.set("target",{x:x,y:y}),link.attr(this.options.linkAttributes),_.isBoolean(this.options.smoothLinks)&&link.set("smooth",this.options.smoothLinks),this.options.graph.addCell(link,{validation:!1,halo:this.cid}),this._linkView=this.options.paper.findViewByModel(link),this._linkView.startArrowheadMove("target",{whenNotAllowed:"remove"})},ElementHalo.prototype.startForking=function(evt,x,y){var options=this.options;this.startBatch();var clone=options.clone(options.cellView.model,{fork:!0});if(!(clone instanceof joint.dia.Cell))throw new Error('ui.Halo: option "clone" has to return a cell.');var link=options.paper.getDefaultLink(options.cellView).set({source:{id:options.cellView.model.id},target:{id:clone.id}});link.attr(options.linkAttributes),_.isBoolean(options.smoothLinks)&&link.set("smooth",options.smoothLinks),this.centerElementAtCursor(clone,x,y),options.graph.addCells([clone,link],{halo:this.cid}),this._cloneView=clone.findView(options.paper),this._cloneView.pointerdown(evt,x,y)},ElementHalo.prototype.startResizing=function(evt){this.startBatch(),this._flip=[1,0,0,1,1,0,0,1][Math.floor(g.normalizeAngle(this.options.cellView.model.get("angle"))/45)]},ElementHalo.prototype.startRotating=function(evt,x,y){this.startBatch();var center=this.options.cellView.model.getBBox().center(),angle=g.normalizeAngle(this.options.cellView.model.get("angle"));this._center=center,this._rotationStartAngle=angle||0,this._clientStartAngle=g.point(x,y).theta(center)},ElementHalo.prototype.doResize=function(evt,x,y,dx,dy){var size=this.options.cellView.model.get("size"),width=Math.max(size.width+(this._flip?dx:dy),1),height=Math.max(size.height+(this._flip?dy:dx),1);this.options.cellView.model.resize(width,height,{absolute:!0})},ElementHalo.prototype.doRotate=function(evt,x,y){var theta=this._clientStartAngle-g.point(x,y).theta(this._center),newAngle=g.snapToGrid(this._rotationStartAngle+theta,this.options.rotateAngleGrid);this.options.cellView.model.rotate(newAngle,!0)},ElementHalo.prototype.doClone=function(evt,x,y){this._cloneView.pointermove(evt,x,y)},ElementHalo.prototype.startCloning=function(evt,x,y){var options=this.options;this.startBatch();var clone=options.clone(options.cellView.model,{clone:!0});if(!(clone instanceof joint.dia.Cell))throw new Error('ui.Halo: option "clone" has to return a cell.');this.centerElementAtCursor(clone,x,y),clone.addTo(options.graph,{halo:this.cid}),this._cloneView=clone.findView(options.paper),this._cloneView.pointerdown(evt,x,y)},ElementHalo.prototype.centerElementAtCursor=function(element,x,y){var center=element.getBBox().center(),tx=x-center.x,ty=y-center.y;element.translate(tx,ty)},ElementHalo.prototype.doFork=function(evt,x,y){this._cloneView.pointermove(evt,x,y)},ElementHalo.prototype.doLink=function(evt,x,y){this._linkView&&this._linkView.pointermove(evt,x,y)},ElementHalo.prototype.stopLinking=function(evt){this._linkView&&(this._linkView.pointerup(evt),this._linkView.model.hasLoop()&&this.makeLoopLink(this._linkView.model),this.stopBatch(),this.triggerAction("link","add",this._linkView.model),this._linkView=null)},ElementHalo.prototype.stopForking=function(evt,x,y){this._cloneView.pointerup(evt,x,y),this.stopBatch()},ElementHalo.prototype.stopCloning=function(evt,x,y){this._cloneView.pointerup(evt,x,y),this.stopBatch()},ElementHalo.prototype.unlinkElement=function(evt){this.options.graph.removeLinks(this.options.cellView.model)},ElementHalo.prototype.makeLoopLink=function(link){var p1,p2,linkWidth=this.options.loopLinkWidth,paperOpt=this.options.paper.options,paperRect=g.rect({x:0,y:0,width:paperOpt.width,height:paperOpt.height}),bbox=V(this.options.cellView.el).bbox(!1,this.options.paper.viewport),sides=_.uniq([this.options.loopLinkPreferredSide,"top","bottom","left","right"]),sideFound=_.find(sides,function(side){var centre,dx=0,dy=0;switch(side){case"top":centre=g.point(bbox.x+bbox.width/2,bbox.y-linkWidth),dx=linkWidth/2;break;case"bottom":centre=g.point(bbox.x+bbox.width/2,bbox.y+bbox.height+linkWidth),dx=linkWidth/2;break;case"left":centre=g.point(bbox.x-linkWidth,bbox.y+bbox.height/2),dy=linkWidth/2;break;case"right":centre=g.point(bbox.x+bbox.width+linkWidth,bbox.y+bbox.height/2),dy=linkWidth/2}return p1=g.point(centre).offset(-dx,-dy),p2=g.point(centre).offset(dx,dy),paperRect.containsPoint(p1)&&paperRect.containsPoint(p2)},this);sideFound&&link.set("vertices",[p1,p2])},joint.ui.Halo=joint.mvc.View.extend({PIE_INNER_RADIUS:20,PIE_OUTER_RADIUS:50,className:"halo",events:{"mousedown .handle":"onHandlePointerDown","touchstart .handle":"onHandlePointerDown","mousedown .pie-toggle":"onPieTogglePointerDown","touchstart .pie-toggle":"onPieTogglePointerDown"},options:{loopLinkPreferredSide:"top",loopLinkWidth:40,rotateAngleGrid:15,clearAll:!0,useModelGeometry:!1,clone:function(cell,opt){return cell.clone().unset("z")},type:"surrounding",pieSliceAngle:45,pieStartAngleOffset:0,pieIconSize:14,pieToggles:[{name:"default",position:"e"}],boxContent:!1,linkAttributes:{},smoothLinks:void 0},init:function(){var cell=this.options.cellView.model,cellViewAbstract=cell.isLink()?new LinkHalo:new ElementHalo;_.assign(this,_.omit(cellViewAbstract,"options")),_.defaults(this.options,cellViewAbstract.options,{paper:this.options.cellView.paper,graph:this.options.cellView.paper.model}),_.bindAll(this,"pointermove","pointerup","render","update"),this.options.clearAll&&joint.ui.Halo.clear(this.options.paper),this.listenTo(this.options.graph,"reset",this.remove),this.listenTo(this.options.graph,"all",this.update),this.listenTo(this.options.paper,"blank:pointerdown halo:create",this.remove),this.listenTo(this.options.paper,"scale translate",this.update),this.listenTo(cell,"remove",this.remove),$(document.body).on("mousemove touchmove",this.pointermove),$(document).on("mouseup touchend",this.pointerup),this.handles=[],_.each(this.options.handles,this.addHandle,this)},render:function(){var options=this.options;switch(this.$el.empty(),this.$handles=$("<div/>").addClass("handles").appendTo(this.el),this.$box=$("<label/>").addClass("box").appendTo(this.el),this.$pieToggles={},this.$el.addClass(options.type),this.$el.addClass(this.cellTypeCssClass()),this.$el.attr("data-type",options.cellView.model.get("type")),this.$handles.append(_.map(this.handles,this.renderHandle,this)),options.type){case"toolbar":case"surrounding":this.hasHandle("fork")&&this.toggleFork();break;case"pie":_.each(this.options.pieToggles,function(opt){var $pieToggle=$("<div/>");$pieToggle.addClass("pie-toggle "+(opt.position||"e")),$pieToggle.attr("data-name",opt.name),joint.util.setAttributesBySelector($pieToggle,opt.attrs),$pieToggle.appendTo(this.el),this.$pieToggles[opt.name]=$pieToggle},this);break;default:throw new Error("ui.Halo: unknown type")}return this.update(),this.$el.addClass("animate").appendTo(options.paper.el),this.setPieIcons(),this},setPieIcons:function(){"pie"===this.options.type&&this.$el.find(".handle").each(_.bind(function(index,handleEl){var $handle=$(handleEl),name=$handle.attr("data-action"),handle=this.getHandle(name);if(!handle||!handle.icon){var bgImage=$handle.css("background-image");if(bgImage){var match=bgImage.match(/url\(['"]?([^\(\)'"]+)['"]?\)/);if(match){var imageUrl=match[1],$sliceIcon=$handle.find(".slice-icon");0<$sliceIcon.length&&V($sliceIcon[0]).attr("xlink:href",imageUrl)}}}},this))},update:function(){if(this.isRendered()){this.updateBoxContent();var bbox=this.getBBox();this.$el.toggleClass("tiny",bbox.width<this.options.tinyThreshold&&bbox.height<this.options.tinyThreshold),this.$el.toggleClass("small",!this.$el.hasClass("tiny")&&bbox.width<this.options.smallThreshold&&bbox.height<this.options.smallThreshold),this.$el.css({width:bbox.width,height:bbox.height,left:bbox.x,top:bbox.y}),this.hasHandle("unlink")&&this.toggleUnlink()}},getBBox:function(){var cellView=this.options.cellView,bbox=this.options.bbox,rect=_.isFunction(bbox)?bbox(cellView,this):bbox;return rect=_.defaults({},rect,{x:0,y:0,width:1,height:1}),g.rect(rect)},cellTypeCssClass:function(){return this.options.typeCssName},updateBoxContent:function(){var boxContent=this.options.boxContent,cellView=this.options.cellView;if(_.isFunction(boxContent)){var content=boxContent.call(this,cellView,this.$box[0]);content&&this.$box.html(content)}else boxContent?this.$box.html(boxContent):this.$box.remove()},extendHandles:function(handleTooltips){_.each(handleTooltips,function(item){var handle=this.getHandle(item.name);handle&&_.extend(handle,item)},this)},addHandles:function(handles){return _.each(handles,this.addHandle,this),this},addHandle:function(opt){var handle=this.getHandle(opt.name);if(!handle&&(this.handles.push(opt),_.each(opt.events,function(method,event){_.isString(method)?this.on("action:"+opt.name+":"+event,this[method],this):this.on("action:"+opt.name+":"+event,method)},this),this.$handles))this.renderHandle(opt).appendTo(this.$handles);return this},renderHandle:function(opt){var handleIdx=this.getHandleIdx(opt.name),$handle=$("<div/>").addClass("handle").addClass(opt.name).attr("data-action",opt.name).prop("draggable",!1);switch(this.options.type){case"toolbar":case"surrounding":$handle.addClass(opt.position),opt.content&&$handle.html(opt.content);break;case"pie":var outerRadius=this.PIE_OUTER_RADIUS,innerRadius=this.PIE_INNER_RADIUS,iconRadius=(outerRadius+innerRadius)/2,center=g.point(outerRadius,outerRadius),sliceRadian=g.toRad(this.options.pieSliceAngle),startRadian=handleIdx*sliceRadian+g.toRad(this.options.pieStartAngleOffset),stopRadian=startRadian+sliceRadian,slicePathData=V.createSlicePathData(innerRadius,outerRadius,startRadian,stopRadian),svgRoot=V("svg").addClass("slice-svg"),svgSlice=V("path").attr("d",slicePathData).translate(outerRadius,outerRadius).addClass("slice"),iconPosition=g.point.fromPolar(iconRadius,-startRadian-sliceRadian/2,center),iconSize=this.options.pieIconSize,svgIcon=V("image").attr(iconPosition).addClass("slice-icon");svgIcon.attr({width:iconSize,height:iconSize}),svgIcon.translate(-iconSize/2,-iconSize/2),svgRoot.append([svgSlice,svgIcon]),$handle.append(svgRoot.node)}return opt.icon&&this.setHandleIcon($handle,opt.icon),joint.util.setAttributesBySelector($handle,opt.attrs),$handle},setHandleIcon:function($handle,icon){switch(this.options.type){case"pie":var $icon=$handle.find(".slice-icon");V($icon[0]).attr("xlink:href",icon);break;case"toolbar":case"surrounding":$handle.css("background-image","url("+icon+")")}},removeHandles:function(){for(;this.handles.length;)this.removeHandle(this.handles[0].name);return this},removeHandle:function(name){var handleIdx=this.getHandleIdx(name),handle=this.handles[handleIdx];return handle&&(_.each(handle.events,function(method,event){this.off("action:"+name+":"+event)},this),this.$(".handle."+name).remove(),this.handles.splice(handleIdx,1)),this},changeHandle:function(name,opt){var handle=this.getHandle(name);return handle&&(this.removeHandle(name),this.addHandle(_.merge({name:name},handle,opt))),this},hasHandle:function(name){return-1!==this.getHandleIdx(name)},getHandleIdx:function(name){return _.findIndex(this.handles,{name:name})},getHandle:function(name){return _.findWhere(this.handles,{name:name})},toggleHandle:function(name,selected){var handle=this.getHandle(name);if(handle){var $handle=this.$(".handle."+name);_.isUndefined(selected)&&(selected=!$handle.hasClass("selected")),$handle.toggleClass("selected",selected);var icon=selected?handle.iconSelected:handle.icon;icon&&this.setHandleIcon($handle,icon)}return this},selectHandle:function(name){return this.toggleHandle(name,!0)},deselectHandle:function(name){return this.toggleHandle(name,!1)},deselectAllHandles:function(){return _.chain(this.handles).pluck("name").each(this.deselectHandle,this).value(),this},onHandlePointerDown:function(evt){if(this._action=$(evt.target).closest(".handle").attr("data-action"),this._action){evt.preventDefault(),evt.stopPropagation(),evt=joint.util.normalizeEvent(evt);var clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY});this._localX=clientCoords.x,this._localY=clientCoords.y,this.triggerAction(this._action,"pointerdown",evt,clientCoords.x,clientCoords.y)}},onPieTogglePointerDown:function(evt){evt.stopPropagation();var $pieToggle=$(evt.target).closest(".pie-toggle"),toggleName=$pieToggle.attr("data-name");this.isOpen(toggleName)||this.isOpen()&&this.toggleState(),this.toggleState(toggleName)},triggerAction:function(action,eventName,evt){var args=Array.prototype.slice.call(arguments,2);args.unshift("action:"+action+":"+eventName),this.trigger.apply(this,args)},stopBatch:function(){this.options.graph.trigger("batch:stop")},startBatch:function(){this.options.graph.trigger("batch:start")},pointermove:function(evt){if(this._action){evt.preventDefault(),evt.stopPropagation(),evt=joint.util.normalizeEvent(evt);var clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),dx=clientCoords.x-this._localX,dy=clientCoords.y-this._localY;this._localX=clientCoords.x,this._localY=clientCoords.y,this.triggerAction(this._action,"pointermove",evt,clientCoords.x,clientCoords.y,dx,dy)}},pointerup:function(evt){if(this._action){var clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY});this.triggerAction(this._action,"pointerup",evt,clientCoords.x,clientCoords.y),this._action=null}},onRemove:function(){$(document.body).off("mousemove touchmove",this.pointermove),$(document).off("mouseup touchend",this.pointerup)},onSetTheme:function(){this.setPieIcons()},removeElement:function(){this.options.cellView.model.remove()},toggleUnlink:function(){var canUnlink=0<this.options.graph.getConnectedLinks(this.options.cellView.model).length;this.$handles.children(".unlink").toggleClass("hidden",!canUnlink)},toggleFork:function(){var clone=this.options.cellView.model.clone(),cloneView=this.options.paper.createViewForModel(clone),canFork=this.options.paper.options.validateConnection(this.options.cellView,null,cloneView,null,"target");this.$handles.children(".fork").toggleClass("hidden",!canFork),cloneView.remove(),clone=null},toggleState:function(toggleName){if(this.isRendered()){var $el=this.$el;if(_.each(this.$pieToggles,function($pieToggle){$pieToggle.removeClass("open")}),this.isOpen())this.trigger("state:close",toggleName),$el.removeClass("open");else{if(this.trigger("state:open",toggleName),toggleName){var pieToggle=_.findWhere(this.options.pieToggles,{name:toggleName});pieToggle&&$el.attr({"data-pie-toggle-position":pieToggle.position,"data-pie-toggle-name":pieToggle.name}),this.$pieToggles[toggleName].addClass("open")}$el.addClass("open")}}},isOpen:function(toggleName){return!!this.isRendered()&&(toggleName?this.$pieToggles[toggleName].hasClass("open"):this.$el.hasClass("open"))},isRendered:function(){return!_.isUndefined(this.$box)}},{clear:function(paper){paper.trigger("halo:create")}})}(joint,_),function(joint,_){joint.ui.Toolbar=joint.mvc.View.extend({options:{groups:{}},align:["left","right"],className:"joint-toolbar",defaultGroup:"default",init:function(){this.widgets=[],this.tools=this.options.tools||[]},getWidgetByName:function(name){return _.find(this.widgets,function(item){return item.options.name===name})},getWidgets:function(){return this.widgets},groupsWithItemsPairs:function(){var groupedItems={};return _.each(this.tools,function(item){var group=item.group||this.defaultGroup;groupedItems[group]=groupedItems[group]||{items:[],group:{}},groupedItems[group].items.push(item),groupedItems[group].group=this.options.groups[group]||{}},this),_.chain(groupedItems).pairs().sortBy(function(pair){return pair[1].group.index}).sortBy(function(pair){return pair[1].group.align||"left"}).value()},render:function(){var sortedGroups=this.groupsWithItemsPairs(),firstAlignRight=!1;return _.each(sortedGroups,function(groupArray){var name=groupArray[0],grouped=groupArray[1],$group=this.renderGroup(name,grouped);!firstAlignRight&&grouped.group.align&&"right"===grouped.group.align&&(firstAlignRight=!0,$group.addClass("group-first")),$group.appendTo(this.el)},this),this},renderGroup:function(name,grouped){var group=grouped.group,items=grouped.items,$groupElement=$("<div/>").addClass("joint-toolbar-group").attr("data-group",name);return group.align&&_.contains(this.align,group.align)&&$groupElement.addClass(group.align),this.renderItems(items,$groupElement),$groupElement},createWidget:function(item){var component=joint.ui.Widget.create(item,this.options.references);return component.on("all",_.bind(function(name){var data=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[item.name+":"+name].concat(data))},this)),this.widgets.push(component),component},renderItems:function(tools,element){_.each(tools,function(item){var component=this.createWidget(item);element.append(component.$el)},this)}})}(joint,_),function(joint,_){joint.ui.Widget=joint.mvc.View.extend({className:"joint-widget",references:[],constructor:function(options,refs){this.availableReferences=refs||{},joint.mvc.View.prototype.constructor.call(this,options)},updateAttrs:function(attrs){joint.util.setAttributesBySelector(this.$el,attrs)},render:function(){return this},bindEvents:function(){},validateReferences:function(){var refs=this.references||[],ret=[];return _.each(refs,function(ref){_.isUndefined(this.availableReferences[ref])&&ret.push(ref)},this),ret},getReference:function(name){return this.availableReferences[name]},getReferences:function(){return this.availableReferences}},{create:function(opt,refs){var type=_.camelCase(_.isString(opt)?opt:opt.type);if(!_.isFunction(joint.ui.widgets[type]))throw new Error('Widget: unable to find widget: "'+type+'"');var widget=new joint.ui.widgets[type](opt,refs),invalidRefs=widget.validateReferences(refs);if(0<invalidRefs.length)throw new Error('Widget: "'+type+'" missing dependency: '+invalidRefs.join(", "));return widget.render(),widget.updateAttrs(opt.attrs),widget.bindEvents(),widget.$el.attr("data-type",type),opt.name&&widget.$el.attr("data-name",opt.name),widget}}),joint.ui.widgets={checkbox:joint.ui.Widget.extend({tagName:"label",events:{"change .input":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},init:function(){_.bindAll(this,"pointerup")},render:function(){var opt=this.options,$label=$("<span/>").text(opt.label||"");return this.$input=$("<input/>",{type:"checkbox",class:"input"}).prop("checked",!!opt.value),this.$span=$("<span/>"),this.$el.append([$label,this.$input,this.$span]),this},onChange:function(evt){this.trigger("change",!!evt.target.checked,evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.addClass("is-in-action"),this.trigger("pointerdown",evt),$(document).on("mouseup.checkbox touchend.checkbox",this.pointerup)},pointerup:function(evt){evt=joint.util.normalizeEvent(evt),$(document).off("mouseup.checkbox touchend.checkbox"),this.trigger("pointerdown",evt),this.$el.removeClass("is-in-action")}}),toggle:joint.ui.Widget.extend({tagName:"label",events:{"change .toggle":"onChange",mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup"},init:function(){_.bindAll(this,"pointerup")},render:function(){var opt=this.options,$label=$("<span/>").text(opt.label||""),$button=$("<span><i/></span>"),$input=$("<input/>",{type:"checkbox",class:"toggle"}).prop("checked",!!opt.value),$wrapper=$("<div/>").addClass(opt.type);return this.$el.append([$label,$wrapper.append($input,$button)]),this},onChange:function(evt){this.trigger("change",!!evt.target.checked,evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.addClass("is-in-action"),this.trigger("pointerdown",evt),$(document).on("mouseup.toggle touchend.toggle",this.pointerup)},pointerup:function(evt){evt=joint.util.normalizeEvent(evt),$(document).off("mouseup.toggle touchend.toggle"),this.$el.removeClass("is-in-action"),this.trigger("pointerup",evt)}}),separator:joint.ui.Widget.extend({render:function(){return this.options.width&&this.$el.css({width:this.options.width}),this}}),label:joint.ui.Widget.extend({tagName:"label",render:function(){return this.$el.text(this.options.text),this}}),range:joint.ui.Widget.extend({events:{"change .input":"onChange","input .input":"onInput"},render:function(){var $units,opt=this.options;return this.$output=$("<output/>").text(opt.value),$units=$("<span/>").addClass("units").text(opt.unit),this.$input=$("<input/>",{type:"range",name:opt.type,min:opt.min,max:opt.max,step:opt.step,class:"input"}).val(opt.value),this.$el.append([this.$input,this.$output,$units]),this},onChange:function(evt){var value=parseInt(this.$input.val(),10);this.$output.text(value),this.trigger("change",value,evt)},onInput:function(evt){this.$output.text(this.$input.val()),this.trigger("input",this.$input.val(),evt)},setValue:function(value){this.$input.val(value),this.$output.text(value)}}),selectBox:joint.ui.Widget.extend({render:function(){var selectBoxOptions=_.omit(this.options,"type","group","index");return this.selectBox=new joint.ui.SelectBox(selectBoxOptions),this.selectBox.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectBox.on("all",this.trigger,this)}}),button:joint.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",click:"pointerclick",touchend:"pointerclick"},tagName:"button",render:function(){var opt=this.options;return this.$el.text(opt.text),this},pointerclick:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerclick",evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerdown",evt)}}),inputText:joint.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var opt=this.options;return this.$label=$("<label/>").text(opt.label),this.$input=$("<div/>").append($("<input/>",{type:"text",class:"input"}).val(opt.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerclick",evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerdown",evt)},pointerup:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerup",evt)},pointerfocusin:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",evt)},pointerfocusout:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",evt)}}),inputNumber:joint.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var opt=this.options;return this.$label=$("<label/>").text(opt.label),this.$input=$("<div/>").append($("<input/>",{type:"number",class:"number",max:opt.max,min:opt.min}).val(opt.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerclick",evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerdown",evt)},pointerup:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerup",evt)},pointerfocusin:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",evt)},pointerfocusout:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",evt)}}),textarea:joint.ui.Widget.extend({events:{mousedown:"pointerdown",touchstart:"pointerdown",mouseup:"pointerup",touchend:"pointerup",click:"pointerclick",focusin:"pointerfocusin",focusout:"pointerfocusout"},tagName:"div",render:function(){var opt=this.options;return this.$label=$("<label/>").text(opt.label),this.$input=$("<div/>").append($("<textarea/>",{class:"textarea"}).text(opt.value)),this.$el.append([this.$label,this.$input]),this},pointerclick:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerclick",evt)},pointerdown:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerdown",evt)},pointerup:function(evt){evt=joint.util.normalizeEvent(evt),this.trigger("pointerup",evt)},pointerfocusin:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.addClass("is-focused"),this.trigger("pointerfocusin",evt)},pointerfocusout:function(evt){evt=joint.util.normalizeEvent(evt),this.$el.removeClass("is-focused"),this.trigger("pointerfocusout",evt)}}),selectButtonGroup:joint.ui.Widget.extend({render:function(){var selectButtonGroupOptions=_.omit(this.options,"type","group","index");return this.selectButtonGroup=new joint.ui.SelectButtonGroup(selectButtonGroupOptions),this.selectButtonGroup.render().$el.appendTo(this.el),this},bindEvents:function(){this.selectButtonGroup.on("all",this.trigger,this)}})},joint.ui.widgets.zoomIn=joint.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(evt){var opt=this.options;this.getReferences().paperScroller.zoom(opt.step,{max:opt.max,grid:opt.step}),joint.ui.widgets.button.prototype.pointerdown.call(this,evt)}}),joint.ui.widgets.zoomOut=joint.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(evt){var opt=this.options;this.getReferences().paperScroller.zoom(-opt.step,{min:opt.min,grid:opt.step}),joint.ui.widgets.button.prototype.pointerdown.call(this,evt)}}),joint.ui.widgets.zoomToFit=joint.ui.widgets.button.extend({references:["paperScroller"],options:{min:.2,max:5,step:.2},pointerdown:function(evt){var opt=this.options;this.getReferences().paperScroller.zoomToFit({padding:20,scaleGrid:opt.step,minScale:opt.min,maxScale:opt.max}),joint.ui.widgets.button.prototype.pointerdown.call(this,evt)}}),joint.ui.widgets.zoomSlider=joint.ui.widgets.range.extend({references:["paperScroller"],options:{min:20,max:500,step:20,value:100,unit:" %"},bindEvents:function(){this.on("change",function(value){this.getReferences().paperScroller.zoom(value/100,{absolute:!0,grid:this.options.step/100})},this),this.getReferences().paperScroller.options.paper.on("scale",function(value){this.setValue(Math.floor(100*value))},this)}}),joint.ui.widgets.undo=joint.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.undo()}}),joint.ui.widgets.redo=joint.ui.widgets.button.extend({references:["commandManager"],pointerclick:function(){this.getReferences().commandManager.redo()}})}(joint,_),function(joint,_){var layoutDefaults={options:function(){return{columnWidth:this.options.width/2-10,columns:2,rowHeight:80,resizeToFit:!0,dy:10,dx:10}},layoutGroup:function(graph,group){var opts=this.options.layout;if(group=group||{},!joint.layout.GridLayout)throw new Error("joint.ui.Stencil: joint.layout.GridLayout is not available.");joint.layout.GridLayout.layout(graph,_.extend({},opts,group.layout))}};joint.ui.Stencil=joint.mvc.View.extend({className:"stencil",events:{"click .btn-expand":"openGroups","click .btn-collapse":"closeGroups","click .groups-toggle .group-label":"openGroups","click .group-label":"onGroupLabelClick","touchstart .group-label":"onGroupLabelClick","input .search":"onSearch","focusin .search":"pointerFocusIn","focusout .search":"pointerFocusOut"},options:{width:200,height:800,label:"Stencil",groups:null,groupsToggleButtons:null,dropAnimation:!1,search:null,layout:null,dragStartClone:function(cell){return cell.clone()},dragEndClone:function(cell){return cell.clone()},layoutGroup:null},init:function(){this.setPaper(this.options.paperScroller||this.options.paper),this.graphs={},this.papers={},this.$groups={},_.bindAll(this,"onDrag","onDragEnd","onDropEnd"),$(document.body).on({"mousemove.stencil touchmove.stencil":this.onDrag,"touchend.stencil":this.onDragEnd}),$(window).on("mouseup.stencil",this.onDragEnd),this.onSearch=_.debounce(this.onSearch,200),this.initializeLayout()},initializeLayout:function(){var layout=this.options.layout;layout&&(_.isFunction(layout)?this.layoutGroup=layout:(this.layoutGroup=_.bind(layoutDefaults.layoutGroup,this),this.options.layout=_.isObject(layout)?layout:{},_.defaults(this.options.layout,layoutDefaults.options.call(this))))},setPaper:function(paper){var options=this.options;if(paper instanceof joint.dia.Paper)options.paperScroller=null,options.paper=paper,options.graph=paper.model;else{if(!("function"==typeof joint.ui.PaperScroller&&paper instanceof joint.ui.PaperScroller))throw new Error("Stencil: paper required");options.paperScroller=paper,options.paper=paper.options.paper,options.graph=paper.options.paper.model}},renderContent:function(){return $("<div/>").addClass("content")},renderPaperDrag:function(){return $("<div/>").addClass("stencil-paper-drag")},renderSearch:function(){return $("<div/>").addClass("search-wrap").append($("<input/>",{type:"search",placeholder:"search"}).addClass("search"))},renderToggleAll:function(){return[$("<div/>").addClass("groups-toggle").append($("<label/>",{text:this.options.label}).addClass("group-label")).append($("<button/>",{text:"+"}).addClass("btn btn-expand")).append($("<button/>",{text:"-"}).addClass("btn btn-collapse"))]},renderElementsContainer:function(){return $("<div/>").addClass("elements")},renderGroup:function(opt){opt=opt||{};var $group=$("<div/>").addClass("group").attr("data-name",opt.name).toggleClass("closed",!!opt.closed),$label=$("<h3/>").addClass("group-label").text(opt.label||opt.name),$elements=this.renderElementsContainer();return $group.append($label,$elements)},render:function(){this.$content=this.renderContent(),this.$paperDrag=this.renderPaperDrag(),this.$el.empty().append(this.$paperDrag,this.$content),this.options.search&&this.$el.addClass("searchable").prepend(this.renderSearch()),this.options.groupsToggleButtons&&this.$el.addClass("collapsible").prepend(this.renderToggleAll());var paperOptions={width:this.options.width,height:this.options.height,interactive:!1};if(this.options.groups){var sortedGroups=_.sortBy(_.pairs(this.options.groups),function(pair){return pair[1].index});_.each(sortedGroups,function(groupArray){var name=groupArray[0],group=groupArray[1],$group=this.$groups[name]=this.renderGroup({name:name,label:group.label,closed:group.closed}).appendTo(this.$content),graph=new joint.dia.Graph,paper=new joint.dia.Paper(_.extend({},paperOptions,{el:$group.find(".elements"),model:graph,width:group.width||paperOptions.width,height:group.height||paperOptions.height}));this.graphs[name]=graph,this.papers[name]=paper},this)}else{var $elements=this.renderElementsContainer().appendTo(this.$content),graph=new joint.dia.Graph,paper=new joint.dia.Paper(_.extend(paperOptions,{el:$elements,model:graph}));this.graphs.__default__=graph,this.papers.__default__=paper}return this._graphDrag=new joint.dia.Graph,this._paperDrag=new joint.dia.Paper({el:this.$paperDrag,width:1,height:1,model:this._graphDrag}),_.each(this.papers,function(paper){this.listenTo(paper,"cell:pointerdown",this.onDragStart)},this),this},load:function(cells,group){cells=cells||{},_.isArray(cells)?this.loadGroup(cells,group):_.each(this.options.groups||[],function(group,name){cells[name]&&this.loadGroup(cells[name],name)},this)},loadGroup:function(cells,group){var graph=this.getGraph(group);graph.resetCells(cells);var paperHeight=this.options.height;group&&(paperHeight=this.getGroup(group).height),this.isLayoutEnabled()&&this.layoutGroup(graph,this.getGroup(group)),paperHeight||this.getPaper(group).fitToContent({gridWidth:1,gridHeight:1,padding:this.options.paperPadding||10})},isLayoutEnabled:function(){return!!this.options.layout},getGraph:function(group){var graph=this.graphs[group||"__default__"];if(!graph)throw new Error("Stencil: group "+group+" does not exist.");return graph},getPaper:function(group){return this.papers[group||"__default__"]},onDragStart:function(cellView,evt){evt.preventDefault(),this.options.graph.startBatch("stencil-drag"),this.$el.addClass("dragging"),this._paperDrag.$el.addClass("dragging"),$(document.body).append(this._paperDrag.$el),this._clone=this.options.dragStartClone(cellView.model),this._cloneBbox=cellView.getBBox();var shift=g.point(this._cloneBbox.x-this._clone.get("position").x,this._cloneBbox.y-this._clone.get("position").y);this._clone.set("position",{x:5-shift.x,y:5-shift.y}).addTo(this._graphDrag),this._cloneView=this._clone.findView(this._paperDrag),this._clonePosition=_.clone(this._clone.position()),this._paperDrag.setDimensions(this._cloneBbox.width+10,this._cloneBbox.height+10);var scrollTop=document.body.scrollTop||document.documentElement.scrollTop;this._paperDragOriginalOffset={left:evt.clientX-this._cloneBbox.width/2,top:evt.clientY+scrollTop-this._cloneBbox.height/2},this._paperDrag.$el.offset(this._paperDragOriginalOffset)},onDrag:function(evt){if(this._clone){evt.preventDefault(),evt=joint.util.normalizeEvent(evt);var scrollTop=document.body.scrollTop||document.documentElement.scrollTop,x=evt.clientX-this._cloneBbox.width/2,y=evt.clientY+scrollTop-this._cloneBbox.height/2;if(this._paperDrag.$el.offset({left:x,top:y}),this.options.paper.options.embeddingMode&&this._cloneView){var localPoint=this.options.paper.clientToLocalPoint({x:x,y:y});localPoint.x+=this._clonePosition.x,localPoint.y+=this._clonePosition.y,this._clone.set("position",localPoint,{silent:!0}),this._cloneView.processEmbedding({model:this._clone,paper:this.options.paper})}}},onDragEnd:function(evt){if(this._clone&&this._cloneBbox){evt=joint.util.normalizeEvent(evt),this._clone.set("position",this._clonePosition,{silent:!0});var cellClone=this.options.dragEndClone(this._clone),dropped=this.drop(evt,cellClone,this._cloneBbox);dropped?this.onDropEnd():this.onDropInvalid(evt,cellClone),this.options.paper.options.embeddingMode&&this._cloneView&&this._cloneView.finalizeEmbedding({model:cellClone,paper:this.options.paper}),this.options.graph.stopBatch("stencil-drag")}},onDropEnd:function(){this.$el.append(this._paperDrag.$el),this.$el.removeClass("dragging"),this._paperDrag.$el.removeClass("dragging"),this._clone.remove(),this._clone=void 0},onDropInvalid:function(evt,cellClone){if(this._clone&&this._cloneBbox&&(evt=joint.util.normalizeEvent(evt),cellClone=cellClone||this.options.dragEndClone(this._clone),this.trigger("drop:invalid",evt,cellClone),this.options.dropAnimation)){var duration=_.isObject(this.options.dropAnimation)?this.options.dropAnimation.duration:150,easing=_.isObject(this.options.dropAnimation)?this.options.dropAnimation.easing:"swing";this._paperDrag.$el.animate(this._paperDragOriginalOffset,duration,easing,this.onDropEnd)}},insideValidArea:function(p){var validArea,paper=this.options.paper,paperScroller=this.options.paperScroller,stencilArea=this.getDropArea(this.$el);if(paperScroller)if(paperScroller.options.autoResizePaper)validArea=this.getDropArea(paperScroller.$el);else{var scrollerArea=this.getDropArea(paperScroller.$el),paperArea=this.getDropArea(paper.$el);validArea=paperArea.intersect(scrollerArea)}else validArea=this.getDropArea(paper.$el);return!(!validArea||!validArea.containsPoint(p)||stencilArea.containsPoint(p))},getDropArea:function($el){var position=$el.offset(),scrollTop=document.body.scrollTop||document.documentElement.scrollTop,scrollLeft=document.body.scrollLeft||document.documentElement.scrollLeft;return g.rect({x:position.left+parseInt($el.css("border-left-width"),10)-scrollLeft,y:position.top+parseInt($el.css("border-top-width"),10)-scrollTop,width:$el.innerWidth(),height:$el.innerHeight()})},drop:function(evt,cell,cellViewBBox){var paper=this.options.paper,graph=this.options.graph,p=(document.body.scrollTop||document.documentElement.scrollTop,document.body.scrollLeft||document.documentElement.scrollLeft,{x:evt.clientX,y:evt.clientY});if(this.insideValidArea(p)){var pointTransformed=paper.clientToLocalPoint(p),cellBBox=cell.getBBox();return pointTransformed.x+=cellBBox.x-cellViewBBox.width/2,pointTransformed.y+=cellBBox.y-cellViewBBox.height/2,cell.set("position",{x:g.snapToGrid(pointTransformed.x,paper.options.gridSize),y:g.snapToGrid(pointTransformed.y,paper.options.gridSize)}),cell.unset("z"),graph.addCell(cell,{stencil:this.cid}),!0}return!1},filter:function(keyword,cellAttributesMap){var lowerCaseOnly=keyword.toLowerCase()==keyword,match=_.reduce(this.papers,function(wasMatch,paper,group){var matchedCells=paper.model.get("cells").filter(function(cell){var cellView=paper.findViewByModel(cell),cellMatch=!keyword||_.some(cellAttributesMap,function(paths,type){if("*"!=type&&cell.get("type")!=type)return!1;var attributeMatch=_.some(paths,function(path){var value=joint.util.getByPath(cell.attributes,path,"/");return!_.isUndefined(value)&&!_.isNull(value)&&(value=value.toString(),lowerCaseOnly&&(value=value.toLowerCase()),0<=value.indexOf(keyword))});return attributeMatch});return V(cellView.el).toggleClass("unmatched",!cellMatch),cellMatch},this),isMatch=!_.isEmpty(matchedCells),filteredGraph=(new joint.dia.Graph).resetCells(matchedCells);return this.trigger("filter",filteredGraph,group),this.isLayoutEnabled()&&this.layoutGroup(filteredGraph,this.getGroup(group)),this.$groups[group]&&this.$groups[group].toggleClass("unmatched",!isMatch),paper.fitToContent({gridWidth:1,gridHeight:1,padding:this.options.paperPadding||10}),wasMatch||isMatch},!1,this);this.$el.toggleClass("not-found",!match)},getGroup:function(name){return this.options.groups&&this.options.groups[name]||{}},onSearch:function(evt){this.filter(evt.target.value,this.options.search)},pointerFocusIn:function(){this.$el.addClass("is-focused")},pointerFocusOut:function(){this.$el.removeClass("is-focused")},onGroupLabelClick:function(evt){evt.preventDefault();var $group=$(evt.target).closest(".group");this.toggleGroup($group.data("name"))},toggleGroup:function(name){this.$('.group[data-name="'+name+'"]').toggleClass("closed")},closeGroup:function(name){this.$('.group[data-name="'+name+'"]').addClass("closed")},openGroup:function(name){this.$('.group[data-name="'+name+'"]').removeClass("closed")},closeGroups:function(){this.$(".group").addClass("closed")},openGroups:function(){this.$(".group").removeClass("closed")},onRemove:function(){_.invoke(this.papers,"remove"),this.papers={},this._paperDrag&&(this._paperDrag.remove(),this._paperDrag=null),$(document.body).off(".stencil",this.onDrag).off(".stencil",this.onDragEnd),$(window).off("mouseup.stencil",this.onDragEnd)}})}(joint,_),function(joint){joint.ui.Inspector=joint.mvc.View.extend({className:"inspector",options:{cellView:void 0,cell:void 0,live:!0,validateInput:function(input,path,type){return!input.validity||input.validity.valid},renderFieldContent:void 0,operators:{},multiOpenGroups:!0,stateKey:function(model){return model.id}},events:{mousedown:"startBatchCommand","change [data-attribute]:not([data-custom-field])":"onChangeInput","click .group-label":"onGroupLabelClick","click .btn-list-add":"addListItem","click .btn-list-del":"deleteListItem"},init:function(){this.options.groups=this.options.groups||{},_.bindAll(this,"stopBatchCommand"),$(document).on("mouseup",this.stopBatchCommand),this.widgets=[],this.flatAttributes=joint.util.flattenObject(this.options.inputs,"/",function(obj){return obj.type}),this._when={},this._bound={};var attributesArray=_.map(this.flatAttributes,function(options,path){if(options.when){var dependant={expression:options.when,path:path};_.each(this.extractExpressionPaths(dependant.expression),function(condPath){(this._when[condPath]||(this._when[condPath]=[])).push(dependant)},this)}return"select"==options.type&&_.isString(options.options)&&(this._bound[path]=options.options),options.path=path,options},this);this.groupedFlatAttributes=_.sortBy(_.sortBy(attributesArray,"index"),function(options){var groupOptions=this.options.groups[options.group];return groupOptions&&groupOptions.index||Number.MAX_VALUE},this),this.on("render",function(){var byPath={},attributeKeys=[];_.each(this.$("[data-attribute]"),function(attribute){var $attribute=$(attribute),path=$attribute.attr("data-attribute");byPath[path]=$attribute,attributeKeys.push(path.substring(0,path.indexOf("/"))||path)},this),this._byPath=byPath,this._attributeKeys=_.uniq(attributeKeys),_.each(this.$groups,function(group){var $group=$(group),isGroupEmpty=0===$group.find("> .field:not(.hidden)").length;$group.toggleClass("empty",isGroupEmpty)})},this),this.listenTo(this.getModel(),"all",this.onCellChange,this)},getModel:function(){return this.options.cell||this.options.cellView.model},onCellChange:function(eventName,cell,change,opt){if((opt=opt||{}).inspector!=this.cid)switch(eventName){case"remove":this.remove();break;case"change:position":this.updateInputPosition();break;case"change:size":this.updateInputSize();break;case"change:angle":this.updateInputAngle();break;case"change:source":case"change:target":case"change:vertices":break;default:if("change:"===eventName.slice(0,"change:".length)){var attributeKey=eventName.slice("change:".length);_.contains(this._attributeKeys,attributeKey)&&this.render()}}},render:function(){var lastGroup;this.$el.empty(),_.invoke(this.widgets,"remove");var $group,$groups=[];return _.each(this.groupedFlatAttributes,function(options){if(lastGroup!==options.group){var groupOptions=this.options.groups[options.group];$group=this.renderGroup({name:options.group,label:groupOptions&&groupOptions.label}),groupOptions&&groupOptions.closed?this.closeGroup($group,{init:!0}):this.openGroup($group,{init:!0}),$groups.push($group)}this.renderTemplate($group,options,options.path),lastGroup=options.group},this),this.$groups=$groups,this.$el.append($groups),this.trigger("render"),this},getCellAttributeValue:function(path,options){var cell=this.getModel(),value=joint.util.getByPath(cell.attributes,path,"/");if(!(options=options||this.flatAttributes[path]))return value;if(_.isUndefined(value)&&!_.isUndefined(options.defaultValue)&&(value=options.defaultValue),options.valueRegExp){if(_.isUndefined(value))throw new Error("Inspector: defaultValue must be present when valueRegExp is used.");var valueMatch=value.match(new RegExp(options.valueRegExp));value=valueMatch&&valueMatch[2]}return value},resolveBindings:function(options){switch(options.type){case"select":var items=options.options||[];_.isString(items)&&(items=joint.util.getByPath(this.getModel().attributes,items,"/")||[]),_.isObject(items[0])||(items=_.map(items,function(item){return{value:item,content:item}})),options.items=items}},updateBindings:function(path){var slaves=_.reduce(this._bound,function(result,master,slave){return 0==path.indexOf(master)&&result.push(slave),result},[]);_.isEmpty(slaves)||(_.each(slaves,function(slave){this.renderTemplate(null,this.flatAttributes[slave],slave,{replace:!0})},this),this.trigger("render"))},renderFieldContent:function(options,path,value){var fieldHtml,widget,selectedIndex,originalSelection,$label;if(_.isFunction(this.options.renderFieldContent)&&(fieldHtml=this.options.renderFieldContent(options,path,value)))return $(fieldHtml).attr({"data-attribute":path,"data-type":options.type,"data-custom-field":!0});switch(options.type){case"select-box":selectedIndex=_.findIndex(options.options,function(option){return option.value===value||!(!_.isUndefined(option.value)||option.content!==value)}),(widget=new joint.ui.SelectBox(_.extend({},_.omit(options,"type","group","index"),{selected:selectedIndex}))).$el.attr({"data-attribute":path,"data-type":options.type}),widget.render(),$label=$("<label/>",{html:options.label||path}),fieldHtml=$("<div/>").append($label,widget.el),options.previewMode?(originalSelection=widget.selection,widget.on("options:mouseout close",function(){widget.selection=originalSelection,this.processInput(widget.$el,{previewCancel:!0,dry:!0})},this),widget.on("option:hover",function(option,index){widget.selection=option,this.processInput(widget.$el,{dry:!0})},this),widget.on("option:select",function(option,index){var originalValue=_.isUndefined(originalSelection)?void 0:widget.getSelectionValue(originalSelection),newValue=widget.getSelectionValue(option),dry=originalValue===newValue;this.processInput(widget.$el,{previewDone:!0,dry:dry,originalValue:originalValue}),originalSelection=option},this)):widget.on("option:select",function(option,index){this.processInput(widget.$el)},this),this.widgets.push(widget);break;case"color-palette":selectedIndex=_.findIndex(options.options,function(option){return option.value===value||!(!_.isUndefined(option.value)||option.content!==value)}),(widget=new joint.ui.ColorPalette(_.extend({},_.omit(options,"type","group","index"),{selected:selectedIndex}))).$el.attr({"data-attribute":path,"data-type":options.type}),widget.render(),$label=$("<label/>",{html:options.label||path}),fieldHtml=$("<div/>").append($label,widget.el),options.previewMode?(originalSelection=widget.selection,widget.on("options:mouseout close",function(){widget.selection=originalSelection,this.processInput(widget.$el,{previewCancel:!0,dry:!0})},this),widget.on("option:hover",function(option,index){widget.selection=option,this.processInput(widget.$el,{dry:!0})},this),widget.on("option:select",function(option,index){var originalValue=_.isUndefined(originalSelection)?void 0:widget.getSelectionValue(originalSelection),newValue=widget.getSelectionValue(option),dry=originalValue===newValue;this.processInput(widget.$el,{previewDone:!0,dry:dry,originalValue:originalValue}),originalSelection=option},this)):widget.on("option:select",function(option,index){this.processInput(widget.$el)},this),this.widgets.push(widget);break;case"select-button-group":options.multi?(selectedIndex=[],_.each(options.options,function(option,idx){_.contains(value,_.isUndefined(option.value)?option.content:option.value)&&selectedIndex.push(idx)})):selectedIndex=_.findIndex(options.options,function(option){return option.value===value||!(!_.isUndefined(option.value)||option.content!==value)}),(widget=new joint.ui.SelectButtonGroup(_.extend({},_.omit(options,"type","group","index"),{selected:selectedIndex}))).$el.attr({"data-attribute":path,"data-type":options.type}),widget.render(),$label=$("<label/>",{html:options.label||path}),fieldHtml=$("<div/>").append($label,widget.el),options.previewMode?(originalSelection=widget.selection,widget.on("mouseout",function(){widget.selection=originalSelection,this.processInput(widget.$el,{previewCancel:!0,dry:!0})},this),widget.on("option:hover",function(option,index){options.multi?widget.selection=_.uniq(widget.selection.concat([option])):widget.selection=option,this.processInput(widget.$el,{dry:!0})},this),widget.on("option:select",function(selection,index){var originalValue=_.isUndefined(originalSelection)?void 0:widget.getSelectionValue(originalSelection),newValue=widget.getSelectionValue(selection),dry=_.isEqual(originalValue,newValue);this.processInput(widget.$el,{previewDone:!0,dry:dry,originalValue:originalValue}),originalSelection=selection},this)):widget.on("option:select",function(option,index){this.processInput(widget.$el)},this),this.widgets.push(widget);break;default:fieldHtml=this.renderOwnFieldContent({options:options,type:options.type,label:options.label||path,attribute:path,value:value})}return fieldHtml},renderGroup:function(opt){opt=opt||{};var $group=$("<div/>").addClass("group").attr("data-name",opt.name),$label=$("<h3/>").addClass("group-label").text(opt.label||opt.name);return $group.append($label)},renderOwnFieldContent:function(opt){var content,$input,$wrapper,$output,$units,$button,$nest,$label;switch($label=$("<label/>").text(opt.label),opt.type){case"number":$input=$("<input/>",{type:"number",min:opt.options.min,max:opt.options.max,step:opt.options.step}).val(opt.value),content=[$label,$input];break;case"range":$label.addClass("with-output"),$output=$("<output/>").text(opt.value),$units=$("<span/>").addClass("units").text(opt.options.unit),($input=$("<input/>",{type:"range",name:opt.type,min:opt.options.min,max:opt.options.max,step:opt.options.step}).val(opt.value)).on("input",function(){$output.text($input.val())}),content=[$label,$output,$units,$input];break;case"textarea":$input=$("<textarea/>").text(opt.value),content=[$label,$input];break;case"select":$input=$("<select/>",{size:opt.options.length}).prop("multiple",!!opt.multiple),_.each(opt.options.items,function(item){var $option=$("<option/>",{value:item.value}).text(item.content);item.value!==opt.value&&!_.contains(opt.value,item.value)||$option.attr("selected","selected"),$input.append($option)}),content=[$label,$input];break;case"toggle":$button=$("<span><i/></span>"),$input=$("<input/>",{type:"checkbox"}).prop("checked",!!opt.value),$wrapper=$("<div/>").addClass(opt.type),content=[$label,$wrapper.append($input,$button)];break;case"color":$input=$("<input/>",{type:"color"}).val(opt.value),content=[$label,$input];break;case"text":$input=$("<input/>",{type:"text"}).val(opt.value),content=[$label,$input];break;case"object":$input=$("<div/>"),$nest=$("<div/>").addClass("object-properties"),content=[$label,$input.append($nest)];break;case"list":$button=$("<button/>").addClass("btn-list-add").text(opt.options.addButtonLabel||"+"),$nest=$("<div/>").addClass("list-items"),$input=$("<div/>"),content=[$label,$input.append($button,$nest)]}return $input&&$input.addClass(opt.type).attr({"data-type":opt.type,"data-attribute":opt.attribute}),$.fn.append.apply($("<div>"),content).children()},renderObjectProperty:function(opt){var $objectProperty=$("<div/>",{"data-property":(opt=opt||{}).property,class:"object-property"});return $objectProperty},renderListItem:function(opt){opt=opt||{};var $button=$("<button/>").addClass("btn-list-del").text(opt.options.removeButtonLabel||"-"),$listItem=$("<div/>",{"data-index":opt.index,class:"list-item"});return $listItem.append($button)},renderFieldContainer:function(opt){var $field=$("<div/>",{"data-field":(opt=opt||{}).path,class:"field"});return $field},renderTemplate:function($el,options,path,opt){$el=$el||this.$el,opt=opt||{},this.resolveBindings(options);var $field=this.renderFieldContainer({path:path});options.when&&!this.isExpressionValid(options.when)&&($field.addClass("hidden"),options.when.otherwise&&options.when.otherwise.unset&&this.unsetProperty(path));var value=this.getCellAttributeValue(path,options),$input=this.renderFieldContent(options,path,value);if($field.append($input),joint.util.setAttributesBySelector($field,options.attrs),"list"===options.type)_.each(value,function(itemValue,idx){var $listItem=this.renderListItem({index:idx,options:options});this.renderTemplate($listItem,options.item,path+"/"+idx),$input.children(".list-items").append($listItem)},this);else if("object"===options.type){options.flatAttributes=joint.util.flattenObject(options.properties,"/",function(obj){return obj.type});var attributesArray=_.map(options.flatAttributes,function(options,path){return options.path=path,options});attributesArray=_.sortBy(attributesArray,function(options){return options.index}),_.each(attributesArray,function(propertyOptions){var $objectProperty=this.renderObjectProperty({property:propertyOptions.path});this.renderTemplate($objectProperty,propertyOptions,path+"/"+propertyOptions.path),$input.children(".object-properties").append($objectProperty)},this)}opt.replace?$el.find('[data-field="'+path+'"]').replaceWith($field):$el.append($field)},updateInputPosition:function(){var $inputX=this._byPath["position/x"],$inputY=this._byPath["position/y"],position=this.getModel().get("position");$inputX&&$inputX.val(position.x),$inputY&&$inputY.val(position.y)},updateInputSize:function(){var $inputWidth=this._byPath["size/width"],$inputHeight=this._byPath["size/height"],size=this.getModel().get("size");$inputWidth&&$inputWidth.val(size.width),$inputHeight&&$inputHeight.val(size.height)},updateInputAngle:function(){var $inputAngle=this._byPath.angle,angle=this.getModel().get("angle");$inputAngle&&$inputAngle.val(angle)},validateInput:function(type,input,path){switch(type){case"select-box":case"color-palette":case"select-button-group":return!0;default:return this.options.validateInput(input,path,type)}},onChangeInput:function(evt){this.processInput($(evt.target))},processInput:function($input,opt){var path=$input.attr("data-attribute"),type=$input.attr("data-type");if(this.validateInput(type,$input[0],path)){this.options.live&&this.updateCell($input,path,opt);var rawValue=this.getFieldValue($input[0],type),value=this.parse(type,rawValue,$input[0]);this.trigger("change:"+path,value,$input[0],opt),this.updateDependants(path)}},updateDependants:function(path){_.each(this._when[path],function(dependant){var $attribute=this._byPath[dependant.path],$field=$attribute.closest(".field"),previouslyHidden=$field.hasClass("hidden"),valid=this.isExpressionValid(dependant.expression);$field.toggleClass("hidden",!valid),dependant.expression.otherwise&&dependant.expression.otherwise.unset&&this.options.live&&(valid?previouslyHidden&&this.updateCell($attribute,dependant.path):(this.unsetProperty(dependant.path),this.renderTemplate(null,this.flatAttributes[dependant.path],dependant.path,{replace:!0}),this.trigger("render")))},this)},unsetProperty:function(path,opt){var cell=this.getModel(),pathArray=path.split("/"),attribute=_.first(pathArray),nestedAttrPath=pathArray.slice(1).join("/");if((opt=opt||{}).inspector=this.cid,opt["inspector_"+this.cid]=!0,"attrs"==path)cell.removeAttr(nestedAttrPath,opt);else if(path==attribute)cell.unset(attribute,opt);else{var oldAttrValue=_.merge({},cell.get(attribute)),newAttrValue=joint.util.unsetByPath(oldAttrValue,nestedAttrPath,"/");cell.set(attribute,newAttrValue,opt)}},getOptions:function($attribute){if(0!==$attribute.length){var path=$attribute.attr("data-attribute"),options=this.flatAttributes[path];if(!options){var $parentAttribute=$attribute.parent().closest("[data-attribute]"),parentPath=$parentAttribute.attr("data-attribute");options=this.getOptions($parentAttribute);var childPath=path.replace(parentPath+"/",""),parent=options;(options=parent.item||parent.flatAttributes[childPath]).parent=parent}return options}},updateCell:function($attr,attrPath,opt){var cell=this.getModel(),byPath={};$attr?byPath[attrPath]=$attr:byPath=this._byPath,this.startBatchCommand();var listsByPath={},valuesByPath={};_.each(byPath,function($attribute,path){if(!$attribute.closest(".field").hasClass("hidden")){var itemPath,listPath,type=$attribute.attr("data-type");switch(type){case"list":(listPath=this.findParentListByPath(path))?(itemPath=path.substr(listPath.length+1),joint.util.setByPath(listsByPath[listPath],itemPath,[],"/")):listsByPath[path]=[];break;case"object":break;default:if(!this.validateInput(type,$attribute[0],path))return;var rawValue=this.getFieldValue($attribute[0],type),value=this.parse(type,rawValue,$attribute[0]),options=this.getOptions($attribute);if(options.valueRegExp){var oldValue=joint.util.getByPath(cell.attributes,path,"/")||options.defaultValue;value=oldValue.replace(new RegExp(options.valueRegExp),"$1"+value+"$3")}if((listPath=this.findParentListByPath(path))&&listsByPath[listPath])return itemPath=path.substr(listPath.length+1),void joint.util.setByPath(listsByPath[listPath],itemPath,value,"/");valuesByPath[path]=value}}},this),_.each(valuesByPath,function(value,path){this.setProperty(path,value,opt),this.updateBindings(path)},this),_.each(listsByPath,function(value,path){this.setProperty(path,value,_.extend({rewrite:!0},opt)),this.updateBindings(path)},this),this.stopBatchCommand()},findParentListByPath:function(path){for(var currentObject,currentItem,pathArray=path.split("/"),index=0,currentPath=pathArray[index],currentOptions=this.flatAttributes[currentPath];index<pathArray.length-1&&(!currentOptions||"list"!==currentOptions.type);)currentOptions&&"object"===currentOptions.type&&(currentObject=currentOptions.properties),currentItem=pathArray[++index],currentPath+="/"+currentItem,currentOptions=currentObject?currentObject[currentItem]:this.flatAttributes[currentPath];return currentPath!==path?currentPath:null},getFieldValue:function(attribute,type){if(_.isFunction(this.options.getFieldValue)){var fieldValue=this.options.getFieldValue(attribute,type);if(fieldValue)return fieldValue.value}var $attribute=$(attribute);switch(type){case"select-box":case"color-palette":case"select-button-group":var view=$attribute.data("view");if(!view)throw new Error("ui.Inspector: can not read value of removed "+type);return view.getSelectionValue();default:return $attribute.val()}},setProperty:function(path,value,opt){(opt=opt||{}).inspector=this.cid;var prop=joint.dia.Cell.prototype.prop,model=this.getModel();opt.previewDone&&prop.call(model,path,opt.originalValue,{rewrite:!0,silent:!0}),_.isUndefined(value)?joint.dia.Cell.prototype.removeProp.call(model,path,opt):prop.call(model,path,_.clone(value),opt)},parse:function(type,value,targetElement){switch(type){case"number":case"range":value=parseFloat(value);break;case"toggle":value=targetElement.checked;break;default:value=value}return value},startBatchCommand:function(){this.inBatch||(this.inBatch=!0,this.getModel().startBatch("inspector",{cid:this.cid}))},stopBatchCommand:function(){this.inBatch&&(this.getModel().stopBatch("inspector",{cid:this.cid}),this.inBatch=!1)},addListItem:function(evt){var $target=$(evt.target),$attribute=$target.closest("[data-attribute]"),path=$attribute.attr("data-attribute"),options=this.getOptions($attribute),$lastListItem=$attribute.children(".list-items").children(".list-item").last(),lastIndex=0===$lastListItem.length?-1:parseInt($lastListItem.attr("data-index"),10),index=lastIndex+1,$listItem=this.renderListItem({index:index,options:options});this.renderTemplate($listItem,options.item,path+"/"+index),$target.parent().children(".list-items").append($listItem),$listItem.find("input:first").focus(),this.trigger("render"),this.options.live&&this.updateCell()},deleteListItem:function(evt){var $listItem=$(evt.target).closest(".list-item");$listItem.nextAll(".list-item").each(function(){var index=parseInt($(this).attr("data-index"),10),newIndex=index-1;$(this).find("[data-field]").each(function(){$(this).attr("data-field",$(this).attr("data-field").replace("/"+index,"/"+newIndex))}),$(this).find("[data-attribute]").each(function(){$(this).attr("data-attribute",$(this).attr("data-attribute").replace("/"+index,"/"+newIndex))}),$(this).attr("data-index",newIndex)}),$listItem.remove(),this.trigger("render"),this.options.live&&this.updateCell()},onRemove:function(){_.invoke(this.widgets,"remove"),$(document).off("mouseup",this.stopBatchCommand)},onGroupLabelClick:function(evt){evt.preventDefault(),this.options.multiOpenGroups||this.closeGroups();var $group=$(evt.target).closest(".group");this.toggleGroup($group)},toggleGroup:function(name){var $group=_.isString(name)?this.$('.group[data-name="'+name+'"]'):$(name);$group.hasClass("closed")?this.openGroup($group):this.closeGroup($group)},closeGroup:function(name,opt){opt=opt||{};var $group=_.isString(name)?this.$('.group[data-name="'+name+'"]'):$(name);!opt.init&&$group.hasClass("closed")||($group.addClass("closed"),this.trigger("group:close",$group.data("name"),opt))},openGroup:function(name,opt){opt=opt||{};var $group=_.isString(name)?this.$('.group[data-name="'+name+'"]'):$(name);(opt.init||$group.hasClass("closed"))&&($group.removeClass("closed"),this.trigger("group:open",$group.data("name"),opt))},closeGroups:function(){_.each(this.$groups,this.closeGroup,this)},openGroups:function(){_.each(this.$groups,this.openGroup,this)},COMPOSITE_OPERATORS:["not","and","or","nor"],PRIMITIVE_OPERATORS:["eq","ne","regex","text","lt","lte","gt","gte","in","nin"],_isComposite:function(expr){return 0<_.intersection(this.COMPOSITE_OPERATORS,_.keys(expr)).length},_isPrimitive:function(expr){var operators=_.keys(this.options.operators).concat(this.PRIMITIVE_OPERATORS);return 0<_.intersection(operators,_.keys(expr)).length},_evalCustomPrimitive:function(name,value,args){return!!this.options.operators[name].apply(this,[this.getModel(),value].concat(args))},_evalPrimitive:function(expr){return _.reduce(expr,function(res,condition,operator){return _.reduce(condition,function(res,condValue,condPath){var val=this.getCellAttributeValue(condPath);if(_.isFunction(this.options.operators[operator]))return this._evalCustomPrimitive(operator,val,condValue);switch(operator){case"eq":return condValue==val;case"ne":return condValue!=val;case"regex":return new RegExp(condValue).test(val);case"text":return!condValue||_.isString(val)&&-1<val.toLowerCase().indexOf(condValue);case"lt":return val<condValue;case"lte":return val<=condValue;case"gt":return condValue<val;case"gte":return condValue<=val;case"in":return _.contains(condValue,val);case"nin":return!_.contains(condValue,val);default:return res}},!1,this)},!1,this)},_evalExpression:function(expr){return this._isPrimitive(expr)?this._evalPrimitive(expr):_.reduce(expr,function(res,childExpr,operator){if("not"==operator)return!this._evalExpression(childExpr);var childExprRes=_.map(childExpr,this._evalExpression,this);switch(operator){case"and":return _.every(childExprRes);case"or":return _.some(childExprRes);case"nor":return!_.some(childExprRes);default:return res}},!1,this)},_extractVariables:function(expr){return _.isArray(expr)||this._isComposite(expr)?_.reduce(expr,function(res,childExpr){return res.concat(this._extractVariables(childExpr))},[],this):_.reduce(expr,function(res,primitive){return _.keys(primitive)},[])},isExpressionValid:function(expr){return expr=_.omit(expr,"otherwise","dependencies"),this._evalExpression(expr)},extractExpressionPaths:function(expr){var dependencies=expr&&expr.dependencies||[];return expr=_.omit(expr,"otherwise","dependencies"),_.uniq(this._extractVariables(expr).concat(dependencies))},getGroupsStateKey:function(){if(_.isFunction(this.options.stateKey))return this.options.stateKey(this.getModel());throw new Error("Inspector: Option stateKey must be a function")},storeGroupsState:function(){var key=this.getGroupsStateKey();joint.ui.Inspector.groupStates[key]=_.map(this.$(".group.closed"),function(g){return $(g).attr("data-name")})},getGroupsState:function(){return joint.ui.Inspector.groupStates[this.getGroupsStateKey()]},restoreGroupsState:function(){var processGroups=function(isClosed,context){_.each(context.options.groups,function(group,groupName){isClosed(group,groupName)?this.closeGroup(groupName):this.openGroup(groupName)},context)},key=this.getGroupsStateKey();joint.ui.Inspector.groupStates[key]?processGroups(function(group,groupName){return _.contains(joint.ui.Inspector.groupStates[key],groupName)},this):processGroups(function(group){return group.closed},this)}},{groupStates:{},instance:null,create:function(container,opt){opt=opt||{},_.defaults(opt,{restoreGroupsState:!0,storeGroupsState:!0});var cell=opt.cell||opt.cellView.model,inspector=joint.ui.Inspector.instance;return inspector&&inspector.options.cell===cell||(inspector&&inspector.el.parentNode&&(opt.storeGroupsState&&inspector.storeGroupsState(),inspector.updateCell(),inspector.remove()),inspector=new joint.ui.Inspector(opt).render(),joint.ui.Inspector.instance=inspector,$(container).html(inspector.el),opt.restoreGroupsState&&inspector.restoreGroupsState()),inspector}})}(joint),joint.ui.FreeTransform=joint.mvc.View.extend({className:"free-transform",events:{"mousedown .resize":"startResizing","mousedown .rotate":"startRotating","touchstart .resize":"startResizing","touchstart .rotate":"startRotating"},DIRECTIONS:["nw","n","ne","e","se","s","sw","w"],POSITIONS:["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],options:{cellView:void 0,rotateAngleGrid:15,preserveAspectRatio:!1,minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,allowOrthogonalResize:!0,allowRotation:!0},init:function(){this.options.cellView&&_.defaults(this.options,{cell:this.options.cellView.model,paper:this.options.cellView.paper,graph:this.options.cellView.paper.model}),_.bindAll(this,"update","remove","pointerup","pointermove"),joint.ui.FreeTransform.clear(this.options.paper),$(document.body).on("mousemove touchmove",this.pointermove),$(document).on("mouseup touchend",this.pointerup),this.listenTo(this.options.graph,"all",this.update),this.listenTo(this.options.graph,"reset",this.remove),this.listenTo(this.options.cell,"remove",this.remove),this.listenTo(this.options.paper,"blank:pointerdown",this.remove),this.listenTo(this.options.paper,"scale translate",this.update),this.options.paper.$el.append(this.el),joint.ui.FreeTransform.registerInstanceToPaper(this,this.options.paper)},renderHandles:function(){var $handleTemplate=$("<div/>").prop("draggable",!1),$rotateHandle=$handleTemplate.clone().addClass("rotate"),$resizeHandles=_.map(this.POSITIONS,function(position){return $handleTemplate.clone().addClass("resize").attr("data-position",position)});this.$el.empty().append($resizeHandles,$rotateHandle)},render:function(){this.renderHandles(),this.$el.attr("data-type",this.options.cell.get("type")),this.$el.toggleClass("no-orthogonal-resize",this.options.preserveAspectRatio||!this.options.allowOrthogonalResize),this.$el.toggleClass("no-rotation",!this.options.allowRotation),this.update()},update:function(){var viewportCTM=this.options.paper.viewport.getCTM(),bbox=this.options.cell.getBBox();bbox.x*=viewportCTM.a,bbox.x+=viewportCTM.e,bbox.y*=viewportCTM.d,bbox.y+=viewportCTM.f,bbox.width*=viewportCTM.a,bbox.height*=viewportCTM.d;var angle=g.normalizeAngle(this.options.cell.get("angle")||0),transformVal="rotate("+angle+"deg)";this.$el.css({width:bbox.width+4,height:bbox.height+4,left:bbox.x-3,top:bbox.y-3,transform:transformVal,"-webkit-transform":transformVal,"-ms-transform":transformVal});var shift=Math.floor(angle*(this.DIRECTIONS.length/360));if(shift!=this._previousDirectionsShift){var directions=this.DIRECTIONS.slice(shift).concat(this.DIRECTIONS.slice(0,shift));this.$(".resize").removeClass(this.DIRECTIONS.join(" ")).each(function(index,el){$(el).addClass(directions[index])}),this._previousDirectionsShift=shift}},calculateTrueDirection:function(relativeDirection){var cell=this.options.cell,normalizedAngle=g.normalizeAngle(cell.get("angle")),trueDirectionIndex=this.POSITIONS.indexOf(relativeDirection);return trueDirectionIndex+=Math.floor(normalizedAngle*(this.POSITIONS.length/360)),trueDirectionIndex%=this.POSITIONS.length,this.POSITIONS[trueDirectionIndex]},startResizing:function(evt){evt.stopPropagation(),this.options.graph.trigger("batch:start");var relativeDirection=$(evt.target).data("position"),trueDirection=this.calculateTrueDirection(relativeDirection),rx=0,ry=0;_.each(relativeDirection.split("-"),function(singleDirection){rx={left:-1,right:1}[singleDirection]||rx,ry={top:-1,bottom:1}[singleDirection]||ry});var direction=this.toValidResizeDirection(relativeDirection),selector={"top-right":"bottomLeft","top-left":"corner","bottom-left":"topRight","bottom-right":"origin"}[direction];this._initial={angle:g.normalizeAngle(this.options.cell.get("angle")||0),resizeX:rx,resizeY:ry,selector:selector,direction:direction,relativeDirection:relativeDirection,trueDirection:trueDirection},this._action="resize",this.startOp(evt.target)},toValidResizeDirection:function(direction){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[direction]||direction},startRotating:function(evt){evt.stopPropagation(),this.options.graph.trigger("batch:start");var center=this.options.cell.getBBox().center(),clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY});this._initial={centerRotation:center,modelAngle:g.normalizeAngle(this.options.cell.get("angle")||0),startAngle:g.point(clientCoords).theta(center)},this._action="rotate",this.startOp(evt.target)},pointermove:function(evt){if(this._action){evt=joint.util.normalizeEvent(evt);var clientCoords=this.options.paper.snapToGrid({x:evt.clientX,y:evt.clientY}),gridSize=this.options.paper.options.gridSize,model=this.options.cell,i=this._initial;switch(this._action){case"resize":var currentRect=model.getBBox(),coimageCoords=g.point(clientCoords).rotate(currentRect.center(),i.angle),requestedSize=coimageCoords.difference(currentRect[i.selector]()),width=i.resizeX?requestedSize.x*i.resizeX:currentRect.width,height=i.resizeY?requestedSize.y*i.resizeY:currentRect.height;if(width=g.snapToGrid(width,gridSize),height=g.snapToGrid(height,gridSize),width=Math.max(width,this.options.minWidth||gridSize),height=Math.max(height,this.options.minHeight||gridSize),width=Math.min(width,this.options.maxWidth),height=Math.min(height,this.options.maxHeight),this.options.preserveAspectRatio){var candidateWidth=currentRect.width*height/currentRect.height,candidateHeight=currentRect.height*width/currentRect.width;width<candidateWidth?height=candidateHeight:width=candidateWidth}currentRect.width==width&&currentRect.height==height||model.resize(width,height,{direction:i.direction,relativeDirection:i.relativeDirection,trueDirection:i.trueDirection,ui:!0});break;case"rotate":var theta=i.startAngle-g.point(clientCoords).theta(i.centerRotation);model.rotate(g.snapToGrid(i.modelAngle+theta,this.options.rotateAngleGrid),!0)}}},pointerup:function(evt){this._action&&(this.stopOp(),this.options.graph.trigger("batch:stop"),this._action=null,this._initial=null)},onRemove:function(){$(document.body).off("mousemove touchmove",this.pointermove),$(document).off("mouseup touchend",this.pointerup),joint.ui.FreeTransform.unregisterInstanceFromPaper(this,this.options.paper)},startOp:function(el){el&&($(el).addClass("in-operation"),this._elementOp=el),this.$el.addClass("in-operation")},stopOp:function(){this._elementOp&&($(this._elementOp).removeClass("in-operation"),this._elementOp=null),this.$el.removeClass("in-operation")}},{instancesByPaper:{},clear:function(paper){paper.trigger("freetransform:create"),this.removeInstancesForPaper(paper)},removeInstancesForPaper:function(paper){_.invoke(this.getInstancesForPaper(paper),"remove")},getInstancesForPaper:function(paper){return this.instancesByPaper[paper.cid]||{}},registerInstanceToPaper:function(instance,paper){this.instancesByPaper[paper.cid]||(this.instancesByPaper[paper.cid]={}),this.instancesByPaper[paper.cid][instance.cid]=instance},unregisterInstanceFromPaper:function(instance,paper){this.instancesByPaper[paper.cid]&&(this.instancesByPaper[paper.cid][instance.cid]=null)}}),joint.ui.Tooltip=joint.mvc.View.extend({className:"tooltip",options:{left:void 0,right:void 0,top:void 0,bottom:void 0,position:void 0,positionSelector:void 0,direction:void 0,padding:0,rootTarget:null,target:null,trigger:"hover",viewport:{selector:null,padding:0},dataAttributePrefix:"tooltip",template:'<div class="tooltip-arrow"/><div class="tooltip-arrow-mask"/><div class="tooltip-content"/>'},init:function(){this.eventNamespace="."+this.className+this.cid;var triggers=this.options.trigger.split(" ");_.bindAll(this,"render","hide","show","toggle","isVisible","position"),this.options.rootTarget?(this.$rootTarget=$(this.options.rootTarget),_.each(triggers,function(trigger){switch(trigger){case"click":this.$rootTarget.on("click"+this.eventNamespace,this.options.target,this.toggle);break;case"hover":this.$rootTarget.on("mouseover"+this.eventNamespace,this.options.target,this.render);break;case"focus":this.$rootTarget.on("focusin"+this.eventNamespace,this.options.target,this.render)}},this)):(this.$target=$(this.options.target),_.each(triggers,function(trigger){switch(trigger){case"click":this.$target.on("click"+this.eventNamespace,this.toggle);break;case"hover":this.$target.on("mouseover"+this.eventNamespace,this.render);break;case"focus":this.$target.on("focusin"+this.eventNamespace,this.render)}},this)),this.$el.append(this.options.template)},onRemove:function(){this.options.rootTarget?this.$rootTarget.off(this.eventNamespace):this.$target.off(this.eventNamespace)},hide:function(){var settings=this.settings;if(settings){this.unbindHideActions(settings.currentTarget);var className=settings.className||"";this.$el.removeClass(className.replace(this.className,"")),this.$el.removeClass("rendered"),this.$el.remove()}},show:function(evt){this.render(evt||{target:this.options.target})},toggle:function(evt){this.isVisible()?this.hide():this.show(evt)},isVisible:function(){return document.body.contains(this.el)},render:function(evt){var point=_.isUndefined(evt.x)||_.isUndefined(evt.y)?null:evt,element=$(evt.target).closest(this.options.target)[0],elementDefinition=this.loadDefinitionFromElementData(element);this.bindHideActions(element);var bbox,settings=this.settings=this.evaluateOptions(element,elementDefinition);settings.currentTarget=element,bbox=point?{x:point.x,y:point.y,width:1,height:1}:joint.util.getElementBBox(element),this.$(".tooltip-content").html(settings.content),this.$el.hide(),this.$el.removeClass("left right top bottom"),this.$el.addClass(settings.className),settings.direction&&"off"!==settings.direction&&this.$el.addClass("auto"===settings.direction?settings.position:settings.direction),$(document.body).append(this.$el);var $images=this.$("img");$images.length?$images.on("load",_.bind(function(){this.position(bbox,settings),this.$el.addClass("rendered")},this)):(this.position(bbox,settings),this.$el.addClass("rendered"))},unbindHideActions:function(element){var hideActionsNamespace=this.eventNamespace+".remove";$(element).off(hideActionsNamespace),clearInterval(this.interval)},bindHideOnRemoveTarget:function(element){clearInterval(this.interval),this.interval=setInterval(_.bind(function(){$.contains(document,element)||(clearInterval(this.interval),this.hide())},this),500)},bindHideActions:function(element){var $element=$(element),hideActionsNamespace=this.eventNamespace+".remove";this.bindHideOnRemoveTarget(element),_.each(this.options.trigger.split(" "),function(trigger){switch(trigger){case"hover":$element.on("mouseout"+hideActionsNamespace,this.hide),$element.on("mousedown"+hideActionsNamespace,this.hide);break;case"focus":$element.on("focusout"+hideActionsNamespace,this.hide),$element.on("mouseout"+hideActionsNamespace,this.hide)}},this)},evaluateOptions:function(element,elementDefinition){elementDefinition=elementDefinition||{};var settings=_.extend({},elementDefinition,this.options);return _.each(settings,function(value,key){var evaluated=_.isFunction(value)?value(element):value;settings[key]=_.isUndefined(evaluated)||_.isNull(evaluated)?elementDefinition[key]:evaluated}),this.normalizePosition(settings),settings},loadDefinitionFromElementData:function(element){if(!element)return{};var data=$(element).data(),prefix=this.options.dataAttributePrefix,options={};return _.each(data,function(value,key){if(_.startsWith(key,prefix)){var newKey=_.trimLeft(key,prefix);""===(newKey=newKey.charAt(0).toLowerCase()+newKey.slice(1))&&(newKey="content"),function(key){return key==="left"||key==="bottom"||key==="top"||key==="right"}(newKey)||(options[newKey]=value)}}),options},normalizePosition:function(options){var deprecatedDefinition=options.left||options.right||options.top||options.bottom;!options.position&&deprecatedDefinition&&(options.left&&(options.position="left"),options.right&&(options.position="right"),options.top&&(options.position="top"),options.bottom&&(options.position="bottom")),!options.positionSelector&&deprecatedDefinition&&(options.positionSelector=deprecatedDefinition)},position:function(bbox,settings){this.$el.show();var elementBBox=this.getTooltipBBox(settings,bbox);elementBBox=this.respectViewport(elementBBox,settings);var arrowPosition={};"left"===settings.position||"right"===settings.position?arrowPosition.top=bbox.y+bbox.height/2-elementBBox.top:"top"===settings.position||"bottom"===settings.position?arrowPosition.left=bbox.x+bbox.width/2-elementBBox.left:arrowPosition.top=bbox.y+bbox.height/2-elementBBox.top,this.$el.css(_.pick(elementBBox,"top","left"));var $arrows=this.$(".tooltip-arrow, .tooltip-arrow-mask");$arrows.removeAttr("style"),$arrows.css(arrowPosition)},getTooltipBBox:function(settings,targetBbox){var $element,positionedBbox,padding=settings.padding,elementBBox={width:this.$el.outerWidth(),height:this.$el.outerHeight()};return $element=$(settings.positionSelector),positionedBbox=$element[0]?joint.util.getElementBBox($element[0]):targetBbox,"left"===settings.position?_.extend(elementBBox,{x:positionedBbox.x+positionedBbox.width+padding,y:targetBbox.y+targetBbox.height/2-elementBBox.height/2}):"right"===settings.position?_.extend(elementBBox,{x:positionedBbox.x-elementBBox.width-padding,y:targetBbox.y+targetBbox.height/2-elementBBox.height/2}):"top"===settings.position?_.extend(elementBBox,{x:targetBbox.x+targetBbox.width/2-elementBBox.width/2,y:positionedBbox.y+positionedBbox.height+padding}):"bottom"===settings.position?_.extend(elementBBox,{x:targetBbox.x+targetBbox.width/2-elementBBox.width/2,y:positionedBbox.y-elementBBox.height-padding}):_.extend(elementBBox,{x:targetBbox.x+targetBbox.width+padding,y:targetBbox.y+targetBbox.height/2-elementBBox.height/2}),elementBBox},respectViewport:function(bbox,settings){bbox.top=bbox.y,bbox.left=bbox.x,bbox.right=bbox.left+bbox.width,bbox.bottom=bbox.top+bbox.height;var viewportBBox=joint.util.getElementBBox(settings.viewport.selector||"html"),marginLeft=parseInt(this.$el.css("marginLeft"),10),marginTop=parseInt(this.$el.css("marginTop"),10),$window=$(window);return settings.viewport.selector||(viewportBBox.width=$window.width()+$window.scrollLeft(),viewportBBox.height=$window.height()+$window.scrollTop()),viewportBBox.top=viewportBBox.y-marginTop,viewportBBox.left=viewportBBox.x-marginLeft,viewportBBox.right=viewportBBox.left+viewportBBox.width,viewportBBox.bottom=viewportBBox.top+viewportBBox.height,bbox.left<viewportBBox.left?bbox.left=bbox.x=viewportBBox.left+settings.viewport.padding:bbox.right>viewportBBox.right&&(bbox.left=bbox.x=viewportBBox.right-settings.viewport.padding-bbox.width),bbox.top<viewportBBox.top?bbox.top=bbox.y=viewportBBox.top+settings.viewport.padding:bbox.bottom>viewportBBox.bottom&&(bbox.top=bbox.y=viewportBBox.bottom-settings.viewport.padding-bbox.height),bbox}}),joint.ui.Snaplines=joint.mvc.View.extend({options:{paper:void 0,distance:10},className:"snaplines",init:function(){_.bindAll(this,"hide"),this.$horizontal=$("<div>").addClass("snapline horizontal").appendTo(this.el),this.$vertical=$("<div>").addClass("snapline vertical").appendTo(this.el),this.$el.hide().appendTo(this.options.paper.el),this.startListening()},startListening:function(){this.stopListening(),this.listenTo(this.options.paper,"cell:pointerdown",this.captureCursorOffset),this.listenTo(this.options.paper,"cell:pointermove",this.snapWhileMoving),this.listenTo(this.options.paper.model,"batch:stop",this.onBatchStop),$(document).on("mouseup",this.hide),this.filterTypes={},this.filterCells={},this.filterFunction=void 0,_.isArray(this.options.filter)?_.each(this.options.filter,function(item){_.isString(item)?this.filterTypes[item]=!0:this.filterCells[item.id]=!0},this):_.isFunction(this.options.filter)&&(this.filterFunction=this.options.filter)},onBatchStop:function(data){"resize"===(data=data||{}).batchName&&this.snapWhileResizing(data.cell,data)},captureCursorOffset:function(cellView,evt,x,y){if(!(cellView instanceof joint.dia.LinkView)){var cellPosition=cellView.model.get("position");this._cursorOffset={x:x-cellPosition.x,y:y-cellPosition.y}}},snapWhileResizing:function(cell,opt){if(opt.ui&&!opt.snapped&&opt.direction&&opt.trueDirection){var cellView=this.options.paper.findViewByModel(cell);if(!(cellView instanceof joint.dia.LinkView)){var cellBBox=cell.getBBox(),cellBBoxRotated=cellBBox.bbox(cell.get("angle")),cellTopLeft=cellBBoxRotated.origin(),cellBottomRight=cellBBoxRotated.corner(),normalizedAngle=g.normalizeAngle(cell.get("angle")),distance=this.options.distance,vertical=null,horizontal=null,cellLine={vertical:0,horizontal:0};if(-1!==opt.trueDirection.indexOf("right")?cellLine.vertical=cellBottomRight.x:cellLine.vertical=cellTopLeft.x,-1!==opt.trueDirection.indexOf("bottom")?cellLine.horizontal=cellBottomRight.y:cellLine.horizontal=cellTopLeft.y,_.find(this.options.paper.model.getElements(),function(snapElement){if(snapElement.id===cell.id||snapElement.isEmbeddedIn(cell)||this.filterTypes[snapElement.get("type")]||this.filterCells[snapElement.id]||this.filterFunction&&this.filterFunction(snapElement))return!1;var snapBBox=snapElement.getBBox().bbox(snapElement.get("angle")),snapTopLeft=snapBBox.origin(),snapBottomRight=snapBBox.corner(),snapLinesByAxis={vertical:[snapTopLeft.x,snapBottomRight.x],horizontal:[snapTopLeft.y,snapBottomRight.y]};return _.each(snapLinesByAxis,function(snapLines,axis){snapLines=_.map(snapLines,function(snapLine){return{position:snapLine,distance:Math.abs(snapLine-cellLine[axis])}}),snapLines=_.filter(snapLines,function(snapLine){return snapLine.distance<distance}),snapLines=_.sortBy(snapLines,function(snapLine1,snapLine2){return snapLine1.distance>snapLine2.distance?1:snapLine1.distance===snapLine2.distance?0:-1}),snapLinesByAxis[axis]=snapLines}),_.isNull(vertical)&&0<snapLinesByAxis.vertical.length&&(vertical=snapLinesByAxis.vertical[0].position),_.isNull(horizontal)&&0<snapLinesByAxis.horizontal.length&&(horizontal=snapLinesByAxis.horizontal[0].position),_.isNumber(vertical)&&_.isNumber(horizontal)},this),this.hide(),_.isNumber(vertical)||_.isNumber(horizontal)){var diffX=0;_.isNumber(vertical)&&(diffX=-1!==opt.trueDirection.indexOf("right")?vertical-cellBBoxRotated.corner().x:cellBBoxRotated.origin().x-vertical);var diffY=0;_.isNumber(horizontal)&&(diffY=-1!==opt.trueDirection.indexOf("bottom")?horizontal-cellBBoxRotated.corner().y:cellBBoxRotated.origin().y-horizontal);var quadrant,diffWidth=0,diffHeight=0,angle=normalizedAngle%90,isAtRightAngle=!(normalizedAngle%90);if(quadrant=0<=normalizedAngle&&normalizedAngle<90?1:90<=normalizedAngle&&normalizedAngle<180?4:180<=normalizedAngle&&normalizedAngle<270?3:2,isAtRightAngle)diffHeight=90===normalizedAngle||270===normalizedAngle?(diffWidth=diffY,diffX):(diffWidth=diffX,diffY);else{var angleInRadians=g.toRad(angle);horizontal&&vertical&&(diffX<diffY?(diffY=0,horizontal=null):(diffX=0,vertical=null)),diffX&&(diffWidth=3===quadrant?diffX/Math.cos(angleInRadians):diffX/Math.sin(angleInRadians)),diffY&&(diffHeight=3===quadrant?diffY/Math.cos(angleInRadians):diffY/Math.sin(angleInRadians));var isQuadrantOneOrThree=1===quadrant||3===quadrant;switch(opt.relativeDirection){case"top":case"bottom":diffHeight=diffY?diffY/(isQuadrantOneOrThree?Math.cos(angleInRadians):Math.sin(angleInRadians)):diffX/(isQuadrantOneOrThree?Math.sin(angleInRadians):Math.cos(angleInRadians));break;case"left":case"right":diffWidth=diffX?diffX/(isQuadrantOneOrThree?Math.cos(angleInRadians):Math.sin(angleInRadians)):diffY/(isQuadrantOneOrThree?Math.sin(angleInRadians):Math.cos(angleInRadians))}}switch(opt.relativeDirection){case"top":case"bottom":diffWidth=0;break;case"left":case"right":diffHeight=0}var newWidth=cellBBox.width+diffWidth,newHeight=cellBBox.height+diffHeight;cell.resize(newWidth,newHeight,{restrictedArea:this.options.paper.getRestrictedArea(cellView),snapped:!0,direction:opt.direction,relativeDirection:opt.relativeDirection,trueDirection:opt.trueDirection}),this.show({vertical:vertical,horizontal:horizontal})}}}},snapWhileMoving:function(cellView,evt,x,y){if(!(cellView instanceof joint.dia.LinkView)){var cell=cellView.model,currentPosition=cell.get("position"),currentSize=cell.get("size"),cellBBox=g.rect(_.extend({x:x-this._cursorOffset.x,y:y-this._cursorOffset.y},currentSize)),cellCenter=cellBBox.center(),cellBBoxRotated=cellBBox.bbox(cell.get("angle")),cellTopLeft=cellBBoxRotated.origin(),cellBottomRight=cellBBoxRotated.corner(),distance=this.options.distance,vertical=null,horizontal=null,verticalFix=0,horizontalFix=0;if(_.find(this.options.paper.model.getElements(),function(snapElement){if(snapElement===cell||snapElement.isEmbeddedIn(cell)||this.filterTypes[snapElement.get("type")]||this.filterCells[snapElement.id]||this.filterFunction&&this.filterFunction(snapElement))return!1;var snapBBox=snapElement.getBBox().bbox(snapElement.get("angle")),snapCenter=snapBBox.center(),snapTopLeft=snapBBox.origin(),snapBottomRight=snapBBox.corner();return _.isNull(vertical)&&(Math.abs(snapCenter.x-cellCenter.x)<distance?(vertical=snapCenter.x,verticalFix=.5):Math.abs(snapTopLeft.x-cellTopLeft.x)<distance?vertical=snapTopLeft.x:Math.abs(snapTopLeft.x-cellBottomRight.x)<distance?(vertical=snapTopLeft.x,verticalFix=1):Math.abs(snapBottomRight.x-cellBottomRight.x)<distance?(vertical=snapBottomRight.x,verticalFix=1):Math.abs(snapBottomRight.x-cellTopLeft.x)<distance&&(vertical=snapBottomRight.x)),_.isNull(horizontal)&&(Math.abs(snapCenter.y-cellCenter.y)<distance?(horizontal=snapCenter.y,horizontalFix=.5):Math.abs(snapTopLeft.y-cellTopLeft.y)<distance?horizontal=snapTopLeft.y:Math.abs(snapTopLeft.y-cellBottomRight.y)<distance?(horizontal=snapTopLeft.y,horizontalFix=1):Math.abs(snapBottomRight.y-cellBottomRight.y)<distance?(horizontal=snapBottomRight.y,horizontalFix=1):Math.abs(snapBottomRight.y-cellTopLeft.y)<distance&&(horizontal=snapBottomRight.y)),_.isNumber(vertical)&&_.isNumber(horizontal)},this),this.hide(),_.isNumber(vertical)||_.isNumber(horizontal)){_.isNumber(vertical)&&(cellBBoxRotated.x=vertical-verticalFix*cellBBoxRotated.width),_.isNumber(horizontal)&&(cellBBoxRotated.y=horizontal-horizontalFix*cellBBoxRotated.height);var newCellCenter=cellBBoxRotated.center(),newX=newCellCenter.x-cellBBox.width/2,newY=newCellCenter.y-cellBBox.height/2;cell.translate(newX-currentPosition.x,newY-currentPosition.y,{restrictedArea:this.options.paper.getRestrictedArea(cellView),snapped:!0}),this.show({vertical:vertical,horizontal:horizontal})}}},show:function(opt){opt=opt||{};var ctm=this.options.paper.viewport.getCTM();opt.horizontal?this.$horizontal.css("top",opt.horizontal*ctm.d+ctm.f).show():this.$horizontal.hide(),opt.vertical?this.$vertical.css("left",opt.vertical*ctm.a+ctm.e).show():this.$vertical.hide(),this.$el.show()},hide:function(){this.$el.hide()},onRemove:function(){$(document).off("mouseup",this.hide)}}),joint.ui.TextEditor=joint.mvc.View.extend({options:{text:void 0,newlineCharacterBBoxWidth:10,placeholder:void 0,focus:!0,debug:!1,useNativeSelection:!0,annotateUrls:!1,urlAnnotation:{attrs:{class:"url-annotation",fill:"lightblue","text-decoration":"underline"}},textareaAttributes:{autocorrect:"off",autocomplete:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}},className:"text-editor",events:{"keyup textarea":"onKeyup","input textarea":"onInput","copy textarea":"onCopy","cut textarea":"onCut","paste textarea":"onPaste","mousedown .char-selection-box":"onMousedown","dblclick .char-selection-box":"onDoubleClick","click .char-selection-box":"onTripleClick"},selection:{start:null,end:null},selecting:!1,init:function(){_.bindAll(this,"onMousedown","onMousemove","onMouseup","onDoubleClick","onTripleClick","onKeydown","onAfterPaste","onAfterKeydown"),this.setTextElement(this.options.text),$(document.body).on("mousemove",this.onMousemove),$(document.body).on("mouseup",this.onMouseup),$(document.body).on("keydown",this.onKeydown),this.options.cellView?this.$viewport=$(this.options.cellView.paper.viewport):this.$viewport=$(this.options.text),this.options.annotations&&this.setAnnotations(this.options.annotations)},setTextElement:function(textElement){this.$elText&&this.unbindTextElement(),this.options.text=textElement,this.$elText=$(textElement),this.$elText.on("mousedown",this.onMousedown),this.$elText.on("dblclick",this.onDoubleClick),this.$elText.on("click",this.onTripleClick)},render:function(root){this.$caret=$("<div>",{class:"caret"}),this.$selection=$("<div>"),this.$selectionBox=$("<div>",{class:"char-selection-box"}),this.$el.append(this.$caret,this.$selection),this.$textareaContainer=$("<div>",{class:"textarea-container"}),this.$textarea=$("<textarea>",this.options.textareaAttributes),this.textarea=this.$textarea[0],this._textContent=this.textarea.value=this.getTextContent(),this._textareaValueBeforeInput=this.textarea.value,this.$textareaContainer.append(this.textarea),this.options.focus&&this.$el.append(this.$textareaContainer),$(root||document.body).append(this.$el);var bbox=V(this.options.text).bbox();return this.$textareaContainer.css({left:bbox.x,top:bbox.y}),this.focus(),V(this.options.text).attr("cursor","text"),this.selectAll(),this},annotateURLBeforeCaret:function(selectionStart){var urlBoundary=this.getURLBoundary(Math.max(selectionStart-1,0));if(urlBoundary){var annotations=this.getAnnotations();return annotations=this.annotateURL(annotations||[],urlBoundary[0],urlBoundary[1]),!0}return!1},hasSelection:function(){return _.isNumber(this.selection.start)&&_.isNumber(this.selection.end)&&this.selection.start!==this.selection.end},textContentHasChanged:function(){return this._textContent!==this.textarea.value},restoreTextAreaSelectionDirection:function(){this._selectionDirection&&(this.textarea.selectionDirection=this._selectionDirection)},storeSelectionDirection:function(){this._selectionDirection=this.textarea.selectionDirection},onKeydown:function(evt){this.options.debug&&console.log("onKeydown(): ",evt.keyCode),this.hasSelection()&&(this.deselect(),this.restoreTextAreaSelectionDirection()),setTimeout(this.onAfterKeydown,0),this._copied=!1,this._selectionStartBeforeInput=this.textarea.selectionStart,this._selectionEndBeforeInput=this.textarea.selectionEnd},onAfterKeydown:function(){this.$textarea.is(":focus")&&(this.storeSelectionDirection(),this.textarea.selectionStart===this.textarea.selectionEnd?this.setCaret(this.textarea.selectionStart):this.select(this.textarea.selectionStart,this.textarea.selectionEnd))},onKeyup:function(evt){this.textContentHasChanged()&&this.onInput(evt)},onCopy:function(evt){this._copied||this.copyToClipboard()},onCut:function(evt){this._copied||this.copyToClipboard()},copyToClipboard:function(){var copySupported=document.queryCommandSupported&&document.queryCommandSupported("copy");if(copySupported){this._copied=!0;document.execCommand("copy")}},onInput:function(evt){if(this.textContentHasChanged()){var diffLength=this.textarea.value.length-this._textareaValueBeforeInput.length,selectionBeforeInput={start:this._selectionStartBeforeInput,end:this._selectionEndBeforeInput},selectionAfterInput={start:this.textarea.selectionStart,end:this.textarea.selectionEnd};this.options.debug&&console.log("onInput()",evt,"selectionBeforeInput",selectionBeforeInput,"selectionAfterInput",selectionAfterInput,"diffLength",diffLength);var opType=this.inferTextOperationType(selectionBeforeInput,selectionAfterInput,diffLength),annotated=!1,annotations=this.getAnnotations();if(this.options.annotateUrls&&"insert"===opType){var insertedText=this.textarea.value.substr(selectionBeforeInput.start,diffLength);this.options.debug&&console.log("onInput()","inserted text",insertedText),/\s/.test(insertedText)&&(annotated=this.annotateURLBeforeCaret(selectionBeforeInput.start))&&(annotations=this.shiftAnnotations(annotations,selectionAfterInput.end,diffLength))}if(annotations&&(annotated||(annotations=this.annotate(annotations,selectionBeforeInput,selectionAfterInput,diffLength)),this.options.debug&&console.log("onInput()","modified annotations",annotations),this._currentAnnotationAttributes&&"insert"===opType)){var insertAnnotation={start:selectionBeforeInput.start,end:selectionAfterInput.end,attrs:this._currentAnnotationAttributes};annotations.push(insertAnnotation),this._currentAnnotationAttributes=void 0,this.options.debug&&console.log("onInput()","insert annotation",insertAnnotation,"final annotations",annotations)}this._annotations=annotations,this.trigger("text:change",this.textarea.value,this._textareaValueBeforeInput,annotations,selectionBeforeInput,selectionAfterInput),this._selectionBeforeInput=selectionAfterInput,this._textareaValueBeforeInput=this.textarea.value,this._textContent=this.textarea.value}},onPaste:function(evt){this.options.debug&&console.log("onPaste()"),this._textareaValueBeforeInput=this.textarea.value,setTimeout(this.onAfterPaste,0)},onAfterPaste:function(){this.setCaret(this.textarea.selectionStart)},onMousedown:function(evt){if(3!==evt.originalEvent.detail){this.options.debug&&console.log("onMousedown()");var selectionStart=this.getCharNumFromEvent(evt);this.startSelecting(),this.select(selectionStart),evt.preventDefault(),evt.stopPropagation()}},onMousemove:function(evt){if(this.selectionInProgress()){this.options.debug&&console.log("onMousemove()");var selectionEnd=this.getCharNumFromEvent(evt);this.storeSelectionDirection(),this.select(null,selectionEnd),evt.preventDefault(),evt.stopPropagation()}},onMouseup:function(evt){this.selectionInProgress()&&(this.options.debug&&console.log("onMouseup()"),this.stopSelecting(),this.trigger("select:changed",this.selection.start,this.selection.end))},onDoubleClick:function(evt){this.options.debug&&console.log("onDoubleClick()");var charNum=this.getCharNumFromEvent(evt),wordBoundary=this.getWordBoundary(charNum);this.select(wordBoundary[0],wordBoundary[1]),evt.preventDefault(),evt.stopPropagation()},onTripleClick:function(evt){3===evt.originalEvent.detail&&(this.options.debug&&console.log("onTripleClick()"),this.hideCaret(),this.selectAll(),evt.preventDefault(),evt.stopPropagation())},findAnnotationsUnderCursor:function(annotations,selectionStart){return V.findAnnotationsAtIndex(annotations,selectionStart)},findAnnotationsInSelection:function(annotations,selectionStart,selectionEnd){return V.findAnnotationsBetweenIndexes(annotations,selectionStart,selectionEnd)},inferTextOperationType:function(selectionBeforeInput,selectionAfterInput,diffLength){return selectionBeforeInput.start===selectionBeforeInput.end&&selectionAfterInput.start===selectionAfterInput.end&&0<diffLength?"insert":selectionBeforeInput.start===selectionBeforeInput.end&&selectionAfterInput.start===selectionAfterInput.end&&diffLength<=0?"delete-single":selectionBeforeInput.start!==selectionBeforeInput.end&&selectionAfterInput.start===selectionAfterInput.end&&selectionAfterInput.start===selectionBeforeInput.start?"delete":selectionBeforeInput.start!==selectionBeforeInput.end&&selectionAfterInput.start!==selectionBeforeInput.start?"delete-insert":void 0},annotate:function(annotations,selectionBeforeInput,selectionAfterInput,diffLength){var newAnnotations=[],opType=this.inferTextOperationType(selectionBeforeInput,selectionAfterInput,diffLength);return _.each(annotations,function(annotation){switch(opType){case"insert":annotation.start<selectionBeforeInput.start&&selectionBeforeInput.start<=annotation.end?annotation.end+=diffLength:annotation.start>=selectionBeforeInput.start&&(annotation.start+=diffLength,annotation.end+=diffLength);break;case"delete-single":annotation.start<selectionBeforeInput.start&&selectionBeforeInput.start<=annotation.end&&selectionBeforeInput.start!==selectionAfterInput.start?annotation.end+=diffLength:annotation.start<=selectionBeforeInput.start&&selectionBeforeInput.start<annotation.end&&selectionBeforeInput.start===selectionAfterInput.start?annotation.end+=diffLength:annotation.start>=selectionBeforeInput.start&&(annotation.start+=diffLength,annotation.end+=diffLength);break;case"delete":if(annotation.start<=selectionBeforeInput.start&&selectionBeforeInput.start<=annotation.end)selectionBeforeInput.end<=annotation.end?annotation.end+=diffLength:annotation.end+=selectionAfterInput.start-annotation.end;else if(annotation.start>=selectionBeforeInput.start&&annotation.start<selectionBeforeInput.end){var inAnnotation=annotation.end-annotation.start,removedInAnnotation=selectionBeforeInput.end-annotation.start;annotation.start=selectionBeforeInput.start,annotation.end=annotation.start+inAnnotation-removedInAnnotation}else annotation.start>=selectionBeforeInput.end&&(annotation.start+=diffLength,annotation.end+=diffLength);break;case"delete-insert":if(annotation.start<=selectionBeforeInput.start&&selectionBeforeInput.start<=annotation.end)selectionBeforeInput.start<annotation.end&&(selectionBeforeInput.end>annotation.end?annotation.end=selectionAfterInput.end:annotation.end=selectionAfterInput.end+(annotation.end-selectionBeforeInput.end));else if(annotation.start>=selectionBeforeInput.start&&annotation.start<=selectionBeforeInput.end){var addedChars=selectionAfterInput.start-selectionBeforeInput.start,removedInAnnotation=selectionBeforeInput.end-annotation.start,inAnnotation=annotation.end-annotation.start;annotation.start=selectionBeforeInput.start+addedChars,annotation.end=annotation.start+inAnnotation-removedInAnnotation}else annotation.start>=selectionBeforeInput.start&&annotation.end<=selectionBeforeInput.end?annotation.start=annotation.end=0:annotation.start>=selectionBeforeInput.end&&(annotation.start+=diffLength,annotation.end+=diffLength);break;default:this.options.debug&&console.log("ui.TextEditor: Unknown text operation.")}annotation.end>annotation.start&&newAnnotations.push(annotation)},this),newAnnotations},shiftAnnotations:function(annotations,selectionStart,offset){return V.shiftAnnotations(annotations,selectionStart,offset)},setCurrentAnnotation:function(attrs){this._currentAnnotationAttributes=attrs},setAnnotations:function(annotations){this._annotations=annotations},getAnnotations:function(){return this._annotations},getCombinedAnnotationAttrsAtIndex:function(selectionStart,annotations){var attrs={};return _.each(annotations,function(annotation){_.isUndefined(annotation.start&&_.isUndefined(annotation.end))?V.mergeAttrs(attrs,annotation.attrs):selectionStart>=annotation.start&&selectionStart<annotation.end&&V.mergeAttrs(attrs,annotation.attrs)}),attrs},getSelectionAttrs:function(range,annotations){var start=range.start,end=range.end;if(start===end&&0===start)return this.getCombinedAnnotationAttrsAtIndex(start,annotations);if(start===end)return this.getCombinedAnnotationAttrsAtIndex(start-1,annotations);for(var commonAttrs,i=start;i<end;i++){var attrs=this.getCombinedAnnotationAttrsAtIndex(i,annotations);if(commonAttrs&&!_.isEqual(commonAttrs,attrs)){commonAttrs=joint.util.flattenObject(V.mergeAttrs({},commonAttrs)),attrs=joint.util.flattenObject(V.mergeAttrs({},attrs));var result={};_.each(attrs,function(value,key){commonAttrs[key]===attrs[key]&&joint.util.setByPath(result,key,value)}),commonAttrs=result}else commonAttrs=attrs}return commonAttrs},getTextContent:function(){var elText=this.options.text,tspans=V(elText).find(".v-line");return 0===tspans.length?elText.textContent:_.reduce(tspans,function(memo,tspan,i,tspans){var line=tspan.node.textContent;return tspan.hasClass("v-empty-line")&&(line=""),i===tspans.length-1?memo+line:memo+line+"\n"},"")},startSelecting:function(){this.selecting=!0},stopSelecting:function(){this.selecting=!1},selectionInProgress:function(){return!0===this.selecting},selectAll:function(){return this.select(0,this.getNumberOfChars())},select:function(startCharNum,endCharNum){return this.options.debug&&console.log("select(",startCharNum,endCharNum,")"),_.isUndefined(endCharNum)&&(endCharNum=startCharNum),_.isNumber(startCharNum)&&(this.selection.start=startCharNum),_.isNumber(endCharNum)&&(this.selection.end=endCharNum),_.isNumber(this.selection.end)||(this.selection.end=this.selection.start),_.isNumber(this.selection.start)&&_.isNumber(this.selection.end)&&(this.selection.start===this.selection.end?(this.clearSelection(),this.focus(),this.setCaret(this.selection.start)):(this.hideCaret(),this.renderSelection(this.selection.start,this.selection.end)),this.trigger("select:change",this.selection.start,this.selection.end)),this},setTextAreaSelection:function(start,end){var selection={start:start,end:end};selection=this.normalizeSelectionRange(selection),this.textarea.focus(),this.textarea.selectionStart=selection.start,this.textarea.selectionEnd=selection.end},renderSelection:function(start,end){this.options.debug&&console.log("renderSelection()");var selection={start:start,end:end};if(selection=this.normalizeSelectionRange(selection),this.clearSelection(),this.options.useNativeSelection){this.$viewport&&(this._viewportUserSelectBefore=this.$viewport.css("user-select"),this.$viewport.css({"-webkit-user-select":"all","-moz-user-select":"all","user-select":"all"}));var length=selection.end-selection.start;this.selectTextInElement(this.options.text,selection.start,length)}else this.renderSelectionBoxes(selection.start,selection.end)},normalizeSelectionStartAndLength:function(text,start,length){var textBefore=text.substr(0,start),textSelected=text.substr(start,length),numLineBreaksBefore=this.countLineBreaks(textBefore),numLineBreaksInSelection=this.countLineBreaks(textSelected);start-=numLineBreaksBefore,length-=numLineBreaksInSelection;var numEmptyLinesBefore=this.countEmptyLines(textBefore),numEmptyLinesInSelection=this.countEmptyLines(textSelected);return length+=numEmptyLinesBefore,length-=numEmptyLinesBefore,{start:start+=numEmptyLinesBefore,length:length+=numEmptyLinesInSelection}},selectTextInElement:function(element,start,length){if(_.isFunction(element.selectSubString)&&this.selectTextInElementUsingSelectSubString(element,start,length),!this.actualSelectionMatchesExpectedSelection(start,length))try{this.selectTextInElementUsingRanges(element,start,length)}catch(error){this.options.debug&&console.log(error),_.isFunction(element.selectSubString)&&this.selectTextInElementUsingSelectSubString(element,start,length)}},selectTextInElementUsingSelectSubString:function(element,start,length){var normalized=this.normalizeSelectionStartAndLength(this.getTextContent(),start,length);try{element.selectSubString(normalized.start,normalized.length)}catch(error){this.options.debug&&console.log(error)}},selectTextInElementUsingRanges:function(element,start,length){var selection=window.getSelection();selection.removeAllRanges();var normalized=this.normalizeSelectionStartAndLength(this.getTextContent(),start,length);start=0+normalized.start,length=0+normalized.length;for(var textNode,range,textNodeStart,textNodeEnd,setStart,setEnd,textNodes=this.getTextNodesFromDomElement(element),offset=0,end=start+length;0<length&&0<textNodes.length;)textNode=textNodes.shift(),textNodeEnd=(textNodeStart=offset)+textNode.length,(start<=textNodeStart&&textNodeStart<end||start<textNodeEnd&&textNodeEnd<=end||textNodeStart<=start&&start<textNodeEnd||textNodeStart<end&&end<=textNodeEnd)&&(setStart=Math.max(start-textNodeStart,0),setEnd=Math.min(setStart+Math.min(length,textNode.length),textNodeEnd),(range=document.createRange()).setStart(textNode,setStart),range.setEnd(textNode,setEnd),selection.addRange(range),length-=setEnd-setStart),offset+=textNode.length},actualSelectionMatchesExpectedSelection:function(start,length){var selection=window.getSelection(),actualSelectedContent=selection.toString(),expectedSelectedContent=this.getExpectedSelectedContent(start,length);return actualSelectedContent=actualSelectedContent.replace(/\s/g," "),expectedSelectedContent===actualSelectedContent},getExpectedSelectedContent:function(start,length){var textContent=this.getTextContent(),expectedSelectedContent=textContent.substr(start,length);return expectedSelectedContent=(expectedSelectedContent=(expectedSelectedContent=expectedSelectedContent.replace(/(\n\r|\r|\n){2,}/g,"-")).replace(/\n\r|\r|\n/g,"")).replace(/\s/g," ")},getTextNodesFromDomElement:function(element){var textNodes=[];return _.each(element.childNodes,function(childNode){_.isUndefined(childNode.tagName)?textNodes.push(childNode):textNodes=textNodes.concat(this.getTextNodesFromDomElement(childNode))},this),textNodes},renderSelectionBoxes:function(start,end){this.options.debug&&console.log("renderSelectionBoxes()"),this.$selection.empty();for(var $prevBox,prevBbox,bbox,fontSize=this.getFontSize(),t=this.getTextTransforms(),angle=t.rotation,i=start;i<end;i++){var $box=this.$selectionBox.clone();try{bbox=this.getCharBBox(i)}catch(e){this.trigger("select:out-of-range",start,end);break}prevBbox&&0===angle&&Math.round(bbox.y)===Math.round(prevBbox.y)&&Math.round(bbox.height)===Math.round(prevBbox.height)&&Math.round(bbox.x)===Math.round(prevBbox.x+prevBbox.width)?$prevBox.css({width:"+="+bbox.width}):($box.css({left:bbox.x,top:bbox.y-bbox.height,width:bbox.width,height:bbox.height,"-webkit-transform":"rotate("+angle+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+angle+"deg)","-moz-transform-origin":"0% 100%"}),this.$selection.append($box),$prevBox=$box),prevBbox=bbox}bbox&&this.$textareaContainer.css({left:bbox.x,top:bbox.y-fontSize*t.scaleY})},clearSelection:function(){return this.options.debug&&console.log("clearSelection()"),this.$selection.empty(),this.options.text.selectSubString&&(this.$viewport&&this._viewportUserSelectBefore&&this.$viewport.css({"-webkit-user-select":this._viewportUserSelectBefore,"-moz-user-select":this._viewportUserSelectBefore,"user-select":this._viewportUserSelectBefore}),window.getSelection().removeAllRanges()),this},deselect:function(){return this.options.debug&&console.log("deselect()"),this.stopSelecting(),this.clearSelection(),this.setTextAreaSelection(this.selection.start,this.selection.end),this},getSelectionStart:function(){return this.selection.start},getSelectionEnd:function(){return this.selection.end},getSelectionRange:function(){return this.normalizeSelectionRange(this.selection)},normalizeSelectionRange:function(selection){var selection=_.clone(selection);return selection.start>selection.end&&(selection.end=[selection.start,selection.start=selection.end][0]),selection},getSelectionLength:function(){var range=this.getSelectionRange();return range.end-range.start},getSelection:function(){var range=this.getSelectionRange();return this.getTextContent().slice(range.start,range.end)},getWordBoundary:function(charNum){for(var text=this.textarea.value,re=/\W/,start=charNum;start;){if(re.test(text[start])){start+=1;break}start-=1}for(var numberOfChars=this.getNumberOfChars(),end=charNum;end<=numberOfChars&&!re.test(text[end]);)end+=1;return start<end?[start,end]:[end,start]},getURLBoundary:function(charNum){for(var text=this.textarea.value,whitespaceRegEx=/\s/,start=charNum;start;){if(whitespaceRegEx.test(text[start])){start+=1;break}start-=1}for(var numberOfChars=this.getNumberOfChars(),end=charNum;end<=numberOfChars&&!whitespaceRegEx.test(text[end]);)end+=1;if(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/.test(text.substring(start,end)))return[start,end]},annotateURL:function(annotations,selectionStart,selectionEnd){var url=this.textarea.value.substring(selectionStart,selectionEnd),urlAnnotation=_.extend({url:url},this.options.urlAnnotation);return urlAnnotation.start=selectionStart,urlAnnotation.end=selectionEnd,_.isEqual(urlAnnotation,_.last(annotations))||annotations.push(urlAnnotation),annotations},getCharBBox:function(charNum){if(this.isLineEnding(charNum)){var bbox=this.getCharBBox(charNum-1);return bbox.x=bbox.x2,bbox.y=bbox.y2,bbox.width=this.options.newlineCharacterBBoxWidth||10,bbox}var svgCharNum=this.realToSvgCharNum(charNum),elText=this.options.text,startPosition=elText.getStartPositionOfChar(svgCharNum),endPosition=elText.getEndPositionOfChar(svgCharNum),extent=elText.getExtentOfChar(svgCharNum);startPosition=this.localToScreenCoordinates(startPosition),endPosition=this.localToScreenCoordinates(endPosition);var t=this.getTextTransforms(),x=startPosition.x,y=startPosition.y,w=extent.width*t.scaleX,h=extent.height*t.scaleY;return{x:x,y:y,width:w,height:h,x2:endPosition.x,y2:endPosition.y}},realToSvgCharNum:function(charNum){for(var lineEndings=0,i=0;i<=charNum;i++)this.isLineEnding(i)&&(lineEndings+=1);return charNum-lineEndings},selectionStartToSvgCharNum:function(selectionStart){return selectionStart-this.nonEmptyLinesBefore(selectionStart)},isLineEnding:function(charNum){var text=this.textarea.value;return"\n"===text[charNum]&&0<charNum&&"\n"!==text[charNum-1]},svgToRealCharNum:function(svgCharNum){this.textarea.value;for(var newLinesBefore=0,i=0;i<=svgCharNum+newLinesBefore;i++)this.isLineEnding(i)&&(newLinesBefore+=1);return svgCharNum+newLinesBefore},localToScreenCoordinates:function(p){return $(this.options.text).show(),V.transformPoint(p,this.options.text.getCTM())},getNumberOfChars:function(){return this.getTextContent().length},getCharNumFromEvent:function(evt){var elText=this.options.text,clientX=evt.clientX,clientY=evt.clientY,localClientPoint=V(elText).toLocalPoint(clientX,clientY),svgCharNum=elText.getCharNumAtPosition(localClientPoint);if(svgCharNum<0)return this.getNumberOfChars();var clientScreen=this.localToScreenCoordinates(localClientPoint),bbox=this.getCharBBox(this.svgToRealCharNum(svgCharNum));return Math.abs(bbox.x-clientScreen.x)<Math.abs(bbox.x+bbox.width-clientScreen.x)?this.svgToRealCharNum(svgCharNum):this.svgToRealCharNum(svgCharNum)+1},lineNumber:function(selectionStart){var text=this.textarea.value.substr(0,selectionStart);return this.countLineBreaks(text)},emptyLinesBefore:function(selectionStart){for(var lines=this.textarea.value.split(/\n\r|\r|\n/g),lineNumber=this.lineNumber(selectionStart),n=0,i=lineNumber-1;0<=i;i--)lines[i]||(n+=1);return n},countLineBreaks:function(text){return(text.match(/\n\r|\r|\n/g)||[]).length},countEmptyLines:function(text){return(text.match(/(\n\r|\r|\n){2,}/g)||[]).length},nonEmptyLinesBefore:function(selectionStart){return this.lineNumber(selectionStart)-this.emptyLinesBefore(selectionStart)},isEmptyLine:function(lineNumber){var lines=this.textarea.value.split(/\n\r|\r|\n/g);return!lines[lineNumber]},isEmptyLineUnderSelection:function(selectionStart){var lineNumber=this.lineNumber(selectionStart);return this.isEmptyLine(lineNumber)},getTextTransforms:function(){var screenCTM=this.options.text.getCTM();return V.decomposeMatrix(screenCTM)},getFontSize:function(){return parseInt(V(this.options.text).attr("font-size"),10)},getTextAnchor:function(){return V(this.options.text).attr("text-anchor")||""},setCaret:function(charNum,opt){_.isObject(charNum)&&(opt=charNum,charNum=void 0),opt=opt||{};var caretPosition,elText=this.options.text,numberOfChars=this.getNumberOfChars(),selectionStart=this.selection.start,text=this.textarea.value;void 0!==charNum&&(charNum=Math.min(Math.max(charNum,0),numberOfChars),selectionStart=this.selection.start=this.selection.end=charNum),opt.silent||this.trigger("caret:change",selectionStart),this.setTextAreaSelection(selectionStart,selectionStart),this.options.debug&&console.log("setCaret(",charNum,opt,")","selectionStart",selectionStart,"isLineEnding",this.isLineEnding(selectionStart),"isEmptyLineUnderSelection",this.isEmptyLineUnderSelection(selectionStart),"svgCharNum",this.selectionStartToSvgCharNum(selectionStart),"nonEmptyLinesBefore",this.nonEmptyLinesBefore(selectionStart));try{var charIndex;caretPosition=this.isEmptyLineUnderSelection(selectionStart)||!this.isLineEnding(selectionStart)&&text.length!==selectionStart?(charIndex=this.selectionStartToSvgCharNum(selectionStart),elText.getStartPositionOfChar(charIndex)):(charIndex=this.selectionStartToSvgCharNum(selectionStart)-1,elText.getEndPositionOfChar(charIndex))}catch(e){this.trigger("caret:out-of-range",selectionStart),caretPosition={x:0,y:0}}var caretScreenPosition=this.localToScreenCoordinates(caretPosition),t=this.getTextTransforms(),angle=t.rotation,fontSize=this.getFontSize()*t.scaleY;return this.options.placeholder&&this.$caret.toggleClass("placeholder",0===numberOfChars),this.$caret.css({left:caretScreenPosition.x,top:caretScreenPosition.y+(numberOfChars?-fontSize:0),height:fontSize,"line-height":fontSize+"px","font-size":fontSize+"px","-webkit-transform":"rotate("+angle+"deg)","-webkit-transform-origin":"0% 100%","-moz-transform":"rotate("+angle+"deg)","-moz-transform-origin":"0% 100%"}).attr({"text-anchor":this.getTextAnchor()}).show(),this.$textareaContainer.css({left:caretScreenPosition.x,top:caretScreenPosition.y+(numberOfChars?-fontSize:0)}),this.focus(),this},focus:function(){return this.options.debug&&console.log("focus()"),this.showCaret(),this},blur:function(){return this.options.debug&&console.log("blur()"),this.hideCaret(),this},showCaret:function(){return this.options.debug&&console.log("showCaret()"),this.$caret.show(),this},hideCaret:function(){return this.options.debug&&console.log("hideCaret()"),this.$caret.hide(),this},unbindTextElement:function(){this.$elText.off("mousedown",this.onMousedown),this.$elText.off("dblclick",this.onDoubleClick),this.$elText.off("click",this.onTripleClick)},onRemove:function(){this.unbindTextElement(),$(document.body).off("mousemove",this.onMousemove),$(document.body).off("mouseup",this.onMouseup),$(document.body).off("keydown",this.onKeydown),V(this.options.text).attr("cursor","")}},_.extend({getTextElement:function(el){var tagName=el.tagName.toUpperCase();if("TEXT"===tagName||"TSPAN"===tagName||"TEXTPATH"===tagName)return"TEXT"===tagName?el:this.getTextElement(el.parentNode)},edit:function(el,opt){var update=!1!==(opt=opt||{}).update;this.options=_.extend({},opt,{update:update});var textElement=this.getTextElement(el);if(textElement){var target;if(this.close(),this.ed=new joint.ui.TextEditor(_.extend({text:textElement},opt)),this.ed.on("all",this.trigger,this),opt.cellView){if(target=opt.cellView.paper.el,this.cellViewUnderEdit=opt.cellView,this.cellViewUnderEditInteractiveOption=this.cellViewUnderEdit.options.interactive,this.cellViewUnderEdit.options.interactive=!1,opt.annotationsProperty&&!this.ed.getAnnotations()){var annotations=this.cellViewUnderEdit.model.prop(opt.annotationsProperty);annotations&&this.ed.setAnnotations(this.deepCloneAnnotations(annotations))}}else{var svg=V(textElement).svg();target=svg.parentNode}return update&&this.ed.on("text:change",function(newText,oldText,annotations){if(opt.cellView){var originalLabelIndex=null;if(opt.textProperty&&(opt.cellView.model.isLink()&&"labels"===opt.textProperty.substr(0,"labels".length)&&(originalLabelIndex=V($(V(textElement).node).closest(".label")[0]).index()),opt.cellView.model.prop(opt.textProperty,newText,{textEditor:this.ed.cid})),opt.annotationsProperty&&opt.cellView.model.prop(opt.annotationsProperty,this.deepCloneAnnotations(annotations),{rewrite:!0,textEditor:this.ed.cid}),null!==originalLabelIndex){var labelElements=V(opt.cellView.el).find(".label");textElement=labelElements[originalLabelIndex].findOne("text"),this.ed.setTextElement(textElement.node)}}else V(textElement).text(newText,annotations)},this),this.ed.render(target),this}this.options.debug&&console.log("ui.TextEditor: cannot find a text element.")},close:function(){if(this.ed){if(this.ed.options.annotateUrls){var selectionStart=this.ed.getSelectionStart(),annotationsUnderCursor=this.findAnnotationsUnderCursor(),containsURLAnnotation=_.find(annotationsUnderCursor,function(annotation){return!!annotation.url&&annotation});if(!containsURLAnnotation){var annotated=this.ed.annotateURLBeforeCaret(selectionStart);annotated&&this.applyAnnotations(this.getAnnotations())}}this.ed.remove(),this.cellViewUnderEdit&&(this.cellViewUnderEdit.options.interactive=this.cellViewUnderEditInteractiveOption),this.ed=this.cellViewUnderEdit=this.cellViewUnderEditInteractiveOption=void 0}},applyAnnotations:function(annotations){var opt=this.options;if(this.ed&&opt.update){opt.cellView&&opt.annotationsProperty?(opt.cellView.model.prop(opt.annotationsProperty,this.deepCloneAnnotations(annotations),{rewrite:!0}),this.ed.setAnnotations(annotations)):V(this.ed.options.text).text(this.ed.getTextContent(),annotations);var range=this.getSelectionRange(),selectionLength=this.getSelectionLength();0<selectionLength?this.ed.select(range.start,range.end):this.ed.setCaret()}},deepCloneAnnotations:function(annotations){try{return JSON.parse(JSON.stringify(annotations))}catch(e){return}},proxy:function(method,args){if(this.ed)return this.ed[method].apply(this.ed,args)},setCurrentAnnotation:function(attributes){return this.proxy("setCurrentAnnotation",arguments)},getAnnotations:function(){return this.proxy("getAnnotations",arguments)},setCaret:function(){return this.proxy("setCaret",arguments)},deselect:function(){return this.proxy("deselect",arguments)},selectAll:function(){return this.proxy("selectAll",arguments)},select:function(){return this.proxy("select",arguments)},getNumberOfChars:function(){return this.proxy("getNumberOfChars",arguments)},getCharNumFromEvent:function(){return this.proxy("getCharNumFromEvent",arguments)},getWordBoundary:function(){return this.proxy("getWordBoundary",arguments)},findAnnotationsUnderCursor:function(){return this.proxy("findAnnotationsUnderCursor",[this.ed.getAnnotations(),this.ed.getSelectionStart()])},findAnnotationsInSelection:function(){if(this.ed){var range=this.ed.getSelectionRange();return this.proxy("findAnnotationsInSelection",[this.ed.getAnnotations(),range.start,range.end])}},getSelectionAttrs:function(annotations){if(this.ed){var range=this.ed.getSelectionRange();return this.proxy("getSelectionAttrs",[range,annotations])}},getSelectionLength:function(){return this.proxy("getSelectionLength",arguments)},getSelectionRange:function(){return this.proxy("getSelectionRange",arguments)}},Backbone.Events)),joint.ui.Dialog=joint.mvc.View.extend({className:"dialog",events:{"click .bg":"action","click .btn-close":"action","click .controls button":"action","mousedown .titlebar":"onDragStart","touchstart .titlebar":"onDragStart"},options:{draggable:!1,closeButtonContent:"&times;",closeButton:!0,inlined:!1,modal:!0},init:function(){_.bindAll(this,"onDrag","onDragEnd")},render:function(){var $bg=$("<div/>",{class:"bg","data-action":"close"}),$fg=$("<div/>",{class:"fg"}),$titlebar=$("<div/>",{class:"titlebar"}),$body=$("<div/>",{class:"body"}),$btnClose=$("<button/>",{class:"btn-close","data-action":"close",html:this.options.closeButtonContent}),$controls=$("<div/>",{class:"controls"});return this.$el.toggleClass("draggable",!!this.options.draggable),this.options.type&&this.$el.attr("data-type",this.options.type),this.options.inlined&&this.$el.addClass("inlined"),this.options.modal&&this.$el.addClass("modal"),this.options.width&&$fg.width(this.options.width),this.options.title?$titlebar.append(this.options.title):$titlebar.addClass("empty"),this.options.content&&$body.append(this.options.content),this.options.buttons&&_.each(this.options.buttons.reverse(),function(button){var $button=$("<button/>",{class:"control-button",html:button.content,"data-action":button.action});button.position&&$button.addClass(button.position),$controls.append($button)}),$fg.append($titlebar,$body,$controls),this.options.closeButton&&$fg.append($btnClose),this.$el.empty().append($bg,$fg),this},open:function(el){return this.delegateEvents(),this.on("action:close",this.close,this),$(document.body).on({"mousemove.dialog touchmove.dialog":this.onDrag,"mouseup.dialog touchend.dialog":this.onDragEnd}),$(el||document.body).append(this.render().el),this.$el.addClass("rendered"),this},close:function(){return this.remove(),this},onRemove:function(){$(document.body).off(".dialog",this.onDrag).off(".dialog",this.onDragStart)},action:function(evt){var $button=$(evt.target).closest("[data-action]"),action=$button.attr("data-action");action&&this.trigger("action:"+action)},onDragStart:function(evt){this.options.draggable&&(evt=joint.util.normalizeEvent(evt),this._dx=evt.clientX,this._dy=evt.clientY,this._dragging=!0)},onDrag:function(evt){if(this._dragging){evt=joint.util.normalizeEvent(evt);var $fg=this.$(".fg"),offset=$fg.offset();$fg.css({top:offset.top+(evt.clientY-this._dy),left:offset.left+(evt.clientX-this._dx),margin:0}),this._dx=evt.clientX,this._dy=evt.clientY}},onDragEnd:function(){this._dragging=!1}}),joint.ui.FlashMessage=joint.ui.Dialog.extend({className:joint.ui.Dialog.prototype.className+" flash-message",options:_.merge({},joint.ui.Dialog.prototype.options,{closeButton:!0,modal:!1,cascade:!0,closeAnimation:{delay:2e3,duration:200,easing:"swing",properties:{opacity:0}},openAnimation:{duration:200,easing:"swing",properties:{opacity:1}}}),init:function(){_.bindAll(this,"startCloseAnimation"),joint.ui.Dialog.prototype.init.apply(this,arguments),this.on("close:animation:complete",this.close,this)},open:function(){joint.ui.Dialog.prototype.open.apply(this,arguments);var $fg=this.$(".fg");return this._foregroundHeight=$fg.height(),this.addToCascade(),$fg.css("height",0),this.startOpenAnimation(),this.options.closeAnimation&&this.options.closeAnimation.delay&&setTimeout(this.startCloseAnimation,this.options.closeAnimation.delay),this},close:function(){return joint.ui.Dialog.prototype.close.apply(this,arguments),this.removeFromCascade(),this},addToCascade:function(){if(this.options.cascade){var top=this.constructor.top;this.$(".fg").css("top",top),this.constructor.top+=this._foregroundHeight+this.constructor.padding}this.constructor.opened.push(this)},removeFromCascade:function(){if(this.options.cascade){for(var openedFlashMessages=this.constructor.opened,isAfter=!1,i=0;i<openedFlashMessages.length;i++){var opened=openedFlashMessages[i];if(opened.options.cascade&&isAfter){var openedTop=parseInt(opened.$(".fg").css("top"),10);opened.$(".fg").css("top",openedTop-this._foregroundHeight-this.constructor.padding)}opened===this&&(isAfter=!0)}isAfter&&(this.constructor.top-=this._foregroundHeight+this.constructor.padding)}this.constructor.opened=_.without(this.constructor.opened,this)},startCloseAnimation:function(){this.$(".fg").animate(this.options.closeAnimation.properties,_.extend({complete:_.bind(function(){this.trigger("close:animation:complete")},this)},this.options.closeAnimation))},startOpenAnimation:function(){var $fg=this.$(".fg");$fg.animate(_.extend({},this.options.openAnimation.properties,{height:this._foregroundHeight}),_.extend({complete:_.bind(function(){this.trigger("open:animation:complete")},this)},this.options.openAnimation))}},{top:20,padding:15,opened:[],open:function(content,title,opt){return opt=opt||{},new joint.ui.FlashMessage(_.extend({title:title,type:"info",content:content},opt)).open(opt.target)},close:function(){_.invoke(this.opened,"close")}}),function(joint,backbone,_){"use strict";var Keyboard=function(){_.bindAll(this,"handleKey"),this.parser=new KeyboardParser,this.enable()};_.extend(Keyboard.prototype,backbone.Events),Keyboard.prototype.on=function(event,callback,context){return Backbone.Events.on.call(this,this.normalizeEvent(event),callback,context),this},Keyboard.prototype.off=function(event,callback,context){var remove=event?this.normalizeEvent(event):null;return Backbone.Events.off.call(this,remove,callback,context),this},Keyboard.prototype.normalizeEvent=function(event){return"object"==typeof event?_.transform(event,function(res,value,key){res[this.normalizeShortcut(key)]=value},null,this):this.normalizeShortcut(event)},Keyboard.prototype.normalizeShortcut=function(shortcut){if("all"===shortcut.toLowerCase())return shortcut;for(var eventsToBind=this.parser.toEventObjectList(shortcut),result=[],i=0;i<eventsToBind.length;i++)result.push(this.hash(eventsToBind[i]));return result.join(" ")},Keyboard.prototype.enable=function(){window.addEventListener?(document.addEventListener("keydown",this.handleKey,!1),document.addEventListener("keypress",this.handleKey,!1),document.addEventListener("keyup",this.handleKey,!1)):window.attachEvent&&(document.attachEvent("keydown",this.handleKey,!1),document.attachEvent("keypress",this.handleKey,!1),document.attachEvent("keyup",this.handleKey,!1))},Keyboard.prototype.disable=function(){window.removeEventListener?(document.removeEventListener("keydown",this.handleKey,!1),document.removeEventListener("keypress",this.handleKey,!1),document.removeEventListener("keyup",this.handleKey,!1)):window.detachEvent&&(document.detachEvent("keydown",this.handleKey,!1),document.detachEvent("keypress",this.handleKey,!1),document.detachEvent("keyup",this.handleKey,!1))},Keyboard.prototype.isActive=function(name,event){return this.isModifierActive(name,event)},Keyboard.prototype.isModifierActive=function(key,event){for(var events=this.parser.toEventObjectList(key),i=0;i<events.length;i++)if(events[i].modifiersCompare(event))return!0;return!1},Keyboard.prototype.hash=function(event){var toInt=function(value){return value?1:0},parts=[event.type,":",event.which,toInt(event.shiftKey),toInt(event.ctrlKey),toInt(event.altKey),toInt(event.metaKey)];return parts.join("")},Keyboard.prototype.handleKey=function(event){if(!this.isUnsupportedElement(event)){var ev=KeyboardEvent.fromNative(event);Backbone.Events.trigger.call(this,this.hash(ev),event)}},Keyboard.prototype.isUnsupportedElement=function(event){var element=event.target||event.srcElement,tagName=(element?element.tagName:"").toUpperCase();return"INPUT"===tagName||"SELECT"===tagName||"TEXTAREA"===tagName};var KeyboardParser=function(){};KeyboardParser.prototype={constructor:KeyboardParser,parseEventString:function(str){var strPart,i,parts=(str=str||"").split("+"),event=new KeyboardEvent(0);for(i=0;i<parts.length;i++){strPart=parts[i];var modifierName=this.getModifierPropertyName(strPart);modifierName?event[modifierName]=!0:event.which=KeyboardParser.getCode(strPart)}return event},toEventObjectList:function(str){for(var rawEventsParts=str.replace(/\s*\+\s*/gi,"+").split(" "),events=[],i=0;i<rawEventsParts.length;i++)events.push(this.composeEventObject(rawEventsParts[i]));return events},composeEventObject:function(rawEvent){var ev,parts=rawEvent.split(":"),type=Types.KEYDOWN,shortcutValue=parts[0];if(1<parts.length&&(shortcutValue=parts[1],type=parts[0]),-1===AvailableEventTypes.indexOf(type))throw rawEvent+": invalid shortcut definition";return(ev=this.parseEventString(shortcutValue)).setType(type),ev},getModifierPropertyName:function(key){var code=modifier[key];return modifierMap[code]}},KeyboardParser.getCode=function(char){return keyMap[char]||char.toUpperCase().charCodeAt(0)};var modifier={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91,meta:91},modifierMap={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"},charCodeAlternatives={57392:"ctrl",63289:"num",59:";",61:"=",173:"-"},keyMap={backspace:8,tab:9,clear:12,enter:13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,home:36,end:35,pageup:33,pagedown:34,plus:187,minus:189,"-":189,",":188,".":190,"/":191,"`":192,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},Types={KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup"},AvailableEventTypes=[Types.KEYPRESS,Types.KEYDOWN,Types.KEYUP],KeyboardEvent=function(charCode,isShift,isCtrl,isAlt,isMeta,type){this.which=charCode,this.shiftKey=isShift||!1,this.ctrlKey=isCtrl||!1,this.altKey=isAlt||!1,this.metaKey=isMeta||!1,this.type=type||Types.KEYDOWN};KeyboardEvent.fromNative=function(e){var normalizedCharCode=e.which;return e.type===Types.KEYPRESS&&(normalizedCharCode=String.fromCharCode(e.which).toUpperCase().charCodeAt(0)),charCodeAlternatives[normalizedCharCode]&&(normalizedCharCode=KeyboardParser.getCode(charCodeAlternatives[normalizedCharCode])),new KeyboardEvent(normalizedCharCode,e.shiftKey,e.ctrlKey,e.altKey,e.metaKey,e.type)},KeyboardEvent.prototype.modifiersCompare=function(eventToCompare){return!(this.shiftKey&&this.shiftKey!==eventToCompare.shiftKey||this.ctrlKey&&this.ctrlKey!==eventToCompare.ctrlKey||this.altKey&&this.altKey!==eventToCompare.altKey||this.metaKey&&this.metaKey!==eventToCompare.metaKey)},KeyboardEvent.prototype.setType=function(type){this.type=type},joint.ui.Keyboard=Keyboard}(joint,Backbone,_),joint.ui.Lightbox=joint.ui.Dialog.extend({className:joint.ui.Dialog.prototype.className+" lightbox",options:_.merge({},joint.ui.Dialog.prototype.options,{closeButton:!0,modal:!0,closeAnimation:{delay:2e3,duration:200,easing:"swing",properties:{opacity:0}},top:100,windowArea:.8,openAnimation:!1}),init:function(){_.bindAll(this,"startCloseAnimation","positionAndScale"),joint.ui.Dialog.prototype.init.apply(this,arguments),this.options.image&&(this.$image=$("<img/>",{src:this.options.image}),this.$image.on("load",this.positionAndScale),this.options.content=this.$image),$(window).on("resize",this.positionAndScale),this.on("close:animation:complete",this.remove,this)},open:function(){return joint.ui.Dialog.prototype.open.apply(this,arguments),this.positionAndScale(),this.startOpenAnimation(),this},positionAndScale:function(){var $fg=this.$(".fg"),$img=this.$(".body > img"),ratio=this.options.windowArea,width=window.innerWidth*ratio;this.$el.css("margin-top",this.options.top);var $titlebar=this.$(".titlebar");$titlebar.css("width",width);var titlebarHeight=$titlebar.height(),height=window.innerHeight*ratio-titlebarHeight-this.options.top;$titlebar.css("width","auto"),$fg.css({width:width,height:height});var imageWidth=$img.width(),imageHeight=$img.height();$fg.css({width:imageWidth,height:imageHeight})},close:function(){return this.options.closeAnimation?this.startCloseAnimation():joint.ui.Dialog.prototype.close.apply(this,arguments),this},onRemove:function(){joint.ui.Dialog.prototype.onRemove.apply(this,arguments),$(window).off("resize",this.positionAndScale),this.$image&&this.$image.off("load",this.positionAndScale)},startCloseAnimation:function(){this.$el.animate(this.options.closeAnimation.properties,_.extend({complete:_.bind(function(){this.trigger("close:animation:complete")},this)},this.options.closeAnimation))},startOpenAnimation:function(){this.$el.animate(_.extend({},this.options.openAnimation.properties,{height:this._foregroundHeight}),_.extend({complete:_.bind(function(){this.trigger("open:animation:complete")},this)},this.options.openAnimation))}}),joint.ui.ContextToolbar=joint.mvc.View.extend({className:"context-toolbar",eventNamespace:"context-toolbar",events:{"click .tool":"onToolPointerdown"},options:{padding:20,autoClose:!0},init:function(){_.bindAll(this,"onDocumentMousedown")},render:function(){return this.constructor.opened&&this.constructor.close(),this.bind(),this.options.type&&this.$el.attr("data-type",this.options.type),$(this.getRoot()).append(this.$el),this.renderContent(),this.position(),this.constructor.opened=this},renderContent:function(){var $tools=$("<div/>",{class:"tools"});this.options.tools&&_.each(this.options.tools,function(tool){var $html;$html=tool.icon?$("<img/>",{src:tool.icon}):tool.content;var $tool=$("<button/>",{class:"tool",html:$html,"data-action":tool.action});tool.attrs&&$tool.attr(tool.attrs),$tools.append($tool)}),this.$el.append($tools)},getRoot:function(){return this.options.root||document.documentElement},position:function(){$(this.options.target);var bbox=joint.util.getElementBBox(this.options.target),rootBbox=joint.util.getElementBBox(this.getRoot()),width=this.$el.outerWidth(),left=(this.$el.outerHeight(),bbox.x+bbox.width/2-width/2),top=bbox.y+bbox.height+this.options.padding;left-=rootBbox.x,top-=rootBbox.y,this.$el.css({left:left,top:top})},onRemove:function(){this.unbind(),this.constructor.opened=void 0},bind:function(){$(document).on("mousedown."+this.eventNamespace,this.onDocumentMousedown)},unbind:function(){return $(document).off("mousedown."+this.eventNamespace,this.onDocumentMousedown),this},onToolPointerdown:function(evt){var $tool=$(evt.target).closest("[data-action]"),action=$tool.attr("data-action");action&&this.trigger("action:"+action,evt)},onDocumentMousedown:function(evt){if(this.options.autoClose){var target=this.options.target;this.el.contains(evt.target)||target.contains(evt.target)||target===evt.target||(this.constructor.close(),this.remove())}}},{opened:void 0,close:function(){this.opened&&(this.opened.remove(),this.opened=void 0)},update:function(){this.opened&&this.opened.position()}}),joint.ui.Popup=joint.ui.ContextToolbar.extend({className:"popup",eventNamespace:"popup",events:{},renderContent:function(){var content=_.isFunction(this.options.content)?this.options.content(this.el):this.options.content;content&&this.$el.html(content)}}),joint.ui.SelectBox=joint.mvc.View.extend({className:"select-box",events:{"click .select-box-selection":"onToggle","click .select-box-option":"onSelect"},options:{options:[],width:void 0,openPolicy:"auto",target:"undefined"!=typeof document?document.body:null,keyboardNavigation:!0,selected:void 0,selectBoxOptionsClass:void 0,disabled:!1},init:function(){_.bindAll(this,"onOutsideClick","onOptionHover","onSelect","onKeydown","onOptionsMouseOut"),$(document).on("click.selectBox",this.onOutsideClick),this.options.keyboardNavigation&&$(document).on("keydown.selectBox",this.onKeydown),this.$el.data("view",this),_.isUndefined(this.options.selected)?this.selection=_.findWhere(this.options.options,{selected:!0})||this.options.options[0]:this.selection=this.options.options[this.options.selected]},render:function(){return this.$el.empty(),this.$selection=null,this.renderSelection(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions(),this.$options=$("<div/>",{class:[this.className,"select-box-options",this.themeClassNamePrefix+this.theme].join(" ")}),this.$options.addClass(this.options.selectBoxOptionsClass),this.$options.on("click.selectBox",".select-box-option",this.onSelect),this.$options.on("mouseover.selectBox",".select-box-option",this.onOptionHover),this.$options.on("mouseleave.selectBox",this.onOptionsMouseOut),this.options.width&&this.$options.css("width",this.options.width),_.each(this.options.options,function(option,idx){var $option=this.renderOption(option,idx);this.$options.append($option),this.selection===option&&$option.addClass("selected hover")},this),this.$target=$(this.options.target),this.$optionsArrow=$("<div/>").addClass("select-box-options-arrow").appendTo(this.$options)},removeOptions:function(){this.$options&&(this.$options.removeClass("rendered"),this.$options.remove())},renderOption:function(option,idx){var $option=this.renderOptionContent(option);return $option.addClass("select-box-option"),$option.data("index",idx),$option},renderOptionContent:function(option){var $option=$("<div/>",{class:"select-box-option-content",html:option.content});return option.icon&&$option.prepend($("<img/>",{class:"select-box-option-icon",src:option.icon})),$option},renderSelection:function(option){if(this.$selection||(this.$selection=$("<div/>",{class:"select-box-selection"}),this.$el.append(this.$selection)),this.$selection.empty(),option){var $option=this.renderOptionContent(option);this.$selection.append($option)}else if(this.options.placeholder){var $placeholder=$("<div/>",{class:"select-box-placeholder",html:this.options.placeholder});this.$selection.append($placeholder)}},getOptionIndex:function(el){return $(el).closest(".select-box-option").data("index")},onSelect:function(evt){var idx=this.getOptionIndex(evt.target);this.select(idx,{ui:!0})},onToggle:function(evt){this.toggle()},markOptionHover:function(idx){this.$options.find(".hover").removeClass("hover"),$(this.$options.find(".select-box-option")[idx]).addClass("hover")},onOptionHover:function(evt){var idx=this.getOptionIndex(evt.target);this.markOptionHover(idx),this.trigger("option:hover",this.options.options[idx],idx)},onOutsideClick:function(evt){!this.el.contains(evt.target)&&this.$el.hasClass("opened")&&this.close()},onOptionsMouseOut:function(evt){this.trigger("options:mouseout",evt)},getSelection:function(){return this.selection},getSelectionValue:function(selection){return(selection=selection||this.selection)&&(_.isUndefined(selection.value)?selection.content:selection.value)},getSelectionIndex:function(){return _.findIndex(this.options.options,this.selection)},getOptionHoverIndex:function(){return this.$options.find(".select-box-option.hover").index()},select:function(index,opt){this.selection=this.options.options[index],this.renderSelection(this.selection),this.trigger("option:select",this.selection,index,opt),this.close()},selectByValue:function(value,opt){for(var options=this.options.options||[],i=0;i<options.length;i++){var option=options[i];if(_.isUndefined(option.value)&&option.content===value)return this.select(i,opt);if(!_.isUndefined(option.value)&&option.value===value)return this.select(i,opt)}},isOpen:function(){return this.$el.hasClass("opened")},toggle:function(){this.isOpen()?this.close():this.open()},position:function(){var $selection=this.$(".select-box-selection"),selectionHeight=$selection.outerHeight(),selectionOffset=$selection.offset(),selectionLeft=selectionOffset.left,selectionTop=selectionOffset.top,optionsHeight=this.$options.outerHeight(),targetBBox={left:0,top:0};this.options.target!==document.body?((targetBBox=this.$target.offset()).width=this.$target.outerWidth(),targetBBox.height=this.$target.outerHeight(),targetBBox.left-=this.$target.scrollLeft(),targetBBox.top-=this.$target.scrollTop()):(targetBBox.width=$(window).width(),targetBBox.height=$(window).height());var left=selectionLeft,top="auto",openPolicy=this.options.openPolicy;switch("selected"!==openPolicy||this.selection||(openPolicy="auto"),openPolicy){case"above":top=selectionTop-optionsHeight;break;case"coverAbove":top=selectionTop-optionsHeight+selectionHeight;break;case"below":top=selectionTop+selectionHeight;break;case"coverBelow":top=selectionTop;break;case"selected":var selectedOptionPosition=this.$options.find(".selected").position();top=selectionTop-selectedOptionPosition.top;break;default:var isOptionsOverBottomEdge=selectionTop-this.$target.scrollTop()+optionsHeight>targetBBox.top+targetBBox.height;top=isOptionsOverBottomEdge?selectionTop-optionsHeight+selectionHeight:selectionTop}left-=targetBBox.left,top-=targetBBox.top,this.$options.css({left:left,top:top})},open:function(){this.isDisabled()||(this.renderOptions(),this.$options.appendTo(this.options.target),this.$options.addClass("rendered"),this.position(),this.$el.addClass("opened"),this.respectWindowBoundaries(),this.alignOptionsArrow())},respectWindowBoundaries:function(){var overflow=this.calculateElOverflow(this.$options),increment={left:0,top:0};this.$options.outerWidth()<=this.$target.innerWidth()&&(overflow.left&&overflow.right||(overflow.left?increment.left=overflow.left:overflow.right&&(increment.left=-overflow.right))),this.$options.outerHeight()<=this.$target.innerHeight()&&(overflow.top&&overflow.bottom||(overflow.top?increment.top=overflow.top:overflow.bottom&&(increment.top=-overflow.bottom))),this.$options.css({left:"+="+increment.left,top:"+="+increment.top})},alignOptionsArrow:function(){var elBBox=this.$el[0].getBoundingClientRect(),optionsBBox=this.$options[0].getBoundingClientRect(),newLeft=elBBox.left+elBBox.width/2;newLeft-=optionsBBox.left,newLeft-=this.$optionsArrow.outerWidth()/2,this.$optionsArrow.css({left:newLeft})},close:function(){this.removeOptions(),this.$el.removeClass("opened"),this.trigger("close")},onRemove:function(){this.removeOptions(),$(document).off(".selectBox",this.onOutsideClick),this.options.keyboardNavigation&&$(document).off(".selectBox",this.onKeydown)},onKeydown:function(evt){if(this.isOpen()){var dir;switch(evt.which){case 39:case 40:dir=1;break;case 38:case 37:dir=-1;break;case 13:var hoverIndex=this.getOptionHoverIndex();return void(0<=hoverIndex&&this.select(hoverIndex));case 27:return this.close();default:return}evt.preventDefault();var idx=this.getOptionHoverIndex(),nextIdx=idx+dir,options=this.options.options;nextIdx<0&&(nextIdx=options.length-1),nextIdx>=options.length&&(nextIdx=0),this.markOptionHover(nextIdx),this.trigger("option:hover",this.options.options[nextIdx],nextIdx)}},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.close(),this.$el.addClass("disabled")},onSetTheme:function(oldTheme,newTheme){this.$options&&(oldTheme&&this.$options.removeClass(this.themeClassNamePrefix+oldTheme),this.$options.addClass(this.themeClassNamePrefix+newTheme))},calculateElOverflow:function(el,target){target=target||window,el instanceof jQuery&&(el=el[0]),target instanceof jQuery&&(target=target[0]);var targetBBox,overflow={},elBBox=el.getBoundingClientRect();if(target===window){var windowWidth=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,windowHeight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;targetBBox={width:windowWidth,height:windowHeight,left:0,top:0,right:windowWidth,bottom:windowHeight}}else targetBBox=target.getBoundingClientRect();return _.each(["left","top"],function(side){overflow[side]=Math.min(0,elBBox[side]-targetBBox[side])}),_.each(["right","bottom"],function(side){overflow[side]=Math.min(0,targetBBox[side]-elBBox[side])}),_.each(overflow,function(value,key){overflow[key]=Math.abs(Math.round(value))}),overflow}}),joint.ui.ColorPalette=joint.ui.SelectBox.extend({className:"select-box color-palette",position:function(){var $selection=this.$(".select-box-selection"),selectionHeight=$selection.outerHeight(),selectionOffset=$selection.offset(),left=selectionOffset.left,top=selectionOffset.top+selectionHeight;if(this.options.target!==document.body){this.$target=this.$target||$(this.options.target);var targetOffset=this.$target.offset();left-=targetOffset.left-this.$target.scrollLeft(),top-=targetOffset.top-this.$target.scrollTop()}this.$options.css({left:left,top:top})},renderOptionContent:function(option){var $option=$("<div/>",{class:"select-box-option-content"});return $option.css("background-color",option.content),option.icon&&$option.prepend($("<img/>",{class:"select-box-option-icon",src:option.icon})),$option}}),joint.ui.SelectButtonGroup=joint.mvc.View.extend({className:"select-button-group",events:{"click .select-button-group-button":"onSelect","mouseover .select-button-group-button":"onOptionHover",mouseleave:"onMouseOut","mousedown .select-button-group-button":"pointerdown","touchstart .select-button-group-button":"pointerdown","mouseup .select-button-group-button":"pointerup","touchend .select-button-group-button":"pointerup"},options:{buttonWidth:void 0,buttonHeight:void 0,options:[],disabled:!1,multi:!1,selected:void 0},init:function(){_.bindAll(this,"onSelect","pointerup"),this.$el.data("view",this);var multi=this.options.multi;_.isUndefined(this.options.selected)?this.selection=multi?_.filter(this.options.options,{selected:!0}):_.findWhere(this.options.options,{selected:!0}):this.selection=multi?_.isArray(this.options.selected)?_.filter(this.options.options,function(option,idx){return _.contains(this.options.selected,idx)},this):[this.options.options[this.options.selected]]:this.options.options[this.options.selected]},render:function(){return this.renderOptions(this.selection),this.options.width&&this.$el.css("width",this.options.width),this.options.disabled&&this.disable(),this.$el.append(this.$options),this},renderOptions:function(){this.removeOptions();var multi=this.options.multi;_.each(this.options.options,function(option,idx){var isSelected=multi?_.contains(this.selection,option):this.selection===option,$option=this.renderOption(option,idx,isSelected);this.$el.append($option),isSelected&&$option.addClass("selected")},this)},removeOptions:function(){this.$el.empty()},renderOption:function(option,idx,isSelected){var $option=this.renderOptionContent(option,isSelected);$option.data("index",idx);var buttonWidth=option.buttonWidth||this.options.buttonWidth;buttonWidth&&$option.css("width",buttonWidth);var buttonHeight=option.buttonHeight||this.options.buttonHeight;return buttonHeight&&$option.css("height",buttonHeight),$option},renderOptionContent:function(option,isSelected){var $option=$("<div/>",{class:"select-button-group-button",html:option.content});if(option.icon||isSelected&&option.iconSelected){var $icon=$("<img/>",{class:"select-button-group-button-icon",src:isSelected&&option.iconSelected?option.iconSelected:option.icon}),iconWidth=option.iconWidth||this.options.iconWidth;iconWidth&&$icon.css("width",iconWidth);var iconHeight=option.iconHeight||this.options.iconHeight;iconHeight&&$icon.css("height",iconHeight),$option.prepend($icon)}return joint.util.setAttributesBySelector($option,option.attrs),$option},getOptionIndex:function(el){return $(el).closest(".select-button-group-button").data("index")},onSelect:function(evt){if(!this.isDisabled()){var idx=this.getOptionIndex(evt.target);this.select(idx,{ui:!0})}},onOptionHover:function(evt){if(!this.isDisabled()){var idx=this.getOptionIndex(evt.target);this.trigger("option:hover",this.options.options[idx],idx)}},onMouseOut:function(evt){this.isDisabled()||this.trigger("mouseout",evt)},getSelection:function(){return this.selection},getSelectionValue:function(selection){if(selection=selection||this.selection)return this.options.multi?_.map(selection,function(option){return _.isUndefined(option.value)?option.content:option.value}):_.isUndefined(selection.value)?selection.content:selection.value},select:function(index,opt){var option=this.options.options[index],$option=$(this.$(".select-button-group-button")[index]),multi=this.options.multi;if(multi){$option.toggleClass("selected");var isSelected=$option.hasClass("selected");isSelected?-1===this.selection.indexOf(option)&&this.selection.push(option):this.selection=_.without(this.selection,option),option.iconSelected&&$option.find(".select-button-group-button-icon").attr("src",isSelected?option.iconSelected:option.icon)}else{this.selection=option;var $prevSelected=this.$(".selected"),prevSelection=this.options.options[$prevSelected.index()];$prevSelected.removeClass("selected"),$option.addClass("selected"),prevSelection&&prevSelection.iconSelected&&$prevSelected.find(".select-button-group-button-icon").attr("src",prevSelection.icon),this.selection.iconSelected&&$option.find(".select-button-group-button-icon").attr("src",this.selection.iconSelected)}this.trigger("option:select",this.selection,index,opt)},selectByValue:function(value,opt){_.isArray(value)||(value=[value]);for(var options=this.options.options||[],i=0;i<options.length;i++){var option=options[i];_.isUndefined(option.value)&&_.contains(value,option.content)?this.select(i,opt):!_.isUndefined(option.value)&&_.contains(value,option.value)&&this.select(i,opt)}},deselect:function(){this.$(".selected").removeClass("selected"),this.options.multi?this.selection=[]:this.selection=void 0},isDisabled:function(){return this.$el.hasClass("disabled")},enable:function(){this.$el.removeClass("disabled")},disable:function(){this.$el.addClass("disabled")},pointerdown:function(evt){var index=this.getOptionIndex(evt.target),$option=$(this.$(".select-button-group-button")[index]);$option.addClass("is-in-action"),$(document).on("mouseup.select-button-group touchend.select-button-group",this.pointerup)},pointerup:function(){this.$(".is-in-action").removeClass("is-in-action"),$(document).off("mouseup.select-button-group touchend.select-button-group")}}),joint.ui.Navigator=joint.mvc.View.extend({className:"navigator",events:{"mousedown .paper":"scrollTo","touchstart .paper":"scrollTo",mousedown:"startAction",touchstart:"startAction"},options:{paperConstructor:joint.dia.Paper,paperOptions:{},zoomOptions:null,zoom:{min:.5,max:2},width:300,height:200,padding:10},init:function(){this.options.zoomOptions?this.options.zoom=_.extend({},this.options.zoom,this.options.zoomOptions):this.options.zoom&&(this.options.zoom=_.defaults({},this.options.zoom,this.constructor.prototype.options.zoom)),_.bindAll(this,"updateCurrentView","doAction","stopAction"),this.updateCurrentView=_.debounce(this.updateCurrentView,0);var paperScroller=this.options.paperScroller;paperScroller.$el.on("scroll.navigator",this.updateCurrentView);var sourcePaper=this.sourcePaper=paperScroller.options.paper;this.listenTo(sourcePaper,"resize",this.updatePaper);this.targetPaper=new this.options.paperConstructor(_.merge({model:sourcePaper.model,interactive:!1},this.options.paperOptions));$(document.body).on({"mousemove.navigator touchmove.navigator":this.doAction,"mouseup.navigator touchend.navigator":this.stopAction})},render:function(){if(this.targetPaper.$el.appendTo(this.el),this.sourcePaper.model.get("cells").each(this.targetPaper.renderView,this.targetPaper),this.$currentView=$("<div>").addClass("current-view"),this.options.zoom){var $currentViewControl=$("<div>").addClass("current-view-control");this.$currentView.append($currentViewControl)}return this.$el.append(this.$currentView).css({width:this.options.width,height:this.options.height,padding:this.options.padding}),this.updatePaper(this.sourcePaper.options.width,this.sourcePaper.options.height),this},updatePaper:function(width,height){var sourceOrigin=this.sourcePaper.options.origin,sourceScale=V(this.sourcePaper.viewport).scale(),navigatorWidth=this.options.width-2*this.options.padding,navigatorHeight=this.options.height-2*this.options.padding;width/=sourceScale.sx,height/=sourceScale.sy;var ratio=this.ratio=Math.min(navigatorWidth/width,navigatorHeight/height),ox=sourceOrigin.x*ratio/sourceScale.sx,oy=sourceOrigin.y*ratio/sourceScale.sy;width*=ratio,height*=ratio,this.targetPaper.setDimensions(width,height),this.targetPaper.setOrigin(ox,oy),this.targetPaper.scale(ratio,ratio),this.updateCurrentView()},updateCurrentView:function(){var ratio=this.ratio,sourceScale=V(this.sourcePaper.viewport).scale(),paperScroller=this.options.paperScroller,topLeftCoordinates=paperScroller.toLocalPoint(0,0),paperPosition=this.targetPaper.$el.position(),paperOrigin=V(this.targetPaper.viewport).translate();paperOrigin.ty=paperOrigin.ty||0,this.currentViewGeometry={top:paperPosition.top+topLeftCoordinates.y*ratio+paperOrigin.ty,left:paperPosition.left+topLeftCoordinates.x*ratio+paperOrigin.tx,width:paperScroller.$el.innerWidth()*ratio/sourceScale.sx,height:paperScroller.$el.innerHeight()*ratio/sourceScale.sy},this.$currentView.css(this.currentViewGeometry)},startAction:function(evt){evt=joint.util.normalizeEvent(evt),this._action=$(evt.target).hasClass("current-view-control")?"zooming":"panning",this._clientX=evt.clientX,this._clientY=evt.clientY},doAction:function(evt){if(this._action){evt=joint.util.normalizeEvent(evt);var sourceScale=V(this.sourcePaper.viewport).scale(),dx=(evt.clientX-this._clientX)*sourceScale.sx,dy=(evt.clientY-this._clientY)*sourceScale.sy;switch(this._action){case"panning":this.options.paperScroller.el.scrollLeft+=dx/this.ratio,this.options.paperScroller.el.scrollTop+=dy/this.ratio;break;case"zooming":var levelDiff=-dx/this.currentViewGeometry.width;this.options.paperScroller.zoom(levelDiff,this.options.zoom)}this._clientX=evt.clientX,this._clientY=evt.clientY}},stopAction:function(){this._action=null},scrollTo:function(evt){evt=joint.util.normalizeEvent(evt);var offsetX,offsetY,paperOrigin=V(this.targetPaper.viewport).translate();if(paperOrigin.ty=paperOrigin.ty||0,_.isUndefined(evt.offsetX)){var targetPaperOffset=this.targetPaper.$el.offset();offsetX=evt.pageX-targetPaperOffset.left,offsetY=evt.pageY-targetPaperOffset.top}else offsetX=evt.offsetX,offsetY=evt.offsetY;var cx=(offsetX-paperOrigin.tx)/this.ratio,cy=(offsetY-paperOrigin.ty)/this.ratio;this.options.paperScroller.center(cx,cy)},onRemove:function(){this.targetPaper.remove(),this.options.paperScroller.$el.off(".navigator"),$(document.body).off(".navigator")}}),joint.ui.TreeLayoutView=joint.mvc.View.extend({MINIMAL_PREVIEW_SIZE:10,className:"tree-layout",options:{previewAttrs:{child:{},parent:{rx:2,ry:2}},useModelGeometry:!1,clone:function(cell){return cell.clone()},canInteract:_.constant(!0)},init:function(){_.bindAll(this,"onPointermove","onPointerup"),this.toggleDefaultInteraction(!1),this.startListening(),this.render(),this.onSetTheme(null,this.theme)},startListening:function(){var paper=this.options.paper;this.listenTo(paper,"element:pointerdown",this.canInteract(this.onPointerdown))},toggleDefaultInteraction:function(interactive){this.options.paper.setInteractivity(interactive)},render:function(){var paper=this.options.paper;return this.$activeBox=$("<div>").addClass("tree-layout-box active hidden").appendTo(this.el),this.draggingPaper=new joint.dia.Paper({model:new joint.dia.Graph,interactive:!1,width:"100%",height:"100%"}),this.$translateBox=$("<div>").addClass("tree-layout-box translate hidden").append(this.draggingPaper.render().el).appendTo(this.el),this.$mask=$("<div>").addClass("tree-layout-mask"),this.svgViewport=V(paper.viewport),this.svgPreviewChild=V("circle").attr(this.options.previewAttrs.child||{}).addClass("tree-layout-preview child"),this.svgPreviewConnection=V("path").attr(this.options.previewAttrs.link||{}).addClass("tree-layout-preview link"),this.svgPreviewParent=V("rect").attr(this.options.previewAttrs.parent||{}).addClass("tree-layout-preview parent"),this.svgPreview=V("g").addClass("tree-layout-preview-group").append([this.svgPreviewConnection,this.svgPreviewParent,this.svgPreviewChild]),this.$el.appendTo(paper.el),this},onSetTheme:function(oldTheme,newTheme){var $elsWithThemeClass=[this.svgPreview,this.$mask];_.each($elsWithThemeClass,function($elWithThemeClass){$elWithThemeClass&&(oldTheme&&$elWithThemeClass.removeClass(this.themeClassNamePrefix+oldTheme),$elWithThemeClass.addClass(this.themeClassNamePrefix+newTheme))},this)},onRemove:function(){this.svgPreview.remove()},toggleDropping:function(state){this.$mask.toggleClass("dropping-not-allowed",!state),this.$translateBox.toggleClass("no-drop",!state)},canDrop:function(){return this.isActive()&&!this.$translateBox.hasClass("no-drop")},isActive:function(){return!this.$translateBox.hasClass("hidden")},_startDrag:function(elements,x,y){var paper=this.options.paper;this.$mask.appendTo(paper.el),this.toggleDropping(!1),this.ctm=paper.viewport.getCTM();var element=_.first(elements),elementView=element.findView(paper),bbox=elementView.getBBox({useModelGeometry:this.options.useModelGeometry});this.updateBox(this.$translateBox,_.defaults({x:x,y:y},bbox)),this.updateBox(this.$activeBox,bbox),this.$activeBox.removeClass("hidden"),this.$translateBox.removeClass("hidden"),this.prepareDraggingPaper(element)},updateBox:function($box,bbox){$box.css({width:bbox.width,height:bbox.height,left:bbox.x,top:bbox.y})},positionTranslateBox:function(position){var transformedPosition=V.transformPoint(position,this.ctm);this.$translateBox.css({left:transformedPosition.x,top:transformedPosition.y})},prepareDraggingPaper:function(draggedElement){var clone=this.options.clone(draggedElement).position(0,0);this.draggingPaper.scale(this.ctm.a,this.ctm.d),this.draggingPaper.model.resetCells([clone])},_doDrag:function(elements,x,y){var rootLayoutArea,layoutArea,layout=this.model,coordinates={x:x,y:y};if(this.candidate&&(this.candidate=null,this.hidePreview()),this.positionTranslateBox(coordinates),(rootLayoutArea=layout.getMinimalRootAreaByPoint(coordinates))&&(layoutArea=rootLayoutArea.findMinimalAreaByPoint(coordinates,{expandBy:Math.min(layout.get("siblingGap"),layout.get("gap"))/2})),layoutArea){var direction=this.findDirection(layoutArea,coordinates),siblings=layoutArea.getLayoutSiblings(direction),siblingRank=siblings.getSiblingRankByPoint(coordinates),isConnectionValid=_.every(elements,_.partial(this.isConnectionValid,_,siblings,siblingRank),this);isConnectionValid?(this.candidate={id:layoutArea.root.id,direction:direction,siblingRank:siblingRank+.5},this.updatePreview(siblings,siblingRank),this.showPreview(),this.toggleDropping(!0)):this.toggleDropping(!1)}else this.toggleDropping(!0)},_finishDrag:function(elements,x,y){this.$mask.remove().removeClass("dropping-not-allowed"),this.candidate?(_.each(elements,_.partial(this.reconnectElement,_,this.candidate),this),this.candidate=null,this.model.layout({ui:!0})):this.canDrop()&&(_.each(elements,_.partial(this.translateElement,_,x,y),this),this.model.layout({ui:!0})),this.$activeBox.addClass("hidden"),this.$translateBox.addClass("hidden"),this.hidePreview()},reconnectElement:function(element,candidate){var opt={direction:candidate.direction,siblingRank:candidate.siblingRank,ui:!0},canReconnect=this.model.reconnectElement(element,candidate.id,opt);if(!canReconnect){var paper=this.options.paper,link=paper.getDefaultLink(element.findView(paper));link.set({source:{id:candidate.id},target:{id:element.id}}),link.addTo(paper.model,opt),this.model.changeSiblingRank(element,candidate.siblingRank,opt),this.model.changeDirection(element,candidate.direction,opt);var prevDirection=this.model.getAttribute(element,"direction");this.model.updateDirections(element,[prevDirection,candidate.direction],opt)}},translateElement:function(element,x,y){var inboundLinks=this.model.graph.getConnectedLinks(element,{inbound:!0});_.invoke(inboundLinks,"remove");var elementSize=element.get("size");element.set("position",{x:x-elementSize.width/2,y:y-elementSize.height/2},{ui:!0})},updatePreview:function(siblings,siblingRank){var parent=siblings.parentArea.root,childWidth=Math.max(this.model.get("siblingGap")/2,this.MINIMAL_PREVIEW_SIZE),childSize={width:childWidth,height:childWidth},childPosition=siblings.getNeighborPointFromRank(siblingRank),points=siblings.getConnectionPoints(childPosition,{ignoreSiblings:!0}),parentPoint=siblings.getParentConnectionPoint(),childPoint=siblings.getChildConnectionPoint(childPosition,childSize);this.updateParentPreview(parent.get("position"),parent.get("size")),this.updateChildPreview(childPosition,childSize),this.updateConnectionPreview(parentPoint,childPoint,points)},showPreview:function(){this.svgViewport.append(this.svgPreview)},hidePreview:function(){this.svgPreview.remove()},updateParentPreview:function(position,size){this.svgPreviewParent.attr({x:position.x,y:position.y,width:size.width,height:size.height})},updateChildPreview:function(position,size){this.svgPreviewChild.attr({cx:position.x,cy:position.y,r:size.width/2})},updateConnectionPreview:function(source,target,vertices){this.svgPreviewConnection.attr({d:joint.connectors.rounded(source,target,vertices,{})})},findDirection:function(layoutArea,point){var directions,type=layoutArea.root.get("layout")||layoutArea.getType();switch(type){case"BL-BR":case"TL-TR":case"L-R":return directions=type.split("-"),point.x>layoutArea.rootCX?directions[1]:directions[0];case"BL-TL":case"BR-TR":case"B-T":return directions=type.split("-"),point.y>layoutArea.rootCY?directions[0]:directions[1];case"L":case"R":case"T":case"B":case"TR":case"TL":case"BR":case"BL":return type;default:return layoutArea.direction}},isConnectionValid:function(element,siblings,siblingRank){if(element.id==siblings.parentArea.root.id)return!1;if(this.model.graph.isSuccessor(element,siblings.parentArea.root))return!1;var elementArea=this.model.getLayoutArea(element);if(elementArea.parentArea&&elementArea.parentArea==siblings.parentArea&&elementArea.direction==siblings.direction){var rankChange=elementArea.siblingRank-siblingRank;if(0==rankChange||1==rankChange)return!1}return!0},canInteract:function(handler){return _.bind(function(cellView){this.options.canInteract(cellView)&&handler.apply(this,arguments)},this)},getEventNamespace:function(){return".tree-layout-"+this.cid},startDragging:function(elements,x,y){var draggedElements=_.isArray(elements)?elements:[elements];_.isEmpty(draggedElements)||(this._registerPointerEvents(),this._moveCounter=0,this._draggedElements=draggedElements)},onPointerdown:function(elementView,evt,x,y){this.startDragging(elementView.model,x,y)},onPointermove:function(evt){var paper=this.options.paper,localPoint=paper.clientToLocalPoint({x:evt.clientX,y:evt.clientY});this._moveCounter===paper.options.clickThreshold?this._startDrag(this._draggedElements,localPoint.x,localPoint.y):this._moveCounter>paper.options.clickThreshold&&this._doDrag(this._draggedElements,localPoint.x,localPoint.y),this._moveCounter++},onPointerup:function(evt){var paper=this.options.paper;if(this._moveCounter>=paper.options.clickThreshold){var localPoint=paper.clientToLocalPoint({x:evt.clientX,y:evt.clientY});this._finishDrag(this._draggedElements,localPoint.x,localPoint.y)}this._draggedElements=null,this._unregisterPointerEvents()},_registerPointerEvents:function(){var namespace=this.getEventNamespace();$(document).on("mousemove"+namespace+" touchmove"+namespace,this.onPointermove).on("mouseup"+namespace+" touchend"+namespace,this.onPointerup)},_unregisterPointerEvents:function(){$(document).off(this.getEventNamespace())}}),joint.layout.ForceDirected=Backbone.Model.extend({defaults:{linkDistance:10,linkStrength:1,charge:10},initialize:function(opt){this.elements=this.get("graph").getElements(),this.links=this.get("graph").getLinks(),this.cells=this.get("graph").get("cells"),this.width=this.get("width"),this.height=this.get("height"),this.gravityCenter=this.get("gravityCenter"),this.t=1,this.energy=1/0,this.progress=0},start:function(){var w=this.get("width"),h=this.get("height");_.each(this.elements,function(el){el.set("position",{x:Math.random()*w,y:Math.random()*h}),el.charge=el.get("charge")||this.get("charge"),el.weight=el.get("weight")||1;var pos=el.get("position");el.x=pos.x,el.y=pos.y,el.px=el.x,el.py=el.y,el.fx=0,el.fy=0},this),_.each(this.links,function(link){link.strength=link.get("strength")||this.get("linkStrength"),link.distance=link.get("distance")||this.get("linkDistance"),link.source=this.cells.get(link.get("source").id),link.target=this.cells.get(link.get("target").id)},this)},step:function(){if(.99*this.t<.005)return this.notifyEnd();var i,j,w=this.width,h=this.height,gravityCenter=this.gravityCenter,energyBefore=this.energy,xBefore=this.energy=0,yBefore=0,xAfter=0,yAfter=0,nElements=this.elements.length,nLinks=this.links.length;for(i=0;i<nElements-1;i++){var v=this.elements[i];for(xBefore+=v.x,yBefore+=v.y,j=i+1;j<nElements;j++){var u=this.elements[j],dx=u.x-v.x,dy=u.y-v.y,distanceSquared=dx*dx+dy*dy,distance=Math.sqrt(distanceSquared),fr=this.t*v.charge/distanceSquared,fx=fr*dx,fy=fr*dy;v.fx-=fx,v.fy-=fy,u.fx+=fx,u.fy+=fy,this.energy+=fx*fx+fy*fy}}for(xBefore+=this.elements[nElements-1].x,yBefore+=this.elements[nElements-1].y,i=0;i<nLinks;i++){var link=this.links[i],v=link.source,u=link.target,dx=u.x-v.x,dy=u.y-v.y,distanceSquared=dx*dx+dy*dy,distance=Math.sqrt(distanceSquared),fa=this.t*link.strength*(distance-link.distance)/distance,fx=fa*dx,fy=fa*dy,k=v.weight/(v.weight+u.weight);v.x+=fx*(1-k),v.y+=fy*(1-k),u.x-=fx*k,u.y-=fy*k,this.energy+=fx*fx+fy*fy}for(i=0;i<nElements;i++){var el=this.elements[i],pos={x:el.x,y:el.y};gravityCenter&&(pos.x+=(gravityCenter.x-pos.x)*this.t*.1,pos.y+=(gravityCenter.y-pos.y)*this.t*.1),pos.x+=el.fx,pos.y+=el.fy,pos.x=Math.max(0,Math.min(w,pos.x)),pos.y=Math.max(0,Math.min(h,pos.y));pos.x+=.9*(el.px-pos.x),pos.y+=.9*(el.py-pos.y),el.px=pos.x,el.py=pos.y,el.fx=el.fy=0,el.x=pos.x,el.y=pos.y,xAfter+=el.x,yAfter+=el.y,this.notify(el,i,pos)}this.t=this.cool(this.t,this.energy,energyBefore);var gdx=xBefore-xAfter,gdy=yBefore-yAfter,gd=Math.sqrt(gdx*gdx+gdy*gdy);gd<1&&this.notifyEnd()},cool:function(t,energy,energyBefore){return energy<energyBefore?(this.progress+=1,5<=this.progress?(this.progress=0,t/.99):t):(this.progress=0,.99*t)},notify:function(el,i,pos){el.set("position",pos)},notifyEnd:function(){this.trigger("end")}}),joint.layout=joint.layout||{},joint.layout.GridLayout={layout:function(graphOrCells,opt){var graph;graph=graphOrCells instanceof joint.dia.Graph?graphOrCells:(new joint.dia.Graph).resetCells(graphOrCells),graphOrCells=null,opt=opt||{};var elements=graph.getElements(),columns=opt.columns||1,dx=opt.dx||0,dy=opt.dy||0,columnWidth=opt.columnWidth||this._maxDim(elements,"width")+dx,rowHeight=opt.rowHeight||this._maxDim(elements,"height")+dy,centre=_.isUndefined(opt.centre)||!1!==opt.centre,resizeToFit=!!opt.resizeToFit,marginX=opt.marginX||0,marginY=opt.marginY||0;graph.startBatch("layout"),_.each(elements,function(element,index){var cx=0,cy=0,elementSize=element.get("size");if(resizeToFit){var elementWidth=columnWidth-2*dx,elementHeight=rowHeight-2*dy,calcElHeight=elementSize.height*(elementSize.width?elementWidth/elementSize.width:1),calcElWidth=elementSize.width*(elementSize.height?elementHeight/elementSize.height:1);rowHeight<calcElHeight?elementWidth=calcElWidth:elementHeight=calcElHeight,elementSize={width:elementWidth,height:elementHeight},element.set("size",elementSize)}centre&&(cx=(columnWidth-elementSize.width)/2,cy=(rowHeight-elementSize.height)/2),cx+=marginX,cy+=marginY,element.set("position",{x:index%columns*columnWidth+dx+cx,y:Math.floor(index/columns)*rowHeight+dy+cy})}),graph.stopBatch("layout")},_maxDim:function(elements,dimension){return _.reduce(elements,function(max,el){return Math.max(el.get("size")[dimension],max)},0)}},function(joint,Backbone,_,g){function LayoutSiblings(layoutAreas,parentArea,opt){opt=_.defaults(opt||{},{siblingGap:0}),this.width=0,this.height=0,this.layoutAreas=this.sortLayoutAreas(layoutAreas),this.parentArea=parentArea,this.siblingGap=opt.siblingGap,this.exists()&&this.computeSize(opt)}_.extend(LayoutSiblings.prototype,{sortLayoutAreas:function(layoutAreas){var areas=_.sortBy(layoutAreas,"siblingRank");return _.each(areas,function(area,index){area.siblingRank=index}),areas},move:function(dx,dy){_.each(this.layoutAreas,function(area){area.dx+=dx,area.dy+=dy})},exists:function(){return 0<this.layoutAreas.length},sumGaps:function(gap){var gapCount=Math.max(this.layoutAreas.length-1,0);return gapCount*gap},getSiblingRankByPoint:function(point){if(!this.exists())return-1;var closestArea=this.findAreaByPoint(point);return closestArea?closestArea.siblingRank-1:this.layoutAreas.length-1},getFirstChildConnectionPoints:function(){return[]},getConnectionPoints:function(point,opt){if(!this.exists())return this.getFirstChildConnectionPoints(point);var deltaCoordinates={dx:point.x-this.parentArea.rootCX,dy:point.y-this.parentArea.rootCY};return this.layoutAreas[0].getRootVertices(deltaCoordinates,opt)},getParentConnectionPoint:function(){var parentArea=this.parentArea,offset=this.proxyLayoutArea("getConnectionPoint",parentArea.rootSize),connectionPoint=g.point(parentArea.rootCX,parentArea.rootCY);return connectionPoint.offset(offset.x,offset.y)},getChildConnectionPoint:function(point,rootSize){var offset=this.proxyLayoutArea("getConnectionPoint",rootSize);return g.point(point).difference(offset)},proxyLayoutArea:function(method){var args=Array.prototype.slice.call(arguments,1);return LayoutArea.fromDirection(this.direction).prototype[method].apply(this.parentArea,args)}}),LayoutSiblings.extend=Backbone.Model.extend;var VerticalLayoutSiblings=LayoutSiblings.extend({getTopDY:function(){return-this.height/2},findAreaByPoint:function(point){return _.find(this.layoutAreas,function(area){return area.rootCY>point.y})},computeSize:function(opt){this.height=this.sumGaps(opt.siblingGap),this.height+=_.sum(this.layoutAreas,function(area){return area.height+area.prevSiblingGap+area.nextSiblingGap}),_.reduce(this.layoutAreas,function(y,area){return this.width=Math.max(this.width,area.getExtendedWidth()),area.dy+=y+area.getCY(),y+area.prevSiblingGap+area.height+area.nextSiblingGap+opt.siblingGap},this.getTopDY(),this)},getYTowardsParent:function(){return this.parentArea.rootCY},getXTowardsParent:function(){var parentArea=this.parentArea;return parentArea.rootCX+this.LRSign*(parentArea.rootSize.width/2+parentArea.gap)},getNeighborPointFromRank:function(rank){var y,siblingGap=this.siblingGap;if(this.exists()){var prevArea=this.layoutAreas[rank],nextArea=this.layoutAreas[rank+1];y=prevArea?nextArea?(prevArea.y+prevArea.height+nextArea.y)/2:prevArea.y+prevArea.height+siblingGap/2:nextArea.y-siblingGap/2}else y=this.getYTowardsParent();return{x:this.getXTowardsParent(),y:y}}}),LeftLayoutSiblings=VerticalLayoutSiblings.extend({direction:"L",LRSign:-1}),RightLayoutSiblings=VerticalLayoutSiblings.extend({direction:"R",LRSign:1}),treeLayoutSiblings={getXTowardsParent:function(){var parentArea=this.parentArea;return parentArea.rootCX+this.LRSign*parentArea.gap},getYTowardsParent:function(){var parentArea=this.parentArea,dy=parentArea.getLRHeight(parentArea.siblings)/2;return dy+=Math.min(parentArea.firstChildGap,this.siblingGap/2),parentArea.rootCY+this.TBSign*dy},getFirstChildConnectionPoints:function(point){return[g.point(this.parentArea.rootCX,point.y)]},getChildConnectionPoint:function(point,rootSize){return g.point(point).offset(-this.LRSign*rootSize.width/2,0)},getParentConnectionPoint:function(){var parentArea=this.parentArea,connectionPoint=g.point(parentArea.rootCX,parentArea.rootCY);return connectionPoint.offset(0,this.TBSign*parentArea.rootSize.height/2)}},bottomTreeLayoutSiblings={getTopDY:function(){var topArea=this.layoutAreas[0];return topArea?topArea.prevSiblingGap:0}},topTreeLayoutSiblings={getTopDY:function(){return-this.height}},BottomRightLayoutSiblings=VerticalLayoutSiblings.extend({direction:"BR",LRSign:1,TBSign:1});_.extend(BottomRightLayoutSiblings.prototype,treeLayoutSiblings,bottomTreeLayoutSiblings);var BottomLeftLayoutSiblings=VerticalLayoutSiblings.extend({direction:"BL",LRSign:-1,TBSign:1});_.extend(BottomLeftLayoutSiblings.prototype,treeLayoutSiblings,bottomTreeLayoutSiblings);var TopRightLayoutSiblings=VerticalLayoutSiblings.extend({direction:"TR",LRSign:1,TBSign:-1});_.extend(TopRightLayoutSiblings.prototype,treeLayoutSiblings,topTreeLayoutSiblings);var TopLeftLayoutSiblings=VerticalLayoutSiblings.extend({direction:"TL",LRSign:-1,TBSign:-1});_.extend(TopLeftLayoutSiblings.prototype,treeLayoutSiblings,topTreeLayoutSiblings);var HorizontalLayoutSiblings=LayoutSiblings.extend({getLeftDX:function(){return-this.width/2},findAreaByPoint:function(point){return _.find(this.layoutAreas,function(area){return area.rootCX>point.x})},computeSize:function(opt){this.width=this.sumGaps(opt.siblingGap),this.width+=_.sum(this.layoutAreas,function(area){return area.width+area.prevSiblingGap+area.nextSiblingGap}),_.reduce(this.layoutAreas,function(x,area){return this.height=Math.max(this.height,area.getExtendedHeight()),area.dx+=x+area.getCX(),x+area.prevSiblingGap+area.width+area.nextSiblingGap+opt.siblingGap},this.getLeftDX(),this)},getNeighborPointFromRank:function(rank){var x;if(this.exists()){var prevArea=this.layoutAreas[rank],nextArea=this.layoutAreas[rank+1];x=prevArea?nextArea?(prevArea.x+prevArea.width+nextArea.x)/2:prevArea.x+prevArea.width+this.siblingGap/2:nextArea.x-this.siblingGap/2}else x=this.parentArea.rootCX;return{x:x,y:this.getYTowardsParent()}}}),TopLayoutSiblings=HorizontalLayoutSiblings.extend({direction:"T",getYTowardsParent:function(){var parentArea=this.parentArea;return parentArea.rootCY-parentArea.getLRHeight()/2-parentArea.gap}}),BottomLayoutSiblings=HorizontalLayoutSiblings.extend({direction:"B",getYTowardsParent:function(){var parentArea=this.parentArea;return parentArea.rootCY+parentArea.getLRHeight()/2+parentArea.gap}});function LayoutArea(root,childAreas,opt){var options=_.extend({},opt,this.getRootAttributes(root,opt.attributeNames)),globalGap=opt.gap||0;_.defaults(options,{parentGap:globalGap,siblingGap:globalGap,firstChildGap:globalGap}),this.root=root,this.childAreas=childAreas,this.siblingRank=options.siblingRank,this.rootOffset=options.rootOffset,this.nextSiblingGap=options.nextSiblingGap,this.prevSiblingGap=options.prevSiblingGap,this.gap=this.parentGap=options.parentGap,this.firstChildGap=options.firstChildGap,this.dx=0,this.dy=0,this.width=0,this.height=0,_.invoke(childAreas,"addParentReference",this),this.computeRelativePosition(root,childAreas,options)}_.extend(LayoutArea,{create:function(direction,root,childAreas,opt){var constructor=LayoutArea.fromDirection(direction,opt);return new constructor(root,childAreas,opt)},fromDirection:function(direction,opt){var constructor;switch(direction){case"L":constructor=LeftLayoutArea;break;case"T":constructor=TopLayoutArea;break;case"R":constructor=RightLayoutArea;break;case"B":constructor=BottomLayoutArea;break;case"BR":constructor=BottomRightLayoutArea;break;case"BL":constructor=BottomLeftLayoutArea;break;case"TR":constructor=TopRightLayoutArea;break;case"TL":constructor=TopLeftLayoutArea;break;default:constructor=LayoutArea}return constructor}}),_.extend(LayoutArea.prototype,{direction:null,getHeight:function(siblings,rootSize){return this.getTHeight(siblings)+this.getBHeight(siblings)+this.getLRHeight()},getWidth:function(siblings,rootSize){return Math.max(siblings.T.width,siblings.B.width,this.getXLRWidth(siblings,rootSize))},getLRHeight:function(){return Math.max(this.rootSize.height,this.siblings.L.height,this.siblings.R.height)},getTHeight:function(siblings){return siblings.T.height+this.getTXHeight(siblings)},getBHeight:function(siblings){return siblings.B.height+this.getBXHeight(siblings)},getXLRWidth:function(siblings,rootSize){return this.getLWidth(siblings,rootSize)+rootSize.width+this.getRWidth(siblings,rootSize)},getXRWidth:function(siblings,rootSize){var xrWidth=Math.max(siblings.BR.width,siblings.TR.width);return 0<xrWidth&&(xrWidth-=rootSize.width/2),xrWidth},getTXHeight:function(siblings){var txHeight=Math.max(siblings.TR.height,siblings.TL.height);return 0<txHeight&&(txHeight+=this.firstChildGap),txHeight},getBXHeight:function(siblings){var bxHeight=Math.max(siblings.BR.height,siblings.BL.height);return 0<bxHeight&&(bxHeight+=this.firstChildGap),bxHeight},getXLWidth:function(siblings,rootSize){var xlWidth=Math.max(siblings.BL.width,siblings.TL.width);return 0<xlWidth&&(xlWidth-=rootSize.width/2),xlWidth},getRWidth:function(siblings,rootSize){return Math.max(siblings.R.width,this.getXRWidth(siblings,rootSize))},getLWidth:function(siblings,rootSize){return Math.max(siblings.L.width,this.getXLWidth(siblings,rootSize))},getTBOverlap:function(siblings,rootSize){var tbOverlap=Math.max(siblings.T.width,siblings.B.width);return 0<tbOverlap&&(tbOverlap-=rootSize.width,tbOverlap/=2),tbOverlap},getMinimalGap:function(siblings){return Math.min(siblings.siblingGap,this.firstChildGap,this.parentGap)},getBBox:function(opt){var bbox=g.rect(this),pad=opt&&opt.expandBy;return pad&&bbox.moveAndExpand({x:-pad,y:-pad,width:2*pad,height:2*pad}),bbox},containsPoint:function(point,opt){return this.getBBox(opt).containsPoint(point)},getLayoutSiblings:function(direction){return this.siblings[direction]},getExtendedWidth:function(){return this.width+this.gap+this.rootOffset},getExtendedHeight:function(){return this.height+this.gap+this.rootOffset},findMinimalAreaByPoint:function(point,opt){return this.containsPoint(point,opt)?(_.some(this.childAreas,function(area){return!!(minimalArea=area.findMinimalAreaByPoint(point,opt))}),minimalArea||this):null;var minimalArea},getType:function(){return _.reduce(this.siblings,function(memo,siblingGroup,direction){return siblingGroup.exists()?memo.concat(direction):memo},[]).sort().join("-")},addParentReference:function(parentArea){this.parentArea=parentArea},getRootAttributes:function(root,attributeNames){var siblingRank=root.get(attributeNames.siblingRank||"siblingRank");return{siblingRank:_.isNumber(siblingRank)?siblingRank:null,rootOffset:root.get(attributeNames.offset||"offset")||0,rootMargin:root.get(attributeNames.margin||"margin")||0,prevSiblingGap:root.get(attributeNames.prevSiblingGap||"prevSiblingGap")||0,nextSiblingGap:root.get(attributeNames.nextSiblingGap||"nextSiblingGap")||0}},getRootSize:function(root,rootMargin){var rootSize=_.clone(root.get("size"));return rootSize[this.marginDimension]+=rootMargin,rootSize},createSiblings:function(childAreas,opt){var groupedAreas=_.groupBy(childAreas,"direction");return{L:new LeftLayoutSiblings(groupedAreas.L,this,opt),T:new TopLayoutSiblings(groupedAreas.T,this,opt),R:new RightLayoutSiblings(groupedAreas.R,this,opt),B:new BottomLayoutSiblings(groupedAreas.B,this,opt),BR:new BottomRightLayoutSiblings(groupedAreas.BR,this,opt),BL:new BottomLeftLayoutSiblings(groupedAreas.BL,this,opt),TR:new TopRightLayoutSiblings(groupedAreas.TR,this,opt),TL:new TopLeftLayoutSiblings(groupedAreas.TL,this,opt)}},computeSize:function(siblings,rootSize){return{width:this.getWidth(siblings,rootSize),height:this.getHeight(siblings,rootSize)}},computeOrigin:function(){var siblings=this.siblings,rootSize=this.rootSize,maxWidth=Math.max(this.getLWidth(siblings,rootSize)+rootSize.width/2,this.getXLWidth(siblings,rootSize)+rootSize.width/2,siblings.T.width/2,siblings.B.width/2);return{x:this.rootCX-maxWidth,y:this.rootCY-this.getTHeight(siblings)-this.getLRHeight()/2}},moveSiblings:function(siblings,rootSize){if(this.hasHorizontalSiblings(siblings)){var dx=rootSize.width/2;siblings.L.move(-dx,0),siblings.R.move(dx,0)}if(this.hasVerticalSiblings(siblings)){var dy=this.getLRHeight()/2;siblings.T.move(0,-dy),siblings.B.move(0,dy),siblings.BR.move(0,dy),siblings.BL.move(0,dy),siblings.B.move(0,this.getBXHeight(siblings)),siblings.TR.move(0,-dy),siblings.TL.move(0,-dy),siblings.T.move(0,-this.getTXHeight(siblings))}},moveRootToConnectionPoint:function(rootSize){var connectionPoint=this.getConnectionPoint(rootSize);this.dx+=connectionPoint.x,this.dy+=connectionPoint.y},computeRelativePosition:function(root,childAreas,opt){var siblings=this.siblings=this.createSiblings(childAreas,{siblingGap:opt.siblingGap}),rootSize=this.rootSize=this.getRootSize(root,opt.rootMargin);_.extend(this,this.computeSize(siblings,rootSize)),this.moveSiblings(siblings,rootSize),this.moveRootToConnectionPoint(rootSize),this.moveRootBehindSiblings(siblings,rootSize),this.moveRootFromParent()},computeAbsolutePosition:function(){if(this.parentArea)this.rootCX=this.parentArea.rootCX+this.dx,this.rootCY=this.parentArea.rootCY+this.dy,this.level=this.parentArea.level+1;else{var rootCenter=this.root.getBBox().center();this.rootCX=rootCenter.x,this.rootCY=rootCenter.y,this.level=0}_.extend(this,this.computeOrigin())},hasVerticalSiblings:function(siblings){return siblings.T.exists()||siblings.B.exists()||siblings.BR.exists()||siblings.BL.exists()||siblings.TR.exists()||siblings.TL.exists()},hasHorizontalSiblings:function(siblings){return siblings.L.exists()||siblings.R.exists()},isSourceArea:function(){return!this.parentArea},isSinkArea:function(){return 0===this.childAreas.length},getRootPosition:function(){var rootSize=this.root.get("size");return{x:this.rootCX-rootSize.width/2,y:this.rootCY-rootSize.height/2}},getRootVertices:function(deltaCoordinates,opt){if(opt=opt||{},0===(deltaCoordinates=deltaCoordinates||this)[this.deltaCoordinate]||!this.parentArea)return[];var relativeVertices,parentInnerSize=this.parentArea.getInnerSize();if(!opt.ignoreSiblings&&this.hasSiblingsBetweenParent()){var oppositeSiblings=this.siblings[this.oppositeDirection];relativeVertices=this.getRelativeVerticesAvoidingSiblings(parentInnerSize,deltaCoordinates,oppositeSiblings)}else relativeVertices=this.getRelativeVertices(parentInnerSize,deltaCoordinates);return _.invoke(relativeVertices,"offset",this.parentArea.rootCX,this.parentArea.rootCY)},getInnerSize:function(){return{width:this.rootSize.width,height:this.getLRHeight()}},getConnectionPoint:function(){return null},getRelativeVertices:function(){return null},moveRootFromParent:function(){},moveRootBehindSiblings:function(){},hasSiblingsBetweenParent:function(){return!this.isSourceArea()&&this.siblings[this.oppositeDirection].exists()},getCY:function(){return this.height/2+this.prevSiblingGap},getCX:function(){return this.width/2+this.prevSiblingGap}}),LayoutArea.extend=Backbone.Model.extend;var RightLayoutArea=LayoutArea.extend({direction:"R",oppositeDirection:"L",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(rootSize.width/2,0)},moveRootBehindSiblings:function(siblings,rootSize){this.dx+=Math.max(this.getLWidth(siblings,rootSize),this.getTBOverlap(siblings,rootSize)),this.dy+=(this.getTHeight(siblings)-this.getBHeight(siblings))/2},moveRootFromParent:function(){this.dx+=this.parentGap+this.rootOffset},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize),dx=this.parentGap/2;return[connectionPoint.clone().offset(dx,0),connectionPoint.clone().offset(dx,deltaCoordinates.dy)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var connectionPoint=this.getConnectionPoint(parentRootSize),siblingGap=siblings.siblingGap,signY=0<deltaCoordinates.dy?-1:1,fx=1<siblings.layoutAreas.length?1.5:1,y1=deltaCoordinates.dy+signY*(siblings.height+siblingGap)/2,y2=deltaCoordinates.dy+signY*this.rootSize.height/4,x1=this.gap/2,x2=fx*x1+siblings.width;return[connectionPoint.clone().offset(x1,0),connectionPoint.clone().offset(x1,y1),connectionPoint.clone().offset(x2,y1),connectionPoint.clone().offset(x2,y2)]}}),LeftLayoutArea=LayoutArea.extend({direction:"L",oppositeDirection:"R",deltaCoordinate:"dx",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(-rootSize.width/2,0)},moveRootBehindSiblings:function(siblings,rootSize){this.dx-=Math.max(this.getRWidth(siblings,rootSize),this.getTBOverlap(siblings,rootSize)),this.dy+=(this.getTHeight(siblings)-this.getBHeight(siblings))/2},moveRootFromParent:function(){this.dx-=this.parentGap+this.rootOffset},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize),dx=-this.parentGap/2;return[connectionPoint.clone().offset(dx,0),connectionPoint.clone().offset(dx,deltaCoordinates.dy)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var connectionPoint=this.getConnectionPoint(parentRootSize),siblingGap=siblings.siblingGap,signY=0<deltaCoordinates.dy?-1:1,fx=1<siblings.layoutAreas.length?1.5:1,y1=deltaCoordinates.dy+signY*(siblings.height+siblingGap)/2,y2=deltaCoordinates.dy+signY*this.rootSize.height/4,x1=this.gap/2,x2=fx*x1+siblings.width;return[connectionPoint.clone().offset(-x1,0),connectionPoint.clone().offset(-x1,y1),connectionPoint.clone().offset(-x2,y1),connectionPoint.clone().offset(-x2,y2)]}}),TopLayoutArea=LayoutArea.extend({direction:"T",oppositeDirection:"B",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(rootSize){return g.point(0,-rootSize.height/2)},moveRootBehindSiblings:function(siblings,rootSize){this.dx+=(this.getLWidth(siblings,rootSize)-this.getRWidth(siblings,rootSize))/2,this.hasHorizontalSiblings(siblings)&&(this.dy-=(this.getLRHeight()-rootSize.height)/2),this.dy-=this.getBHeight(siblings)},moveRootFromParent:function(){this.dy-=this.parentGap+this.rootOffset},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize),dy=-this.getTXHeight(this.parentArea.siblings)-this.parentGap/2;return[connectionPoint.clone().offset(0,dy),connectionPoint.clone().offset(deltaCoordinates.dx,dy)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var connectionPoint=this.getConnectionPoint(parentRootSize),siblingGap=siblings.siblingGap,y1=this.getTXHeight(this.parentArea.siblings)+this.parentGap/2,y2=y1+siblings.height;1<siblings.layoutAreas.length&&(y2+=this.parentGap/4);var signX=0<deltaCoordinates.dx?-1:1,x1=deltaCoordinates.dx+signX*(siblings.width+siblingGap)/2,x2=deltaCoordinates.dx+signX*this.rootSize.width/4;return[connectionPoint.clone().offset(0,-y1),connectionPoint.clone().offset(x1,-y1),connectionPoint.clone().offset(x1,-y2),connectionPoint.clone().offset(x2,-y2)]}}),BottomLayoutArea=LayoutArea.extend({direction:"B",oppositeDirection:"T",deltaCoordinate:"dy",marginDimension:"width",getConnectionPoint:function(rootSize){return g.point(0,rootSize.height/2)},moveRootBehindSiblings:function(siblings,rootSize){this.dx+=(this.getLWidth(siblings,rootSize)-this.getRWidth(siblings,rootSize))/2,this.dy+=this.getTHeight(siblings),this.hasHorizontalSiblings(siblings)&&(this.dy+=(this.getLRHeight()-rootSize.height)/2)},moveRootFromParent:function(){this.dy+=this.parentGap+this.rootOffset},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize),dy=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2;return[connectionPoint.clone().offset(0,dy),connectionPoint.clone().offset(deltaCoordinates.dx,dy)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var connectionPoint=this.getConnectionPoint(parentRootSize),siblingGap=siblings.siblingGap,y1=this.getBXHeight(this.parentArea.siblings)+this.parentGap/2,y2=y1+siblings.height;1<siblings.layoutAreas.length&&(y2+=this.parentGap/4);var signX=0<deltaCoordinates.dx?-1:1,x1=deltaCoordinates.dx+signX*(siblings.width+siblingGap)/2,x2=deltaCoordinates.dx+signX*this.rootSize.width/4;return[connectionPoint.clone().offset(0,y1),connectionPoint.clone().offset(x1,y1),connectionPoint.clone().offset(x1,y2),connectionPoint.clone().offset(x2,y2)]}}),BottomRightLayoutArea=LayoutArea.extend({direction:"BR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(0,rootSize.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(siblings,rootSize){var btWidth=Math.max(siblings.T.width,siblings.B.width);this.dx+=Math.max(this.getLWidth(siblings,rootSize),(btWidth-rootSize.width)/2),this.dy+=this.getTHeight(siblings),this.hasHorizontalSiblings(siblings)&&(this.dy+=(this.getLRHeight()-rootSize.height)/2)},moveRootFromParent:function(){this.dy+=this.firstChildGap,this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize);return[connectionPoint.clone().offset(0,deltaCoordinates.dy-parentRootSize.height/2)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var x=deltaCoordinates.dx-this.rootSize.width/4,y=deltaCoordinates.dy;return y+=Math.max(siblings.height,this.rootSize.height)/2,y+=this.getMinimalGap(siblings)/2,[g.point(0,y),g.point(x,y)]}}),BottomLeftLayoutArea=LayoutArea.extend({direction:"BL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(0,rootSize.height/2)},getCY:function(){return this.prevSiblingGap},moveRootBehindSiblings:function(siblings,rootSize){var btWidth=Math.max(siblings.T.width,siblings.B.width);this.dx-=Math.max(this.getRWidth(siblings,rootSize),(btWidth-rootSize.width)/2),this.dy+=this.getTHeight(siblings),this.hasHorizontalSiblings(siblings)&&(this.dy+=(this.getLRHeight()-rootSize.height)/2)},moveRootFromParent:function(){this.dy+=this.firstChildGap,this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize);return[connectionPoint.clone().offset(0,deltaCoordinates.dy-parentRootSize.height/2)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var x=deltaCoordinates.dx+this.rootSize.width/4,y=deltaCoordinates.dy;return y+=Math.max(siblings.height,this.rootSize.height)/2,y+=this.getMinimalGap(siblings)/2,[g.point(0,y),g.point(x,y)]}}),TopRightLayoutArea=LayoutArea.extend({direction:"TR",oppositeDirection:"L",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(0,rootSize.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(siblings,rootSize){this.dx+=Math.max(this.getLWidth(siblings,rootSize),this.getTBOverlap(siblings,rootSize)),this.dy-=this.getBHeight(siblings),this.hasHorizontalSiblings(siblings)&&(this.dy-=(this.getLRHeight()-rootSize.height)/2)},moveRootFromParent:function(){this.dy-=this.firstChildGap,this.dx+=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize);return[connectionPoint.clone().offset(0,deltaCoordinates.dy-parentRootSize.height/2)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var x=deltaCoordinates.dx-this.rootSize.width/4,y=deltaCoordinates.dy;return y-=Math.max(siblings.height,this.rootSize.height)/2,y-=this.getMinimalGap(siblings)/2,[g.point(0,y),g.point(x,y)]}}),TopLeftLayoutArea=LayoutArea.extend({direction:"TL",oppositeDirection:"R",deltaCoordinate:"dy",marginDimension:"height",getConnectionPoint:function(rootSize){return g.point(0,rootSize.height/2)},getCY:function(){return this.height-this.rootSize.height+this.prevSiblingGap},moveRootBehindSiblings:function(siblings,rootSize){this.dx-=Math.max(this.getRWidth(siblings,rootSize),this.getTBOverlap(siblings,rootSize)),this.dy-=this.getBHeight(siblings),this.hasHorizontalSiblings(siblings)&&(this.dy-=(this.getLRHeight()-rootSize.height)/2)},moveRootFromParent:function(){this.dy-=this.firstChildGap,this.dx-=this.rootSize.width/2+this.rootOffset+this.parentGap},getRelativeVertices:function(parentRootSize,deltaCoordinates){var connectionPoint=this.getConnectionPoint(parentRootSize);return[connectionPoint.clone().offset(0,deltaCoordinates.dy-parentRootSize.height/2)]},getRelativeVerticesAvoidingSiblings:function(parentRootSize,deltaCoordinates,siblings){var x=deltaCoordinates.dx+this.rootSize.width/4,y=deltaCoordinates.dy;return y-=Math.max(siblings.height,this.rootSize.height)/2,y-=this.getMinimalGap(siblings)/2,[g.point(0,y),g.point(x,y)]}}),directionRules={rotate:function(rule){var directionChange="LRBT".indexOf(rule[0])-"LRBT".indexOf(rule[1]);return function(direction){var directionIndex="LRBT".indexOf(direction);return 0<=directionIndex?"LRBT"[(4+directionIndex-directionChange)%4]:direction}},flip:function(rule){var from=rule[0],to=rule[1];return function(direction){return direction===from?to:direction===to?from:direction}},straighten:function(rule){return _.constant(rule[1])}},TreeLayout=Backbone.Model.extend({defaults:{graph:void 0,gap:20,parentGap:20,siblingGap:20,firstChildGap:20,direction:"R",directionRule:directionRules.straighten,updatePosition:function(element,position,opt){element.set("position",position,opt)},updateVertices:function(link,vertices,opt){link.set("vertices",vertices,opt)},updateAttributes:null,filter:null,attributeNames:{}},initialize:function(){this._cacheOptions(this.attributes),this.layoutAreas={}},layout:function(opt){return this.layoutAreas={},_.each(this.getGraphSources(opt),_.partial(this.layoutTree,_,opt),this),this.trigger("layout:done",opt),this},layoutTree:function(root,opt){(opt=opt||{}).treeLayout=!0;var rootArea=this._computeLayoutAreas(root,this.get("direction"),opt);return this._computeAbsolutePositions(rootArea),this._updateCells(rootArea,opt),this},getLayoutArea:function(element){return this.layoutAreas[element.id||element]||null},getRootLayoutAreas:function(){return _.map(this.getGraphSources(),this.getLayoutArea,this)},getGraphSources:function(opt){var sources=this.graph.getSources();return this.filter&&0<sources.length&&(sources=this.filter(sources,null,opt)||sources),sources},getMinimalRootAreaByPoint:function(point){var rootLayoutAreas=_.filter(this.getRootLayoutAreas(),function(layoutArea){return layoutArea.containsPoint(point)});return _.isEmpty(rootLayoutAreas)?null:_.min(rootLayoutAreas,function(layoutArea){return layoutArea.width*layoutArea.height})},_computeLayoutAreas:function(element,prevDirection,opt){var direction=element.get(this.getAttributeName("direction"))||prevDirection,children=this._getChildren(element,opt),childLayoutAreas=_.map(children,_.partial(this._computeLayoutAreas,_,direction,opt),this),layoutArea=LayoutArea.create(direction,element,childLayoutAreas,this.attributes);return layoutArea.link=this.graph.getConnectedLinks(element,{inbound:!0})[0],this.layoutAreas[element.id]=layoutArea},_cacheOptions:function(options){_.each(["updateAttributes","updateVertices","updatePosition","filter"],function(name){this[name]=_.isFunction(options[name])?options[name]:null},this),this.graph=options.graph},_getChildren:function(parent,opt){var children=this.graph.getNeighbors(parent,{outbound:!0});return this.filter&&0<children.length&&(children=this.filter(children,parent,opt)||children),children},_computeAbsolutePositions:function(layoutArea){layoutArea.computeAbsolutePosition(layoutArea),_.each(layoutArea.childAreas,this._computeAbsolutePositions,this)},_updateCells:function(layoutArea,opt){var rootElement=layoutArea.root,rootLink=layoutArea.link||null;rootLink&&(this.updatePosition&&this.updatePosition(rootElement,layoutArea.getRootPosition(),opt),this.updateVertices&&this.updateVertices(rootLink,layoutArea.getRootVertices(),opt)),this.changeSiblingRank(rootElement,layoutArea.siblingRank,opt),this.updateAttributes&&this.updateAttributes(layoutArea,rootElement,rootLink,opt),_.each(layoutArea.childAreas,_.partial(this._updateCells,_,opt),this)},updateDirections:function(root,rule,opt){opt=opt||{};var directionAttribute=this.getAttributeName("direction"),getDirection=this.get("directionRule")(rule);this.graph.search(root,_.bind(function(element,level){if(0!==level){var newDirection=getDirection(element.get(directionAttribute));this.changeDirection(element,newDirection,opt)}},this),{outbound:!0})},reconnectElement:function(element,targetElement,opt){opt=opt||{};var layoutArea=this.getLayoutArea(element),link=layoutArea.link;if(link){link.set("source",{id:targetElement.id||targetElement},opt);var oldDirection=layoutArea.direction,newDirection=opt.direction||oldDirection,newSiblingRank=opt.siblingRank||void 0;return this.changeSiblingRank(element,newSiblingRank,opt),this.changeDirection(element,newDirection,opt),oldDirection!==newDirection&&this.updateDirections(element,[oldDirection,opt.direction],opt),!0}return!1},changeSiblingRank:function(element,siblingRank,opt){element.set(this.getAttributeName("siblingRank"),siblingRank,opt)},changeDirection:function(element,direction,opt){element.set(this.getAttributeName("direction"),direction,opt)},getAttributeName:function(attribute){return this.get("attributeNames")[attribute]||attribute},getAttribute:function(element,attribute){return element.get(this.getAttributeName(attribute))},prepare:function(){return this}},{directionRules:directionRules});joint.layout.TreeLayout=TreeLayout}(joint,Backbone,_,g),joint.format.gexf={},joint.format.gexf.toCellsArray=function(xmlString,makeElement,makeLink){var parser=new DOMParser,dom=parser.parseFromString(xmlString,"text/xml");if("parsererror"==dom.documentElement.nodeName)throw new Error("Error while parsing GEXF file.");var nodes=dom.documentElement.querySelectorAll("node"),edges=dom.documentElement.querySelectorAll("edge"),cells=[];return _.each(nodes,function(node){var size=parseFloat(node.querySelector("size").getAttribute("value")),element=makeElement({id:node.getAttribute("id"),width:size,height:size,label:node.getAttribute("label")});cells.push(element)}),_.each(edges,function(edge){var link=makeLink({source:edge.getAttribute("source"),target:edge.getAttribute("target")});cells.unshift(link)}),cells},joint.dia.Paper.prototype.toSVG=function(callback,opt){opt=opt||{};var viewportTransform=V(this.viewport).attr("transform");V(this.viewport).attr("transform","");var viewportBbox=opt.area||this.getContentBBox(),svgClone=this.svg.cloneNode(!0);V(this.viewport).attr("transform",viewportTransform||""),svgClone.removeAttribute("style"),opt.preserveDimensions?V(svgClone).attr({width:viewportBbox.width,height:viewportBbox.height}):V(svgClone).attr({width:"100%",height:"100%"}),V(svgClone).attr("viewBox",viewportBbox.x+" "+viewportBbox.y+" "+viewportBbox.width+" "+viewportBbox.height);for(var styleSheetsCount=document.styleSheets.length,styleSheetsCopy=[],i=styleSheetsCount-1;0<=i;i--)styleSheetsCopy[i]=document.styleSheets[i],document.styleSheets[i].disabled=!0;var defaultComputedStyles={};$(this.svg).find("*").each(function(idx){var computedStyle=window.getComputedStyle(this,null),defaultComputedStyle={};_.each(computedStyle,function(property){defaultComputedStyle[property]=computedStyle.getPropertyValue(property)}),defaultComputedStyles[idx]=defaultComputedStyle}),styleSheetsCount!=document.styleSheets.length&&_.each(styleSheetsCopy,function(copy,i){document.styleSheets[i]=copy});for(var i=0;i<styleSheetsCount;i++)document.styleSheets[i].disabled=!1;var customStyles={};$(this.svg).find("*").each(function(idx){var computedStyle=window.getComputedStyle(this,null),defaultComputedStyle=defaultComputedStyles[idx],customStyle={};_.each(computedStyle,function(property){computedStyle.getPropertyValue(property)!==defaultComputedStyle[property]&&(customStyle[property]=computedStyle.getPropertyValue(property))}),customStyles[idx]=customStyle});var images=[];function serialize(){return(new XMLSerializer).serializeToString(svgClone).replace(/&nbsp;/g," ")}if($(svgClone).find("*").each(function(idx){$(this).css(customStyles[idx]),"image"===this.tagName.toLowerCase()&&images.push(this)}),!opt.convertImagesToDataUris||!images.length)return callback(serialize());!function convertImages(done){var image=V(images.shift());if(!image)return done();var url=image.attr("xlink:href")||image.attr("href");joint.util.imageToDataUri(url,function(err,dataUri){image.attr("xlink:href",dataUri),convertImages(done)})}(function(){callback(serialize())})},joint.dia.Paper.prototype.openAsSVG=function(opt){var windowName=_.uniqueId("svg_output");this.toSVG(function(svg){var imageWindow=window.open("",windowName,"menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes"),dataImageUri="data:image/svg+xml,"+encodeURIComponent(svg);imageWindow.document.write('<img src="'+dataImageUri+'" style="max-height:100%" />')},_.extend({convertImagesToDataUris:!0},opt))};var mul_table=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],shg_table=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function stackBlurCanvasRGBA(id,top_x,top_y,width,height,radius){if(!(isNaN(radius)||radius<1)){radius|=0;var imageData,canvas=document.getElementById(id),context=canvas.getContext("2d");try{try{imageData=context.getImageData(top_x,top_y,width,height)}catch(e){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"),imageData=context.getImageData(top_x,top_y,width,height)}catch(e){throw alert("Cannot access local image"),new Error("unable to access local image data: "+e)}}}catch(e){throw alert("Cannot access image"),new Error("unable to access image data: "+e)}var x,y,i,p,yp,yi,yw,r_sum,g_sum,b_sum,a_sum,r_out_sum,g_out_sum,b_out_sum,a_out_sum,r_in_sum,g_in_sum,b_in_sum,a_in_sum,pr,pg,pb,pa,rbs,pixels=imageData.data,div=radius+radius+1,widthMinus1=width-1,heightMinus1=height-1,radiusPlus1=radius+1,sumFactor=radiusPlus1*(radiusPlus1+1)/2,stackStart=new BlurStack,stack=stackStart;for(i=1;i<div;i++)if(stack=stack.next=new BlurStack,i==radiusPlus1)var stackEnd=stack;stack.next=stackStart;var stackIn=null,stackOut=null;yw=yi=0;var mul_sum=mul_table[radius],shg_sum=shg_table[radius];for(y=0;y<height;y++){for(r_in_sum=g_in_sum=b_in_sum=a_in_sum=r_sum=g_sum=b_sum=a_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;i<radiusPlus1;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(i=1;i<radiusPlus1;i++)p=yi+((widthMinus1<i?widthMinus1:i)<<2),r_sum+=(stack.r=pr=pixels[p])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[p+1])*rbs,b_sum+=(stack.b=pb=pixels[p+2])*rbs,a_sum+=(stack.a=pa=pixels[p+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next;for(stackIn=stackStart,stackOut=stackEnd,x=0;x<width;x++)pixels[yi+3]=pa=a_sum*mul_sum>>shg_sum,0!=pa?(pa=255/pa,pixels[yi]=(r_sum*mul_sum>>shg_sum)*pa,pixels[yi+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[yi+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[yi]=pixels[yi+1]=pixels[yi+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=yw+((p=x+radius+1)<widthMinus1?p:widthMinus1)<<2,r_in_sum+=stackIn.r=pixels[p],g_in_sum+=stackIn.g=pixels[p+1],b_in_sum+=stackIn.b=pixels[p+2],a_in_sum+=stackIn.a=pixels[p+3],r_sum+=r_in_sum,g_sum+=g_in_sum,b_sum+=b_in_sum,a_sum+=a_in_sum,stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=4;yw+=width}for(x=0;x<width;x++){for(g_in_sum=b_in_sum=a_in_sum=r_in_sum=g_sum=b_sum=a_sum=r_sum=0,r_out_sum=radiusPlus1*(pr=pixels[yi=x<<2]),g_out_sum=radiusPlus1*(pg=pixels[yi+1]),b_out_sum=radiusPlus1*(pb=pixels[yi+2]),a_out_sum=radiusPlus1*(pa=pixels[yi+3]),r_sum+=sumFactor*pr,g_sum+=sumFactor*pg,b_sum+=sumFactor*pb,a_sum+=sumFactor*pa,stack=stackStart,i=0;i<radiusPlus1;i++)stack.r=pr,stack.g=pg,stack.b=pb,stack.a=pa,stack=stack.next;for(yp=width,i=1;i<=radius;i++)yi=yp+x<<2,r_sum+=(stack.r=pr=pixels[yi])*(rbs=radiusPlus1-i),g_sum+=(stack.g=pg=pixels[yi+1])*rbs,b_sum+=(stack.b=pb=pixels[yi+2])*rbs,a_sum+=(stack.a=pa=pixels[yi+3])*rbs,r_in_sum+=pr,g_in_sum+=pg,b_in_sum+=pb,a_in_sum+=pa,stack=stack.next,i<heightMinus1&&(yp+=width);for(yi=x,stackIn=stackStart,stackOut=stackEnd,y=0;y<height;y++)pixels[(p=yi<<2)+3]=pa=a_sum*mul_sum>>shg_sum,0<pa?(pa=255/pa,pixels[p]=(r_sum*mul_sum>>shg_sum)*pa,pixels[p+1]=(g_sum*mul_sum>>shg_sum)*pa,pixels[p+2]=(b_sum*mul_sum>>shg_sum)*pa):pixels[p]=pixels[p+1]=pixels[p+2]=0,r_sum-=r_out_sum,g_sum-=g_out_sum,b_sum-=b_out_sum,a_sum-=a_out_sum,r_out_sum-=stackIn.r,g_out_sum-=stackIn.g,b_out_sum-=stackIn.b,a_out_sum-=stackIn.a,p=x+((p=y+radiusPlus1)<heightMinus1?p:heightMinus1)*width<<2,r_sum+=r_in_sum+=stackIn.r=pixels[p],g_sum+=g_in_sum+=stackIn.g=pixels[p+1],b_sum+=b_in_sum+=stackIn.b=pixels[p+2],a_sum+=a_in_sum+=stackIn.a=pixels[p+3],stackIn=stackIn.next,r_out_sum+=pr=stackOut.r,g_out_sum+=pg=stackOut.g,b_out_sum+=pb=stackOut.b,a_out_sum+=pa=stackOut.a,r_in_sum-=pr,g_in_sum-=pg,b_in_sum-=pb,a_in_sum-=pa,stackOut=stackOut.next,yi+=width}context.putImageData(imageData,top_x,top_y)}}function BlurStack(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}
/*!
 * canvg.js - Javascript SVG parser and renderer on Canvas
 * MIT Licensed 
 * Gabe Lerner (gabelerner@gmail.com)
 * http://code.google.com/p/canvg/
 *
 * Requires: rgbcolor.js - http://www.phpied.com/rgb-color-parser-in-javascript/
 */
/*!
 * canvg.js - Javascript SVG parser and renderer on Canvas
 * MIT Licensed 
 * Gabe Lerner (gabelerner@gmail.com)
 * http://code.google.com/p/canvg/
 *
 * Requires: rgbcolor.js - http://www.phpied.com/rgb-color-parser-in-javascript/
 */
(function(){function build(){var svg={FRAMERATE:30,MAX_VIRTUAL_PIXELS:3e4,init:function(ctx){var uniqueId=0;svg.UniqueId=function(){return"canvg"+ ++uniqueId},svg.Definitions={},svg.Styles={},svg.Animations=[],svg.Images=[],svg.ctx=ctx,svg.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(d){return null!=d&&"number"==typeof d?d:"x"==d?this.width():"y"==d?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}}};return svg.init(),svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++)if(!svg.Images[i].loaded)return!1;return!0},svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"")},svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ")},svg.ajax=function(url){var AJAX;return(AJAX=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"))?(AJAX.open("GET",url,!1),AJAX.send(null),AJAX.responseText):null},svg.parseXml=function(xml){if(window.DOMParser)return(new DOMParser).parseFromString(xml,"text/xml");xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xml),xmlDoc},svg.Property=function(name,value){this.name=name,this.value=value},svg.Property.prototype.getValue=function(){return this.value},svg.Property.prototype.hasValue=function(){return null!=this.value&&""!==this.value},svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);return(this.value+"").match(/%$/)&&(n/=100),n},svg.Property.prototype.valueOrDefault=function(def){return this.hasValue()?this.value:def},svg.Property.prototype.numValueOrDefault=function(def){return this.hasValue()?this.numValue():def},svg.Property.prototype.addOpacity=function(opacity){var newValue=this.value;if(null!=opacity&&""!=opacity&&"string"==typeof this.value){var color=new RGBColor(this.value);color.ok&&(newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacity+")")}return new svg.Property(this.name,newValue)},svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);return name=(name=name&&name[1])||this.value,svg.Definitions[name]},svg.Property.prototype.isUrlDefinition=function(){return 0==this.value.indexOf("url(")},svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(null!=def&&def.createGradient)return def.createGradient(svg.ctx,e,opacityProp);if(null!=def&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition(),pt.hasValue()&&(def.attribute("patternTransform",!0).value=pt.value)}return def.createPattern(svg.ctx,e)}return null},svg.Property.prototype.getDPI=function(viewPort){return 96},svg.Property.prototype.getEM=function(viewPort){var em=12,fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);return fontSize.hasValue()&&(em=fontSize.toPixels(viewPort)),em},svg.Property.prototype.getUnits=function(){return(this.value+"").replace(/[0-9\.\-]/g,"")},svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+"";if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1/72);if(s.match(/pc$/))return 15*this.numValue();if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();return processPercent&&n<1?n*svg.ViewPort.ComputeSize(viewPort):n},svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/s$/)?1e3*this.numValue():(s.match(/ms$/),this.numValue())},svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+"";return s.match(/deg$/)?this.numValue()*(Math.PI/180):s.match(/grad$/)?this.numValue()*(Math.PI/200):s.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},svg.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=null!=inherit?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var that=this;this.Parse=function(s){for(var f={},d=svg.trim(svg.compressSpaces(s||"")).split(" "),set={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},ff="",i=0;i<d.length;i++)set.fontStyle||-1==that.Styles.indexOf(d[i])?set.fontVariant||-1==that.Variants.indexOf(d[i])?set.fontWeight||-1==that.Weights.indexOf(d[i])?set.fontSize?"inherit"!=d[i]&&(ff+=d[i]):("inherit"!=d[i]&&(f.fontSize=d[i].split("/")[0]),set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=!0):("inherit"!=d[i]&&(f.fontWeight=d[i]),set.fontStyle=set.fontVariant=set.fontWeight=!0):("inherit"!=d[i]&&(f.fontVariant=d[i]),set.fontStyle=set.fontVariant=!0):("inherit"!=d[i]&&(f.fontStyle=d[i]),set.fontStyle=!0);return""!=ff&&(f.fontFamily=ff),f}},svg.ToNumberArray=function(s){for(var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" "),i=0;i<a.length;i++)a[i]=parseFloat(a[i]);return a},svg.Point=function(x,y){this.x=x,this.y=y},svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x)},svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4],yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp,this.y=yp},svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1])},svg.CreatePath=function(s){for(var a=svg.ToNumberArray(s),path=[],i=0;i<a.length;i+=2)path.push(new svg.Point(a[i],a[i+1]));return path},svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(x,y){null!=x&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=x,this.x2=x),x<this.x1&&(this.x1=x),x>this.x2&&(this.x2=x)),null!=y&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=y,this.y2=y),y<this.y1&&(this.y1=y),y>this.y2&&(this.y2=y))},this.addX=function(x){this.addPoint(x,null)},this.addY=function(y){this.addPoint(null,y)},this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1),this.addPoint(bb.x2,bb.y2)},this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x),cp1y=p0y+2/3*(p1y-p0y),cp2x=cp1x+1/3*(p2x-p0x),cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y)},this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];for(this.addPoint(p0[0],p0[1]),this.addPoint(p3[0],p3[1]),i=0;i<=1;i++){function f(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i]}var b=6*p0[i]-12*p1[i]+6*p2[i],a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i],c=3*p1[i]-3*p0[i];if(0!=a){var b2ac=Math.pow(b,2)-4*c*a;if(!(b2ac<0)){var t1=(-b+Math.sqrt(b2ac))/(2*a);0<t1&&t1<1&&(0==i&&this.addX(f(t1)),1==i&&this.addY(f(t1)));var t2=(-b-Math.sqrt(b2ac))/(2*a);0<t2&&t2<1&&(0==i&&this.addX(f(t2)),1==i&&this.addY(f(t2)))}}else{if(0==b)continue;var t=-c/b;0<t&&t<1&&(0==i&&this.addX(f(t)),1==i&&this.addY(f(t)))}}},this.isPointInBox=function(x,y){return this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2},this.addPoint(x1,y1),this.addPoint(x2,y2)},svg.Transform=function(v){var that=this;this.Type={},this.Type.translate=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0)},this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]),this.cx=a[1]||0,this.cy=a[2]||0,this.apply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.unapply=function(ctx){ctx.translate(this.cx,this.cy),ctx.rotate(-1*this.angle.toRadians()),ctx.translate(-this.cx,-this.cy)},this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]),p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(s){this.p=svg.CreatePoint(s),this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(s){this.m=svg.ToNumberArray(s),this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(p){p.applyTransform(this.m)}},this.Type.SkewBase=function(s){this.base=that.Type.matrix,this.base(s),this.angle=new svg.Property("angle",s)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(s){this.base=that.Type.SkewBase,this.base(s),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++)this.transforms[i].apply(ctx)},this.unapply=function(ctx){for(var i=this.transforms.length-1;0<=i;i--)this.transforms[i].unapply(ctx)},this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++)this.transforms[i].applyToPoint(p)};for(var data=svg.trim(svg.compressSpaces(v)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/),i=0;i<data.length;i++){var type=svg.trim(data[i].split("(")[0]),s=data[i].split("(")[1].replace(")",""),transform=new this.Type[type](s);transform.type=type,this.transforms.push(transform)}},svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){var align=(aspectRatio=(aspectRatio=svg.compressSpaces(aspectRatio)).replace(/^defer\s/,"")).split(" ")[0]||"xMidYMid",meetOrSlice=aspectRatio.split(" ")[1]||"meet",scaleX=width/desiredWidth,scaleY=height/desiredHeight,scaleMin=Math.min(scaleX,scaleY),scaleMax=Math.max(scaleX,scaleY);"meet"==meetOrSlice&&(desiredWidth*=scaleMin,desiredHeight*=scaleMin),"slice"==meetOrSlice&&(desiredWidth*=scaleMax,desiredHeight*=scaleMax),refX=new svg.Property("refX",refX),refY=new svg.Property("refY",refY),refX.hasValue()&&refY.hasValue()?ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y")):(align.match(/^xMid/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width/2-desiredWidth/2,0),align.match(/YMid$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height/2-desiredHeight/2),align.match(/^xMax/)&&("meet"==meetOrSlice&&scaleMin==scaleY||"slice"==meetOrSlice&&scaleMax==scaleY)&&ctx.translate(width-desiredWidth,0),align.match(/YMax$/)&&("meet"==meetOrSlice&&scaleMin==scaleX||"slice"==meetOrSlice&&scaleMax==scaleX)&&ctx.translate(0,height-desiredHeight)),"none"==align?ctx.scale(scaleX,scaleY):"meet"==meetOrSlice?ctx.scale(scaleMin,scaleMin):"slice"==meetOrSlice&&ctx.scale(scaleMax,scaleMax),ctx.translate(null==minX?0:-minX,null==minY?0:-minY)},svg.Element={},svg.EmptyProperty=new svg.Property("EMPTY",""),svg.Element.ElementBase=function(node){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(name,createIfNotExists){var a=this.attributes[name];return null!=a?a:(1==createIfNotExists&&(a=new svg.Property(name,""),this.attributes[name]=a),a||svg.EmptyProperty)},this.getHrefAttribute=function(){for(var a in this.attributes)if(a.match(/:href$/))return this.attributes[a];return svg.EmptyProperty},this.style=function(name,createIfNotExists){var s=this.styles[name];if(null!=s)return s;var a=this.attribute(name);if(null!=a&&a.hasValue())return this.styles[name]=a;var p=this.parent;if(null!=p){var ps=p.style(name);if(null!=ps&&ps.hasValue())return ps}return 1==createIfNotExists&&(s=new svg.Property(name,""),this.styles[name]=s),s||svg.EmptyProperty},this.render=function(ctx){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value){if(ctx.save(),this.attribute("mask").hasValue()){var mask=this.attribute("mask").getDefinition();null!=mask&&mask.apply(ctx,this)}else if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();null!=filter&&filter.apply(ctx,this)}else this.setContext(ctx),this.renderChildren(ctx),this.clearContext(ctx);ctx.restore()}},this.setContext=function(ctx){},this.clearContext=function(ctx){},this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++)this.children[i].render(ctx)},this.addChild=function(childNode,create){var child=childNode;create&&(child=svg.CreateElement(childNode)),(child.parent=this).children.push(child)},null!=node&&1==node.nodeType){for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(1==childNode.nodeType&&this.addChild(childNode,!0),this.captureTextNodes&&3==childNode.nodeType){var text=childNode.nodeValue||childNode.text||"";""!=svg.trim(svg.compressSpaces(text))&&this.addChild(new svg.Element.tspan(childNode),!1)}}for(i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.nodeValue)}if(null!=(styles=svg.Styles[node.nodeName]))for(var name in styles)this.styles[name]=styles[name];if(this.attribute("class").hasValue())for(var classes=svg.compressSpaces(this.attribute("class").value).split(" "),j=0;j<classes.length;j++){if(null!=(styles=svg.Styles["."+classes[j]]))for(var name in styles)this.styles[name]=styles[name];if(null!=(styles=svg.Styles[node.nodeName+"."+classes[j]]))for(var name in styles)this.styles[name]=styles[name]}if(this.attribute("id").hasValue()&&null!=(styles=svg.Styles["#"+this.attribute("id").value]))for(var name in styles)this.styles[name]=styles[name];if(this.attribute("style").hasValue()){var styles=this.attribute("style").value.split(";");for(i=0;i<styles.length;i++)if(""!=svg.trim(styles[i])){var style=styles[i].split(":"),value=(name=svg.trim(style[0]),svg.trim(style[1]));this.styles[name]=new svg.Property(name,value)}}this.attribute("id").hasValue()&&null==svg.Definitions[this.attribute("id").value]&&(svg.Definitions[this.attribute("id").value]=this)}},svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.setContext=function(ctx){var fs;if(this.style("fill").isUrlDefinition())null!=(fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity")))&&(ctx.fillStyle=fs);else if(this.style("fill").hasValue()){var fillStyle;"currentColor"==(fillStyle=this.style("fill")).value&&(fillStyle.value=this.style("color").value),ctx.fillStyle="none"==fillStyle.value?"rgba(0,0,0,0)":fillStyle.value}if(this.style("fill-opacity").hasValue()&&(fillStyle=(fillStyle=new svg.Property("fill",ctx.fillStyle)).addOpacity(this.style("fill-opacity").value),ctx.fillStyle=fillStyle.value),this.style("stroke").isUrlDefinition())null!=(fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity")))&&(ctx.strokeStyle=fs);else if(this.style("stroke").hasValue()){var strokeStyle;"currentColor"==(strokeStyle=this.style("stroke")).value&&(strokeStyle.value=this.style("color").value),ctx.strokeStyle="none"==strokeStyle.value?"rgba(0,0,0,0)":strokeStyle.value}if(this.style("stroke-opacity").hasValue()&&(strokeStyle=(strokeStyle=new svg.Property("stroke",ctx.strokeStyle)).addOpacity(this.style("stroke-opacity").value),ctx.strokeStyle=strokeStyle.value),this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=0==newLineWidth?.001:newLineWidth}if(this.style("stroke-linecap").hasValue()&&(ctx.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(ctx.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(ctx.miterLimit=this.style("stroke-miterlimit").value),this.style("stroke-dasharray").hasValue()){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);void 0!==ctx.setLineDash?ctx.setLineDash(gaps):void 0!==ctx.webkitLineDash?ctx.webkitLineDash=gaps:void 0!==ctx.mozDash&&(ctx.mozDash=gaps);var offset=this.style("stroke-dashoffset").numValueOrDefault(1);void 0!==ctx.lineDashOffset?ctx.lineDashOffset=offset:void 0!==ctx.webkitLineDashOffset?ctx.webkitLineDashOffset=offset:void 0!==ctx.mozDashOffset&&(ctx.mozDashOffset=offset)}if(void 0!==ctx.font&&(ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()&&new svg.Transform(this.attribute("transform").value).apply(ctx),this.style("clip-path").hasValue()){var clip=this.style("clip-path").getDefinition();null!=clip&&clip.apply(ctx)}this.style("opacity").hasValue()&&(ctx.globalAlpha=this.style("opacity").numValue())}},svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase,svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.path=function(ctx){return null!=ctx&&ctx.beginPath(),new svg.BoundingBox},this.renderChildren=function(ctx){this.path(ctx),svg.Mouse.checkPath(this,ctx),""!=ctx.fillStyle&&(this.attribute("fill-rule").hasValue()?ctx.fill(this.attribute("fill-rule").value):ctx.fill()),""!=ctx.strokeStyle&&ctx.stroke();var markers=this.getMarkers();if(null!=markers){if(this.style("marker-start").isUrlDefinition()&&(marker=this.style("marker-start").getDefinition()).render(ctx,markers[0][0],markers[0][1]),this.style("marker-mid").isUrlDefinition())for(var marker=this.style("marker-mid").getDefinition(),i=1;i<markers.length-1;i++)marker.render(ctx,markers[i][0],markers[i][1]);this.style("marker-end").isUrlDefinition()&&(marker=this.style("marker-end").getDefinition()).render(ctx,markers[markers.length-1][0],markers[markers.length-1][1])}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseClearContext=this.clearContext,this.clearContext=function(ctx){this.baseClearContext(ctx),svg.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)",ctx.lineCap="butt",ctx.lineJoin="miter",ctx.miterLimit=4,this.baseSetContext(ctx),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width(),height=svg.ViewPort.height();if(this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%"),void 0===this.root){width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");var x=0,y=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(x=-this.attribute("refX").toPixels("x"),y=-this.attribute("refY").toPixels("y")),ctx.beginPath(),ctx.moveTo(x,y),ctx.lineTo(width,y),ctx.lineTo(width,height),ctx.lineTo(x,height),ctx.closePath(),ctx.clip()}if(svg.ViewPort.SetCurrent(width,height),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value),svg.ViewPort.RemoveCurrent(),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.svg.prototype=new svg.Element.RenderedElementBase,svg.Element.rect=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y"),rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(ry=rx),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(rx=ry),rx=Math.min(rx,width/2),ry=Math.min(ry,height/2),null!=ctx&&(ctx.beginPath(),ctx.moveTo(x+rx,y),ctx.lineTo(x+width-rx,y),ctx.quadraticCurveTo(x+width,y,x+width,y+ry),ctx.lineTo(x+width,y+height-ry),ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height),ctx.lineTo(x+rx,y+height),ctx.quadraticCurveTo(x,y+height,x,y+height-ry),ctx.lineTo(x,y+ry),ctx.quadraticCurveTo(x,y,x+rx,y),ctx.closePath()),new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.rect.prototype=new svg.Element.PathElementBase,svg.Element.circle=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y"),r=this.attribute("r").toPixels();return null!=ctx&&(ctx.beginPath(),ctx.arc(cx,cy,r,0,2*Math.PI,!0),ctx.closePath()),new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r)}},svg.Element.circle.prototype=new svg.Element.PathElementBase,svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.path=function(ctx){var KAPPA=(Math.sqrt(2)-1)/3*4,rx=this.attribute("rx").toPixels("x"),ry=this.attribute("ry").toPixels("y"),cx=this.attribute("cx").toPixels("x"),cy=this.attribute("cy").toPixels("y");return null!=ctx&&(ctx.beginPath(),ctx.moveTo(cx,cy-ry),ctx.bezierCurveTo(cx+KAPPA*rx,cy-ry,cx+rx,cy-KAPPA*ry,cx+rx,cy),ctx.bezierCurveTo(cx+rx,cy+KAPPA*ry,cx+KAPPA*rx,cy+ry,cx,cy+ry),ctx.bezierCurveTo(cx-KAPPA*rx,cy+ry,cx-rx,cy+KAPPA*ry,cx-rx,cy),ctx.bezierCurveTo(cx-rx,cy-KAPPA*ry,cx-KAPPA*rx,cy-ry,cx,cy-ry),ctx.closePath()),new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry)}},svg.Element.ellipse.prototype=new svg.Element.PathElementBase,svg.Element.line=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(ctx){var points=this.getPoints();return null!=ctx&&(ctx.beginPath(),ctx.moveTo(points[0].x,points[0].y),ctx.lineTo(points[1].x,points[1].y)),new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y)},this.getMarkers=function(){var points=this.getPoints(),a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]]}},svg.Element.line.prototype=new svg.Element.PathElementBase,svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase,this.base(node),this.points=svg.CreatePath(this.attribute("points").value),this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);null!=ctx&&(ctx.beginPath(),ctx.moveTo(this.points[0].x,this.points[0].y));for(var i=1;i<this.points.length;i++)bb.addPoint(this.points[i].x,this.points[i].y),null!=ctx&&ctx.lineTo(this.points[i].x,this.points[i].y);return bb},this.getMarkers=function(){for(var markers=[],i=0;i<this.points.length-1;i++)markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);return markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]),markers}},svg.Element.polyline.prototype=new svg.Element.PathElementBase,svg.Element.polygon=function(node){this.base=svg.Element.polyline,this.base(node),this.basePath=this.path,this.path=function(ctx){var bb=this.basePath(ctx);return null!=ctx&&(ctx.lineTo(this.points[0].x,this.points[0].y),ctx.closePath()),bb}},svg.Element.polygon.prototype=new svg.Element.polyline,svg.Element.path=function(node){this.base=svg.Element.PathElementBase,this.base(node);var d=this.attribute("d").value;d=(d=(d=(d=(d=(d=(d=(d=d.replace(/,/gm," ")).replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2")).replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2")).replace(/(\.[0-9]*)(\.)/gm,"$1 $2")).replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),d=svg.compressSpaces(d),d=svg.trim(d),this.PathParser=new function(d){this.tokens=d.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new svg.Point(0,0),this.control=new svg.Point(0,0),this.current=new svg.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return!!this.isEnd()||null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p)},this.getAsControlPoint=function(){var p=this.getPoint();return this.control=p},this.getAsCurrentPoint=function(){var p=this.getPoint();return this.current=p},this.getReflectedControlPoint=function(){return"c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase()?this.current:new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},this.makeAbsolute=function(p){return this.isRelativeCommand()&&(p.x+=this.current.x,p.y+=this.current.y),p},this.addMarker=function(p,from,priorTo){null!=priorTo&&0<this.angles.length&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo)),this.addMarkerAngle(p,null==from?null:from.angleTo(p))},this.addMarkerAngle=function(p,a){this.points.push(p),this.angles.push(a)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++)if(null==this.angles[i])for(var j=i+1;j<this.angles.length;j++)if(null!=this.angles[j]){this.angles[i]=this.angles[j];break}return this.angles}}(d),this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox;for(null!=ctx&&ctx.beginPath();!pp.isEnd();)switch(pp.nextCommand(),pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();for(pp.addMarker(p),bb.addPoint(p.x,p.y),null!=ctx&&ctx.moveTo(p.x,p.y),pp.start=pp.current;!pp.isCommandOrEnd();)p=pp.getAsCurrentPoint(),pp.addMarker(p,pp.start),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y);break;case"L":case"l":for(;!pp.isCommandOrEnd();){var c=pp.current;p=pp.getAsCurrentPoint(),pp.addMarker(p,c),bb.addPoint(p.x,p.y),null!=ctx&&ctx.lineTo(p.x,p.y)}break;case"H":case"h":for(;!pp.isCommandOrEnd();){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y)}break;case"V":case"v":for(;!pp.isCommandOrEnd();)newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar()),pp.addMarker(newP,pp.current),pp.current=newP,bb.addPoint(pp.current.x,pp.current.y),null!=ctx&&ctx.lineTo(pp.current.x,pp.current.y);break;case"C":case"c":for(;!pp.isCommandOrEnd();){var curr=pp.current,p1=pp.getPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y)}break;case"S":case"s":for(;!pp.isCommandOrEnd();)curr=pp.current,p1=pp.getReflectedControlPoint(),cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint(),pp.addMarker(cp,cntrl,p1),bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);break;case"Q":case"q":for(;!pp.isCommandOrEnd();)curr=pp.current,cntrl=pp.getAsControlPoint(),cp=pp.getAsCurrentPoint(),pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);break;case"T":case"t":for(;!pp.isCommandOrEnd();)curr=pp.current,cntrl=pp.getReflectedControlPoint(),pp.control=cntrl,cp=pp.getAsCurrentPoint(),pp.addMarker(cp,cntrl,cntrl),bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y),null!=ctx&&ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);break;case"A":case"a":for(;!pp.isCommandOrEnd();){curr=pp.current;var rx=pp.getScalar(),ry=pp.getScalar(),xAxisRotation=pp.getScalar()*(Math.PI/180),largeArcFlag=pp.getScalar(),sweepFlag=pp.getScalar(),currp=(cp=pp.getAsCurrentPoint(),new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2)),l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);1<l&&(rx*=Math.sqrt(l),ry*=Math.sqrt(l));var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt((Math.pow(rx,2)*Math.pow(ry,2)-Math.pow(rx,2)*Math.pow(currp.y,2)-Math.pow(ry,2)*Math.pow(currp.x,2))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));function m(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2))}function a(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v))}isNaN(s)&&(s=0);var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx),centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y),r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))},a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]),u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry],v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry],ad=a(u,v);r(u,v)<=-1&&(ad=Math.PI),1<=r(u,v)&&(ad=0);var dir=1-sweepFlag?1:-1,ah=a1+ad/2*dir,halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));if(pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2),pp.addMarkerAngle(cp,ah-dir*Math.PI),bb.addPoint(cp.x,cp.y),null!=ctx){r=ry<rx?rx:ry;var sx=ry<rx?1:rx/ry,sy=ry<rx?ry/rx:1;ctx.translate(centp.x,centp.y),ctx.rotate(xAxisRotation),ctx.scale(sx,sy),ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag),ctx.scale(1/sx,1/sy),ctx.rotate(-xAxisRotation),ctx.translate(-centp.x,-centp.y)}}break;case"Z":case"z":null!=ctx&&ctx.closePath(),pp.current=pp.start}return bb},this.getMarkers=function(){for(var points=this.PathParser.getMarkerPoints(),angles=this.PathParser.getMarkerAngles(),markers=[],i=0;i<points.length;i++)markers.push([points[i],angles[i]]);return markers}},svg.Element.path.prototype=new svg.Element.PathElementBase,svg.Element.pattern=function(node){this.base=svg.Element.ElementBase,this.base(node),this.createPattern=function(ctx,element){var width=this.attribute("width").toPixels("x",!0),height=this.attribute("height").toPixels("y",!0),tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.width=new svg.Property("width",width+"px"),tempSvg.attributes.height=new svg.Property("height",height+"px"),tempSvg.attributes.transform=new svg.Property("transform",this.attribute("patternTransform").value),tempSvg.children=this.children;var c=document.createElement("canvas");c.width=width,c.height=height;var cctx=c.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&cctx.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var x=-1;x<=1;x++)for(var y=-1;y<=1;y++)cctx.save(),cctx.translate(x*c.width,y*c.height),tempSvg.render(cctx),cctx.restore();return ctx.createPattern(c,"repeat")}},svg.Element.pattern.prototype=new svg.Element.ElementBase,svg.Element.marker=function(node){this.base=svg.Element.ElementBase,this.base(node),this.baseRender=this.render,this.render=function(ctx,point,angle){ctx.translate(point.x,point.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(angle),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(ctx.lineWidth,ctx.lineWidth),ctx.save();var tempSvg=new svg.Element.svg;tempSvg.attributes.viewBox=new svg.Property("viewBox",this.attribute("viewBox").value),tempSvg.attributes.refX=new svg.Property("refX",this.attribute("refX").value),tempSvg.attributes.refY=new svg.Property("refY",this.attribute("refY").value),tempSvg.attributes.width=new svg.Property("width",this.attribute("markerWidth").value),tempSvg.attributes.height=new svg.Property("height",this.attribute("markerHeight").value),tempSvg.attributes.fill=new svg.Property("fill",this.attribute("fill").valueOrDefault("black")),tempSvg.attributes.stroke=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none")),tempSvg.children=this.children,tempSvg.render(ctx),ctx.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&ctx.rotate(-angle),ctx.translate(-point.x,-point.y)}},svg.Element.marker.prototype=new svg.Element.ElementBase,svg.Element.defs=function(node){this.base=svg.Element.ElementBase,this.base(node),this.render=function(ctx){}},svg.Element.defs.prototype=new svg.Element.ElementBase,svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase,this.base(node),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"stop"==child.type&&this.stops.push(child)}this.getGradient=function(){},this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;function addParentOpacity(color){return parentOpacityProp.hasValue()?new svg.Property("color",color).addOpacity(parentOpacityProp.value).value:color}this.getHrefAttribute().hasValue()&&(stopsContainer=this.getHrefAttribute().getDefinition());var g=this.getGradient(ctx,element);if(null==g)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++)g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0],rect=new svg.Element.rect;rect.attributes.x=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.y=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3),rect.attributes.width=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS),rect.attributes.height=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g;group.attributes.transform=new svg.Property("transform",this.attribute("gradientTransform").value),group.children=[rect];var tempSvg=new svg.Element.svg;tempSvg.attributes.x=new svg.Property("x",0),tempSvg.attributes.y=new svg.Property("y",0),tempSvg.attributes.width=new svg.Property("width",rootView.width),tempSvg.attributes.height=new svg.Property("height",rootView.height),tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width,c.height=rootView.height;var tempCtx=c.getContext("2d");return tempCtx.fillStyle=g,tempSvg.render(tempCtx),tempCtx.createPattern(c,"no-repeat")}return g}},svg.Element.GradientBase.prototype=new svg.Element.ElementBase,svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("x1").hasValue()||this.attribute("y1").hasValue()||this.attribute("x2").hasValue()||this.attribute("y2").hasValue()||(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var x1="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),y1="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),x2="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),y2="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return x1==x2&&y1==y2?null:ctx.createLinearGradient(x1,y1,x2,y2)}},svg.Element.linearGradient.prototype=new svg.Element.GradientBase,svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase,this.base(node),this.getGradient=function(ctx,element){var bb=element.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var cx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),cy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),fx=cx,fy=cy;this.attribute("fx").hasValue()&&(fx="objectBoundingBox"==this.gradientUnits?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(fy="objectBoundingBox"==this.gradientUnits?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var r="objectBoundingBox"==this.gradientUnits?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return ctx.createRadialGradient(fx,fy,0,cx,cy,r)}},svg.Element.radialGradient.prototype=new svg.Element.GradientBase,svg.Element.stop=function(node){this.base=svg.Element.ElementBase,this.base(node),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),1<this.offset&&(this.offset=1);var stopColor=this.style("stop-color");this.style("stop-opacity").hasValue()&&(stopColor=stopColor.addOpacity(this.style("stop-opacity").value)),this.color=stopColor.value},svg.Element.stop.prototype=new svg.Element.ElementBase,svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase,this.base(node),svg.Animations.push(this),this.duration=0,this.begin=this.attribute("begin").toMilliseconds(),this.maxDuration=this.begin+this.attribute("dur").toMilliseconds(),this.getProperty=function(){var attributeType=this.attribute("attributeType").value,attributeName=this.attribute("attributeName").value;return"CSS"==attributeType?this.parent.style(attributeName,!0):this.parent.attribute(attributeName,!0)},this.initialValue=null,this.initialUnits="",this.removed=!1,this.calcValue=function(){return""},this.update=function(delta){if(null==this.initialValue&&(this.initialValue=this.getProperty().value,this.initialUnits=this.getProperty().getUnits()),this.duration>this.maxDuration){if("indefinite"!=this.attribute("repeatCount").value&&"indefinite"!=this.attribute("repeatDur").value)return"remove"==this.attribute("fill").valueOrDefault("remove")&&!this.removed&&(this.removed=!0,this.getProperty().value=this.initialValue,!0);this.duration=0}this.duration=this.duration+delta;var updated=!1;if(this.begin<this.duration){var newValue=this.calcValue();this.attribute("type").hasValue()&&(newValue=this.attribute("type").value+"("+newValue+")"),this.getProperty().value=newValue,updated=!0}return updated},this.from=this.attribute("from"),this.to=this.attribute("to"),this.values=this.attribute("values"),this.values.hasValue()&&(this.values.value=this.values.value.split(";")),this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1),lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb])),ret.to=new svg.Property("to",parseFloat(this.values.value[ub])),ret.progress=(p-lb)/(ub-lb)}else ret.from=this.from,ret.to=this.to;return ret}},svg.Element.AnimateBase.prototype=new svg.Element.ElementBase,svg.Element.animate=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress();return p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress+this.initialUnits}},svg.Element.animate.prototype=new svg.Element.AnimateBase,svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){var p=this.progress(),from=new RGBColor(p.from.value),to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress,g=from.g+(to.g-from.g)*p.progress,b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")"}return this.attribute("from").value}},svg.Element.animateColor.prototype=new svg.Element.AnimateBase,svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase,this.base(node),this.calcValue=function(){for(var p=this.progress(),from=svg.ToNumberArray(p.from.value),to=svg.ToNumberArray(p.to.value),newValue="",i=0;i<from.length;i++)newValue+=from[i]+(to[i]-from[i])*p.progress+" ";return newValue}},svg.Element.animateTransform.prototype=new svg.Element.animate,svg.Element.font=function(node){this.base=svg.Element.ElementBase,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];"font-face"==child.type?(this.fontFace=child).style("font-family").hasValue()&&(svg.Definitions[child.style("font-family").value]=this):"missing-glyph"==child.type?this.missingGlyph=child:"glyph"==child.type&&(""!=child.arabicForm?(this.isRTL=!0,this.isArabic=!0,void 0===this.glyphs[child.unicode]&&(this.glyphs[child.unicode]=[]),this.glyphs[child.unicode][child.arabicForm]=child):this.glyphs[child.unicode]=child)}},svg.Element.font.prototype=new svg.Element.ElementBase,svg.Element.fontface=function(node){this.base=svg.Element.ElementBase,this.base(node),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},svg.Element.fontface.prototype=new svg.Element.ElementBase,svg.Element.missingglyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=0},svg.Element.missingglyph.prototype=new svg.Element.path,svg.Element.glyph=function(node){this.base=svg.Element.path,this.base(node),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},svg.Element.glyph.prototype=new svg.Element.path,svg.Element.text=function(node){this.captureTextNodes=!0,this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.style("dominant-baseline").hasValue()&&(ctx.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(ctx.textBaseline=this.style("alignment-baseline").value)},this.getBoundingBox=function(){return new svg.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(ctx){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(ctx,this,0);for(var i=0;i<this.children.length;i++)this.renderChild(ctx,this,i)},this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if("start"==textAnchor)return 0;for(var width=0,i=startI;i<parent.children.length;i++){var child=parent.children[i];if(startI<i&&child.attribute("x").hasValue())break;width+=child.measureTextRecursive(ctx)}return-1*("end"==textAnchor?width:width/2)},this.renderChild=function(ctx,parent,i){var child=parent.children[i];for(child.attribute("x").hasValue()?child.x=child.attribute("x").toPixels("x")+this.getAnchorDelta(ctx,parent,i):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),child.attribute("dx").hasValue()&&(this.x+=child.attribute("dx").toPixels("x")),child.x=this.x),this.x=child.x+child.measureText(ctx),child.attribute("y").hasValue()?child.y=child.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),child.attribute("dy").hasValue()&&(this.y+=child.attribute("dy").toPixels("y")),child.y=this.y),this.y=child.y,child.render(ctx),i=0;i<child.children.length;i++)this.renderChild(ctx,child,i)}},svg.Element.text.prototype=new svg.Element.RenderedElementBase,svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getGlyph=function(font,text,i){var c=text[i],glyph=null;if(font.isArabic){var arabicForm="isolated";(0==i||" "==text[i-1])&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="terminal"),0<i&&" "!=text[i-1]&&i<text.length-2&&" "!=text[i+1]&&(arabicForm="medial"),0<i&&" "!=text[i-1]&&(i==text.length-1||" "==text[i+1])&&(arabicForm="initial"),void 0!==font.glyphs[c]&&null==(glyph=font.glyphs[c][arabicForm])&&"glyph"==font.glyphs[c].type&&(glyph=font.glyphs[c])}else glyph=font.glyphs[c];return null==glyph&&(glyph=font.missingGlyph),glyph},this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null==customFont)""!=ctx.fillStyle&&ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y),""!=ctx.strokeStyle&&ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);else{var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle),text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i),scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y),ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize,"italic"==fontStyle&&ctx.transform(1,0,.4,1,0,0),glyph.render(ctx),"italic"==fontStyle&&ctx.transform(1,0,-.4,1,0,0),ctx.lineWidth=lw,ctx.scale(1/scale,-1/scale),ctx.translate(-this.x,-this.y),this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(this.x+=dx[i])}}},this.getText=function(){},this.measureTextRecursive=function(ctx){for(var width=this.measureText(ctx),i=0;i<this.children.length;i++)width+=this.children[i].measureTextRecursive(ctx);return width},this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(null!=customFont){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize),measure=0,text=this.getText();customFont.isRTL&&(text=text.split("").reverse().join(""));for(var dx=svg.ToNumberArray(this.parent.attribute("dx").value),i=0;i<text.length;i++)measure+=(this.getGlyph(customFont,text,i).horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm,void 0===dx[i]||isNaN(dx[i])||(measure+=dx[i]);return measure}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return 10*textToMeasure.length;ctx.save(),this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;return ctx.restore(),width}},svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase,svg.Element.tspan=function(node){this.captureTextNodes=!0,this.base=svg.Element.TextElementBase,this.base(node),this.text=node.nodeValue||node.text||"",this.getText=function(){return this.text}},svg.Element.tspan.prototype=new svg.Element.TextElementBase,svg.Element.tref=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(null!=element)return element.children[0].getText()}},svg.Element.tref.prototype=new svg.Element.TextElementBase,svg.Element.a=function(node){this.base=svg.Element.TextElementBase,this.base(node),this.hasText=!0;for(var i=0;i<node.childNodes.length;i++)3!=node.childNodes[i].nodeType&&(this.hasText=!1);this.text=this.hasText?node.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y))}else{var g=new svg.Element.g;g.children=this.children,g.parent=this,g.render(ctx)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer"}},svg.Element.a.prototype=new svg.Element.TextElementBase,svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase,this.base(node);var href=this.getHrefAttribute().value,isSvg=href.match(/\.svg$/);if(svg.Images.push(this),this.loaded=!1,isSvg)this.img=svg.ajax(href),this.loaded=!0;else{this.img=document.createElement("img");var self=this;this.img.onload=function(){self.loaded=!0},this.img.onerror=function(){"undefined"!=typeof console&&(console.log('ERROR: image "'+href+'" not found'),self.loaded=!0)},this.img.src=href}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");0!=width&&0!=height&&(ctx.save(),isSvg?ctx.drawSvg(this.img,x,y,width,height):(ctx.translate(x,y),svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0),ctx.drawImage(this.img,0,0)),ctx.restore())},this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height)}},svg.Element.image.prototype=new svg.Element.RenderedElementBase,svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.getBoundingBox=function(){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());return bb}},svg.Element.g.prototype=new svg.Element.RenderedElementBase,svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){if(this.baseSetContext(ctx),this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value),minX=viewBox[0],minY=viewBox[1];width=viewBox[2],height=viewBox[3],svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,minX,minY),svg.ViewPort.SetCurrent(viewBox[2],viewBox[3])}}},svg.Element.symbol.prototype=new svg.Element.RenderedElementBase,svg.Element.style=function(node){this.base=svg.Element.ElementBase,this.base(node);for(var css="",i=0;i<node.childNodes.length;i++)css+=node.childNodes[i].nodeValue;css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");var cssDefs=(css=svg.compressSpaces(css)).split("}");for(i=0;i<cssDefs.length;i++)if(""!=svg.trim(cssDefs[i]))for(var cssDef=cssDefs[i].split("{"),cssClasses=cssDef[0].split(","),cssProps=cssDef[1].split(";"),j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(""!=cssClass){for(var props={},k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":"),name=cssProps[k].substr(0,prop),value=cssProps[k].substr(prop+1,cssProps[k].length-prop);null!=name&&null!=value&&(props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value)))}if(svg.Styles[cssClass]=props,"@font-face"==cssClass)for(var fontFamily=props["font-family"].value.replace(/"/g,""),srcs=props.src.value.split(","),s=0;s<srcs.length;s++)if(0<srcs[s].indexOf('format("svg")'))for(var urlStart=srcs[s].indexOf("url"),urlEnd=srcs[s].indexOf(")",urlStart),url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6),fonts=svg.parseXml(svg.ajax(url)).getElementsByTagName("font"),f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font}}}},svg.Element.style.prototype=new svg.Element.ElementBase,svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase,this.base(node),this.baseSetContext=this.setContext,this.setContext=function(ctx){this.baseSetContext(ctx),this.attribute("x").hasValue()&&ctx.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&ctx.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var element=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(element.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(element.attribute("height",!0).value=this.attribute("height").value),element},this.path=function(ctx){var element=this.getDefinition();null!=element&&element.path(ctx)},this.getBoundingBox=function(){var element=this.getDefinition();if(null!=element)return element.getBoundingBox()},this.renderChildren=function(ctx){var element=this.getDefinition();if(null!=element){var oldParent=element.parent;element.parent=null,element.render(ctx),element.parent=oldParent}}},svg.Element.use.prototype=new svg.Element.RenderedElementBase,svg.Element.mask=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x"),y=this.attribute("y").toPixels("y"),width=this.attribute("width").toPixels("x"),height=this.attribute("height").toPixels("y");if(0==width&&0==height){for(var bb=new svg.BoundingBox,i=0;i<this.children.length;i++)bb.addBoundingBox(this.children[i].getBoundingBox());x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height())}var mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width,cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width,c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx),tempCtx.globalCompositeOperation="destination-in",tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat"),tempCtx.fillRect(0,0,x+width,y+height),ctx.fillStyle=tempCtx.createPattern(c,"no-repeat"),ctx.fillRect(0,0,x+width,y+height),element.attribute("mask").value=mask},this.render=function(ctx){}},svg.Element.mask.prototype=new svg.Element.ElementBase,svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx){for(var i=0;i<this.children.length;i++){var child=this.children[i];if(void 0!==child.path){var transform=null;child.attribute("transform").hasValue()&&(transform=new svg.Transform(child.attribute("transform").value)).apply(ctx),child.path(ctx),ctx.clip(),transform&&transform.unapply(ctx)}}},this.render=function(ctx){}},svg.Element.clipPath.prototype=new svg.Element.ElementBase,svg.Element.filter=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,element){var bb=element.getBoundingBox(),x=Math.floor(bb.x1),y=Math.floor(bb.y1),width=Math.floor(bb.width()),height=Math.floor(bb.height()),filter=element.style("filter").value;element.style("filter").value="";for(var px=0,py=0,i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd),py=Math.max(py,efd)}var c=document.createElement("canvas");c.width=width+2*px,c.height=height+2*py;var tempCtx=c.getContext("2d");for(tempCtx.translate(-x+px,-y+py),element.render(tempCtx),i=0;i<this.children.length;i++)this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py),element.style("filter",!0).value=filter},this.render=function(ctx){}},svg.Element.filter.prototype=new svg.Element.ElementBase,svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){}},svg.Element.feMorphology.prototype=new svg.Element.ElementBase,svg.Element.feColorMatrix=function(node){function imGet(img,x,y,width,height,rgba){return img[y*width*4+4*x+rgba]}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+4*x+rgba]=val}this.base=svg.Element.ElementBase,this.base(node),this.apply=function(ctx,x,y,width,height){var srcData=ctx.getImageData(0,0,width,height);for(y=0;y<height;y++)for(x=0;x<width;x++){var gray=(imGet(srcData.data,x,y,width,0,0)+imGet(srcData.data,x,y,width,0,1)+imGet(srcData.data,x,y,width,0,2))/3;imSet(srcData.data,x,y,width,0,0,gray),imSet(srcData.data,x,y,width,0,1,gray),imSet(srcData.data,x,y,width,0,2,gray)}ctx.clearRect(0,0,width,height),ctx.putImageData(srcData,0,0)}},svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase,svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase,this.base(node),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(ctx,x,y,width,height){ctx.canvas.id=svg.UniqueId(),ctx.canvas.style.display="none",document.body.appendChild(ctx.canvas),stackBlurCanvasRGBA(ctx.canvas.id,x,y,width,height,this.blurRadius),document.body.removeChild(ctx.canvas)}},svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase,svg.Element.title=function(node){},svg.Element.title.prototype=new svg.Element.ElementBase,svg.Element.desc=function(node){},svg.Element.desc.prototype=new svg.Element.ElementBase,svg.Element.MISSING=function(node){"undefined"!=typeof console&&console.log("ERROR: Element '"+node.nodeName+"' not yet implemented.")},svg.Element.MISSING.prototype=new svg.Element.ElementBase,svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;return(e=void 0!==svg.Element[className]?new svg.Element[className](node):new svg.Element.MISSING(node)).type=node.nodeName,e},svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url))},svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml))},svg.loadXmlDoc=function(ctx,dom){function mapXY(p){for(var e=ctx.canvas;e;)p.x-=e.offsetLeft,p.y-=e.offsetTop,e=e.offsetParent;return window.scrollX&&(p.x+=window.scrollX),window.scrollY&&(p.y+=window.scrollY),p}function draw(){svg.ViewPort.Clear(),ctx.canvas.parentNode&&svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight),1!=svg.opts.ignoreDimensions&&(e.style("width").hasValue()&&(ctx.canvas.width=e.style("width").toPixels("x"),ctx.canvas.style.width=ctx.canvas.width+"px"),e.style("height").hasValue()&&(ctx.canvas.height=e.style("height").toPixels("y"),ctx.canvas.style.height=ctx.canvas.height+"px"));var cWidth=ctx.canvas.clientWidth||ctx.canvas.width,cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(1==svg.opts.ignoreDimensions&&e.style("width").hasValue()&&e.style("height").hasValue()&&(cWidth=e.style("width").toPixels("x"),cHeight=e.style("height").toPixels("y")),svg.ViewPort.SetCurrent(cWidth,cHeight),null!=svg.opts.offsetX&&(e.attribute("x",!0).value=svg.opts.offsetX),null!=svg.opts.offsetY&&(e.attribute("y",!0).value=svg.opts.offsetY),null!=svg.opts.scaleWidth&&null!=svg.opts.scaleHeight){var xRatio=1,yRatio=1,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);e.attribute("width").hasValue()?xRatio=e.attribute("width").toPixels("x")/svg.opts.scaleWidth:isNaN(viewBox[2])||(xRatio=viewBox[2]/svg.opts.scaleWidth),e.attribute("height").hasValue()?yRatio=e.attribute("height").toPixels("y")/svg.opts.scaleHeight:isNaN(viewBox[3])||(yRatio=viewBox[3]/svg.opts.scaleHeight),e.attribute("width",!0).value=svg.opts.scaleWidth,e.attribute("height",!0).value=svg.opts.scaleHeight,e.attribute("viewBox",!0).value="0 0 "+cWidth*xRatio+" "+cHeight*yRatio,e.attribute("preserveAspectRatio",!0).value="none"}1!=svg.opts.ignoreClear&&ctx.clearRect(0,0,cWidth,cHeight),e.render(ctx),isFirstRender&&(isFirstRender=!1,"function"==typeof svg.opts.renderCallback&&svg.opts.renderCallback(dom))}svg.init(ctx),1!=svg.opts.ignoreMouse&&(ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y)},ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(null!=e?e.clientX:event.clientX,null!=e?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y)});var e=svg.CreateElement(dom.documentElement),isFirstRender=e.root=!0,waitingForImages=!0;svg.ImagesLoaded()&&(waitingForImages=!1,draw()),svg.intervalID=setInterval(function(){var needUpdate=!1;if(waitingForImages&&svg.ImagesLoaded()&&(needUpdate=!(waitingForImages=!1)),1!=svg.opts.ignoreMouse&&(needUpdate|=svg.Mouse.hasEvents()),1!=svg.opts.ignoreAnimation)for(var i=0;i<svg.Animations.length;i++)needUpdate|=svg.Animations[i].update(1e3/svg.FRAMERATE);"function"==typeof svg.opts.forceRedraw&&1==svg.opts.forceRedraw()&&(needUpdate=!0),needUpdate&&(draw(),svg.Mouse.runEvents())},1e3/svg.FRAMERATE)},svg.stop=function(){svg.intervalID&&clearInterval(svg.intervalID)},svg.Mouse=new function(){this.events=[],this.hasEvents=function(){return 0!=this.events.length},this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){e.onclick&&e.onclick()}})},this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){e.onmousemove&&e.onmousemove()}})},this.eventElements=[],this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)&&(this.eventElements[i]=element)}},this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];bb.isPointInBox(e.x,e.y)&&(this.eventElements[i]=element)}},this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++)for(var e=this.events[i],element=this.eventElements[i];element;)e.run(element),element=element.parent;this.events=[],this.eventElements=[]}},svg}this.canvg=function(target,s,opts){if(null!=target||null!=s||null!=opts){opts=opts||{},"string"==typeof target&&(target=document.getElementById(target)),null!=target.svg&&target.svg.stop();var svg=build();1==target.childNodes.length&&"OBJECT"==target.childNodes[0].nodeName||(target.svg=svg),svg.opts=opts;var ctx=target.getContext("2d");void 0!==s.documentElement?svg.loadXmlDoc(ctx,s):"<"==s.substr(0,1)?svg.loadXml(ctx,s):svg.load(ctx,s)}else for(var svgTags=document.getElementsByTagName("svg"),i=0;i<svgTags.length;i++){var svgTag=svgTags[i],c=document.createElement("canvas");c.width=svgTag.clientWidth,c.height=svgTag.clientHeight,svgTag.parentNode.insertBefore(c,svgTag),svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag),canvg(c,div.innerHTML)}}})(),"undefined"!=typeof CanvasRenderingContext2D&&(CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh})}),function(joint,_){"use strict";function getScale(size){var scale=1;if(!_.isUndefined(size)&&(scale=parseFloat(size),!_.isFinite(scale)||0===scale))throw new Error("dia.Paper: invalid raster size ("+size+")");return scale}function getPadding(opt){var padding=joint.util.normalizeSides(opt.padding);return opt.width&&opt.height&&(padding.left+padding.right>=opt.width&&(padding.left=padding.right=0),padding.top+padding.bottom>=opt.height&&(padding.top=padding.bottom=0)),padding}joint.dia.Paper.prototype.toDataURL=function(callback,opt){if("function"!=typeof this.toSVG)throw new Error("The joint.format.svg.js plugin must be loaded.");opt=opt||{};var svg,clientRect=this.getContentBBox(),rasterBBox=function(clientRect,opt){if(opt.width&&opt.height)return{width:opt.width,height:opt.height};var padding=getPadding(opt),contentWidth=clientRect.width||1,contentHeight=clientRect.height||1,scale=getScale(opt.size);return contentHeight*=scale,{width:(contentWidth*=scale)+padding.left+padding.right,height:contentHeight+padding.top+padding.bottom}}(clientRect,opt),img=new Image;img.onload=function(){var dataURL,context,canvas;function createCanvas(){(canvas=document.createElement("canvas")).width=rasterBBox.width,canvas.height=rasterBBox.height,(context=canvas.getContext("2d")).fillStyle=opt.backgroundColor||"white",context.fillRect(0,0,rasterBBox.width,rasterBBox.height)}function readCanvas(){dataURL=canvas.toDataURL(opt.type,opt.quality),callback(dataURL),canvas.svg&&_.isFunction(canvas.svg.stop)&&_.defer(canvas.svg.stop)}createCanvas();try{context.drawImage(img,0,0,rasterBBox.width,rasterBBox.height),readCanvas()}catch(e){if("undefined"==typeof canvg)return void console.error("Canvas tainted. Canvg library required.");createCanvas();var canvgOpt={ignoreDimensions:!0,ignoreClear:!0,ignoreMouse:!0,ignoreAnimation:!0,offsetX:0,offsetY:0,useCORS:!0};canvg(canvas,svg,_.extend(canvgOpt,{forceRedraw:_.once(function(){return!0}),renderCallback:function(){try{readCanvas()}catch(e){svg=function(svg){return svg.replace(/\<image[^>]*>/g,function(imageTag){var href=imageTag.match(/href="([^"]*)"/)[1];if("data:image/svg+xml"!==href.substr(0,"data:image/svg+xml".length))return imageTag;var svg=decodeURIComponent(href.substr(href.indexOf(",")+1));return svg.substr(svg.indexOf("<svg"))})}(svg),createCanvas(),canvg(canvas,svg,_.extend(canvgOpt,{renderCallback:readCanvas}))}}}))}},this.toSVG(function(svgString){svg=svgString=svgString.replace('width="100%"','width="'+rasterBBox.width+'"').replace('height="100%"','height="'+rasterBBox.height+'"'),img.src="data:image/svg+xml,"+encodeURIComponent(svgString)},{convertImagesToDataUris:!0,area:function(clientBox,opt){var padding=getPadding(opt),scaleFactor=1/getScale(opt.size),paddingBox=g.rect({x:-padding.left,y:-padding.top,width:padding.left+padding.right,height:padding.top+padding.bottom}).scale(scaleFactor,scaleFactor);if(opt.width&&opt.height){var withPadding=g.rect(clientBox).moveAndExpand({x:padding.left,y:padding.right,width:padding.top,height:padding.bottom});paddingBox.scale(withPadding.width/opt.width,withPadding.height/opt.height)}return clientBox.moveAndExpand(paddingBox)}(clientRect,opt)})},joint.dia.Paper.prototype.toPNG=function(callback,opt){(opt=opt||{}).type="image/png",this.toDataURL(callback,opt)},joint.dia.Paper.prototype.toJPEG=function(callback,opt){(opt=opt||{}).type="image/jpeg",this.toDataURL(callback,opt)},joint.dia.Paper.prototype.openAsPNG=function(opt){var windowName=_.uniqueId("png_output");this.toPNG(function(dataURL){window.open("",windowName,"menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes").document.write('<img src="'+dataURL+'"/>')},_.extend({padding:10},opt))}}(joint,_),function($,_,V,joint){function beforePrint(opt){opt=opt||{},this.trigger("beforeprint",opt),this.$printArea=$("<div/>").addClass("printarea"),opt.size&&this.$printArea.addClass("printarea-size-"+opt.size);var $printPaper=this.$el.clone().appendTo(this.$printArea),padding=joint.util.normalizeSides(opt.padding),bbox=this.getContentBBox().moveAndExpand({x:-padding.left,y:-padding.top,width:padding.left+padding.right,height:padding.top+padding.bottom});V($printPaper.find("svg")[0]).attr({width:"100%",height:"100%",viewBox:[bbox.x,bbox.y,bbox.width,bbox.height].join(" ")}),this.$detachedChildren=this.$el.children().detach(),this.$printArea.prependTo(document.body)}function afterPrint(opt){opt=opt||{},this.$printArea.remove(),this.$el.append(this.$detachedChildren),this.$detachedChildren=null,this.$printArea=null,this.trigger("afterprint",opt)}joint.dia.Paper.prototype.print=function(opt){opt=opt||{},_.defaults(opt,{size:"a4",padding:5});var localBeforePrint=_.bind(beforePrint,this,opt),localAfterPrint=_.bind(afterPrint,this,opt),onceAfterPrint=_.once(function(){localAfterPrint(),$(window).off("afterprint",onceAfterPrint),$(window).off("mouseover",onceAfterPrint)});$(window).one("afterprint",onceAfterPrint),$(document).one("mouseover",onceAfterPrint),_.delay(onceAfterPrint,1e3),localBeforePrint(),window.print()}}($,_,V,joint);var WebSocketServer=__webpack_require__(18).Server,WebSocket=__webpack_require__(18),url=__webpack_require__(59);return WebSocket=WebSocket||"undefined"!=typeof window&&window.WebSocket,joint.com=joint.com||{},joint.com.Channel=function(opt){if(this.options=opt,!this.options||!this.options.graph)throw new Error("Channel: missing a graph.");this.options.ttl=this.options.ttl||60,this.options.healthCheckInterval=this.options.healthCheckInterval||36e5,this.options.reconnectInterval=this.options.reconnectInterval||1e4,this.options.serverShouldSendGraph=!!_.isUndefined(this.options.serverShouldSendGraph)||this.options.serverShouldSendGraph,this._isClient=!!this.options.url,this._clients=[],this.messageQueue=[],this.id=this.options.id||(this._isClient?"c_":"s_")+joint.util.uuid(),this.state={},this.state[this.id]=0,this.sites={},this.sites[this.id]={socket:void 0,outgoing:[],ttl:this.options.ttl},this.initialize()},_.extend(joint.com.Channel.prototype,Backbone.Events),joint.com.Channel.prototype.initialize=function(){this.options.graph.on("all",this.onGraphChange.bind(this)),this._isClient?this.connectClient():this.options.port&&(this.server=new WebSocketServer({port:this.options.port}),this.server.on("connection",this.onConnection.bind(this))),this._isClient||(this._healthCheckInterval=setInterval(this.healthCheck.bind(this),this.options.healthCheckInterval))},joint.com.Channel.prototype.connectClient=function(){var url=this.options.url+"/?channelId="+this.id+"&state="+JSON.stringify(this.state)+(this.options.query?"&query="+JSON.stringify(this.options.query):"");0<this.options.debugLevel&&this.log("connectClient",url);var socket=new WebSocket(url);socket.onopen=this.onConnection.bind(this,socket),socket.onclose=this.onClose.bind(this,socket)},joint.com.Channel.prototype.close=function(){this._reconnectTimeout&&clearTimeout(this._reconnectTimeout),this._healthCheckInterval&&clearInterval(this._healthCheckInterval),this._closed=!0,_.each(this.sites,function(site){site.socket&&site.socket.close()}),this.server&&this.server.close()},joint.com.Channel.prototype.healthCheck=function(){0<this.options.debugLevel&&this.log("healthCheck",_.object(_.keys(this.sites),_.pluck(this.sites,"ttl"))),_.each(this.sites,function(site,channelId){channelId!==this.id&&(site.socket&&1===site.socket.readyState?site.ttl=this.options.ttl:site.ttl-=1,site.ttl<=0&&(this.sites=_.omit(this.sites,channelId),this.state=_.omit(this.state,channelId)))},this)},joint.com.Channel.prototype.onConnection=function(socket){if(this._clients.push(socket),this.trigger("open",socket),this._isClient)(this.sites[this.id].socket=socket).onmessage=function(evt){this.onMessage(socket,evt.data)}.bind(this);else{var channelId=url.parse(socket.upgradeReq.url,!0).query.channelId;if(this.sites[channelId])this.sites[channelId].socket=socket;else if(1<this.debugLevel&&this.log("new_site",channelId),this.sites[channelId]={socket:socket,outgoing:[],ttl:this.options.ttl},this.state[channelId]=0,this.options.serverShouldSendGraph){var op={channelId:this.id,state:JSON.parse(JSON.stringify(this.state)),action:"graph",graph:this.options.graph.toJSON()};this.messageQueue.push({type:"op",data:op,source:this.id,target:[channelId]}),this.send()}socket.on("message",this.onMessage.bind(this,socket)),socket.on("close",this.onClose.bind(this,socket))}},joint.com.Channel.prototype.onClose=function(socket){var index=this._clients.indexOf(socket);-1!==index&&this._clients.splice(index,1),this._isClient&&!this._closed&&(this._reconnectTimeout&&clearTimeout(this._reconnectTimeout),this._reconnectTimeout=setTimeout(this.connectClient.bind(this),this.options.reconnectInterval)),this.trigger("close",socket)},joint.com.Channel.prototype.onMessage=function(socket,message){this.trigger("message:received",message),1<this.options.debugLevel&&this.log("message",message);try{message=JSON.parse(message)}catch(err){return console.error("Channel: message parsing failed.",err)}if("notification"==message.type)return this.trigger(message.data.event,message.data.data),this.sendNotification(message);var op=message.data;if(this._isClient){var mySite=this.sites[this.id];op=this.receive(mySite,this.id,op)}else{var otherSite=this.sites[op.channelId];op=this.receive(otherSite,op.channelId,op),mySite=this.sites[this.id],op=this.receive(mySite,this.id,op)}"graph"===op.action?this.state[op.channelId]=op.state[op.channelId]:this.state[op.channelId]=(this.state[op.channelId]||0)+1,1<this.options.debugLevel&&this.log("new state",this.state),this.execute(op),_.each(this.sites,function(site,channelId){channelId!==this.id&&channelId!==op.channelId&&this.receive(site,channelId,op)},this),this._isClient||(message.op=op,this.messageQueue.push(message),this.broadcast(message)),this.trigger("message:processed",message)},joint.com.Channel.prototype.receive=function(site,channelId,op){if(!site)return op;1<this.options.debugLevel&&this.log("receive",channelId,op),1<this.options.debugLevel&&this.log("outgoing",site.outgoing),site.outgoing=_.filter(site.outgoing,function(oldOp){return oldOp.state[oldOp.channelId]>=(op.state[oldOp.channelId]||0)}),1<this.options.debugLevel&&this.log("outgoing.length",site.outgoing.length);for(var i=0;i<site.outgoing.length;i++){var oldOp=site.outgoing[i],transformResult=this.transform(op,oldOp);op=transformResult[0],site.outgoing[i]=transformResult[1]}return op},joint.com.Channel.prototype.transform=function(o1,o2){return 1<this.options.debugLevel&&this.log("transform",o1,o2),"change:target"===o1.action&&"remove"===o2.action&&o1.cell.target.id===o2.cell.id&&(o1.cell.target={x:0,y:0}),"change:source"===o1.action&&"remove"===o2.action&&o1.cell.source.id===o2.cell.id&&(o1.cell.source={x:0,y:0}),[o1,o2]},joint.com.Channel.prototype.execute=function(op){var cell;switch(op.action){case"add":this.options.graph.addCell(op.cell,{remote:!0});break;case"remove":(cell=this.options.graph.getCell(op.cell.id))&&cell.remove({remote:!0,disconnectLinks:!0});break;case"graph":this.options.graph.fromJSON(op.graph);break;default:var attribute=op.action.substr("change:".length);(cell=this.options.graph.getCell(op.cell.id))&&cell.set(attribute,op.cell[attribute],{remote:!0})}},joint.com.Channel.prototype.broadcast=function(message){this._isClient?message.target=_.keys(this.sites):message.target=_.keys(_.omit(this.sites,this.id,message.source)),this.send()},joint.com.Channel.prototype.send=function(){if(!this._paused){for(var toRemove=[],i=0;i<this.messageQueue.length;i++){var m=this.messageQueue[i];this.sendMessage(m)&&toRemove.push(i)}toRemove.forEach(_.bind(function(msgIdx){this.messageQueue.splice(msgIdx,1)},this))}},joint.com.Channel.prototype.sendMessage=function(m){1<this.debugLevel&&this.log("sendMessage",m);var successTargets=[];return m.target.forEach(function(target,idx){var recievingSite=this.sites[target];if(!recievingSite)return successTargets.push(idx);recievingSite.socket&&1===recievingSite.socket.readyState&&(1<this.debugLevel&&this.log("sendMessage",target,m),recievingSite.socket.send(JSON.stringify(m)),successTargets.push(idx))},this),successTargets.forEach(function(targetIdx){m.target.splice(targetIdx,1)}),!m.target.length},joint.com.Channel.prototype.log=function(keyword,args){var text="Channel ["+this.id+"] "+keyword.toUpperCase()+": ";console.log.apply(console,[text].concat(Array.prototype.slice.call(arguments,1)))},joint.com.Channel.prototype.pause=function(){this._paused=!0},joint.com.Channel.prototype.unpause=function(){this._paused=!1,this.send()},joint.com.Channel.prototype.notify=function(event,data){var message={type:"notification",source:this.id,data:{event:event,data:data}};this.sendNotification(message)},joint.com.Channel.prototype.sendNotification=function(message){this._isClient?message.target=_.keys(this.sites):message.target=_.keys(_.omit(this.sites,this.id,message.source)),this.sendMessage(message)},joint.com.Channel.prototype.onGraphChange=function(eventName,cell,graph,options){if(!(options&&options.remote||"add"!==eventName&&"remove"!==eventName&&"change:"!==eventName.substr(0,"change:".length))){var op={channelId:this.id,state:JSON.parse(JSON.stringify(this.state)),action:eventName,cell:cell.toJSON()},message={type:"op",data:op,source:this.id};1<this.options.debugLevel&&this.log("generate",message),this.messageQueue.push(message),this.broadcast(message),this.sites[this.id].outgoing.push(op),this.state[this.id]++}},joint.com.ChannelHub=function(opt){if(this.options=opt,!this.options.port)throw new Error("ChannelHub: missing a port.");this.initialize()},_.extend(joint.com.ChannelHub.prototype,Backbone.Events),joint.com.ChannelHub.prototype.initialize=function(){this.server=new WebSocketServer({port:this.options.port}),this.server.on("connection",this.onConnection.bind(this))},joint.com.ChannelHub.prototype.onConnection=function(socket){var req={query:url.parse(socket.upgradeReq.url,!0).query};if(!this.router)throw new Error("ChannelHub: missing a router.");var called=!1,channel=this.router(req,function(error,channel){if(error)throw new Error(error);channel&&!called&&(channel.onConnection(socket),called=!0)});channel instanceof joint.com.Channel&&(channel.onConnection(socket),called=!0)},joint.com.ChannelHub.prototype.route=function(router){this.router=router},joint.com.ChannelHub.prototype.close=function(){this.server.close()},joint.alg=joint.alg||{},joint.alg.Dijkstra=function(adjacencyList,source,weight){weight=weight||function(u,v){return 1};var dist={};dist[source]=0;var previous={},Q=new joint.alg.PriorityQueue;for(var v in adjacencyList)v!==source&&(dist[v]=1/0),Q.insert(dist[v],v,v);for(var scanned={};!Q.isEmpty();){var u=Q.remove();scanned[u]=!0;for(var neighbours=adjacencyList[u]||[],i=0;i<neighbours.length;i++)if(!scanned[v=neighbours[i]]){var alt=dist[u]+weight(u,v);alt<dist[v]&&(dist[v]=alt,previous[v]=u,Q.updatePriority(v,alt))}}return previous},joint.alg=joint.alg||{},joint.alg.PriorityQueue=function(opt){opt=opt||{},this.comparator=opt.comparator||function(a,b){return a-b},this.index={},this.data=opt.data||[],this.heapify()},joint.alg.PriorityQueue.prototype.isEmpty=function(){return 0===this.data.length},joint.alg.PriorityQueue.prototype.insert=function(priority,value,id){var node={priority:priority,value:value};this.data.push(node);var index=this.data.length-1;id&&(node.id=id,this.index[id]=index),this.bubbleUp(index)},joint.alg.PriorityQueue.prototype.peek=function(){return this.data[0]&&this.data[0].value},joint.alg.PriorityQueue.prototype.peekPriority=function(){return this.data[0]&&this.data[0].priority},joint.alg.PriorityQueue.prototype.updatePriority=function(id,priority){var index=this.index[id];if(null==index)throw new Error("Node with id "+id+" was not found in the heap.");var data=this.data,oldPriority=data[index].priority,comp=this.comparator(priority,oldPriority);comp<0?(data[index].priority=priority,this.bubbleUp(index)):0<comp&&(data[index].priority=priority,this.bubbleDown(index))},joint.alg.PriorityQueue.prototype.remove=function(){var data=this.data,peek=data[0],last=data.pop();return this.index[data.length]=null,0<data.length&&((data[0]=last).id&&(this.index[last.id]=0),this.bubbleDown(0)),peek&&peek.value},joint.alg.PriorityQueue.prototype.heapify=function(){for(var i=0;i<this.data.length;i++)this.bubbleUp(i)},joint.alg.PriorityQueue.prototype.bubbleUp=function(pos){for(var parent,aux,data=this.data;0<pos&&(parent=pos-1>>>1,this.comparator(data[pos].priority,data[parent].priority)<0);)aux=data[parent],data[parent]=data[pos],data[pos].id&&(this.index[data[pos].id]=parent),data[pos]=aux,data[pos].id&&(this.index[data[pos].id]=pos),pos=parent},joint.alg.PriorityQueue.prototype.bubbleDown=function(pos){for(var data=this.data,last=data.length-1;;){var left=1+(pos<<1),right=1+left,minIndex=pos;if(left<=last&&this.comparator(data[left].priority,data[minIndex].priority)<0&&(minIndex=left),right<=last&&this.comparator(data[right].priority,data[minIndex].priority)<0&&(minIndex=right),minIndex===pos)break;var aux=data[minIndex];data[minIndex]=data[pos],data[pos].id&&(this.index[data[pos].id]=minIndex),data[pos]=aux,data[pos].id&&(this.index[data[pos].id]=pos),pos=minIndex}},joint.storage=joint.storage||{},joint.storage.Local={prefix:"joint.storage",insert:function(collection,doc,callback){var id=doc.id||_.uniqueId("doc-"),index=this.loadIndex(collection);index.keys.push(id),this.setItem(this.docKey(collection,id),doc),this.setItem(this.indexKey(collection),index),this.callback(callback,null,_.extend({},doc,{id:id}))},find:function(collection,query,callback){var index=this.loadIndex(collection),docs=[];if(_.isEmpty(query))_.each(index.keys,function(id){var doc=this.getItem(this.docKey(collection,id));doc||this.callback(callback,new Error("Storage incosistency. No document found for an ID "+id+" from index.")),docs.push(doc)},this),this.callback(callback,null,docs);else if(query.id){var doc=this.getItem(this.docKey(collection,query.id));this.callback(callback,null,doc?[doc]:[])}else this.callback(callback,null,[])},remove:function(collection,query,callback){var index=this.loadIndex(collection);_.isEmpty(query)?(_.each(index.keys,function(id){localStorage.removeItem(this.docKey(collection,id))},this),localStorage.removeItem(this.indexKey(collection)),this.callback(callback,null)):query.id&&(_.remove(index.keys,function(key){return key===query.id}),localStorage.removeItem(this.docKey(collection,query.id)),this.setItem(this.indexKey(collection),index),this.callback(callback,null))},callback:function(callback,err,ret){callback&&_.defer(function(){callback(err,ret)})},setItem:function(key,item){localStorage.setItem(key,JSON.stringify(item))},getItem:function(key){var item=localStorage.getItem(key);return item?JSON.parse(item):item},loadIndex:function(collection){var index=this.getItem(this.indexKey(collection))||{};return index.keys=index.keys||[],index},docKey:function(collection,id){return this.prefix+"."+collection+".docs."+id},indexKey:function(collection){return this.prefix+"."+collection+".index"}},joint.g=g,joint.V=joint.Vectorizer=V,joint}(0,Backbone,_,$)}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){(function(global,module){var __WEBPACK_AMD_DEFINE_RESULT__;!function(){function Ctor(){}var root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,SymbolProto="undefined"!=typeof Symbol?Symbol.prototype:null,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeCreate=Object.create,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};exports.nodeType?root._=_:(!module.nodeType&&module.exports&&(exports=module.exports=_),exports._=_),_.VERSION="1.9.1";function optimizeCb(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}}function cb(value,context,argCount){return _.iteratee!==builtinIteratee?_.iteratee(value,context):null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)&&!_.isArray(value)?_.matcher(value):_.property(value)}var builtinIteratee;_.iteratee=builtinIteratee=function(value,context){return cb(value,context,1/0)};function restArguments(func,startIndex){return startIndex=null==startIndex?func.length-1:+startIndex,function(){for(var length=Math.max(arguments.length-startIndex,0),rest=Array(length),index=0;index<length;index++)rest[index]=arguments[index+startIndex];switch(startIndex){case 0:return func.call(this,rest);case 1:return func.call(this,arguments[0],rest);case 2:return func.call(this,arguments[0],arguments[1],rest)}var args=Array(startIndex+1);for(index=0;index<startIndex;index++)args[index]=arguments[index];return args[startIndex]=rest,func.apply(this,args)}}function baseCreate(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result}function shallowProperty(key){return function(obj){return null==obj?void 0:obj[key]}}function has(obj,path){return null!=obj&&hasOwnProperty.call(obj,path)}function deepGet(obj,path){for(var length=path.length,i=0;i<length;i++){if(null==obj)return;obj=obj[path[i]]}return length?obj:void 0}function isArrayLike(collection){var length=getLength(collection);return"number"==typeof length&&0<=length&&length<=MAX_ARRAY_INDEX}var MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=shallowProperty("length");_.each=_.forEach=function(obj,iteratee,context){var i,length;if(iteratee=optimizeCb(iteratee,context),isArrayLike(obj))for(i=0,length=obj.length;i<length;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){return function(obj,iteratee,memo,context){var initial=3<=arguments.length;return function(obj,iteratee,memo,initial){var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0<dir?0:length-1;for(initial||(memo=obj[keys?keys[index]:index],index+=dir);0<=index&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}(obj,optimizeCb(iteratee,context,4),memo,initial)}}_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key=(isArrayLike(obj)?_.findIndex:_.findKey)(obj,predicate,context);if(void 0!==key&&-1!==key)return obj[key]},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),"number"==typeof fromIndex&&!guard||(fromIndex=0),0<=_.indexOf(obj,item,fromIndex)},_.invoke=restArguments(function(obj,path,args){var contextPath,func;return _.isFunction(path)?func=path:_.isArray(path)&&(contextPath=path.slice(0,-1),path=path[path.length-1]),_.map(obj,function(context){var method=func;if(!method){if(contextPath&&contextPath.length&&(context=deepGet(context,contextPath)),null==context)return;method=context[path]}return null==method?method:method.apply(context,args)})}),_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-1/0,lastComputed=-1/0;if(null==iteratee||"number"==typeof iteratee&&"object"!=typeof obj[0]&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)null!=(value=obj[i])&&result<value&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(v,index,list){computed=iteratee(v,index,list),(lastComputed<computed||computed===-1/0&&result===-1/0)&&(result=v,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee||"number"==typeof iteratee&&"object"!=typeof obj[0]&&null!=obj)for(var i=0,length=(obj=isArrayLike(obj)?obj:_.values(obj)).length;i<length;i++)null!=(value=obj[i])&&value<result&&(result=value);else iteratee=cb(iteratee,context),_.each(obj,function(v,index,list){((computed=iteratee(v,index,list))<lastComputed||computed===1/0&&result===1/0)&&(result=v,lastComputed=computed)});return result},_.shuffle=function(obj){return _.sample(obj,1/0)},_.sample=function(obj,n,guard){if(null==n||guard)return isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)];var sample=isArrayLike(obj)?_.clone(obj):_.values(obj),length=getLength(sample);n=Math.max(Math.min(n,length),0);for(var last=length-1,index=0;index<n;index++){var rand=_.random(index,last),temp=sample[index];sample[index]=sample[rand],sample[rand]=temp}return sample.slice(0,n)},_.sortBy=function(obj,iteratee,context){var index=0;return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,key,list){return{value:value,index:index++,criteria:iteratee(value,key,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(b<a||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),"value")};function group(behavior,partition){return function(obj,iteratee,context){var result=partition?[[],[]]:{};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}}_.groupBy=group(function(result,value,key){has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){has(result,key)?result[key]++:result[key]=1});var reStrSymbol=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):_.isString(obj)?obj.match(reStrSymbol):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=group(function(result,value,pass){result[pass?0:1].push(value)},!0),_.first=_.head=_.take=function(array,n,guard){return null==array||array.length<1?null==n?void 0:[]:null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){return null==array||array.length<1?null==n?void 0:[]:null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,Boolean)};var flatten=function(input,shallow,strict,output){for(var idx=(output=output||[]).length,i=0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value)))if(shallow)for(var j=0,len=value.length;j<len;)output[idx++]=value[j++];else flatten(value,shallow,strict,output),idx=output.length;else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=restArguments(function(array,otherArrays){return _.difference(array,otherArrays)}),_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted&&!iteratee?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=restArguments(function(arrays){return _.uniq(flatten(arrays,!0,!0))}),_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);i<length;i++){var item=array[i];if(!_.contains(result,item)){var j;for(j=1;j<argsLength&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=restArguments(function(array,rest){return rest=flatten(rest,!0,!0),_.filter(array,function(value){return!_.contains(rest,value)})}),_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;index<length;index++)result[index]=_.pluck(array,index);return result},_.zip=restArguments(_.unzip),_.object=function(list,values){for(var result={},i=0,length=getLength(list);i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=0<dir?0:length-1;0<=index&&index<length;index+=dir)if(predicate(array[index],index,array))return index;return-1}}_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){for(var value=(iteratee=cb(iteratee,context,1))(obj),low=0,high=getLength(array);low<high;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)0<dir?i=0<=idx?idx:Math.max(idx+length,i):length=0<=idx?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return array[idx=sortedIndex(array,item)]===item?idx:-1;if(item!=item)return 0<=(idx=predicateFind(slice.call(array,i,length),_.isNaN))?idx+i:-1;for(idx=0<dir?i:length-1;0<=idx&&idx<length;idx+=dir)if(array[idx]===item)return idx;return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||(stop<start?-1:1);for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;idx<length;idx++,start+=step)range[idx]=start;return range},_.chunk=function(array,count){if(null==count||count<1)return[];for(var result=[],i=0,length=array.length;i<length;)result.push(slice.call(array,i,i+=count));return result};function executeBound(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self}_.bind=restArguments(function(func,context,args){if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var bound=restArguments(function(callArgs){return executeBound(func,bound,context,this,args.concat(callArgs))});return bound}),_.partial=restArguments(function(func,boundArgs){var placeholder=_.partial.placeholder,bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;i<length;i++)args[i]=boundArgs[i]===placeholder?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound}),(_.partial.placeholder=_).bindAll=restArguments(function(obj,keys){var index=(keys=flatten(keys,!1,!1)).length;if(index<1)throw new Error("bindAll must be passed function names");for(;index--;){var key=keys[index];obj[key]=_.bind(obj[key],obj)}}),_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=restArguments(function(func,wait,args){return setTimeout(function(){return func.apply(null,args)},wait)}),_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var timeout,context,args,result,previous=0;options=options||{};function later(){previous=!1===options.leading?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)}function throttled(){var now=_.now();previous||!1!==options.leading||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||wait<remaining?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining)),result}return throttled.cancel=function(){clearTimeout(timeout),previous=0,timeout=context=args=null},throttled},_.debounce=function(func,wait,immediate){function later(context,args){timeout=null,args&&(result=func.apply(context,args))}var timeout,result,debounced=restArguments(function(args){if(timeout&&clearTimeout(timeout),immediate){var callNow=!timeout;timeout=setTimeout(later,wait),callNow&&(result=func.apply(this,args))}else timeout=_.delay(later,wait,this,args);return result});return debounced.cancel=function(){clearTimeout(timeout),timeout=null},debounced},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.before=function(times,func){var memo;return function(){return 0<--times&&(memo=func.apply(this,arguments)),times<=1&&(func=null),memo}},_.once=_.partial(_.before,2),_.restArguments=restArguments;function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)(prop=nonEnumerableProps[nonEnumIdx])in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=_.keys(obj),length=keys.length,results={},index=0;index<length;index++){var currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()};function createAssigner(keysFunc,defaults){return function(obj){var length=arguments.length;if(defaults&&(obj=Object(obj)),length<2||null==obj)return obj;for(var index=1;index<length;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;i<l;i++){var key=keys[i];defaults&&void 0!==obj[key]||(obj[key]=source[key])}return obj}}_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(predicate(obj[key=keys[i]],key,obj))return key};function keyInObj(value,key,obj){return key in obj}var eq,deepEq;_.pick=restArguments(function(obj,keys){var result={},iteratee=keys[0];if(null==obj)return result;_.isFunction(iteratee)?(1<keys.length&&(iteratee=optimizeCb(iteratee,keys[1])),keys=_.allKeys(obj)):(iteratee=keyInObj,keys=flatten(keys,!1,!1),obj=Object(obj));for(var i=0,length=keys.length;i<length;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result}),_.omit=restArguments(function(obj,keys){var context,iteratee=keys[0];return _.isFunction(iteratee)?(iteratee=_.negate(iteratee),1<keys.length&&(context=keys[1])):(keys=_.map(flatten(keys,!1,!1),String),iteratee=function(value,key){return!_.contains(keys,key)}),_.pick(obj,iteratee,context)}),_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0},eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return!1;if(a!=a)return b!=b;var type=typeof a;return("function"==type||"object"==type||"object"==typeof b)&&deepEq(a,b,aStack,bStack)},deepEq=function(a,b,aStack,bStack){a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!=+a?+b!=+b:0==+a?1/+a==1/b:+a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object Symbol]":return SymbolProto.valueOf.call(a)===SymbolProto.valueOf.call(b)}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}bStack=bStack||[];for(var length=(aStack=aStack||[]).length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if((length=a.length)!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0},_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj||(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length)},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"==type||"object"==type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return has(obj,"callee")});var nodelist=root.document&&root.document.childNodes;"object"!=typeof Int8Array&&"function"!=typeof nodelist&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return!_.isSymbol(obj)&&isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&isNaN(obj)},_.isBoolean=function(obj){return!0===obj||!1===obj||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,path){if(!_.isArray(path))return has(obj,path);for(var length=path.length,i=0;i<length;i++){var key=path[i];if(null==obj||!hasOwnProperty.call(obj,key))return!1;obj=obj[key]}return!!length},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=function(path){return _.isArray(path)?function(obj){return deepGet(obj,path)}:shallowProperty(path)},_.propertyOf=function(obj){return null==obj?function(){}:function(path){return _.isArray(path)?deepGet(obj,path):obj[path]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};function createEscaper(map){function escaper(match){return map[match]}var source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}}var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap);_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(obj,path,fallback){_.isArray(path)||(path=[path]);var length=path.length;if(!length)return _.isFunction(fallback)?fallback.call(obj):fallback;for(var i=0;i<length;i++){var prop=null==obj?void 0:obj[path[i]];void 0===prop&&(prop=fallback,i=length),obj=_.isFunction(prop)?prop.call(obj):prop}return obj};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function escapeChar(match){return"\\"+escapes[match]}var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escapeRegExp=/\\|'|\r|\n|\u2028|\u2029/g;_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var render,matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escapeRegExp,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}function template(data){return render.call(this,data,_)}var argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};function chainResult(instance,obj){return instance._chain?_(obj).chain():obj}_.mixin=function(obj){return _.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),chainResult(this,func.apply(_,args))}}),_},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],chainResult(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return chainResult(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,_.prototype.toString=function(){return String(this._wrapped)},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return _}.apply(exports,[]))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(6),__webpack_require__(4)(module))},function(module,exports,__webpack_require__){module.exports={Graph:__webpack_require__(8),version:__webpack_require__(23)}},function(module,exports){module.exports="1.0.7"},function(module,exports,__webpack_require__){var _=__webpack_require__(2),Graph=__webpack_require__(8);module.exports={write:function(g){var json={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:function(g){return _.map(g.nodes(),function(v){var nodeValue=g.node(v),parent=g.parent(v),node={v:v};return _.isUndefined(nodeValue)||(node.value=nodeValue),_.isUndefined(parent)||(node.parent=parent),node})}(g),edges:function(g){return _.map(g.edges(),function(e){var edgeValue=g.edge(e),edge={v:e.v,w:e.w};return _.isUndefined(e.name)||(edge.name=e.name),_.isUndefined(edgeValue)||(edge.value=edgeValue),edge})}(g)};_.isUndefined(g.graph())||(json.value=_.clone(g.graph()));return json},read:function(json){var g=new Graph(json.options).setGraph(json.value);return _.each(json.nodes,function(entry){g.setNode(entry.v,entry.value),entry.parent&&g.setParent(entry.v,entry.parent)}),_.each(json.edges,function(entry){g.setEdge({v:entry.v,w:entry.w,name:entry.name},entry.value)}),g}}},function(module,exports,__webpack_require__){module.exports={components:__webpack_require__(26),dijkstra:__webpack_require__(12),dijkstraAll:__webpack_require__(27),findCycles:__webpack_require__(28),floydWarshall:__webpack_require__(29),isAcyclic:__webpack_require__(30),postorder:__webpack_require__(31),preorder:__webpack_require__(32),prim:__webpack_require__(33),tarjan:__webpack_require__(14),topsort:__webpack_require__(15)}},function(module,exports,__webpack_require__){var _=__webpack_require__(2);module.exports=function(g){var cmpt,visited={},cmpts=[];function dfs(v){_.has(visited,v)||(visited[v]=!0,cmpt.push(v),_.each(g.successors(v),dfs),_.each(g.predecessors(v),dfs))}return _.each(g.nodes(),function(v){cmpt=[],dfs(v),cmpt.length&&cmpts.push(cmpt)}),cmpts}},function(module,exports,__webpack_require__){var dijkstra=__webpack_require__(12),_=__webpack_require__(2);module.exports=function(g,weightFunc,edgeFunc){return _.transform(g.nodes(),function(acc,v){acc[v]=dijkstra(g,v,weightFunc,edgeFunc)},{})}},function(module,exports,__webpack_require__){var _=__webpack_require__(2),tarjan=__webpack_require__(14);module.exports=function(g){return _.filter(tarjan(g),function(cmpt){return 1<cmpt.length||1===cmpt.length&&g.hasEdge(cmpt[0],cmpt[0])})}},function(module,exports,__webpack_require__){var _=__webpack_require__(2);module.exports=function(g,weightFn,edgeFn){return function(g,weightFn,edgeFn){var results={},nodes=g.nodes();return nodes.forEach(function(v){results[v]={},results[v][v]={distance:0},nodes.forEach(function(w){v!==w&&(results[v][w]={distance:Number.POSITIVE_INFINITY})}),edgeFn(v).forEach(function(edge){var w=edge.v===v?edge.w:edge.v,d=weightFn(edge);results[v][w]={distance:d,predecessor:v}})}),nodes.forEach(function(k){var rowK=results[k];nodes.forEach(function(i){var rowI=results[i];nodes.forEach(function(j){var ik=rowI[k],kj=rowK[j],ij=rowI[j],altDistance=ik.distance+kj.distance;altDistance<ij.distance&&(ij.distance=altDistance,ij.predecessor=kj.predecessor)})})}),results}(g,weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})};var DEFAULT_WEIGHT_FUNC=_.constant(1)},function(module,exports,__webpack_require__){var topsort=__webpack_require__(15);module.exports=function(g){try{topsort(g)}catch(e){if(e instanceof topsort.CycleException)return!1;throw e}return!0}},function(module,exports,__webpack_require__){var dfs=__webpack_require__(16);module.exports=function(g,vs){return dfs(g,vs,"post")}},function(module,exports,__webpack_require__){var dfs=__webpack_require__(16);module.exports=function(g,vs){return dfs(g,vs,"pre")}},function(module,exports,__webpack_require__){var _=__webpack_require__(2),Graph=__webpack_require__(8),PriorityQueue=__webpack_require__(13);module.exports=function(g,weightFunc){var v,result=new Graph,parents={},pq=new PriorityQueue;function updateNeighbors(edge){var w=edge.v===v?edge.w:edge.v,pri=pq.priority(w);if(void 0!==pri){var edgeWeight=weightFunc(edge);edgeWeight<pri&&(parents[w]=v,pq.decrease(w,edgeWeight))}}if(0===g.nodeCount())return result;_.each(g.nodes(),function(v){pq.add(v,Number.POSITIVE_INFINITY),result.setNode(v)}),pq.decrease(g.nodes()[0],0);var init=!1;for(;0<pq.size();){if(v=pq.removeMin(),_.has(parents,v))result.setEdge(v,parents[v]);else{if(init)throw new Error("Input graph is not connected: "+g);init=!0}g.nodeEdges(v).forEach(updateNeighbors)}return result}},function(module,exports,__webpack_require__){module.exports={graphlib:__webpack_require__(3),layout:__webpack_require__(35),debug:__webpack_require__(57),util:{time:__webpack_require__(1).time,notime:__webpack_require__(1).notime},version:__webpack_require__(58)}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),acyclic=__webpack_require__(36),normalize=__webpack_require__(39),rank=__webpack_require__(40),normalizeRanks=__webpack_require__(1).normalizeRanks,parentDummyChains=__webpack_require__(42),removeEmptyRanks=__webpack_require__(1).removeEmptyRanks,nestingGraph=__webpack_require__(43),addBorderSegments=__webpack_require__(44),coordinateSystem=__webpack_require__(45),order=__webpack_require__(46),position=__webpack_require__(55),util=__webpack_require__(1),Graph=__webpack_require__(3).Graph;module.exports=function(g,opts){var time=opts&&opts.debugTiming?util.time:util.notime;time("layout",function(){var layoutGraph=time("  buildLayoutGraph",function(){return function(inputGraph){var g=new Graph({multigraph:!0,compound:!0}),graph=canonicalize(inputGraph.graph());return g.setGraph(_.merge({},graphDefaults,selectNumberAttrs(graph,graphNumAttrs),_.pick(graph,graphAttrs))),_.each(inputGraph.nodes(),function(v){var node=canonicalize(inputGraph.node(v));g.setNode(v,_.defaults(selectNumberAttrs(node,nodeNumAttrs),nodeDefaults)),g.setParent(v,inputGraph.parent(v))}),_.each(inputGraph.edges(),function(e){var edge=canonicalize(inputGraph.edge(e));g.setEdge(e,_.merge({},edgeDefaults,selectNumberAttrs(edge,edgeNumAttrs),_.pick(edge,edgeAttrs)))}),g}(g)});time("  runLayout",function(){!function(g,time){time("    makeSpaceForEdgeLabels",function(){!function(g){var graph=g.graph();graph.ranksep/=2,_.each(g.edges(),function(e){var edge=g.edge(e);edge.minlen*=2,"c"!==edge.labelpos.toLowerCase()&&("TB"===graph.rankdir||"BT"===graph.rankdir?edge.width+=edge.labeloffset:edge.height+=edge.labeloffset)})}(g)}),time("    removeSelfEdges",function(){!function(g){_.each(g.edges(),function(e){if(e.v===e.w){var node=g.node(e.v);node.selfEdges||(node.selfEdges=[]),node.selfEdges.push({e:e,label:g.edge(e)}),g.removeEdge(e)}})}(g)}),time("    acyclic",function(){acyclic.run(g)}),time("    nestingGraph.run",function(){nestingGraph.run(g)}),time("    rank",function(){rank(util.asNonCompoundGraph(g))}),time("    injectEdgeLabelProxies",function(){!function(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(edge.width&&edge.height){var v=g.node(e.v),label={rank:(g.node(e.w).rank-v.rank)/2+v.rank,e:e};util.addDummyNode(g,"edge-proxy",label,"_ep")}})}(g)}),time("    removeEmptyRanks",function(){removeEmptyRanks(g)}),time("    nestingGraph.cleanup",function(){nestingGraph.cleanup(g)}),time("    normalizeRanks",function(){normalizeRanks(g)}),time("    assignRankMinMax",function(){!function(g){var maxRank=0;_.each(g.nodes(),function(v){var node=g.node(v);node.borderTop&&(node.minRank=g.node(node.borderTop).rank,node.maxRank=g.node(node.borderBottom).rank,maxRank=_.max(maxRank,node.maxRank))}),g.graph().maxRank=maxRank}(g)}),time("    removeEdgeLabelProxies",function(){!function(g){_.each(g.nodes(),function(v){var node=g.node(v);"edge-proxy"===node.dummy&&(g.edge(node.e).labelRank=node.rank,g.removeNode(v))})}(g)}),time("    normalize.run",function(){normalize.run(g)}),time("    parentDummyChains",function(){parentDummyChains(g)}),time("    addBorderSegments",function(){addBorderSegments(g)}),time("    order",function(){order(g)}),time("    insertSelfEdges",function(){!function(g){var layers=util.buildLayerMatrix(g);_.each(layers,function(layer){var orderShift=0;_.each(layer,function(v,i){var node=g.node(v);node.order=i+orderShift,_.each(node.selfEdges,function(selfEdge){util.addDummyNode(g,"selfedge",{width:selfEdge.label.width,height:selfEdge.label.height,rank:node.rank,order:i+ ++orderShift,e:selfEdge.e,label:selfEdge.label},"_se")}),delete node.selfEdges})})}(g)}),time("    adjustCoordinateSystem",function(){coordinateSystem.adjust(g)}),time("    position",function(){position(g)}),time("    positionSelfEdges",function(){!function(g){_.each(g.nodes(),function(v){var node=g.node(v);if("selfedge"===node.dummy){var selfNode=g.node(node.e.v),x=selfNode.x+selfNode.width/2,y=selfNode.y,dx=node.x-x,dy=selfNode.height/2;g.setEdge(node.e,node.label),g.removeNode(v),node.label.points=[{x:x+2*dx/3,y:y-dy},{x:x+5*dx/6,y:y-dy},{x:x+dx,y:y},{x:x+5*dx/6,y:y+dy},{x:x+2*dx/3,y:y+dy}],node.label.x=node.x,node.label.y=node.y}})}(g)}),time("    removeBorderNodes",function(){!function(g){_.each(g.nodes(),function(v){if(g.children(v).length){var node=g.node(v),t=g.node(node.borderTop),b=g.node(node.borderBottom),l=g.node(_.last(node.borderLeft)),r=g.node(_.last(node.borderRight));node.width=Math.abs(r.x-l.x),node.height=Math.abs(b.y-t.y),node.x=l.x+node.width/2,node.y=t.y+node.height/2}}),_.each(g.nodes(),function(v){"border"===g.node(v).dummy&&g.removeNode(v)})}(g)}),time("    normalize.undo",function(){normalize.undo(g)}),time("    fixupEdgeLabelCoords",function(){!function(g){_.each(g.edges(),function(e){var edge=g.edge(e);if(_.has(edge,"x"))switch("l"!==edge.labelpos&&"r"!==edge.labelpos||(edge.width-=edge.labeloffset),edge.labelpos){case"l":edge.x-=edge.width/2+edge.labeloffset;break;case"r":edge.x+=edge.width/2+edge.labeloffset}})}(g)}),time("    undoCoordinateSystem",function(){coordinateSystem.undo(g)}),time("    translateGraph",function(){!function(g){var minX=Number.POSITIVE_INFINITY,maxX=0,minY=Number.POSITIVE_INFINITY,maxY=0,graphLabel=g.graph(),marginX=graphLabel.marginx||0,marginY=graphLabel.marginy||0;function getExtremes(attrs){var x=attrs.x,y=attrs.y,w=attrs.width,h=attrs.height;minX=Math.min(minX,x-w/2),maxX=Math.max(maxX,x+w/2),minY=Math.min(minY,y-h/2),maxY=Math.max(maxY,y+h/2)}_.each(g.nodes(),function(v){getExtremes(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.has(edge,"x")&&getExtremes(edge)}),minX-=marginX,minY-=marginY,_.each(g.nodes(),function(v){var node=g.node(v);node.x-=minX,node.y-=minY}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,function(p){p.x-=minX,p.y-=minY}),_.has(edge,"x")&&(edge.x-=minX),_.has(edge,"y")&&(edge.y-=minY)}),graphLabel.width=maxX-minX+marginX,graphLabel.height=maxY-minY+marginY}(g)}),time("    assignNodeIntersects",function(){!function(g){_.each(g.edges(),function(e){var p1,p2,edge=g.edge(e),nodeV=g.node(e.v),nodeW=g.node(e.w);p2=edge.points?(p1=edge.points[0],edge.points[edge.points.length-1]):(edge.points=[],p1=nodeW,nodeV),edge.points.unshift(util.intersectRect(nodeV,p1)),edge.points.push(util.intersectRect(nodeW,p2))})}(g)}),time("    reversePoints",function(){!function(g){_.each(g.edges(),function(e){var edge=g.edge(e);edge.reversed&&edge.points.reverse()})}(g)}),time("    acyclic.undo",function(){acyclic.undo(g)})}(layoutGraph,time)}),time("  updateInputGraph",function(){!function(inputGraph,layoutGraph){_.each(inputGraph.nodes(),function(v){var inputLabel=inputGraph.node(v),layoutLabel=layoutGraph.node(v);inputLabel&&(inputLabel.x=layoutLabel.x,inputLabel.y=layoutLabel.y,layoutGraph.children(v).length&&(inputLabel.width=layoutLabel.width,inputLabel.height=layoutLabel.height))}),_.each(inputGraph.edges(),function(e){var inputLabel=inputGraph.edge(e),layoutLabel=layoutGraph.edge(e);inputLabel.points=layoutLabel.points,_.has(layoutLabel,"x")&&(inputLabel.x=layoutLabel.x,inputLabel.y=layoutLabel.y)}),inputGraph.graph().width=layoutGraph.graph().width,inputGraph.graph().height=layoutGraph.graph().height}(g,layoutGraph)})})};var graphNumAttrs=["nodesep","edgesep","ranksep","marginx","marginy"],graphDefaults={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},graphAttrs=["acyclicer","ranker","rankdir","align"],nodeNumAttrs=["width","height"],nodeDefaults={width:0,height:0},edgeNumAttrs=["minlen","weight","width","height","labeloffset"],edgeDefaults={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},edgeAttrs=["labelpos"];function selectNumberAttrs(obj,attrs){return _.mapValues(_.pick(obj,attrs),Number)}function canonicalize(attrs){var newAttrs={};return _.each(attrs,function(v,k){newAttrs[k.toLowerCase()]=v}),newAttrs}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),greedyFAS=__webpack_require__(37);module.exports={run:function(g){var fas="greedy"===g.graph().acyclicer?greedyFAS(g,function(g){return function(e){return g.edge(e).weight}}(g)):function(g){var fas=[],stack={},visited={};return _.each(g.nodes(),function dfs(v){if(_.has(visited,v))return;visited[v]=!0;stack[v]=!0;_.each(g.outEdges(v),function(e){_.has(stack,e.w)?fas.push(e):dfs(e.w)});delete stack[v]}),fas}(g);_.each(fas,function(e){var label=g.edge(e);g.removeEdge(e),label.forwardName=e.name,label.reversed=!0,g.setEdge(e.w,e.v,label,_.uniqueId("rev"))})},undo:function(g){_.each(g.edges(),function(e){var label=g.edge(e);if(label.reversed){g.removeEdge(e);var forwardName=label.forwardName;delete label.reversed,delete label.forwardName,g.setEdge(e.w,e.v,label,forwardName)}})}}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),Graph=__webpack_require__(3).Graph,List=__webpack_require__(38);module.exports=function(g,weightFn){if(g.nodeCount()<=1)return[];var state=function(g,weightFn){var fasGraph=new Graph,maxIn=0,maxOut=0;_.each(g.nodes(),function(v){fasGraph.setNode(v,{v:v,in:0,out:0})}),_.each(g.edges(),function(e){var prevWeight=fasGraph.edge(e.v,e.w)||0,weight=weightFn(e),edgeWeight=prevWeight+weight;fasGraph.setEdge(e.v,e.w,edgeWeight),maxOut=Math.max(maxOut,fasGraph.node(e.v).out+=weight),maxIn=Math.max(maxIn,fasGraph.node(e.w).in+=weight)});var buckets=_.range(maxOut+maxIn+3).map(function(){return new List}),zeroIdx=maxIn+1;return _.each(fasGraph.nodes(),function(v){assignBucket(buckets,zeroIdx,fasGraph.node(v))}),{graph:fasGraph,buckets:buckets,zeroIdx:zeroIdx}}(g,weightFn||DEFAULT_WEIGHT_FN),results=function(g,buckets,zeroIdx){var entry,results=[],sources=buckets[buckets.length-1],sinks=buckets[0];for(;g.nodeCount();){for(;entry=sinks.dequeue();)removeNode(g,buckets,zeroIdx,entry);for(;entry=sources.dequeue();)removeNode(g,buckets,zeroIdx,entry);if(g.nodeCount())for(var i=buckets.length-2;0<i;--i)if(entry=buckets[i].dequeue()){results=results.concat(removeNode(g,buckets,zeroIdx,entry,!0));break}}return results}(state.graph,state.buckets,state.zeroIdx);return _.flatten(_.map(results,function(e){return g.outEdges(e.v,e.w)}),!0)};var DEFAULT_WEIGHT_FN=_.constant(1);function removeNode(g,buckets,zeroIdx,entry,collectPredecessors){var results=collectPredecessors?[]:void 0;return _.each(g.inEdges(entry.v),function(edge){var weight=g.edge(edge),uEntry=g.node(edge.v);collectPredecessors&&results.push({v:edge.v,w:edge.w}),uEntry.out-=weight,assignBucket(buckets,zeroIdx,uEntry)}),_.each(g.outEdges(entry.v),function(edge){var weight=g.edge(edge),w=edge.w,wEntry=g.node(w);wEntry.in-=weight,assignBucket(buckets,zeroIdx,wEntry)}),g.removeNode(entry.v),results}function assignBucket(buckets,zeroIdx,entry){entry.out?entry.in?buckets[entry.out-entry.in+zeroIdx].enqueue(entry):buckets[buckets.length-1].enqueue(entry):buckets[0].enqueue(entry)}},function(module,exports){function List(){var sentinel={};sentinel._next=sentinel._prev=sentinel,this._sentinel=sentinel}function unlink(entry){entry._prev._next=entry._next,entry._next._prev=entry._prev,delete entry._next,delete entry._prev}function filterOutLinks(k,v){if("_next"!==k&&"_prev"!==k)return v}(module.exports=List).prototype.dequeue=function(){var sentinel=this._sentinel,entry=sentinel._prev;if(entry!==sentinel)return unlink(entry),entry},List.prototype.enqueue=function(entry){var sentinel=this._sentinel;entry._prev&&entry._next&&unlink(entry),entry._next=sentinel._next,sentinel._next._prev=entry,(sentinel._next=entry)._prev=sentinel},List.prototype.toString=function(){for(var strs=[],sentinel=this._sentinel,curr=sentinel._prev;curr!==sentinel;)strs.push(JSON.stringify(curr,filterOutLinks)),curr=curr._prev;return"["+strs.join(", ")+"]"}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),util=__webpack_require__(1);module.exports={run:function(g){g.graph().dummyChains=[],_.each(g.edges(),function(edge){!function(g,e){var dummy,attrs,i,v=e.v,vRank=g.node(v).rank,w=e.w,wRank=g.node(w).rank,name=e.name,edgeLabel=g.edge(e),labelRank=edgeLabel.labelRank;if(wRank===vRank+1)return;for(g.removeEdge(e),i=0,++vRank;vRank<wRank;++i,++vRank)edgeLabel.points=[],attrs={width:0,height:0,edgeLabel:edgeLabel,edgeObj:e,rank:vRank},dummy=util.addDummyNode(g,"edge",attrs,"_d"),vRank===labelRank&&(attrs.width=edgeLabel.width,attrs.height=edgeLabel.height,attrs.dummy="edge-label",attrs.labelpos=edgeLabel.labelpos),g.setEdge(v,dummy,{weight:edgeLabel.weight},name),0===i&&g.graph().dummyChains.push(dummy),v=dummy;g.setEdge(v,w,{weight:edgeLabel.weight},name)}(g,edge)})},undo:function(g){_.each(g.graph().dummyChains,function(v){var w,node=g.node(v),origLabel=node.edgeLabel;for(g.setEdge(node.edgeObj,origLabel);node.dummy;)w=g.successors(v)[0],g.removeNode(v),origLabel.points.push({x:node.x,y:node.y}),"edge-label"===node.dummy&&(origLabel.x=node.x,origLabel.y=node.y,origLabel.width=node.width,origLabel.height=node.height),v=w,node=g.node(v)})}}},function(module,exports,__webpack_require__){"use strict";var longestPath=__webpack_require__(7).longestPath,feasibleTree=__webpack_require__(17),networkSimplex=__webpack_require__(41);module.exports=function(g){switch(g.graph().ranker){case"network-simplex":networkSimplexRanker(g);break;case"tight-tree":!function(g){longestPath(g),feasibleTree(g)}(g);break;case"longest-path":longestPathRanker(g);break;default:networkSimplexRanker(g)}};var longestPathRanker=longestPath;function networkSimplexRanker(g){networkSimplex(g)}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),feasibleTree=__webpack_require__(17),slack=__webpack_require__(7).slack,initRank=__webpack_require__(7).longestPath,preorder=__webpack_require__(3).alg.preorder,postorder=__webpack_require__(3).alg.postorder,simplify=__webpack_require__(1).simplify;function networkSimplex(g){g=simplify(g),initRank(g);var e,t=feasibleTree(g);for(initLowLimValues(t),initCutValues(t,g);e=leaveEdge(t);)exchangeEdges(t,g,e,enterEdge(t,g,e))}function initCutValues(t,g){var vs=postorder(t,t.nodes());vs=vs.slice(0,vs.length-1),_.each(vs,function(v){!function(t,g,child){var parent=t.node(child).parent;t.edge(child,parent).cutvalue=calcCutValue(t,g,child)}(t,g,v)})}function calcCutValue(t,g,child){var parent=t.node(child).parent,childIsTail=!0,graphEdge=g.edge(child,parent),cutValue=0;return graphEdge||(childIsTail=!1,graphEdge=g.edge(parent,child)),cutValue=graphEdge.weight,_.each(g.nodeEdges(child),function(e){var isOutEdge=e.v===child,other=isOutEdge?e.w:e.v;if(other!==parent){var pointsToHead=isOutEdge===childIsTail,otherWeight=g.edge(e).weight;if(cutValue+=pointsToHead?otherWeight:-otherWeight,function(tree,u,v){return tree.hasEdge(u,v)}(t,child,other)){var otherCutValue=t.edge(child,other).cutvalue;cutValue+=pointsToHead?-otherCutValue:otherCutValue}}}),cutValue}function initLowLimValues(tree,root){arguments.length<2&&(root=tree.nodes()[0]),function dfsAssignLowLim(tree,visited,nextLim,v,parent){var low=nextLim,label=tree.node(v);visited[v]=!0;_.each(tree.neighbors(v),function(w){_.has(visited,w)||(nextLim=dfsAssignLowLim(tree,visited,nextLim,w,v))});label.low=low;label.lim=nextLim++;parent?label.parent=parent:delete label.parent;return nextLim}(tree,{},1,root)}function leaveEdge(tree){return _.find(tree.edges(),function(e){return tree.edge(e).cutvalue<0})}function enterEdge(t,g,edge){var v=edge.v,w=edge.w;g.hasEdge(v,w)||(v=edge.w,w=edge.v);var vLabel=t.node(v),wLabel=t.node(w),tailLabel=vLabel,flip=!1;vLabel.lim>wLabel.lim&&(tailLabel=wLabel,flip=!0);var candidates=_.filter(g.edges(),function(edge){return flip===isDescendant(t,t.node(edge.v),tailLabel)&&flip!==isDescendant(t,t.node(edge.w),tailLabel)});return _.min(candidates,function(edge){return slack(g,edge)})}function exchangeEdges(t,g,e,f){var v=e.v,w=e.w;t.removeEdge(v,w),t.setEdge(f.v,f.w,{}),initLowLimValues(t),initCutValues(t,g),function(t,g){var root=_.find(t.nodes(),function(v){return!g.node(v).parent}),vs=preorder(t,root);vs=vs.slice(1),_.each(vs,function(v){var parent=t.node(v).parent,edge=g.edge(v,parent),flipped=!1;edge||(edge=g.edge(parent,v),flipped=!0),g.node(v).rank=g.node(parent).rank+(flipped?edge.minlen:-edge.minlen)})}(t,g)}function isDescendant(tree,vLabel,rootLabel){return rootLabel.low<=vLabel.lim&&vLabel.lim<=rootLabel.lim}(module.exports=networkSimplex).initLowLimValues=initLowLimValues,networkSimplex.initCutValues=initCutValues,networkSimplex.calcCutValue=calcCutValue,networkSimplex.leaveEdge=leaveEdge,networkSimplex.enterEdge=enterEdge,networkSimplex.exchangeEdges=exchangeEdges},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(g){var postorderNums=function(g){var result={},lim=0;return _.each(g.children(),function dfs(v){var low=lim;_.each(g.children(v),dfs);result[v]={low:low,lim:lim++}}),result}(g);_.each(g.graph().dummyChains,function(v){for(var node=g.node(v),edgeObj=node.edgeObj,pathData=function(g,postorderNums,v,w){var parent,lca,vPath=[],wPath=[],low=Math.min(postorderNums[v].low,postorderNums[w].low),lim=Math.max(postorderNums[v].lim,postorderNums[w].lim);parent=v;for(;parent=g.parent(parent),vPath.push(parent),parent&&(postorderNums[parent].low>low||lim>postorderNums[parent].lim););lca=parent,parent=w;for(;(parent=g.parent(parent))!==lca;)wPath.push(parent);return{path:vPath.concat(wPath.reverse()),lca:lca}}(g,postorderNums,edgeObj.v,edgeObj.w),path=pathData.path,lca=pathData.lca,pathIdx=0,pathV=path[pathIdx],ascending=!0;v!==edgeObj.w;){if(node=g.node(v),ascending){for(;(pathV=path[pathIdx])!==lca&&g.node(pathV).maxRank<node.rank;)pathIdx++;pathV===lca&&(ascending=!1)}if(!ascending){for(;pathIdx<path.length-1&&g.node(pathV=path[pathIdx+1]).minRank<=node.rank;)pathIdx++;pathV=path[pathIdx]}g.setParent(v,pathV),v=g.successors(v)[0]}})}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),util=__webpack_require__(1);module.exports={run:function(g){var root=util.addDummyNode(g,"root",{},"_root"),depths=function(g){var depths={};return _.each(g.children(),function(v){!function dfs(v,depth){var children=g.children(v);children&&children.length&&_.each(children,function(child){dfs(child,depth+1)});depths[v]=depth}(v,1)}),depths}(g),height=_.max(depths)-1,nodeSep=2*height+1;g.graph().nestingRoot=root,_.each(g.edges(),function(e){g.edge(e).minlen*=nodeSep});var weight=function(g){return _.reduce(g.edges(),function(acc,e){return acc+g.edge(e).weight},0)}(g)+1;_.each(g.children(),function(child){!function dfs(g,root,nodeSep,weight,height,depths,v){var children=g.children(v);if(!children.length)return void(v!==root&&g.setEdge(root,v,{weight:0,minlen:nodeSep}));var top=util.addBorderNode(g,"_bt"),bottom=util.addBorderNode(g,"_bb"),label=g.node(v);g.setParent(top,v);label.borderTop=top;g.setParent(bottom,v);label.borderBottom=bottom;_.each(children,function(child){dfs(g,root,nodeSep,weight,height,depths,child);var childNode=g.node(child),childTop=childNode.borderTop?childNode.borderTop:child,childBottom=childNode.borderBottom?childNode.borderBottom:child,thisWeight=childNode.borderTop?weight:2*weight,minlen=childTop!==childBottom?1:height-depths[v]+1;g.setEdge(top,childTop,{weight:thisWeight,minlen:minlen,nestingEdge:!0}),g.setEdge(childBottom,bottom,{weight:thisWeight,minlen:minlen,nestingEdge:!0})});g.parent(v)||g.setEdge(root,top,{weight:0,minlen:height+depths[v]})}(g,root,nodeSep,weight,height,depths,child)}),g.graph().nodeRankFactor=nodeSep},cleanup:function(g){var graphLabel=g.graph();g.removeNode(graphLabel.nestingRoot),delete graphLabel.nestingRoot,_.each(g.edges(),function(e){g.edge(e).nestingEdge&&g.removeEdge(e)})}}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),util=__webpack_require__(1);function addBorderNode(g,prop,prefix,sg,sgNode,rank){var label={width:0,height:0,rank:rank,borderType:prop},prev=sgNode[prop][rank-1],curr=util.addDummyNode(g,"border",label,prefix);sgNode[prop][rank]=curr,g.setParent(curr,sg),prev&&g.setEdge(prev,curr,{weight:1})}module.exports=function(g){_.each(g.children(),function dfs(v){var children=g.children(v),node=g.node(v);if(children.length&&_.each(children,dfs),_.has(node,"minRank")){node.borderLeft=[],node.borderRight=[];for(var rank=node.minRank,maxRank=node.maxRank+1;rank<maxRank;++rank)addBorderNode(g,"borderLeft","_bl",v,node,rank),addBorderNode(g,"borderRight","_br",v,node,rank)}})}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0);function swapWidthHeight(g){_.each(g.nodes(),function(v){swapWidthHeightOne(g.node(v))}),_.each(g.edges(),function(e){swapWidthHeightOne(g.edge(e))})}function swapWidthHeightOne(attrs){var w=attrs.width;attrs.width=attrs.height,attrs.height=w}function reverseYOne(attrs){attrs.y=-attrs.y}function swapXYOne(attrs){var x=attrs.x;attrs.x=attrs.y,attrs.y=x}module.exports={adjust:function(g){var rankDir=g.graph().rankdir.toLowerCase();"lr"!==rankDir&&"rl"!==rankDir||swapWidthHeight(g)},undo:function(g){var rankDir=g.graph().rankdir.toLowerCase();"bt"!==rankDir&&"rl"!==rankDir||function(g){_.each(g.nodes(),function(v){reverseYOne(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,reverseYOne),_.has(edge,"y")&&reverseYOne(edge)})}(g);"lr"!==rankDir&&"rl"!==rankDir||(function(g){_.each(g.nodes(),function(v){swapXYOne(g.node(v))}),_.each(g.edges(),function(e){var edge=g.edge(e);_.each(edge.points,swapXYOne),_.has(edge,"x")&&swapXYOne(edge)})}(g),swapWidthHeight(g))}}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),initOrder=__webpack_require__(47),crossCount=__webpack_require__(48),sortSubgraph=__webpack_require__(49),buildLayerGraph=__webpack_require__(53),addSubgraphConstraints=__webpack_require__(54),Graph=__webpack_require__(3).Graph,util=__webpack_require__(1);function buildLayerGraphs(g,ranks,relationship){return _.map(ranks,function(rank){return buildLayerGraph(g,rank,relationship)})}function sweepLayerGraphs(layerGraphs,biasRight){var cg=new Graph;_.each(layerGraphs,function(lg){var root=lg.graph().root,sorted=sortSubgraph(lg,root,cg,biasRight);_.each(sorted.vs,function(v,i){lg.node(v).order=i}),addSubgraphConstraints(lg,cg,sorted.vs)})}function assignOrder(g,layering){_.each(layering,function(layer){_.each(layer,function(v,i){g.node(v).order=i})})}module.exports=function(g){var maxRank=util.maxRank(g),downLayerGraphs=buildLayerGraphs(g,_.range(1,maxRank+1),"inEdges"),upLayerGraphs=buildLayerGraphs(g,_.range(maxRank-1,-1,-1),"outEdges"),layering=initOrder(g);assignOrder(g,layering);for(var best,bestCC=Number.POSITIVE_INFINITY,i=0,lastBest=0;lastBest<4;++i,++lastBest){sweepLayerGraphs(i%2?downLayerGraphs:upLayerGraphs,2<=i%4),layering=util.buildLayerMatrix(g);var cc=crossCount(g,layering);cc<bestCC&&(lastBest=0,best=_.cloneDeep(layering),bestCC=cc)}assignOrder(g,best)}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0);module.exports=function(g){var visited={},simpleNodes=_.filter(g.nodes(),function(v){return!g.children(v).length}),maxRank=_.max(_.map(simpleNodes,function(v){return g.node(v).rank})),layers=_.map(_.range(maxRank+1),function(){return[]});var orderedVs=_.sortBy(simpleNodes,function(v){return g.node(v).rank});return _.each(orderedVs,function dfs(v){if(_.has(visited,v))return;visited[v]=!0;var node=g.node(v);layers[node.rank].push(v);_.each(g.successors(v),dfs)}),layers}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0);function twoLayerCrossCount(g,northLayer,southLayer){for(var southPos=_.zipObject(southLayer,_.map(southLayer,function(v,i){return i})),southEntries=_.flatten(_.map(northLayer,function(v){return _.chain(g.outEdges(v)).map(function(e){return{pos:southPos[e.w],weight:g.edge(e).weight}}).sortBy("pos").value()}),!0),firstIndex=1;firstIndex<southLayer.length;)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=_.map(new Array(treeSize),function(){return 0}),cc=0;return _.each(southEntries.forEach(function(entry){var index=entry.pos+firstIndex;tree[index]+=entry.weight;for(var weightSum=0;0<index;)index%2&&(weightSum+=tree[index+1]),tree[index=index-1>>1]+=entry.weight;cc+=entry.weight*weightSum})),cc}module.exports=function(g,layering){for(var cc=0,i=1;i<layering.length;++i)cc+=twoLayerCrossCount(g,layering[i-1],layering[i]);return cc}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),barycenter=__webpack_require__(50),resolveConflicts=__webpack_require__(51),sort=__webpack_require__(52);function expandSubgraphs(entries,subgraphs){_.each(entries,function(entry){entry.vs=_.flatten(entry.vs.map(function(v){return subgraphs[v]?subgraphs[v].vs:v}),!0)})}function mergeBarycenters(target,other){_.isUndefined(target.barycenter)?(target.barycenter=other.barycenter,target.weight=other.weight):(target.barycenter=(target.barycenter*target.weight+other.barycenter*other.weight)/(target.weight+other.weight),target.weight+=other.weight)}module.exports=function sortSubgraph(g,v,cg,biasRight){var movable=g.children(v),node=g.node(v),bl=node?node.borderLeft:void 0,br=node?node.borderRight:void 0,subgraphs={};bl&&(movable=_.filter(movable,function(w){return w!==bl&&w!==br}));var barycenters=barycenter(g,movable);_.each(barycenters,function(entry){if(g.children(entry.v).length){var subgraphResult=sortSubgraph(g,entry.v,cg,biasRight);subgraphs[entry.v]=subgraphResult,_.has(subgraphResult,"barycenter")&&mergeBarycenters(entry,subgraphResult)}});var entries=resolveConflicts(barycenters,cg);expandSubgraphs(entries,subgraphs);var result=sort(entries,biasRight);if(bl&&(result.vs=_.flatten([bl,result.vs,br],!0),g.predecessors(bl).length)){var blPred=g.node(g.predecessors(bl)[0]),brPred=g.node(g.predecessors(br)[0]);_.has(result,"barycenter")||(result.barycenter=0,result.weight=0),result.barycenter=(result.barycenter*result.weight+blPred.order+brPred.order)/(result.weight+2),result.weight+=2}return result}},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(g,movable){return _.map(movable,function(v){var inV=g.inEdges(v);if(inV.length){var result=_.reduce(inV,function(acc,e){var edge=g.edge(e),nodeU=g.node(e.v);return{sum:acc.sum+edge.weight*nodeU.order,weight:acc.weight+edge.weight}},{sum:0,weight:0});return{v:v,barycenter:result.sum/result.weight,weight:result.weight}}return{v:v}})}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0);module.exports=function(entries,cg){var mappedEntries={};return _.each(entries,function(entry,i){var tmp=mappedEntries[entry.v]={indegree:0,in:[],out:[],vs:[entry.v],i:i};_.isUndefined(entry.barycenter)||(tmp.barycenter=entry.barycenter,tmp.weight=entry.weight)}),_.each(cg.edges(),function(e){var entryV=mappedEntries[e.v],entryW=mappedEntries[e.w];_.isUndefined(entryV)||_.isUndefined(entryW)||(entryW.indegree++,entryV.out.push(mappedEntries[e.w]))}),function(sourceSet){var entries=[];function handleIn(vEntry){return function(uEntry){uEntry.merged||(_.isUndefined(uEntry.barycenter)||_.isUndefined(vEntry.barycenter)||uEntry.barycenter>=vEntry.barycenter)&&function(target,source){var sum=0,weight=0;target.weight&&(sum+=target.barycenter*target.weight,weight+=target.weight);source.weight&&(sum+=source.barycenter*source.weight,weight+=source.weight);target.vs=source.vs.concat(target.vs),target.barycenter=sum/weight,target.weight=weight,target.i=Math.min(source.i,target.i),source.merged=!0}(vEntry,uEntry)}}function handleOut(vEntry){return function(wEntry){wEntry.in.push(vEntry),0==--wEntry.indegree&&sourceSet.push(wEntry)}}for(;sourceSet.length;){var entry=sourceSet.pop();entries.push(entry),_.each(entry.in.reverse(),handleIn(entry)),_.each(entry.out,handleOut(entry))}return _.chain(entries).filter(function(entry){return!entry.merged}).map(function(entry){return _.pick(entry,["vs","i","barycenter","weight"])}).value()}(_.filter(mappedEntries,function(entry){return!entry.indegree}))}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),util=__webpack_require__(1);function consumeUnsortable(vs,unsortable,index){for(var last;unsortable.length&&(last=_.last(unsortable)).i<=index;)unsortable.pop(),vs.push(last.vs),index++;return index}module.exports=function(entries,biasRight){var parts=util.partition(entries,function(entry){return _.has(entry,"barycenter")}),sortable=parts.lhs,unsortable=_.sortBy(parts.rhs,function(entry){return-entry.i}),vs=[],sum=0,weight=0,vsIndex=0;sortable.sort(function(bias){return function(entryV,entryW){return entryV.barycenter<entryW.barycenter?-1:entryV.barycenter>entryW.barycenter?1:bias?entryW.i-entryV.i:entryV.i-entryW.i}}(!!biasRight)),vsIndex=consumeUnsortable(vs,unsortable,vsIndex),_.each(sortable,function(entry){vsIndex+=entry.vs.length,vs.push(entry.vs),sum+=entry.barycenter*entry.weight,weight+=entry.weight,vsIndex=consumeUnsortable(vs,unsortable,vsIndex)});var result={vs:_.flatten(vs,!0)};weight&&(result.barycenter=sum/weight,result.weight=weight);return result}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),Graph=__webpack_require__(3).Graph;module.exports=function(g,rank,relationship){var root=function(g){var v;for(;g.hasNode(v=_.uniqueId("_root")););return v}(g),result=new Graph({compound:!0}).setGraph({root:root}).setDefaultNodeLabel(function(v){return g.node(v)});return _.each(g.nodes(),function(v){var node=g.node(v),parent=g.parent(v);(node.rank===rank||node.minRank<=rank&&rank<=node.maxRank)&&(result.setNode(v),result.setParent(v,parent||root),_.each(g[relationship](v),function(e){var u=e.v===v?e.w:e.v,edge=result.edge(u,v),weight=_.isUndefined(edge)?0:edge.weight;result.setEdge(u,v,{weight:g.edge(e).weight+weight})}),_.has(node,"minRank")&&result.setNode(v,{borderLeft:node.borderLeft[rank],borderRight:node.borderRight[rank]}))}),result}},function(module,exports,__webpack_require__){var _=__webpack_require__(0);module.exports=function(g,cg,vs){var rootPrev,prev={};_.each(vs,function(v){for(var parent,prevChild,child=g.parent(v);child;){if((parent=g.parent(child))?(prevChild=prev[parent],prev[parent]=child):(prevChild=rootPrev,rootPrev=child),prevChild&&prevChild!==child)return void cg.setEdge(prevChild,child);child=parent}})}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),util=__webpack_require__(1),positionX=__webpack_require__(56).positionX;module.exports=function(g){(function(g){var layering=util.buildLayerMatrix(g),rankSep=g.graph().ranksep,prevY=0;_.each(layering,function(layer){var maxHeight=_.max(_.map(layer,function(v){return g.node(v).height}));_.each(layer,function(v){g.node(v).y=prevY+maxHeight/2}),prevY+=maxHeight+rankSep})})(g=util.asNonCompoundGraph(g)),_.each(positionX(g),function(x,v){g.node(v).x=x})}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(0),Graph=__webpack_require__(3).Graph,util=__webpack_require__(1);function findType1Conflicts(g,layering){var conflicts={};return _.reduce(layering,function(prevLayer,layer){var k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);return _.each(layer,function(v,i){var w=function(g,v){if(g.node(v).dummy)return _.find(g.predecessors(v),function(u){return g.node(u).dummy})}(g,v),k1=w?g.node(w).order:prevLayerLength;!w&&v!==lastNode||(_.each(layer.slice(scanPos,i+1),function(scanNode){_.each(g.predecessors(scanNode),function(u){var uLabel=g.node(u),uPos=uLabel.order;!(uPos<k0||k1<uPos)||uLabel.dummy&&g.node(scanNode).dummy||addConflict(conflicts,u,scanNode)})}),scanPos=i+1,k0=k1)}),layer}),conflicts}function findType2Conflicts(g,layering){var conflicts={};function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.each(_.range(southPos,southEnd),function(i){v=south[i],g.node(v).dummy&&_.each(g.predecessors(v),function(u){var uNode=g.node(u);uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)&&addConflict(conflicts,u,v)})})}return _.reduce(layering,function(north,south){var nextNorthPos,prevNorthPos=-1,southPos=0;return _.each(south,function(v,southLookahead){if("border"===g.node(v).dummy){var predecessors=g.predecessors(v);predecessors.length&&(nextNorthPos=g.node(predecessors[0]).order,scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos),southPos=southLookahead,prevNorthPos=nextNorthPos)}scan(south,southPos,south.length,nextNorthPos,north.length)}),south}),conflicts}function addConflict(conflicts,v,w){if(w<v){var tmp=v;v=w,w=tmp}var conflictsV=conflicts[v];conflictsV||(conflicts[v]=conflictsV={}),conflictsV[w]=!0}function hasConflict(conflicts,v,w){if(w<v){var tmp=v;v=w,w=tmp}return _.has(conflicts[v],w)}function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};return _.each(layering,function(layer){_.each(layer,function(v,order){root[v]=v,align[v]=v,pos[v]=order})}),_.each(layering,function(layer){var prevIdx=-1;_.each(layer,function(v){var ws=neighborFn(v);if(ws.length)for(var mp=((ws=_.sortBy(ws,function(w){return pos[w]})).length-1)/2,i=Math.floor(mp),il=Math.ceil(mp);i<=il;++i){var w=ws[i];align[v]===v&&prevIdx<pos[w]&&!hasConflict(conflicts,v,w)&&(align[w]=v,align[v]=root[v]=root[w],prevIdx=pos[w])}})}),{root:root,align:align}}function horizontalCompaction(g,layering,root,align,reverseSep){var xs={},blockG=function(g,layering,root,reverseSep){var blockGraph=new Graph,graphLabel=g.graph(),sepFn=function(nodeSep,edgeSep,reverseSep){return function(g,v,w){var delta,vLabel=g.node(v),wLabel=g.node(w),sum=0;if(sum+=vLabel.width/2,_.has(vLabel,"labelpos"))switch(vLabel.labelpos.toLowerCase()){case"l":delta=-vLabel.width/2;break;case"r":delta=vLabel.width/2}if(delta&&(sum+=reverseSep?delta:-delta),delta=0,sum+=(vLabel.dummy?edgeSep:nodeSep)/2,sum+=(wLabel.dummy?edgeSep:nodeSep)/2,sum+=wLabel.width/2,_.has(wLabel,"labelpos"))switch(wLabel.labelpos.toLowerCase()){case"l":delta=wLabel.width/2;break;case"r":delta=-wLabel.width/2}return delta&&(sum+=reverseSep?delta:-delta),delta=0,sum}}(graphLabel.nodesep,graphLabel.edgesep,reverseSep);return _.each(layering,function(layer){var u;_.each(layer,function(v){var vRoot=root[v];if(blockGraph.setNode(vRoot),u){var uRoot=root[u],prevMax=blockGraph.edge(uRoot,vRoot);blockGraph.setEdge(uRoot,vRoot,Math.max(sepFn(g,v,u),prevMax||0))}u=v})}),blockGraph}(g,layering,root,reverseSep),visited={};_.each(blockG.nodes(),function pass1(v){_.has(visited,v)||(visited[v]=!0,xs[v]=_.reduce(blockG.inEdges(v),function(max,e){return pass1(e.v),Math.max(max,xs[e.v]+blockG.edge(e))},0))});var borderType=reverseSep?"borderLeft":"borderRight";return _.each(blockG.nodes(),function pass2(v){if(2!==visited[v]){visited[v]++;var node=g.node(v),min=_.reduce(blockG.outEdges(v),function(min,e){return pass2(e.w),Math.min(min,xs[e.w]-blockG.edge(e))},Number.POSITIVE_INFINITY);min!==Number.POSITIVE_INFINITY&&node.borderType!==borderType&&(xs[v]=Math.max(xs[v],min))}}),_.each(align,function(v){xs[v]=xs[root[v]]}),xs}function findSmallestWidthAlignment(g,xss){return _.min(xss,function(xs){var min=_.min(xs,function(x,v){return x-width(g,v)/2});return _.max(xs,function(x,v){return x+width(g,v)/2})-min})}function alignCoordinates(xss,alignTo){var alignToMin=_.min(alignTo),alignToMax=_.max(alignTo);_.each(["u","d"],function(vert){_.each(["l","r"],function(horiz){var delta,alignment=vert+horiz,xs=xss[alignment];xs!==alignTo&&(delta="l"===horiz?alignToMin-_.min(xs):alignToMax-_.max(xs))&&(xss[alignment]=_.mapValues(xs,function(x){return x+delta}))})})}function balance(xss,align){return _.mapValues(xss.ul,function(ignore,v){if(align)return xss[align.toLowerCase()][v];var xs=_.sortBy(_.pluck(xss,v));return(xs[1]+xs[2])/2})}function width(g,v){return g.node(v).width}module.exports={positionX:function(g){var adjustedLayering,layering=util.buildLayerMatrix(g),conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering)),xss={};_.each(["u","d"],function(vert){adjustedLayering="u"===vert?layering:_.values(layering).reverse(),_.each(["l","r"],function(horiz){"r"===horiz&&(adjustedLayering=_.map(adjustedLayering,function(inner){return _.values(inner).reverse()}));var neighborFn=_.bind("u"===vert?g.predecessors:g.successors,g),align=verticalAlignment(g,adjustedLayering,conflicts,neighborFn),xs=horizontalCompaction(g,adjustedLayering,align.root,align.align,"r"===horiz);"r"===horiz&&(xs=_.mapValues(xs,function(x){return-x})),xss[vert+horiz]=xs})});var smallestWidth=findSmallestWidthAlignment(g,xss);return alignCoordinates(xss,smallestWidth),balance(xss,g.graph().align)},findType1Conflicts:findType1Conflicts,findType2Conflicts:findType2Conflicts,addConflict:addConflict,hasConflict:hasConflict,verticalAlignment:verticalAlignment,horizontalCompaction:horizontalCompaction,alignCoordinates:alignCoordinates,findSmallestWidthAlignment:findSmallestWidthAlignment,balance:balance}},function(module,exports,__webpack_require__){var _=__webpack_require__(0),util=__webpack_require__(1),Graph=__webpack_require__(3).Graph;module.exports={debugOrdering:function(g){var layerMatrix=util.buildLayerMatrix(g),h=new Graph({compound:!0,multigraph:!0}).setGraph({});return _.each(g.nodes(),function(v){h.setNode(v,{label:v}),h.setParent(v,"layer"+g.node(v).rank)}),_.each(g.edges(),function(e){h.setEdge(e.v,e.w,{},e.name)}),_.each(layerMatrix,function(layer,i){var layerV="layer"+i;h.setNode(layerV,{rank:"same"}),_.reduce(layer,function(u,v){return h.setEdge(u,v,{style:"invis"}),v})}),h}}},function(module,exports){module.exports="0.7.4"},function(module,exports,__webpack_require__){"use strict";var punycode=__webpack_require__(60),util=__webpack_require__(61);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=__webpack_require__(62);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf("?"),splitter=-1!==queryIndex&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,"/");var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split("#").length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search="",this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)127<part.charCodeAt(j)?newpart+="x":newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){p=this.pathname||"";var s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host=host||"",hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace("#","%23"))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];"protocol"!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],psychotic=(relPath=relative.pathname&&relative.pathname.split("/")||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)(srcPath=srcPath||[]).pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||1<srcPath.length)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;0<=i;i--)"."===(last=srcPath[i])?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var authInHost,isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"",(authInHost=!!(result.host&&0<result.host.indexOf("@"))&&result.host.split("@"))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(":"!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},function(module,exports,__webpack_require__){(function(module,global){var __WEBPACK_AMD_DEFINE_RESULT__;/*! https://mths.be/punycode v1.4.1 by @mathias */!function(){exports&&exports.nodeType,module&&module.nodeType;var freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self;var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";return 1<parts.length&&(result=parts[0]+"@",string=parts[1]),result+map((string=string.replace(regexSeparators,".")).split("."),fn).join(".")}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)55296<=(value=string.charCodeAt(counter++))&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return 65535<value&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);baseMinusTMin*tMax>>1<delta;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for((basic=input.lastIndexOf(delimiter))<0&&(basic=0),j=0;j<basic;++j)128<=input.charCodeAt(j)&&error("not-basic"),output.push(input.charCodeAt(j));for(index=0<basic?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;inputLength<=index&&error("invalid-input"),codePoint=input.charCodeAt(index++),(base<=(digit=codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base)||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,!(digit<(t=k<=bias?tMin:bias+tMax<=k?tMax:k-bias));k+=base)w>floor(maxInt/(baseMinusT=base-t))&&error("overflow"),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=initialN,bias=initialBias,j=delta=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)n<=(currentValue=input[j])&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:bias+tMax<=k?tMax:k-bias));k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}},void 0===(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module))||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}()}).call(this,__webpack_require__(4)(module),__webpack_require__(6))},function(module,exports,__webpack_require__){"use strict";module.exports={isString:function(arg){return"string"==typeof arg},isObject:function(arg){return"object"==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg}}},function(module,exports,__webpack_require__){"use strict";exports.decode=exports.parse=__webpack_require__(63),exports.encode=exports.stringify=__webpack_require__(64)},function(module,exports,__webpack_require__){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;0<maxKeys&&maxKeys<len&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);vstr=0<=idx?(kstr=x.substr(0,idx),x.substr(idx+1)):(kstr=x,""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},function(module,exports,__webpack_require__){"use strict";function stringifyPrimitive(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}}module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}}]));
//# sourceMappingURL=vendors.bundle.js.map